/*
 * ATTENTION: The "eval" devtool has been used (maybe by default in mode: "development").
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
/******/ (function() { // webpackBootstrap
/******/ 	"use strict";
/******/ 	var __webpack_modules__ = ({

/***/ "./src/blendfuncs/add.js":
/*!*******************************!*\
  !*** ./src/blendfuncs/add.js ***!
  \*******************************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var _hdrpaint_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../hdrpaint.js */ \"./src/hdrpaint.js\");\n\n_hdrpaint_js__WEBPACK_IMPORTED_MODULE_0__[\"default\"].blendfuncs[\"add\"] = function (dst, d_idx, src, s_idx, alpha, power) {\n  var src_alpha = src[s_idx + 3] * alpha;\n  var dst_r = 1 - src_alpha;\n  var src_r = power * src_alpha;\n  dst[d_idx + 0] = dst[d_idx + 0] + src[s_idx + 0] * src_r;\n  dst[d_idx + 1] = dst[d_idx + 1] + src[s_idx + 1] * src_r;\n  dst[d_idx + 2] = dst[d_idx + 2] + src[s_idx + 2] * src_r;\n};\n\n//# sourceURL=webpack://hdrpaint/./src/blendfuncs/add.js?");

/***/ }),

/***/ "./src/blendfuncs/mul.js":
/*!*******************************!*\
  !*** ./src/blendfuncs/mul.js ***!
  \*******************************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var _hdrpaint_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../hdrpaint.js */ \"./src/hdrpaint.js\");\n\n_hdrpaint_js__WEBPACK_IMPORTED_MODULE_0__[\"default\"].blendfuncs[\"mul\"] = function (dst, d_idx, src, s_idx, alpha, power) {\n  var src_alpha = src[s_idx + 3] * alpha;\n  var dst_r = 1 - src_alpha;\n  var src_r = power * src_alpha;\n  dst[d_idx + 0] = dst[d_idx + 0] * (dst_r + src[s_idx + 0] * src_r);\n  dst[d_idx + 1] = dst[d_idx + 1] * (dst_r + src[s_idx + 1] * src_r);\n  dst[d_idx + 2] = dst[d_idx + 2] * (dst_r + src[s_idx + 2] * src_r);\n};\n\n//# sourceURL=webpack://hdrpaint/./src/blendfuncs/mul.js?");

/***/ }),

/***/ "./src/blendfuncs/normal.js":
/*!**********************************!*\
  !*** ./src/blendfuncs/normal.js ***!
  \**********************************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var _hdrpaint_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../hdrpaint.js */ \"./src/hdrpaint.js\");\n\n_hdrpaint_js__WEBPACK_IMPORTED_MODULE_0__[\"default\"].blendfuncs[\"normal\"] = function (dst, d_idx, src, s_idx, alpha, power) {\n  var src_alpha = src[s_idx + 3] * alpha;\n  var sa = src[s_idx + 3] * alpha;\n  var da = dst[d_idx + 3] * (1 - sa);\n  var dst_r = 1 - sa;\n  var r = da + sa;\n  if (r == 0) {\n    return;\n  }\n  r = 1 / r;\n  da *= r;\n  sa *= r;\n  sa = power * sa;\n  dst[d_idx + 0] = dst[d_idx + 0] * da + src[s_idx + 0] * sa;\n  dst[d_idx + 1] = dst[d_idx + 1] * da + src[s_idx + 1] * sa;\n  dst[d_idx + 2] = dst[d_idx + 2] * da + src[s_idx + 2] * sa;\n  dst[d_idx + 3] = dst[d_idx + 3] * dst_r + src_alpha;\n};\n\n//# sourceURL=webpack://hdrpaint/./src/blendfuncs/normal.js?");

/***/ }),

/***/ "./src/blendfuncs/sub.js":
/*!*******************************!*\
  !*** ./src/blendfuncs/sub.js ***!
  \*******************************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var _hdrpaint_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../hdrpaint.js */ \"./src/hdrpaint.js\");\n\n_hdrpaint_js__WEBPACK_IMPORTED_MODULE_0__[\"default\"].blendfuncs[\"sub\"] = function (dst, d_idx, src, s_idx, alpha, power) {\n  var src_alpha = src[s_idx + 3] * alpha;\n  var dst_r = 1 - src_alpha;\n  var src_r = power * src_alpha;\n  dst[d_idx + 0] = dst[d_idx + 0] - src[s_idx + 0] * src_r;\n  dst[d_idx + 1] = dst[d_idx + 1] - src[s_idx + 1] * src_r;\n  dst[d_idx + 2] = dst[d_idx + 2] - src[s_idx + 2] * src_r;\n};\n\n//# sourceURL=webpack://hdrpaint/./src/blendfuncs/sub.js?");

/***/ }),

/***/ "./src/blendfuncs/transmit.js":
/*!************************************!*\
  !*** ./src/blendfuncs/transmit.js ***!
  \************************************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var _hdrpaint_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../hdrpaint.js */ \"./src/hdrpaint.js\");\n\n_hdrpaint_js__WEBPACK_IMPORTED_MODULE_0__[\"default\"].blendfuncs[\"transmit\"] = function (dst, d_idx, src, s_idx, alpha, power) {\n  var src_alpha = src[s_idx + 3] * alpha;\n  var dst_r = 1 - src_alpha;\n  var src_r = power * src_alpha;\n  dst[d_idx + 0] = dst[d_idx + 0] * dst_r * src[s_idx + 0] + src[s_idx + 0] * src_r;\n  dst[d_idx + 1] = dst[d_idx + 1] * dst_r * src[s_idx + 1] + src[s_idx + 1] * src_r;\n  dst[d_idx + 2] = dst[d_idx + 2] * dst_r * src[s_idx + 2] + src[s_idx + 2] * src_r;\n  dst[d_idx + 3] = dst[d_idx + 3] * dst_r + src_alpha;\n};\n\n//# sourceURL=webpack://hdrpaint/./src/blendfuncs/transmit.js?");

/***/ }),

/***/ "./src/brush.js":
/*!**********************!*\
  !*** ./src/brush.js ***!
  \**********************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": function() { return /* binding */ Brush; }\n/* harmony export */ });\n/* harmony import */ var _lib_util_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./lib/util.js */ \"./src/lib/util.js\");\n/* harmony import */ var _lib_vector_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./lib/vector.js */ \"./src/lib/vector.js\");\n/* harmony import */ var _lib_img_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./lib/img.js */ \"./src/lib/img.js\");\n/* harmony import */ var _commandlog_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./commandlog.js */ \"./src/commandlog.js\");\n/* harmony import */ var _hdrpaint_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./hdrpaint.js */ \"./src/hdrpaint.js\");\n/* harmony import */ var _redraw_js__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./redraw.js */ \"./src/redraw.js\");\n/* harmony import */ var _layer_js__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./layer.js */ \"./src/layer.js\");\n\n\n\n\n\n\n\nlet refresh_flg = false;\nlet pen_preview_img;\nlet pen_preview_command; //ブラシの描画プレビュー作成用のコマンドオブジェクト\nlet brush_id_count = 0;\nvar getBrushFromDiv = function (div) {\n  var result_brush = null;\n  return _hdrpaint_js__WEBPACK_IMPORTED_MODULE_4__[\"default\"].brushes.find(function (a) {\n    return a.dom === div;\n  });\n};\nvar brushselect = function (e) {\n  //ブラシー一覧クリック時、クリックされたものをアクティブ化する\n\n  var brush = getBrushFromDiv(e.currentTarget);\n  brush.select();\n  e.stopPropagation();\n};\nvar drag_brush = null;\nvar DragStart = function (event) {\n  //ドラッグ開始\n  drag_brush = getBrushFromDiv(event.currentTarget);\n  //     event.dataTransfer.setData(\"text\", drag_brush.id);\n\n  event.stopPropagation();\n};\n//ドラッグ＆ドロップによるブラシ順編集\nvar dragover_handler = function (event) {\n  event.preventDefault();\n  event.dataTransfer.dropEffect = \"move\";\n};\nvar DragEnter = function (event) {\n  //ドラッグ移動時\n  var drop_brush = getBrushFromDiv(event.currentTarget);\n  event.stopPropagation();\n  if (drag_brush === drop_brush) {\n    //自分自身の場合は無視\n    return;\n  }\n  var num = _hdrpaint_js__WEBPACK_IMPORTED_MODULE_4__[\"default\"].brushes.indexOf(drag_brush);\n  var num2 = _hdrpaint_js__WEBPACK_IMPORTED_MODULE_4__[\"default\"].brushes.indexOf(drop_brush);\n  _hdrpaint_js__WEBPACK_IMPORTED_MODULE_4__[\"default\"].brushes.splice(num, 1);\n  _hdrpaint_js__WEBPACK_IMPORTED_MODULE_4__[\"default\"].brushes.splice(num2, 0, drag_brush);\n  Brush.refreshBrush();\n};\nclass Brush {\n  //ブラシ\n  constructor() {\n    this.name = \"\";\n    this.color_effect = [1, 1, 1, 1];\n    this.weight = 3.0;\n    this.softness = 0.0;\n    this.overlap = 0;\n    this.alpha = 1.0;\n    this.antialias = 0;\n    this.eraser = 0;\n    this.weight_pressure_effect = 0;\n    this.alpha_pressure_effect = 0;\n    this.stroke_correction = 1;\n    this.stroke_interpolation = 1;\n    this.shortcut = '';\n    var html = ` \n\t\t\t\t<img draggable=\"false\">\n\t\t\t\t<span class=\"name\"></span>\n\t\t\t\t<div class=\"attributes\"></div>\n\t\t\t`;\n    var dom = document.createElement(\"div\");\n    dom.insertAdjacentHTML('beforeend', html);\n    dom.classList.add(\"brush\");\n    dom.setAttribute(\"draggable\", \"true\");\n    dom.addEventListener(\"click\", brushselect);\n    dom.addEventListener(\"dragstart\", DragStart);\n    dom.addEventListener(\"dragover\", dragover_handler);\n    dom.addEventListener(\"dragenter\", DragEnter);\n\n    //binder.bindNodes(dom,this);\n    binder.bind(dom.querySelector(\".name\"), \"\", this, [\"shortcut\", \"name\"], function (variables) {\n      return \"[\" + variables[0] + \"]\" + variables[1];\n    });\n    this.dom = dom;\n  }\n  static init() {\n    document.querySelector(\"#up_brush\").addEventListener(\"click\", function () {\n      var num = _hdrpaint_js__WEBPACK_IMPORTED_MODULE_4__[\"default\"].brushes.indexOf(_hdrpaint_js__WEBPACK_IMPORTED_MODULE_4__[\"default\"].selected_brush);\n      if (num <= 0) {\n        return;\n      }\n      _hdrpaint_js__WEBPACK_IMPORTED_MODULE_4__[\"default\"].brushes.splice(num, 1);\n      _hdrpaint_js__WEBPACK_IMPORTED_MODULE_4__[\"default\"].brushes.splice(num - 1, 0, _hdrpaint_js__WEBPACK_IMPORTED_MODULE_4__[\"default\"].selected_brush);\n      Brush.refreshBrush();\n    });\n    document.querySelector(\"#down_brush\").addEventListener(\"click\", function () {\n      var num = _hdrpaint_js__WEBPACK_IMPORTED_MODULE_4__[\"default\"].brushes.indexOf(_hdrpaint_js__WEBPACK_IMPORTED_MODULE_4__[\"default\"].selected_brush);\n      if (num + 1 >= _hdrpaint_js__WEBPACK_IMPORTED_MODULE_4__[\"default\"].brushes.length) {\n        return;\n      }\n      _hdrpaint_js__WEBPACK_IMPORTED_MODULE_4__[\"default\"].brushes.splice(num, 1);\n      _hdrpaint_js__WEBPACK_IMPORTED_MODULE_4__[\"default\"].brushes.splice(num + 1, 0, _hdrpaint_js__WEBPACK_IMPORTED_MODULE_4__[\"default\"].selected_brush);\n      Brush.refreshBrush();\n    });\n    document.querySelector(\"#overwrite_brush\").addEventListener(\"click\", function () {\n      _hdrpaint_js__WEBPACK_IMPORTED_MODULE_4__[\"default\"].selected_brush.overwrite();\n    });\n    document.querySelector(\"#create_brush\").addEventListener(\"click\", function () {\n      var brush = Brush.create();\n      _hdrpaint_js__WEBPACK_IMPORTED_MODULE_4__[\"default\"].brushes.push(brush);\n      brush.overwrite();\n      brush.select();\n      Brush.refreshBrush();\n    });\n    document.querySelector(\"#delete_brush\").addEventListener(\"click\", function () {\n      _hdrpaint_js__WEBPACK_IMPORTED_MODULE_4__[\"default\"].selected_brush.delete();\n    });\n\n    //ブラシプレビュー準備\n    pen_preview_command = new _hdrpaint_js__WEBPACK_IMPORTED_MODULE_4__[\"default\"].commandObjs.brush();\n    var param = pen_preview_command.param;\n    var pen_preview = document.getElementById('pen_preview');\n    pen_preview_img = hdrpaint.createImg(pen_preview.width, pen_preview.height);\n    param.img_id = pen_preview_img.id;\n    var points = [];\n    var xs = [-1, -0.7, -0.3, 0.3, 0.7, 1];\n    for (var i = 0; i < xs.length; i++) {\n      var x = xs[i];\n      var point = {\n        \"pos\": new _lib_vector_js__WEBPACK_IMPORTED_MODULE_1__.Vec2(),\n        \"pressure\": 0\n      };\n      point.pos[0] = (x * 0.8 + 1) * (pen_preview.width >>> 1);\n      point.pos[1] = (Math.sin(x * Math.PI) * 0.7 + 1) * (pen_preview.height >>> 1);\n      point.pressure = 1 - i / (xs.length - 1);\n      points.push(point);\n    }\n    param.points = points;\n    param.color_effect = new Float32Array([1.0, 1.0, 1.0, 1.0]);\n    param.undo_data = {};\n  }\n  //削除\n  delete() {\n    var num = _hdrpaint_js__WEBPACK_IMPORTED_MODULE_4__[\"default\"].brushes.indexOf(this);\n    _hdrpaint_js__WEBPACK_IMPORTED_MODULE_4__[\"default\"].brushes.splice(num, 1);\n    if (num >= _hdrpaint_js__WEBPACK_IMPORTED_MODULE_4__[\"default\"].brushes.length) {\n      num = _hdrpaint_js__WEBPACK_IMPORTED_MODULE_4__[\"default\"].brushes.length - 1;\n    }\n    if (num >= 0) {\n      _hdrpaint_js__WEBPACK_IMPORTED_MODULE_4__[\"default\"].brushes[num].select();\n    }\n    Brush.refreshBrush();\n  }\n\n  //現在のブラシID 作るたびインクリメントされる\n  static create() {\n    var brush = new Brush();\n    brush.id = brush_id_count;\n    brush_id_count++;\n    //Hdrpaint.brushes.push(brush);\n\n    brush.name = \"brush\" + (\"0000\" + brush.id).slice(-4);\n    Brush.refreshBrush(brush);\n    //refreshBrush();\n    //brush.select();\n\n    return brush;\n  }\n  refresh() {\n    Brush.refreshBrush(this);\n    Brush.refreshPen(this);\n  }\n  overwrite() {\n    //現在の内容でアクティブブラシを上書き\n    var brush = this;\n    var members = Object.keys(_hdrpaint_js__WEBPACK_IMPORTED_MODULE_4__[\"default\"].brush_status);\n    members.forEach(member => {\n      if (member === \"id\") return;\n      brush[member] = _hdrpaint_js__WEBPACK_IMPORTED_MODULE_4__[\"default\"].brush_status[member];\n    });\n    brush.refresh();\n  }\n  delete() {\n    var num = _hdrpaint_js__WEBPACK_IMPORTED_MODULE_4__[\"default\"].brushes.indexOf(_hdrpaint_js__WEBPACK_IMPORTED_MODULE_4__[\"default\"].selected_brush);\n    _hdrpaint_js__WEBPACK_IMPORTED_MODULE_4__[\"default\"].brushes.splice(num, 1);\n    Brush.refreshBrush();\n  }\n  static setParam(param) {\n    var brush = _hdrpaint_js__WEBPACK_IMPORTED_MODULE_4__[\"default\"].brush_status;\n    param.color = new Float32Array(4);\n    param.color[0] = _hdrpaint_js__WEBPACK_IMPORTED_MODULE_4__[\"default\"].color[0];\n    param.color[1] = _hdrpaint_js__WEBPACK_IMPORTED_MODULE_4__[\"default\"].color[1];\n    param.color[2] = _hdrpaint_js__WEBPACK_IMPORTED_MODULE_4__[\"default\"].color[2];\n    param.color[3] = _hdrpaint_js__WEBPACK_IMPORTED_MODULE_4__[\"default\"].color[3];\n    param.weight = Number(brush.weight);\n    param.softness = Number(brush.softness);\n    param.antialias = Number(brush.antialias);\n    param.eraser = Number(brush.eraser);\n    param.alpha = brush.alpha;\n    param.overlap = parseInt(brush.overlap);\n    param.pressure_effect_flgs = 1 * Number(brush.weight_pressure_effect) | 2 * Number(brush.alpha_pressure_effect);\n    param.alpha_pressure_effect = brush.alpha_pressure_effect;\n    param.stroke_interpolation = brush.stroke_interpolation;\n  }\n  static refreshPen(brush) {\n    var param = pen_preview_command.param;\n    if (!brush) {\n      Brush.setParam(param);\n    } else {\n      param.color = new Float32Array([0, 0, 0, 1]);\n      param.weight = parseFloat(brush[\"weight\"]);\n      param.softness = parseFloat(brush[\"softness\"]);\n      param.antialias = brush.antialias;\n      param.alpha = brush.alpha;\n      param.eraser = brush.eraser;\n      param.overlap = parseInt(brush.overlap);\n      param.pressure_effect_flgs = 1 * brush.weight_pressure_effect | 2 * brush.alpha_pressure_effect;\n      param.alpha_pressure_effect = brush.alpha_pressure_effect;\n      param.stroke_interpolation = brush.stroke_interpolation;\n    }\n    _hdrpaint_js__WEBPACK_IMPORTED_MODULE_4__[\"default\"].painted_mask.fill(0);\n    if (param.eraser) {\n      //消しゴムの場合は黒でクリア\n      var data = pen_preview_img.data;\n      var size = data.length;\n      for (var i = 0; i < size; i += 4) {\n        data[i] = 0;\n        data[i + 1] = 0;\n        data[i + 2] = 0;\n        data[i + 3] = 1;\n      }\n    } else {\n      //通常ブラシの場合は透明でクリア\n      pen_preview_img.clear();\n    }\n    var points = pen_preview_command.param.points;\n    for (var li = 1; li < points.length; li++) {\n      pen_preview_command.draw(li);\n    }\n    var dataurl = pen_preview_img.toDataURL();\n    if (brush) {\n      brush.dom.querySelector(\"img\").src = dataurl;\n    } else {\n      document.getElementById(\"pen_preview\").src = dataurl;\n    }\n  }\n  static refreshPreview() {\n    if (!refresh_flg) {\n      window.requestAnimationFrame(Brush.refreshPreview_);\n      refresh_flg = true;\n    }\n  }\n  static refreshPreview_() {\n    Brush.refreshPen();\n    refresh_flg = false;\n  }\n  select() {\n    //アクティブブラシ変更\n    _hdrpaint_js__WEBPACK_IMPORTED_MODULE_4__[\"default\"].selected_brush = this;\n    for (var bi = 0; bi < _hdrpaint_js__WEBPACK_IMPORTED_MODULE_4__[\"default\"].brushes.length; bi++) {\n      var brush = _hdrpaint_js__WEBPACK_IMPORTED_MODULE_4__[\"default\"].brushes[bi];\n      if (_hdrpaint_js__WEBPACK_IMPORTED_MODULE_4__[\"default\"].selected_brush !== brush) {\n        //アクティブブラシ以外の表示を非アクティブにする\n        brush.dom.classList.remove(\"active\");\n      } else {\n        brush.dom.classList.add(\"active\");\n      }\n    }\n\n    //アクティブブラシパラメータ更新\n    var brush = this;\n    if (!brush) {\n      return;\n    }\n    var members = Object.keys(brush);\n    members.forEach(member => {\n      _hdrpaint_js__WEBPACK_IMPORTED_MODULE_4__[\"default\"].brush_status[member] = brush[member];\n    });\n\n    //ブラシ選択状態にする\n    _hdrpaint_js__WEBPACK_IMPORTED_MODULE_4__[\"default\"].selected_tool = \"pen\";\n    Brush.refreshPreview();\n  }\n  static refreshBrush(brush) {\n    //ブラシ一覧更新\n    if (!brush) {\n      var container = document.getElementById(\"brushes_container\");\n      //子ブラシセット\n      while (container.firstChild) container.removeChild(container.firstChild);\n      for (var li = 0; li < _hdrpaint_js__WEBPACK_IMPORTED_MODULE_4__[\"default\"].brushes.length; li++) {\n        container.appendChild(_hdrpaint_js__WEBPACK_IMPORTED_MODULE_4__[\"default\"].brushes[li].dom);\n      }\n    } else {\n      //\t\t\tvar div= brush.dom.getElementsByClassName(\"name\")[0];\n      //\t\t\tdiv.innerHTML=\"[\" + brush.shortcut + \"]\"  + brush.name;\n    }\n  }\n}\n;\n\n//# sourceURL=webpack://hdrpaint/./src/brush.js?");

/***/ }),

/***/ "./src/command/changeLayerAttribute.js":
/*!*********************************************!*\
  !*** ./src/command/changeLayerAttribute.js ***!
  \*********************************************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var _lib_watcher_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../lib/watcher.js */ \"./src/lib/watcher.js\");\n/* harmony import */ var _layer_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../layer.js */ \"./src/layer.js\");\n/* harmony import */ var _hdrpaint_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../hdrpaint.js */ \"./src/hdrpaint.js\");\n/* harmony import */ var _commandbase_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./commandbase.js */ \"./src/command/commandbase.js\");\n/* harmony import */ var _lib_util_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../lib/util.js */ \"./src/lib/util.js\");\n\n\n\n\n\nclass ChangeLayerAttribute extends _commandbase_js__WEBPACK_IMPORTED_MODULE_3__[\"default\"] {\n  //レイヤパラメータ変更\n  undo() {\n    this.f(this.undo_data.value);\n  }\n  f(value) {\n    var param = this.param;\n    var names = _lib_util_js__WEBPACK_IMPORTED_MODULE_4__[\"default\"].toArray(param.name);\n    var values = _lib_util_js__WEBPACK_IMPORTED_MODULE_4__[\"default\"].toArray(param.value);\n    var layer = hdrpaint.getLayerById(param.layer_id);\n    if (!this.undo_data) {\n      var undo_values = [];\n      for (var i = 0; i < names.length; i++) {\n        undo_values.push(_lib_watcher_js__WEBPACK_IMPORTED_MODULE_0__[\"default\"].getValue(layer, names[i]));\n      }\n      this.undo_data = {\n        value: undo_values\n      };\n    }\n    for (var i = 0; i < names.length; i++) {\n      _lib_watcher_js__WEBPACK_IMPORTED_MODULE_0__[\"default\"].setValue(layer, names[i], values[i]);\n    }\n    //layer[name] = value;\n    layer.refreshDiv();\n    if (layer.type === 2) {\n      layer.registRefreshThumbnail();\n    }\n    parent = hdrpaint.getLayerById(layer.parent);\n    parent.bubbleComposite();\n  }\n  func() {\n    this.f(this.param.value);\n  }\n}\n;\nChangeLayerAttribute.prototype.name = \"changeLayerAttribute\";\n_hdrpaint_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"].commandObjs[\"changeLayerAttribute\"] = ChangeLayerAttribute;\n\n//# sourceURL=webpack://hdrpaint/./src/command/changeLayerAttribute.js?");

/***/ }),

/***/ "./src/command/changeModifierAttribute.js":
/*!************************************************!*\
  !*** ./src/command/changeModifierAttribute.js ***!
  \************************************************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var _hdrpaint_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../hdrpaint.js */ \"./src/hdrpaint.js\");\n\n//モディファイアパラメータ変更\nvar Command = _hdrpaint_js__WEBPACK_IMPORTED_MODULE_0__[\"default\"].Command;\nCommand[\"changeModifierAttribute\"] = function () {\n  return function (log, undo_flg) {\n    var param = log.param;\n    var name = param.name;\n    var value = param.value;\n    var layer = Layer.findById(param.layer_id);\n    if (undo_flg) {\n      value = log.undo_data.value;\n    }\n    if (!log.undo_data) {\n      log.undo_data = {\n        \"value\": layer[name]\n      };\n    }\n    layer[name] = value;\n    layer.refreshDiv();\n    layer.parent.bubbleComposite();\n  };\n}();\n\n//# sourceURL=webpack://hdrpaint/./src/command/changeModifierAttribute.js?");

/***/ }),

/***/ "./src/command/clear.js":
/*!******************************!*\
  !*** ./src/command/clear.js ***!
  \******************************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var _hdrpaint_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../hdrpaint.js */ \"./src/hdrpaint.js\");\n/* harmony import */ var _layer_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../layer.js */ \"./src/layer.js\");\n/* harmony import */ var _commandbase_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./commandbase.js */ \"./src/command/commandbase.js\");\n\n\n\nclass Clear extends _commandbase_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"] {\n  func() {\n    //全クリア\n\n    var param = this.param;\n    var layer = _layer_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].findById(param.layer_id);\n    var layer_img = layer.img;\n    var range = param.range;\n    if (!range) {\n      range = {};\n      range.x = 0;\n      range.y = 0;\n      range.w = layer_img.width;\n      range.h = layer_img.height;\n    }\n    if (!this.undo_data) {\n      var undo_data = {};\n      this.undo_data = undo_data;\n      var layer_img = hdrpaint.getImgById(layer.img_id);\n      var dif = _hdrpaint_js__WEBPACK_IMPORTED_MODULE_0__[\"default\"].createDif(layer_img, range.x, range.y, range.w, range.h);\n      undo_data.difs = [];\n      undo_data.difs.push(dif);\n    }\n    layer_img.clear(range.x, range.y, range.w, range.h);\n    layer.refreshImg();\n  }\n}\n;\n_hdrpaint_js__WEBPACK_IMPORTED_MODULE_0__[\"default\"].commandObjs[\"clear\"] = Clear;\n\n//# sourceURL=webpack://hdrpaint/./src/command/clear.js?");

/***/ }),

/***/ "./src/command/commandbase.js":
/*!************************************!*\
  !*** ./src/command/commandbase.js ***!
  \************************************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": function() { return /* binding */ CommandBase; }\n/* harmony export */ });\n/* harmony import */ var _layer_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../layer.js */ \"./src/layer.js\");\n/* harmony import */ var _lib_img_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../lib/img.js */ \"./src/lib/img.js\");\n\n\nclass CommandBase {\n  constructor() {\n    this.param = {};\n    this.undo_data = null;\n  }\n  undo() {\n    //アンドゥ処理\n    var difs = this.undo_data.difs;\n    if (difs) {\n      //画像戻す\n      var param = this.param;\n      var img_id = null;\n      if (param.img_id) {\n        img_id = param.img_id;\n      } else {\n        var layer_id = param.layer_id;\n        var layer = _layer_js__WEBPACK_IMPORTED_MODULE_0__[\"default\"].findById(layer_id);\n        img_id = layer.img_id;\n      }\n      var img = hdrpaint.getImgById(img_id);\n      for (var di = difs.length; di--;) {\n        var dif = difs[di];\n        _lib_img_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].copy(img, dif.x, dif.y, dif.img, 0, 0, dif.img.width, dif.img.height);\n\n        //再描画\n        var keys = Object.keys(hdrpaint.layers);\n        for (var i = 0; i < keys.length; i++) {\n          var layer = hdrpaint.layers[keys[i]];\n          if (layer.img_id === img_id) {\n            layer.refreshImg(dif.x, dif.y, dif.img.width, dif.img.height);\n          }\n        }\n      }\n    }\n  }\n  func() {\n    //メイン処理\n  }\n  toString() {\n    var param_txt = \"\";\n    var param = this.param;\n    var keys = Object.keys(param);\n    for (var ki = 0; ki < keys.length; ki++) {\n      var key = keys[ki];\n      if (ki) {\n        param_txt += \",\";\n      }\n      param_txt += param[key];\n    }\n    return this.name + \"(\" + param_txt + \")\";\n  }\n}\n;\nCommandBase.prototype.name = \"command\";\n\n//# sourceURL=webpack://hdrpaint/./src/command/commandbase.js?");

/***/ }),

/***/ "./src/command/composite.js":
/*!**********************************!*\
  !*** ./src/command/composite.js ***!
  \**********************************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var _hdrpaint_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../hdrpaint.js */ \"./src/hdrpaint.js\");\n/* harmony import */ var _commandbase_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./commandbase.js */ \"./src/command/commandbase.js\");\n/* harmony import */ var _layer_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../layer.js */ \"./src/layer.js\");\n//レイヤ結合\n\n\n\nclass Composite extends _commandbase_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"] {\n  undo() {\n    var undo_data = this.undo_data;\n    var layer = undo_data.layer;\n    layer.children = undo_data.children;\n    layer.type = 1;\n    layer.refreshDiv();\n  }\n  func() {\n    //グループレイヤの子レイヤをすべて結合して通常レイヤにする\n    var param = this.param;\n    var layer = _layer_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"].findById(param.layer_id);\n\n    //差分ログ作成\n    if (!this.undo_data) {\n      this.undo_data = {\n        \"layer\": layer,\n        \"children\": layer.children\n      };\n    }\n    layer.type = 0;\n    layer.children = null;\n    layer.refreshDiv();\n  }\n}\n;\nComposite.prototype.name = \"composite\";\n_hdrpaint_js__WEBPACK_IMPORTED_MODULE_0__[\"default\"].commandObjs[\"composite\"] = Composite;\n\n//# sourceURL=webpack://hdrpaint/./src/command/composite.js?");

/***/ }),

/***/ "./src/command/copy.js":
/*!*****************************!*\
  !*** ./src/command/copy.js ***!
  \*****************************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../lib/vector.js */ \"./src/lib/vector.js\");\n/* harmony import */ var _layer_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../layer.js */ \"./src/layer.js\");\n/* harmony import */ var _commandbase_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./commandbase.js */ \"./src/command/commandbase.js\");\n/* harmony import */ var _hdrpaint_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../hdrpaint.js */ \"./src/hdrpaint.js\");\n/* harmony import */ var _lib_img_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../lib/img.js */ \"./src/lib/img.js\");\nfunction _defineProperty(obj, key, value) { key = _toPropertyKey(key); if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\nfunction _toPropertyKey(arg) { var key = _toPrimitive(arg, \"string\"); return typeof key === \"symbol\" ? key : String(key); }\nfunction _toPrimitive(input, hint) { if (typeof input !== \"object\" || input === null) return input; var prim = input[Symbol.toPrimitive]; if (prim !== undefined) { var res = prim.call(input, hint || \"default\"); if (typeof res !== \"object\") return res; throw new TypeError(\"@@toPrimitive must return a primitive value.\"); } return (hint === \"string\" ? String : Number)(input); }\n\n\n\n\n\nvar commandObjs = _hdrpaint_js__WEBPACK_IMPORTED_MODULE_3__[\"default\"].commandObjs;\nclass Copy extends _commandbase_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"] {\n  constructor() {\n    super();\n  }\n  undo() {\n    var undo_data = this.undo_data;\n    var layer = undo_data.layer;\n    _hdrpaint_js__WEBPACK_IMPORTED_MODULE_3__[\"default\"].removeLayer(layer);\n    return;\n  }\n  func() {\n    var param = this.param;\n    var src_layer = param.src_layer;\n    var n = param.position;\n    var layer;\n    if (!this.undo_data) {\n      var src_layer = _layer_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].findById(param.src_layer_id);\n      var range = param.range;\n      var img = new _lib_img_js__WEBPACK_IMPORTED_MODULE_4__[\"default\"](range.w, range.h);\n      _lib_img_js__WEBPACK_IMPORTED_MODULE_4__[\"default\"].copy(img, 0, 0, src_layer.img, range.x, range.y, range.w, range.h);\n\n      //layer.refreshDiv();\n\n      _hdrpaint_js__WEBPACK_IMPORTED_MODULE_3__[\"default\"].clipboard = img;\n    } else {\n      layer = this.undo_data.layer;\n    }\n    return layer;\n  }\n}\n_defineProperty(Copy, \"name\", \"copy\");\ncommandObjs[\"copy\"] = Copy;\n\n//# sourceURL=webpack://hdrpaint/./src/command/copy.js?");

/***/ }),

/***/ "./src/command/copylayer.js":
/*!**********************************!*\
  !*** ./src/command/copylayer.js ***!
  \**********************************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../lib/vector.js */ \"./src/lib/vector.js\");\n/* harmony import */ var _layer_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../layer.js */ \"./src/layer.js\");\n/* harmony import */ var _commandbase_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./commandbase.js */ \"./src/command/commandbase.js\");\n/* harmony import */ var _hdrpaint_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../hdrpaint.js */ \"./src/hdrpaint.js\");\n/* harmony import */ var _lib_img_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../lib/img.js */ \"./src/lib/img.js\");\nfunction _defineProperty(obj, key, value) { key = _toPropertyKey(key); if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\nfunction _toPropertyKey(arg) { var key = _toPrimitive(arg, \"string\"); return typeof key === \"symbol\" ? key : String(key); }\nfunction _toPrimitive(input, hint) { if (typeof input !== \"object\" || input === null) return input; var prim = input[Symbol.toPrimitive]; if (prim !== undefined) { var res = prim.call(input, hint || \"default\"); if (typeof res !== \"object\") return res; throw new TypeError(\"@@toPrimitive must return a primitive value.\"); } return (hint === \"string\" ? String : Number)(input); }\n\n\n\n\n\nvar commandObjs = _hdrpaint_js__WEBPACK_IMPORTED_MODULE_3__[\"default\"].commandObjs;\nclass CopyLayer extends _commandbase_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"] {\n  constructor() {\n    super();\n  }\n  undo() {\n    _hdrpaint_js__WEBPACK_IMPORTED_MODULE_3__[\"default\"].removeLayer(this.undo_data.layer_id);\n    return;\n  }\n  func() {\n    var param = this.param;\n    var src_layer = param.src_layer;\n    var n = param.position;\n    var layer_id;\n    if (!this.undo_data) {\n      var src_layer = _layer_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].findById(param.src_layer_id);\n      var src_img = hdrpaint.getImgById(src_layer.img_id);\n      var img = new _lib_img_js__WEBPACK_IMPORTED_MODULE_4__[\"default\"](src_layer.size[0], src_layer.size[1]);\n      _lib_img_js__WEBPACK_IMPORTED_MODULE_4__[\"default\"].copy(img, 0, 0, src_img, 0, 0, img.width, img.height);\n      var layer = _hdrpaint_js__WEBPACK_IMPORTED_MODULE_3__[\"default\"].createLayer(img, 0);\n      var keys = Object.keys(layer);\n      for (var i = 0; i < keys.length; i++) {\n        var key = keys[i];\n        if ([\"id\", \"dom\", \"img\", \"children\"].indexOf(key) >= 0) continue;\n        if (layer[key] instanceof _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec2) {\n          _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec2.copy(layer[key], src_layer[key]);\n        } else {\n          layer[key] = src_layer[key];\n        }\n      }\n      layer.refreshDiv();\n      this.undo_data = {\n        \"layer_id\": layer.id\n      };\n      layer_id = layer.id;\n    } else {\n      layer_id = this.undo_data.layer_id;\n    }\n    var parentLayer = _layer_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].findById(param.parent);\n    parentLayer.append(n, layer_id);\n    _hdrpaint_js__WEBPACK_IMPORTED_MODULE_3__[\"default\"].selectLayer(layer_id);\n    return layer;\n  }\n}\n_defineProperty(CopyLayer, \"name\", \"copylayer\");\ncommandObjs[\"copylayer\"] = CopyLayer;\n\n//# sourceURL=webpack://hdrpaint/./src/command/copylayer.js?");

/***/ }),

/***/ "./src/command/createNewLayer.js":
/*!***************************************!*\
  !*** ./src/command/createNewLayer.js ***!
  \***************************************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var _hdrpaint_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../hdrpaint.js */ \"./src/hdrpaint.js\");\n/* harmony import */ var _lib_img_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../lib/img.js */ \"./src/lib/img.js\");\n/* harmony import */ var _layer_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../layer.js */ \"./src/layer.js\");\n/* harmony import */ var _commandbase_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./commandbase.js */ \"./src/command/commandbase.js\");\n//レイヤ新規作成\n\n\n\n\nclass CreateNewLayer extends _commandbase_js__WEBPACK_IMPORTED_MODULE_3__[\"default\"] {\n  constructor() {\n    super();\n  }\n  undo() {\n    _hdrpaint_js__WEBPACK_IMPORTED_MODULE_0__[\"default\"].removeLayer(this.undo_data.layer_id);\n    return;\n  }\n  func() {\n    var param = this.param;\n    var width = param.width;\n    var height = param.height;\n    var n = param.position;\n    var layer_id;\n    if (!this.undo_data) {\n      var img = hdrpaint.createImg(width, height);\n      var layer = _hdrpaint_js__WEBPACK_IMPORTED_MODULE_0__[\"default\"].createLayer(img.id, param.composite_flg);\n      layer.width = width;\n      layer.height = height;\n      layer_id = layer.id;\n      this.undo_data = {\n        \"layer_id\": layer.id\n      };\n    } else {\n      layer_id = this.undo_data.layer_id;\n    }\n    if (param.parent > 0) {\n      var parentLayer = _layer_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"].findById(param.parent);\n      parentLayer.append(n, layer_id);\n      hdrpaint.selectLayer(layer_id);\n    } else {\n      hdrpaint.root_layer_id = layer_id;\n      hdrpaint.root_layer = _layer_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"].findById(layer_id);\n    }\n    return layer_id;\n  }\n}\n;\nCreateNewLayer.prototype.name = \"createNewLayer\";\nclass CreateNewCompositeLayer extends CreateNewLayer {}\nCreateNewCompositeLayer.prototype.name = \"createNewCompositeLayer\";\nhdrpaint.commandObjs[\"createNewLayer\"] = CreateNewLayer;\nhdrpaint.commandObjs[\"createNewCompositeLayer\"] = CreateNewCompositeLayer;\n\n//# sourceURL=webpack://hdrpaint/./src/command/createNewLayer.js?");

/***/ }),

/***/ "./src/command/createmodifier.js":
/*!***************************************!*\
  !*** ./src/command/createmodifier.js ***!
  \***************************************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../lib/vector.js */ \"./src/lib/vector.js\");\n/* harmony import */ var _commandbase_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./commandbase.js */ \"./src/command/commandbase.js\");\n/* harmony import */ var _hdrpaint_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../hdrpaint.js */ \"./src/hdrpaint.js\");\n/* harmony import */ var _layer_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../layer.js */ \"./src/layer.js\");\nfunction _defineProperty(obj, key, value) { key = _toPropertyKey(key); if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\nfunction _toPropertyKey(arg) { var key = _toPrimitive(arg, \"string\"); return typeof key === \"symbol\" ? key : String(key); }\nfunction _toPrimitive(input, hint) { if (typeof input !== \"object\" || input === null) return input; var prim = input[Symbol.toPrimitive]; if (prim !== undefined) { var res = prim.call(input, hint || \"default\"); if (typeof res !== \"object\") return res; throw new TypeError(\"@@toPrimitive must return a primitive value.\"); } return (hint === \"string\" ? String : Number)(input); }\n\n\n\n\nclass CreateModifier extends _commandbase_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"] {\n  constructor() {\n    super();\n  }\n  undo() {\n    _hdrpaint_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"].removeLayer(this.undo_data.layer_id);\n  }\n  func() {\n    var param = this.param;\n    var src_layer = param.src_layer;\n    var n = param.position;\n    var layer;\n    if (!this.undo_data) {\n      layer = _hdrpaint_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"].createModifier(param.modifier);\n      _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec2.setValues(layer.size, param.width, param.height);\n      layer.init();\n      this.undo_data = {\n        \"layer_id\": layer.id\n      };\n    }\n    if (param.parent_layer_id > 0) {\n      var parentLayer = _layer_js__WEBPACK_IMPORTED_MODULE_3__[\"default\"].findById(param.parent_layer_id);\n      parentLayer.append(n, this.undo_data.layer_id);\n      hdrpaint.selectLayer(this.undo_data.layer_id);\n    } else {\n      hdrpaint.root_layer_id = layer.id;\n      hdrpaint.root_layer = layer;\n    }\n    return layer;\n  }\n}\n_defineProperty(CreateModifier, \"name\", \"createmodifier\");\nhdrpaint.commandObjs[\"createmodifier\"] = CreateModifier;\n\n//# sourceURL=webpack://hdrpaint/./src/command/createmodifier.js?");

/***/ }),

/***/ "./src/command/deleteLayer.js":
/*!************************************!*\
  !*** ./src/command/deleteLayer.js ***!
  \************************************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var _hdrpaint_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../hdrpaint.js */ \"./src/hdrpaint.js\");\n/* harmony import */ var _commandbase_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./commandbase.js */ \"./src/command/commandbase.js\");\n/* harmony import */ var _layer_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../layer.js */ \"./src/layer.js\");\n//レイヤ削除\n\n\n\nclass DeleteLayer extends _commandbase_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"] {\n  undo() {\n    var layer = this.undo_data.layer;\n    var idx = this.undo_data.position;\n    var parent_layer = _layer_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"].findById(this.undo_data.parent);\n    parent_layer.append(idx, layer.id);\n  }\n  func() {\n    var layer_id = this.param.layer_id;\n    var layer = _layer_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"].findById(layer_id);\n    var parent_layer = _layer_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"].findById(layer.parent);\n    if (parent_layer) {\n      var children = parent_layer.children;\n      var idx = children.indexOf(layer_id);\n      if (!this.undo_data) {\n        this.undo_data = {\n          \"layer\": layer,\n          \"position\": idx,\n          \"parent\": parent_layer.id\n        };\n      }\n\n      //レイヤ削除\n      _hdrpaint_js__WEBPACK_IMPORTED_MODULE_0__[\"default\"].removeLayer(layer_id);\n      if (layer === _hdrpaint_js__WEBPACK_IMPORTED_MODULE_0__[\"default\"].selected_layer) {\n        if (children.length === 0) {\n          hdrpaint.selectLayer(parent_layer.id);\n        } else {\n          if (idx < children.length) {\n            layers[idx].select();\n          } else {\n            layers[children.length - 1].select();\n          }\n        }\n      }\n      parent_layer.bubbleComposite();\n    }\n  }\n}\n;\n_hdrpaint_js__WEBPACK_IMPORTED_MODULE_0__[\"default\"].commandObjs[\"deleteLayer\"] = DeleteLayer;\n\n//# sourceURL=webpack://hdrpaint/./src/command/deleteLayer.js?");

/***/ }),

/***/ "./src/command/drawLine.js":
/*!*********************************!*\
  !*** ./src/command/drawLine.js ***!
  \*********************************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../lib/vector.js */ \"./src/lib/vector.js\");\n/* harmony import */ var _penpoint_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../penpoint.js */ \"./src/penpoint.js\");\n/* harmony import */ var _hdrpaint_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../hdrpaint.js */ \"./src/hdrpaint.js\");\n/* harmony import */ var _lib_img_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../lib/img.js */ \"./src/lib/img.js\");\n/* harmony import */ var _layer_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../layer.js */ \"./src/layer.js\");\n/* harmony import */ var _commandbase_js__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./commandbase.js */ \"./src/command/commandbase.js\");\n\n\n\n\n\n\nvar painted_mask = _hdrpaint_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"].painted_mask;\nclass Brush extends _commandbase_js__WEBPACK_IMPORTED_MODULE_5__[\"default\"] {\n  constructor() {\n    super();\n  }\n  toString() {\n    var points = this.param.points;\n    var str = this.name;\n    if (points.length) {\n      str += \"(\" + points[0].pos[0].toFixed(2) + \",\" + points[0].pos[1].toFixed(2) + \")-\";\n      str += points.length - 2 + \"-\";\n      str += \"(\" + points[points.length - 1].pos[0].toFixed(2) + \",\" + points[points.length - 1].pos[1].toFixed(2) + \")\";\n    }\n    return str;\n  }\n  func() {\n    //ペン描画\n    var param = this.param;\n    var layer = _layer_js__WEBPACK_IMPORTED_MODULE_4__[\"default\"].findById(param.layer_id);\n    var points = param.points;\n    painted_mask.fill(0);\n    for (var li = 1; li < points.length; li++) {\n      this.draw(li);\n    }\n  }\n  draw(n) {\n    var param = this.param;\n    var points = param.points;\n    var img = hdrpaint.getImgById(param.img_id);\n    var point0 = points[n - 1];\n    var point1 = points[n];\n    var p0 = point0.pos;\n    var p1 = point1.pos;\n    var offset = 0;\n    //補間するための係数を求める\n    if (n >= 2) {\n      _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec2.sub(A, p0, points[n - 2].pos);\n      var l1 = _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec2.scalar(A);\n      _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec2.sub(B, p1, p0);\n      var l2 = _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec2.scalar(B);\n      if (l1 + l2 > 0) {\n        _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec2.mul(q0, A, l2 / (l1 + l2));\n        _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec2.mad(q0, q0, B, l1 / (l1 + l2));\n      }\n    } else {\n      _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec2.sub(q0, p1, p0);\n    }\n    if (n + 1 < points.length) {\n      _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec2.sub(A, p1, p0);\n      var l1 = _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec2.scalar(A);\n      _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec2.sub(B, points[n + 1].pos, p1);\n      var l2 = _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec2.scalar(B);\n      if (l1 + l2 > 0) {\n        _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec2.mul(q1, A, l2 / (l1 + l2));\n        _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec2.mad(q1, q1, B, l1 / (l1 + l2));\n      }\n    } else {\n      _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec2.sub(q1, p1, p0);\n      _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec2.mad(q1, q1, q0, -0.5);\n    }\n    _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec2.copy(D, p0);\n    _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec2.copy(C, q0);\n    _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec2.mad(A, q1, p1, -2);\n    _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec2.add(A, A, q0);\n    _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec2.mad(A, A, p0, 2);\n    _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec2.sub(B, p1, A);\n    _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec2.sub(B, B, q0);\n    _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec2.sub(B, B, p0);\n    var dp = point1.pressure - point0.pressure;\n    var len = _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec2.len(p1, p0);\n    var devide = clamp(len / 4 | 0, 1, MAX - 1);\n    if (!param.stroke_interpolation) {\n      //補間しない\n      devide = 1;\n    }\n    var _devide = 1 / devide;\n    var wei = param.weight * 0.5;\n    if (param.pressure_effect_flgs & 1) {\n      wei *= Math.max(point0.pressure, point1.pressure);\n    }\n    var left = img.width;\n    var right = 0;\n    var top = img.height;\n    var bottom = 0;\n    for (var i = 0; i < devide + 1; i++) {\n      var p = _p[i];\n      var dt = i * _devide + offset;\n      _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec2.mul(p.pos, A, dt * dt * dt);\n      _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec2.mad(p.pos, p.pos, B, dt * dt);\n      _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec2.mad(p.pos, p.pos, C, dt);\n      _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec2.add(p.pos, p.pos, D);\n      //Vec2.sub(p.pos,p.pos,absolute);\n\n      p.pressure = point0.pressure + dp * dt;\n\n      //Vec2.sub(p.pos,p.pos,layer.position);\n\n      left = Math.min(p.pos[0], left);\n      right = Math.max(p.pos[0], right);\n      top = Math.min(p.pos[1], top);\n      bottom = Math.max(p.pos[1], bottom);\n    }\n    left = Math.floor(clamp(left - wei, 0, img.width - 1));\n    right = Math.ceil(clamp(right + wei, 0, img.width - 1));\n    top = Math.floor(clamp(top - wei, 0, img.height - 1));\n    bottom = Math.ceil(clamp(bottom + wei, 0, img.height - 1));\n\n    //差分ログ作成\n    if (!this.undo_data) {\n      this.undo_data = {\n        \"difs\": []\n      };\n    }\n    if (this.undo_data.difs.length < n) {\n      var dif = _hdrpaint_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"].createDif(img, left, top, right - left + 1, bottom - top + 1);\n      this.undo_data.difs.push(dif);\n    }\n    for (var i = 0; i < devide; i++) {\n      drawPen(img, _p[i], _p[i + 1], param);\n    }\n\n    //再描画\n    var keys = Object.keys(hdrpaint.layers);\n    for (var i = 0; i < keys.length; i++) {\n      var layer = hdrpaint.layers[keys[i]];\n      if (layer.img_id === param.img_id) {\n        layer.refreshImg(left, top, right - left + 1, bottom - top + 1);\n      }\n    }\n  }\n}\n;\nBrush.prototype.name = \"brush\";\nclass Eraser extends Brush {}\nEraser.prototype.name = \"eraser\";\n_hdrpaint_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"].commandObjs[\"eraser\"] = Eraser;\n_hdrpaint_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"].commandObjs[\"brush\"] = Brush;\nvar absolute = new _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec2();\nvar A = new _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec2(),\n  B = new _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec2(),\n  C = new _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec2(),\n  D = new _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec2();\nvar q0 = new _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec2();\nvar q1 = new _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec2();\nvar _p = [];\nvar MAX = 32;\nfor (var i = 0; i < MAX; i++) {\n  _p.push(new _penpoint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"]());\n}\nvar clamp = function (value, min, max) {\n  return Math.min(max, Math.max(min, value));\n};\nvar brush_blend = function (dst, idx, pressure, dist, flg, weight, param) {\n  var alpha_mask = param.alpha_mask;\n  var color = param.color;\n  var sa = color[3] * param.alpha;\n  if (param.eraser) {\n    sa = param.alpha;\n  }\n  if (param.alpha_pressure_effect) {\n    sa *= pressure;\n  }\n  var l = _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec2.scalar(dist);\n  if (param.softness) {\n    sa = sa * Math.min(1, (weight - weight * l) / (weight * param.softness));\n  } else {\n    if (param.antialias) {\n      sa = sa * Math.min(1, weight - weight * l);\n    }\n  }\n  if (param.eraser) {\n    if (param.overlap === 2) {\n      dst[idx + 3] = (1 - sa) * (1 - param.alpha);\n      return;\n    }\n  }\n  if (param.overlap === 2) {\n    dst[idx + 0] = color[0];\n    dst[idx + 1] = color[1];\n    dst[idx + 2] = color[2];\n    if (!alpha_mask) {\n      dst[idx + 3] = sa;\n    }\n    return;\n  }\n  if (param.overlap == 0) {\n    if (flg[idx >> 2] >= sa) {\n      return;\n    }\n    var olda = flg[idx >> 2];\n    flg[idx >> 2] = sa;\n    sa = (sa - olda) / (1 - olda);\n  }\n  if (param.eraser) {\n    dst[idx + 3] = dst[idx + 3] * (1 - sa) + 0 * sa;\n    return;\n  }\n  var da = dst[idx + 3] * (1 - sa);\n  if (!alpha_mask) {\n    dst[idx + 3] = da + sa;\n  }\n  if (dst[idx + 3] && !param.eraser) {\n    var rr = 1 / dst[idx + 3];\n    da *= rr;\n    sa *= rr;\n    dst[idx + 0] += dst[idx + 0] * (-1 + da) + color[0] * sa;\n    dst[idx + 1] += dst[idx + 1] * (-1 + da) + color[1] * sa;\n    dst[idx + 2] += dst[idx + 2] * (-1 + da) + color[2] * sa;\n  }\n};\nvar vec2 = new _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec2();\nvar side = new _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec2();\nvar dist = new _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec2();\nvar drawPen = function (img, point0, point1, param) {\n  var weight = param.weight;\n  var pressure_mask = param.pressure_effect_flgs;\n  var softness = param.softness;\n  //描画\n  var img_data = img.data;\n  weight *= 0.5;\n  var weight_pressure_effect = pressure_mask & 1;\n  var alpha_pressure_effect = (pressure_mask & 2) >> 1;\n  var pos1 = point1.pos;\n  var pos0 = point0.pos;\n  var pressure_0 = point0.pressure;\n  var d_pressure = point1.pressure - point0.pressure;\n  var weight_0pow2 = weight * ((pressure_0 - 1) * weight_pressure_effect + 1);\n  var weight_1pow2 = weight * ((d_pressure + pressure_0 - 1) * weight_pressure_effect + 1);\n  var max_weight = Math.max(weight_0pow2, weight_1pow2);\n  var weight_0pow2 = weight_0pow2 * weight_0pow2;\n  var weight_1pow2 = weight_1pow2 * weight_1pow2;\n  var left = Math.min(pos1[0], pos0[0]);\n  var right = Math.max(pos1[0], pos0[0]) + 1;\n  var top = Math.min(pos1[1], pos0[1]);\n  var bottom = Math.max(pos1[1], pos0[1]) + 1;\n  left = Math.floor(clamp(left - max_weight, 0, img.width));\n  right = Math.ceil(clamp(right + max_weight, 0, img.width));\n  top = Math.floor(clamp(top - max_weight, 0, img.height));\n  bottom = Math.ceil(clamp(bottom + max_weight, 0, img.height));\n  _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec2.sub(vec2, pos1, pos0);\n  var l = _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec2.scalar2(vec2);\n  if (l !== 0) {\n    _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec2.mul(vec2, vec2, 1 / l);\n  } else {\n    _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec2.setValues(vec2, 0, 0);\n  }\n  _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec2.setValues(side, vec2[1], -vec2[0]);\n  _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec2.norm(side);\n  var drawfunc = brush_blend;\n  for (var dy = top; dy < bottom; dy++) {\n    for (var dx = left; dx < right; dx++) {\n      dist[0] = dx - pos0[0] + 0.5;\n      dist[1] = dy - pos0[1] + 0.5;\n      var dp = _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec2.dot(vec2, dist);\n      var l = 0;\n      var l2 = 0;\n      var local_pressure = 0;\n      if (dp <= 0) {\n        //始点より前\n\n        if (_lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec2.scalar2(dist) >= weight_0pow2) {\n          continue;\n        }\n        dp = 0;\n        l = _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec2.scalar(dist);\n        local_pressure = d_pressure * dp + pressure_0;\n        local_weight = weight * ((local_pressure - 1) * weight_pressure_effect + 1);\n      } else if (dp >= 1) {\n        //終端より後\n\n        dist[0] = dx - pos1[0] + 0.5;\n        dist[1] = dy - pos1[1] + 0.5;\n        if (_lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec2.scalar2(dist) >= weight_1pow2) {\n          continue;\n        }\n        dp = 1;\n        l = _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec2.scalar(dist);\n        local_pressure = d_pressure * dp + pressure_0;\n        local_weight = weight * ((local_pressure - 1) * weight_pressure_effect + 1);\n      } else {\n        //線半ば\n\n        local_pressure = d_pressure * dp + pressure_0;\n        var local_weight = weight * ((local_pressure - 1) * weight_pressure_effect + 1);\n        l = _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec2.dot(dist, side);\n        if (l * l >= local_weight * local_weight) {\n          //線幅より外の場合\n          continue;\n        }\n        _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec2.mul(dist, side, l);\n        l = Math.abs(l);\n      }\n      var idx = dy * img.width + dx | 0;\n      _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec2.mul(dist, dist, 1 / local_weight);\n      drawfunc(img_data, idx << 2, local_pressure, dist, painted_mask, local_weight, param);\n    }\n  }\n};\n\n//# sourceURL=webpack://hdrpaint/./src/command/drawLine.js?");

/***/ }),

/***/ "./src/command/fill.js":
/*!*****************************!*\
  !*** ./src/command/fill.js ***!
  \*****************************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../lib/vector.js */ \"./src/lib/vector.js\");\n/* harmony import */ var _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../hdrpaint.js */ \"./src/hdrpaint.js\");\n/* harmony import */ var _layer_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../layer.js */ \"./src/layer.js\");\n/* harmony import */ var _lib_img_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../lib/img.js */ \"./src/lib/img.js\");\n/* harmony import */ var _commandbase_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./commandbase.js */ \"./src/command/commandbase.js\");\n\n\n\n\n\nvar commandObjs = _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].commandObjs;\nvar fillStack = [];\nvar joined_r, joined_g, joined_b, joined_a;\nvar target_r, target_g, target_b, target_a;\nvar offset = new _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec2();\nvar refresh_left, refresh_top, refresh_bottom, refresh_right;\nvar fillCheckAll = function (target, joined, x, y) {\n  var x2 = x + offset[0];\n  var y2 = y + offset[1];\n  if (joined.width <= x2 || x2 < 0 || y2 < 0 || joined.height <= y2) {\n    return false;\n  }\n  var idx = target.getIndex(x, y) << 2;\n  var idx2 = joined.getIndex(x2, y2) << 2;\n  var joined_data = joined.data;\n  var target_data = target.data;\n  return joined_r === joined_data[idx2] && joined_g === joined_data[idx2 + 1] && joined_b === joined_data[idx2 + 2] && joined_a === joined_data[idx2 + 3] && target_r === target_data[idx] && target_g === target_data[idx + 1] && target_b === target_data[idx + 2] && target_a === target_data[idx + 3];\n};\nvar fillCheckLayer = function (target, joined, x, y) {\n  var idx = target.getIndex(x, y) << 2;\n  var target_data = target.data;\n  return target_r === target_data[idx] && target_g === target_data[idx + 1] && target_b === target_data[idx + 2] && target_a === target_data[idx + 3];\n};\nvar fillCheckAlpha = function (target, joined, x, y) {\n  var x2 = x + offset[0];\n  var y2 = y + offset[1];\n  if (joined.width <= x2 || x2 < 0 || y2 < 0 || joined.height <= y2) {\n    return false;\n  }\n  var idx = target.getIndex(x, y) << 2;\n  var idx2 = joined.getIndex(x2, y2) << 2;\n  var joined_data = joined.data;\n  var target_data = target.data;\n  return target_data[idx + 3] !== 1 && joined_data[idx2 + 3] !== 1;\n};\nvar fillCheck = fillCheckAll;\nvar fillSub = function (layer_img, y, left, right) {\n  var joined_img = _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].root_layer.img;\n  var mode = 0;\n\n  //塗りつぶし領域を求める\n\n  //左の端を探す\n  var xi = left;\n  var yidx = layer_img.getIndex(0, y) << 2;\n  for (; xi >= 0; xi--) {\n    var idx2 = yidx + (xi << 2);\n    if (fillCheck(layer_img, joined_img, xi, y)) {\n      if (mode === 0) {\n        mode = 1;\n      }\n    } else {\n      break;\n    }\n  }\n  if (mode === 1) {\n    fillStack.push(y);\n    fillStack.push(xi + 1);\n  }\n  for (var xi = left; xi < right; xi++) {\n    var idx2 = yidx + (xi << 2);\n    if (fillCheck(layer_img, joined_img, xi, y)) {\n      if (mode === 0) {\n        //塗りつぶし領域開始\n        fillStack.push(y);\n        fillStack.push(xi);\n        mode = 1;\n      }\n    } else {\n      if (mode === 1) {\n        //塗りつぶし領域外なので終了\n        fillStack.push(xi);\n        mode = 0;\n      }\n    }\n  }\n\n  //右端\n  if (mode === 1) {\n    var xi = right - 1;\n    for (; xi < layer_img.width; xi++) {\n      var idx2 = yidx + (xi << 2);\n      if (!fillCheck(layer_img, joined_img, xi, y)) {\n        break;\n      }\n    }\n    fillStack.push(xi);\n  }\n};\nclass Fill extends _commandbase_js__WEBPACK_IMPORTED_MODULE_4__[\"default\"] {\n  func() {\n    //塗りつぶし\n    var param = this.param;\n    var layer = _layer_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"].findById(param.layer_id);\n    layer.getAbsolutePosition(offset);\n    var point_x = param.x;\n    var point_y = param.y;\n    var col = param.color;\n    fillCheck = fillCheckAll;\n    if (param.is_layer) {\n      fillCheck = fillCheckLayer;\n    }\n    if (inputs['fill_alpha'].checked) {\n      fillCheck = fillCheckAlpha;\n    }\n\n    //アルファマスク保護設定\n    var mask_alpha = layer.mask_alpha;\n    var one_minus_mask_alpha = 1 - mask_alpha;\n    fillStack = [];\n    var x = point_x | 0;\n    var y = point_y | 0;\n    //塗りつぶし範囲\n    refresh_top = y;\n    refresh_bottom = y;\n    refresh_left = x;\n    refresh_right = x;\n\n    //塗りつぶし対象色\n    var target = hdrpaint.getImgById(layer.img_id);\n    var joined_img = hdrpaint.getImgById(hdrpaint.root_layer.img_id);\n    var idx = joined_img.getIndex(x + layer.position[0], y + layer.position[1]) << 2;\n    joined_r = joined_img.data[idx];\n    joined_g = joined_img.data[idx + 1];\n    joined_b = joined_img.data[idx + 2];\n    joined_a = joined_img.data[idx + 3];\n    idx = target.getIndex(x, y) << 2;\n    target_r = target.data[idx];\n    target_g = target.data[idx + 1];\n    target_b = target.data[idx + 2];\n    target_a = target.data[idx + 3];\n    var draw_r = col[0];\n    var draw_g = col[1];\n    var draw_b = col[2];\n    var draw_a = col[3];\n    var target_data = target.data;\n    if (target_r === draw_r && target_g === draw_g && target_b === draw_b && target_a === draw_a) {\n      //同色の場合終了\n      return;\n    }\n    var old_img = new _lib_img_js__WEBPACK_IMPORTED_MODULE_3__[\"default\"](target.width, target.height);\n    _lib_img_js__WEBPACK_IMPORTED_MODULE_3__[\"default\"].copy(old_img, 0, 0, target, 0, 0, target.width, target.height);\n\n    //開始座標を登録\n    fillStack.push(y);\n    fillStack.push(x);\n    fillStack.push(x);\n    while (fillStack.length) {\n      var right = fillStack.pop(); //右端\n      var left = fillStack.pop(); //左端\n      var yi = fillStack.pop(); //y座標\n\n      //塗りつぶし\n      var yidx = target.getIndex(0, yi) << 2;\n      for (var xi = left; xi < right; xi++) {\n        idx = yidx + (xi << 2);\n        target_data[idx + 0] = draw_r;\n        target_data[idx + 1] = draw_g;\n        target_data[idx + 2] = draw_b;\n        target_data[idx + 3] = target_data[idx + 3] * mask_alpha + draw_a * one_minus_mask_alpha;\n      }\n      if (yi > 0) {\n        //上端に到達していない場合、ひとつ上の行を探索\n        fillSub(target, yi - 1, left, right);\n      }\n      if (yi < target.height - 1) {\n        //下端に到達していない場合、ひとつ下の行を探索\n        fillSub(target, yi + 1, left, right);\n      }\n\n      //更新領域を求める\n      refresh_left = Math.min(refresh_left, left);\n      refresh_right = Math.max(refresh_right, right);\n      refresh_top = Math.min(refresh_top, yi);\n      refresh_bottom = Math.max(refresh_bottom, yi + 1);\n    }\n    var width = refresh_right - refresh_left;\n    var height = refresh_bottom - refresh_top;\n    if (!this.undo_data) {\n      this.undo_data = {};\n      var layer_img = layer.img;\n      layer.img = old_img;\n      var dif = _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].createDif(layer, refresh_left, refresh_top, width, height);\n      layer.img = layer_img;\n      this.undo_data.difs = [];\n      this.undo_data.difs.push(dif);\n    }\n    layer.refreshImg(refresh_left, refresh_top, refresh_right - refresh_left + 1, refresh_bottom - refresh_top + 1);\n  }\n}\ncommandObjs[\"fill\"] = Fill;\n\n//# sourceURL=webpack://hdrpaint/./src/command/fill.js?");

/***/ }),

/***/ "./src/command/joinLayer.js":
/*!**********************************!*\
  !*** ./src/command/joinLayer.js ***!
  \**********************************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../lib/vector.js */ \"./src/lib/vector.js\");\n/* harmony import */ var _commandbase_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./commandbase.js */ \"./src/command/commandbase.js\");\n/* harmony import */ var _hdrpaint_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../hdrpaint.js */ \"./src/hdrpaint.js\");\n/* harmony import */ var _layer_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../layer.js */ \"./src/layer.js\");\n/* harmony import */ var _lib_img_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../lib/img.js */ \"./src/lib/img.js\");\n\n\n\n\n\nclass JoinLayer extends _commandbase_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"] {\n  undo() {\n    var undo_data = this.undo_data;\n    var layer = undo_data.layer;\n    var parent_layer = layer.parent;\n    parent_layer.append(undo_data.position, undo_data.layerA);\n    parent_layer.append(undo_data.positionB, undo_data.layerB);\n    _hdrpaint_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"].removeLayer(layer);\n    return;\n  }\n  func() {\n    var param = this.param;\n    var layer;\n    var layerA = _layer_js__WEBPACK_IMPORTED_MODULE_3__[\"default\"].findById(param.layer_id);\n    var layerB = _layer_js__WEBPACK_IMPORTED_MODULE_3__[\"default\"].findById(param.layer_id2);\n    var parent_layer = layerA.parent;\n    var layers = parent_layer.children;\n    var ls = [layerA, layerB];\n    if (!this.undo_data) {\n      //２つのレイヤが収まるサイズのグループレイヤを作成\n      var x = Math.min(layerA.position[0], layerB.position[0]);\n      var y = Math.min(layerA.position[1], layerB.position[1]);\n      var right = Math.max(layerA.position[0] + layerA.size[0], layerB.position[0] + layerB.size[0]);\n      var bottom = Math.max(layerA.position[1] + layerA.size[1], layerB.position[1] + layerB.size[1]);\n      var width = right - x;\n      var height = bottom - y;\n      var position = layers.indexOf(layerA);\n      var position2 = layers.indexOf(layerB);\n      var img = new _lib_img_js__WEBPACK_IMPORTED_MODULE_4__[\"default\"](width, height);\n      layer = _hdrpaint_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"].createLayer(img, 1);\n      layer.position[0] = x;\n      layer.position[1] = y;\n      layer.name = layerA.name + \",\" + layerB.name;\n\n      //２つのレイヤを子レイヤとしてセット\n      layer.append(0, layerA);\n      layer.append(1, layerB);\n      _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec2.sub(layerB.position, layerB.position, layer.position);\n      _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec2.sub(layerA.position, layerA.position, layer.position);\n\n      //結合\n      layer.composite();\n      layer.type = 0;\n      layer.children = [];\n      _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec2.add(layerB.position, layerB.position, layer.position);\n      _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec2.add(layerA.position, layerA.position, layer.position);\n      layer.refreshDiv();\n      this.undo_data = {\n        \"layerA\": layerA,\n        \"position\": position,\n        \"layerB\": layerB,\n        \"positionB\": position2,\n        \"layer\": layer\n      };\n    } else {\n      layer = this.undo_data.layer;\n    }\n\n    //結合元レイヤを削除\n    for (var li = 0; li < ls.length; li++) {\n      var n = layers.indexOf(ls[li]);\n      layers.splice(n, 1);\n    }\n\n    //結合したレイヤを挿入\n    parent_layer.append(n, layer);\n    layer.select();\n  }\n}\n;\nJoinLayer.prototype.name = \"JoinLayer\";\n_hdrpaint_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"].commandObjs[\"joinLayer\"] = JoinLayer;\n\n//# sourceURL=webpack://hdrpaint/./src/command/joinLayer.js?");

/***/ }),

/***/ "./src/command/loadImage.js":
/*!**********************************!*\
  !*** ./src/command/loadImage.js ***!
  \**********************************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var _commandbase_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./commandbase.js */ \"./src/command/commandbase.js\");\n/* harmony import */ var _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../hdrpaint.js */ \"./src/hdrpaint.js\");\n/* harmony import */ var _layer_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../layer.js */ \"./src/layer.js\");\nfunction _defineProperty(obj, key, value) { key = _toPropertyKey(key); if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\nfunction _toPropertyKey(arg) { var key = _toPrimitive(arg, \"string\"); return typeof key === \"symbol\" ? key : String(key); }\nfunction _toPrimitive(input, hint) { if (typeof input !== \"object\" || input === null) return input; var prim = input[Symbol.toPrimitive]; if (prim !== undefined) { var res = prim.call(input, hint || \"default\"); if (typeof res !== \"object\") return res; throw new TypeError(\"@@toPrimitive must return a primitive value.\"); } return (hint === \"string\" ? String : Number)(input); }\n\n\n\nvar commandObjs = _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].commandObjs;\nclass LoadImage extends _commandbase_js__WEBPACK_IMPORTED_MODULE_0__[\"default\"] {\n  constructor() {\n    super();\n  }\n  undo() {\n    _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].removeLayer(this.undo_data.layer);\n    return;\n  }\n  func() {\n    var param = this.param;\n    var n = param.position;\n    var img = this.param.img;\n    var file = param.file;\n    var parent_layer = _layer_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"].findById(param.parent_layer_id);\n    var layer;\n    if (!this.undo_data) {\n      param.img = null;\n      layer = _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].createLayer(img);\n      this.undo_data = {\n        \"layer\": layer\n      };\n    } else {\n      layer = this.undo_data.layer;\n    }\n    parent_layer.append(param.position, layer);\n    layer.select();\n  }\n}\n_defineProperty(LoadImage, \"name\", \"LoadImage\");\ncommandObjs[\"loadImage\"] = LoadImage;\n\n//# sourceURL=webpack://hdrpaint/./src/command/loadImage.js?");

/***/ }),

/***/ "./src/command/moveLayer.js":
/*!**********************************!*\
  !*** ./src/command/moveLayer.js ***!
  \**********************************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var _hdrpaint_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../hdrpaint.js */ \"./src/hdrpaint.js\");\n/* harmony import */ var _layer_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../layer.js */ \"./src/layer.js\");\n/* harmony import */ var _commandbase_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./commandbase.js */ \"./src/command/commandbase.js\");\n//レイヤ位置移動\n\n\n\nclass MoveLayer extends _commandbase_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"] {\n  undo() {\n    this.func(true);\n  }\n  func(undo_flg) {\n    var param = this.param;\n    var layer = _layer_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].findById(param.layer_id);\n    //\t\tvar now_parent_layer= Layer.findParent(layer);\n    var now_parent_layer = _layer_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].findById(layer.parent);\n    var layers = now_parent_layer.children;\n    var next_parent_layer = param.parent_layer_id;\n    var position = param.position;\n    var layer_num = layers.indexOf(param.layer_id);\n    if (undo_flg) {\n      position = this.undo_data.before;\n      next_parent_layer = this.undo_data.before_parent;\n    }\n    next_parent_layer = _layer_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].findById(next_parent_layer);\n    if (position < 0 || next_parent_layer.children.length < position) {\n      return;\n    }\n    if (layer_num === position && now_parent_layer === next_parent_layer) {\n      return;\n    }\n    now_parent_layer.children.splice(layer_num, 1);\n    now_parent_layer.bubbleComposite();\n    var layers_container = layer.dom.parentNode;\n    next_parent_layer.append(position, param.layer_id);\n    if (!this.undo_data) {\n      this.undo_data = {\n        \"before\": layer_num,\n        \"before_parent\": now_parent_layer.id\n      };\n    }\n  }\n}\n;\nMoveLayer.prototype.name = \"moveLayer\";\n_hdrpaint_js__WEBPACK_IMPORTED_MODULE_0__[\"default\"].commandObjs[\"moveLayer\"] = MoveLayer;\n\n//# sourceURL=webpack://hdrpaint/./src/command/moveLayer.js?");

/***/ }),

/***/ "./src/command/multiCommand.js":
/*!*************************************!*\
  !*** ./src/command/multiCommand.js ***!
  \*************************************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var _hdrpaint_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../hdrpaint.js */ \"./src/hdrpaint.js\");\n//複数コマンドバッチ\n\nvar Command = _hdrpaint_js__WEBPACK_IMPORTED_MODULE_0__[\"default\"].Command;\nCommand[\"multiCommand\"] = function () {\n  return function (_log, undo_flg) {\n    var logs = _log.param.logs;\n    if (undo_flg) {\n      for (var li = logs.length; li--;) {\n        var log = logs[li];\n        Command[log.command](log, true);\n        var difs = log.undo_data.difs;\n        if (difs) {\n          //画像戻す\n          var param = log.param;\n          var layer_id = param.layer_id;\n          var layer = Layer.findById(param.layer_id);\n          for (var di = difs.length; di--;) {\n            var dif = difs[di];\n            Img.copy(layer.img, dif.x, dif.y, dif.img, 0, 0, dif.img.width, dif.img.height);\n          }\n        }\n      }\n    } else {\n      if (!_log.undo_data) {\n        _log.undo_data = {};\n      }\n      for (var li = 0; li < logs.length; li++) {\n        var log = logs[li];\n        log.func();\n      }\n    }\n  };\n}();\n\n//# sourceURL=webpack://hdrpaint/./src/command/multiCommand.js?");

/***/ }),

/***/ "./src/command/paste.js":
/*!******************************!*\
  !*** ./src/command/paste.js ***!
  \******************************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../lib/vector.js */ \"./src/lib/vector.js\");\n/* harmony import */ var _layer_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../layer.js */ \"./src/layer.js\");\n/* harmony import */ var _commandbase_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./commandbase.js */ \"./src/command/commandbase.js\");\n/* harmony import */ var _hdrpaint_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../hdrpaint.js */ \"./src/hdrpaint.js\");\n/* harmony import */ var _lib_img_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../lib/img.js */ \"./src/lib/img.js\");\n\n\n\n\n\nvar commandObjs = _hdrpaint_js__WEBPACK_IMPORTED_MODULE_3__[\"default\"].commandObjs;\nclass Paste extends _commandbase_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"] {\n  constructor() {\n    super();\n  }\n  undo() {\n    _hdrpaint_js__WEBPACK_IMPORTED_MODULE_3__[\"default\"].removeLayer(this.undo_data.layer);\n    return;\n  }\n  func() {\n    var param = this.param;\n    var n = param.position;\n    var layer;\n    if (!this.undo_data) {\n      var clip = _hdrpaint_js__WEBPACK_IMPORTED_MODULE_3__[\"default\"].clipboard;\n      var img = hdrpaint.createImg(clip.width, clip.height);\n      img.copy(0, 0, clip, 0, 0, clip.width, clip.height);\n      var rectangle = _hdrpaint_js__WEBPACK_IMPORTED_MODULE_3__[\"default\"].getSelectArea();\n      layer = _hdrpaint_js__WEBPACK_IMPORTED_MODULE_3__[\"default\"].createLayer(img.id, param.composite_flg);\n      layer.position[0] = rectangle.x;\n      layer.position[1] = rectangle.y;\n      this.undo_data = {\n        \"layer\": layer\n      };\n    } else {\n      layer = this.undo_data.layer;\n    }\n    var parentLayer = _layer_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].findById(param.parent);\n    parentLayer.append(n, layer.id);\n    hdrpaint.selectLayer(layer.id);\n    return layer;\n  }\n}\ncommandObjs[\"paste\"] = Paste;\n\n//# sourceURL=webpack://hdrpaint/./src/command/paste.js?");

/***/ }),

/***/ "./src/command/resizeCanvas.js":
/*!*************************************!*\
  !*** ./src/command/resizeCanvas.js ***!
  \*************************************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../lib/vector.js */ \"./src/lib/vector.js\");\n/* harmony import */ var _lib_img_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../lib/img.js */ \"./src/lib/img.js\");\n/* harmony import */ var _hdrpaint_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../hdrpaint.js */ \"./src/hdrpaint.js\");\n/* harmony import */ var _commandbase_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./commandbase.js */ \"./src/command/commandbase.js\");\n/* harmony import */ var _layer_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../layer.js */ \"./src/layer.js\");\n\n\n\n\n\nclass ResizeCanvas extends _commandbase_js__WEBPACK_IMPORTED_MODULE_3__[\"default\"] {\n  undo() {\n    this.func(true);\n  }\n  func(undo_flg) {\n    var param = this.param;\n    var width = param.width;\n    var height = param.height;\n    var old_width = preview.width;\n    var old_height = preview.height;\n    if (undo_flg) {\n      width = this.undo_data.width;\n      height = this.undo_data.height;\n    }\n    if (!this.undo_data) {\n      this.undo_data = {\n        \"width\": old_width,\n        \"height\": old_height\n      };\n    }\n    preview.width = width;\n    preview.height = height;\n    preview_ctx_imagedata = preview_ctx.createImageData(width, height);\n    bloomed_img = new _lib_img_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"](width, height);\n    bloom_img = new _lib_img_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"](width, height);\n    var root_layer = hdrpaint.root_layer;\n    root_layer.width = width;\n    root_layer.height = height;\n    root_layer.img = new _lib_img_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"](width, height);\n    root_layer.img_id = -1;\n    _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec2.setValues(root_layer.size, width, height);\n    root_layer.composite();\n  }\n}\n;\nResizeCanvas.prototype.name = \"resizeCavnas\";\n_hdrpaint_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"].commandObjs[\"resizeCanvas\"] = ResizeCanvas;\n\n//# sourceURL=webpack://hdrpaint/./src/command/resizeCanvas.js?");

/***/ }),

/***/ "./src/command/resizeLayer.js":
/*!************************************!*\
  !*** ./src/command/resizeLayer.js ***!
  \************************************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var _hdrpaint_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../hdrpaint.js */ \"./src/hdrpaint.js\");\n/* harmony import */ var _commandlog_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../commandlog.js */ \"./src/commandlog.js\");\n/* harmony import */ var _commandbase_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./commandbase.js */ \"./src/command/commandbase.js\");\n/* harmony import */ var _layer_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../layer.js */ \"./src/layer.js\");\n/* harmony import */ var _lib_img_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../lib/img.js */ \"./src/lib/img.js\");\n//リサイズレイヤ\n//\n\n\n\n\n\nclass ResizeLayer extends _commandbase_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"] {\n  undo() {\n    this.func(true);\n  }\n  func(undo_flg) {\n    var param = this.param;\n    if (param.layer_id === -1) {\n      if (undo_flg) {\n        for (var li = this.cmds.length; li--;) {\n          this.cmds[li].undo();\n        }\n        return;\n      }\n\n      //全レイヤ一括の場合バッチ化\n      var cmds = [];\n      var layers = _layer_js__WEBPACK_IMPORTED_MODULE_3__[\"default\"].layerArray();\n      for (var li = 0; li < layers.length; li++) {\n        var layer = layers[li];\n        if (layer === _hdrpaint_js__WEBPACK_IMPORTED_MODULE_0__[\"default\"].root_layer) {\n          continue;\n        }\n        var cmd = new ResizeLayer();\n        cmd.param = {\n          \"layer_id\": layer.id,\n          \"width\": param.width,\n          \"height\": param.height\n        };\n        cmd.func();\n        cmds.push(cmd);\n      }\n      this.cmds = cmds;\n      return;\n    }\n    var layer = _layer_js__WEBPACK_IMPORTED_MODULE_3__[\"default\"].findById(param.layer_id);\n    var old_img = hdrpaint.getImgById(layer.img_id);\n    if (!old_img) {\n      return;\n    }\n    var old_width = old_img.width;\n    var old_height = old_img.height;\n    var width = param.width;\n    var height = param.height;\n    if (undo_flg) {\n      width = this.undo_data.width;\n      height = this.undo_data.height;\n    }\n    layer.width = width;\n    layer.height = height;\n\n    //差分ログ作成\n    if (!this.undo_data) {\n      this.undo_data = {\n        \"width\": old_width,\n        \"height\": old_height\n      };\n      var dx = old_width - width;\n      var dy = old_height - height;\n      this.undo_data.difs = [];\n      var dif;\n      if (dx > 0) {\n        dif = _hdrpaint_js__WEBPACK_IMPORTED_MODULE_0__[\"default\"].createDif(old_img, width, 0, dx, old_height);\n        this.undo_data.difs.push(dif);\n      }\n      if (dy > 0) {\n        dif = _hdrpaint_js__WEBPACK_IMPORTED_MODULE_0__[\"default\"].createDif(old_img, 0, height, old_width, dy);\n        this.undo_data.difs.push(dif);\n      }\n    }\n    var new_img = hdrpaint.createImg(width, height);\n    layer.img_id = new_img.id;\n    layer.size[0] = width;\n    layer.size[1] = height;\n    _lib_img_js__WEBPACK_IMPORTED_MODULE_4__[\"default\"].copy(new_img, 0, 0, old_img, 0, 0, old_img.width, old_img.height);\n    layer.refreshDiv();\n    layer.registRefreshThumbnail();\n    if (layer.parent) {\n      var parentLayer = _layer_js__WEBPACK_IMPORTED_MODULE_3__[\"default\"].findById(layer.parent);\n      parentLayer.bubbleComposite();\n    }\n  }\n}\n;\nResizeLayer.prototype.name = \"resizeLayer\";\n_hdrpaint_js__WEBPACK_IMPORTED_MODULE_0__[\"default\"].commandObjs[\"resizeLayer\"] = ResizeLayer;\n\n//# sourceURL=webpack://hdrpaint/./src/command/resizeLayer.js?");

/***/ }),

/***/ "./src/command/translate.js":
/*!**********************************!*\
  !*** ./src/command/translate.js ***!
  \**********************************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var _hdrpaint_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../hdrpaint.js */ \"./src/hdrpaint.js\");\n/* harmony import */ var _layer_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../layer.js */ \"./src/layer.js\");\n/* harmony import */ var _commandbase_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./commandbase.js */ \"./src/command/commandbase.js\");\n\n\n\nclass TranslateLayer extends _commandbase_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"] {\n  undo() {\n    this.param.x *= -1;\n    this.param.y *= -1;\n    this.func();\n    this.param.x *= -1;\n    this.param.y *= -1;\n  }\n  func() {\n    var param = this.param;\n    var layer = _layer_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].findById(param.layer_id);\n    var x = param.x;\n    var y = param.y;\n    if (!this.undo_data) {\n      this.undo_data = {};\n    }\n    if (!layer) {\n      //レイヤ指定無しの場合はルート直下のレイヤすべてを移動\n      var layers = root_layer.children;\n      for (var li = 0; li < layers.length; li++) {\n        var l = layers[li];\n        l.position[0] += x;\n        l.position[1] += y;\n        if (isNaN(l.position[0])) {\n          l.position[0] = 0;\n        }\n        if (isNaN(l.position[1])) {\n          l.position[1] = 0;\n        }\n        l.refreshDiv();\n      }\n      root_layer.composite();\n    } else {\n      layer.position[0] += x;\n      layer.position[1] += y;\n      if (isNaN(layer.position[0])) {\n        layer.position[0] = 0;\n      }\n      if (isNaN(layer.position[1])) {\n        layer.position[1] = 0;\n      }\n      layer.refreshDiv();\n      layer.refreshImg();\n    }\n  }\n}\n;\nTranslateLayer.prototype.name = \"translateLayer\";\n_hdrpaint_js__WEBPACK_IMPORTED_MODULE_0__[\"default\"].commandObjs[\"translateLayer\"] = TranslateLayer;\n\n//# sourceURL=webpack://hdrpaint/./src/command/translate.js?");

/***/ }),

/***/ "./src/commandlog.js":
/*!***************************!*\
  !*** ./src/commandlog.js ***!
  \***************************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": function() { return /* binding */ CommandLog; }\n/* harmony export */ });\n/* harmony import */ var _lib_util_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./lib/util.js */ \"./src/lib/util.js\");\n/* harmony import */ var _layer_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./layer.js */ \"./src/layer.js\");\n/* harmony import */ var _lib_img_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./lib/img.js */ \"./src/lib/img.js\");\n\n\nfunction _defineProperty(obj, key, value) { key = _toPropertyKey(key); if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\nfunction _toPropertyKey(arg) { var key = _toPrimitive(arg, \"string\"); return typeof key === \"symbol\" ? key : String(key); }\nfunction _toPrimitive(input, hint) { if (typeof input !== \"object\" || input === null) return input; var prim = input[Symbol.toPrimitive]; if (prim !== undefined) { var res = prim.call(input, hint || \"default\"); if (typeof res !== \"object\") return res; throw new TypeError(\"@@toPrimitive must return a primitive value.\"); } return (hint === \"string\" ? String : Number)(input); }\n\n\n\nlet undo_max = 10; //undo情報最大保持ステップ数\nlet command_log_cursor = -1; //現在のログ位置(undo redoで移動する)\nlet log_id = 0;\nclass CommandLog {\n  //ログ制御\n  constructor() {\n    this.obj = null;\n    this.option = null;\n  }\n  refreshLabel() {\n    var log = this;\n    //optionのテキストをセット\n    var label = \"\" + (\"0000\" + log.id).substr(-4) + \"| \";\n    label = label + log.obj.toString();\n    _lib_util_js__WEBPACK_IMPORTED_MODULE_0__[\"default\"].setText(this.option, label);\n  }\n  static reset() {\n    //コマンドログとヒストリをすべて削除\n    log_id = 0;\n    var options = inputs[\"history\"].options;\n    for (var i = options.length; i--;) {\n      inputs[\"history\"].removeChild(options[i]);\n    }\n    CommandLog.command_logs.length = 0;\n    command_log_cursor = -1;\n  }\n  static moveLog(n) {\n    //現在の処理を強制終了\n    pen_log = null;\n    if (pen_func) {\n      pen_func.end_flg = 1;\n      pen_func.pen_log.obj.param.points.length = pen_func.idx;\n      pen_func = null;\n    }\n\n    //指定された番号のコマンドログが実行された状態にする\n    for (; command_log_cursor < n;) {\n      //リドゥ\n      command_log_cursor++;\n      var log = CommandLog.command_logs[command_log_cursor];\n      log.obj.func();\n    }\n    for (; command_log_cursor > n;) {\n      //アンドゥ\n      var log = CommandLog.command_logs[command_log_cursor];\n      log.obj.undo();\n      command_log_cursor--;\n    }\n  }\n  static createLog(command, param, flg) {\n    //ログオブジェクトを作成する\n    var log = null;\n    if (command_log_cursor >= 0 && !flg) {\n      var current_log = CommandLog.command_logs[command_log_cursor];\n      var log_command = current_log.obj;\n      if (log_command) {\n        if (command === log_command.name) {\n          if (command === \"changeLayerAttribute\") {\n            if (log_command.param.layer_id === param.layer_id && log_command.param.name === param.name) {\n              log = current_log;\n            }\n          } else if (command === \"translateLayer\") {\n            if (log_command.param.layer_id === param.layer_id) {\n              log = current_log;\n            }\n          } else if (command === \"moveLayer\") {\n            if (log_command.param.layer_id === param.layer_id) {\n              log = current_log;\n            }\n          }\n        }\n      }\n    }\n    //カーソル以降のヒストリ削除\n    CommandLog.command_logs.splice(command_log_cursor + 1, CommandLog.command_logs.length - (command_log_cursor + 1));\n    if (!log) {\n      log = new CommandLog();\n      log.id = log_id;\n      log_id++;\n      command_log_cursor++;\n      CommandLog.command_logs.push(log);\n    }\n    return log;\n  }\n  static appendOption() {\n    //ヒストリ追加\n\n    var options = inputs[\"history\"].options;\n\n    //現在のカーソル以降で一番小さいoptionを探す\n    var option = null;\n    var idx = options.length;\n    for (; idx--;) {\n      if (options[idx].value < command_log_cursor) {\n        break;\n      }\n      option = options[idx];\n    }\n    idx++;\n    for (var oi = options.length - 1; oi > idx; oi--) {\n      //カーソル以降のoptionを1こ残して削除\n      inputs[\"history\"].removeChild(options[oi]);\n    }\n    if (!option) {\n      //optionがない場合は新規追加\n      option = document.createElement(\"option\");\n      inputs[\"history\"].appendChild(option);\n    }\n    var log = CommandLog.command_logs[command_log_cursor];\n    option.value = command_log_cursor;\n    log.option = option;\n    //log.refreshLabel();\n    //\t\tvar label=\"\" + (\"0000\" + log.id).substr(-4) + \"| \" \n    //\t\t\t+ log.command+\"(\"+param_txt+\")\";\n    //\t\tUtil.setText(option, label);\n\n    //選択状態にする\n    inputs[\"history\"].selectedIndex = options.length - 1;\n    if (options.length > undo_max) {\n      //アンドゥ制限超えた部分を無効化\n      var old_option = options[options.length - undo_max - 1];\n      var old_log = CommandLog.command_logs[old_option.value];\n      old_option.setAttribute(\"disabled\", \"disabled\");\n      old_log.undo_data = null;\n    }\n    if (options.length > 10) {\n      inputs[\"history\"].removeChild(options[0]);\n    }\n    return option;\n  }\n}\n_defineProperty(CommandLog, \"command_logs\", []);\n\n//# sourceURL=webpack://hdrpaint/./src/commandlog.js?");

/***/ }),

/***/ "./src/file.js":
/*!*********************!*\
  !*** ./src/file.js ***!
  \*********************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": function() { return /* binding */ FileManager; }\n/* harmony export */ });\n/* harmony import */ var _lib_util_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./lib/util.js */ \"./src/lib/util.js\");\n/* harmony import */ var _lib_vector_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./lib/vector.js */ \"./src/lib/vector.js\");\n/* harmony import */ var _hdrpaint_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./hdrpaint.js */ \"./src/hdrpaint.js\");\n/* harmony import */ var _lib_img_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./lib/img.js */ \"./src/lib/img.js\");\n/* harmony import */ var _brush_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./brush.js */ \"./src/brush.js\");\n/* harmony import */ var _lib_zip_js__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./lib/zip.js */ \"./src/lib/zip.js\");\n/* harmony import */ var _redraw_js__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./redraw.js */ \"./src/redraw.js\");\n/* harmony import */ var _layer_js__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./layer.js */ \"./src/layer.js\");\n/* harmony import */ var _commandlog_js__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./commandlog.js */ \"./src/commandlog.js\");\n\n\n\n\n\n\n\n\n\nvar loadHpd_ = function (buffer) {\n  var files = _lib_zip_js__WEBPACK_IMPORTED_MODULE_5__[\"default\"].read(buffer);\n  var doc_file = files.find(function (f) {\n    return f.name === \"doc.txt\";\n  });\n  if (!doc_file) {\n    return;\n  }\n  _redraw_js__WEBPACK_IMPORTED_MODULE_6__[\"default\"].disableRefresh();\n  if (hdrpaint.root_layer) {\n    hdrpaint.removeLayer(hdrpaint.root_layer.id);\n    //hdrpaint.commandObjs.deleteLayer({param:{\"layer_id\":hdrpaint.root_layer.id}});\n  }\n  var doc_data = JSON.parse(_lib_util_js__WEBPACK_IMPORTED_MODULE_0__[\"default\"].utf8ToString(doc_file.data));\n\n  //情報セット\n  var keys = Object.keys(doc_data);\n  for (var ki = 0; ki < keys.length; ki++) {\n    var id = keys[ki];\n    var input = inputs[id];\n    if (!input) {\n      continue;\n    }\n    input.value = doc_data[id];\n    if (input.type === \"checkbox\" && input.value === \"1\") {\n      input.checked = true;\n    }\n  }\n  _layer_js__WEBPACK_IMPORTED_MODULE_7__[\"default\"].layer_id_count = doc_data.layer_id_count;\n  var brushes = _hdrpaint_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"].brushes;\n  brushes = [];\n  for (var bi = 0; bi < doc_data.brushes.length; bi++) {\n    //ブラシ読み込み\n    var doc_brush = doc_data.brushes[bi];\n    var brush = _brush_js__WEBPACK_IMPORTED_MODULE_4__[\"default\"].create();\n    brushes.push(brush);\n\n    //パラメータ設定\n    var id = brush.id;\n    setParam(brush, doc_brush);\n    brush.id = id;\n    brush.refresh();\n  }\n  _brush_js__WEBPACK_IMPORTED_MODULE_4__[\"default\"].refreshBrush();\n  for (var i = 0; i < files.length; i++) {\n    var file = files[i];\n    if (file.name.indexOf(\".exr\") < 0) {\n      continue;\n    }\n    var id = file.name.replace(\".exr\", \"\");\n    id = Number(id);\n    hdrpaint.imgs[id] = _lib_img_js__WEBPACK_IMPORTED_MODULE_3__[\"default\"].loadExr(file.data);\n  }\n  hdrpaint.layers = [];\n  hdrpaint.layer_id_count = 0;\n  for (var li = 0; li < doc_data.layers.length; li++) {\n    //レイヤ読み込み\n    var layer;\n    var doc_layer = doc_data.layers[li];\n    switch (parseInt(doc_layer.type)) {\n      case 0:\n        //通常レイヤ\n        layer = hdrpaint.createLayer(doc_layer.img_id, 0);\n        break;\n      default:\n        //グループレイヤ\n        layer = _hdrpaint_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"].createModifier(doc_layer.modifier);\n        break;\n    }\n\n    //layers.push(layer);\n\n    //レイヤパラメータ設定\n    var keys = Object.keys(doc_layer);\n    for (var ki = 0; ki < keys.length; ki++) {\n      if (typeof layer[keys[ki]] === \"number\") {\n        layer[keys[ki]] = parseFloat(doc_layer[keys[ki]]);\n      } else {\n        layer[keys[ki]] = doc_layer[keys[ki]];\n      }\n    }\n    hdrpaint.layers[layer.id] = layer;\n  }\n  for (var li = 0; li < hdrpaint.layers.length; li++) {\n    layer = hdrpaint.layers[li];\n    if (!layer) continue;\n    layer.refreshDiv();\n  }\n  hdrpaint.root_layer = hdrpaint.layers[1];\n  hdrpaint.root_layer_id = 1;\n  _hdrpaint_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"].onlyExecute(\"resizeCanvas\", {\n    \"width\": hdrpaint.root_layer.width,\n    \"height\": hdrpaint.root_layer.height\n  });\n  var maxid = 0;\n  //for(var li=0;li<layers.length;li++){\n  //\tvar layer = layers[li];\n  //\tlayer.refreshDiv();\n  //\tmaxid=Math.max(maxid,layer.id);\n  //}\n  //Hdrpaint.setLayerIdCount(maxid+1);\n  _redraw_js__WEBPACK_IMPORTED_MODULE_6__[\"default\"].enableRefresh();\n  _redraw_js__WEBPACK_IMPORTED_MODULE_6__[\"default\"].compositeAll();\n  _commandlog_js__WEBPACK_IMPORTED_MODULE_8__[\"default\"].reset();\n  if (brushes.length > 0) {\n    brushes[0].select();\n  }\n};\n_hdrpaint_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"].addDialog(\"loading\", `\n\t\tファイル読み込み中...\n\n\t\t`);\nvar setParam = function (dst, src) {\n  var keys = Object.keys(src);\n  for (var ki = 0; ki < keys.length; ki++) {\n    var key = keys[ki];\n    if (typeof dst[key] === \"number\") {\n      dst[key] = Number(src[key]);\n    } else {\n      dst[key] = src[key];\n    }\n  }\n};\nvar addBrush = function (buffer) {\n  var files = _lib_zip_js__WEBPACK_IMPORTED_MODULE_5__[\"default\"].read(buffer);\n  var doc_file = files.find(function (f) {\n    return f.name === \"doc.txt\";\n  });\n  if (!doc_file) {\n    return;\n  }\n  var doc_data = JSON.parse(_lib_util_js__WEBPACK_IMPORTED_MODULE_0__[\"default\"].utf8ToString(doc_file.data));\n  for (var bi = 0; bi < doc_data.brushes.length; bi++) {\n    //ブラシ読み込み\n    var doc_brush = doc_data.brushes[bi];\n    var brush = _brush_js__WEBPACK_IMPORTED_MODULE_4__[\"default\"].create();\n    brushes.push(brush);\n\n    //パラメータ設定\n    var id = brush.id;\n    setParam(brush, doc_brush);\n    brush.id = id;\n    brush.refresh();\n  }\n  _brush_js__WEBPACK_IMPORTED_MODULE_4__[\"default\"].refreshBrush();\n};\nclass FileManager {\n  constructor() {}\n  static saveHpd(e) {\n    //ドキュメントファイル保存\n    var files = [];\n    var doc_data = {};\n    var brushes = _hdrpaint_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"].brushes;\n    var layers = hdrpaint.layers;\n    var imgs = hdrpaint.imgs;\n    doc_data.layers = [];\n    for (var li = 0; li < imgs.length; li++) {\n      //通常レイヤ\n      if (!imgs[li]) {\n        continue;\n      }\n      var file = {};\n      files.push(file);\n      file.data = new Uint8Array(imgs[li].createExr(3));\n      file.name = li + \".exr\";\n    }\n    for (var li = 0; li < layers.length; li++) {\n      var layer = layers[li];\n      if (!layer) continue;\n      var layer2 = {};\n\n      //レイヤ情報収集\n      var keys = Object.keys(layer);\n      for (var ki = 0; ki < keys.length; ki++) {\n        layer2[keys[ki]] = layer[keys[ki]];\n      }\n      delete layer2.img;\n      delete layer2.div;\n      delete layer2.dom;\n      delete layer2.aaadiv;\n      doc_data.layers.push(layer2);\n    }\n    //ブラシ情報セット\n    doc_data.brushes = [];\n    for (var bi = 0; bi < brushes.length; bi++) {\n      var brush = brushes[bi];\n      var brush2 = {};\n\n      //情報収集\n      var keys = Object.keys(brush);\n      for (var ki = 0; ki < keys.length; ki++) {\n        brush2[keys[ki]] = brush[keys[ki]];\n      }\n      //不要なデータを削除\n      delete brush2.div;\n      delete brush2.dom;\n      doc_data.brushes.push(brush2);\n    }\n\n    //その他情報をセット\n    doc_data.canvas_width = preview.width;\n    doc_data.canvas_height = preview.height;\n    var keys = Object.keys(inputs);\n    for (var i = 0; i < keys.length; i++) {\n      var id = keys[i];\n      var input = inputs[id];\n      doc_data[id] = input.value;\n      if (input.type === \"checkbox\") {\n        if (input.checked) {\n          doc_data[id] = 1;\n        } else {\n          doc_data[id] = 0;\n        }\n      }\n    }\n    doc_data.layer_id_count = _layer_js__WEBPACK_IMPORTED_MODULE_7__[\"default\"].layer_id_count;\n\n    //ドキュメント情報をdoc.txtとして書き込む\n    var file = {};\n    file.data = _lib_util_js__WEBPACK_IMPORTED_MODULE_0__[\"default\"].stringToUtf8(JSON.stringify(doc_data));\n    file.name = \"doc.txt\";\n    files.push(file);\n\n    //doc.txtと画像ファイルを無圧縮zipにする\n    var buffer = _lib_zip_js__WEBPACK_IMPORTED_MODULE_5__[\"default\"].create(files, 0);\n    var blob = new Blob([buffer], {\n      type: \"application/octet-stream\"\n    });\n    var a = e.target;\n    a.href = window.URL.createObjectURL(blob);\n    a.target = '_blank';\n    a.download = \"project.hpd\";\n  }\n  static loadHpd(file) {\n    _hdrpaint_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"].showDialog(\"loading\");\n    _lib_util_js__WEBPACK_IMPORTED_MODULE_0__[\"default\"].loadBinary(file, function (buffer) {\n      loadHpd_(buffer);\n      var log = _commandlog_js__WEBPACK_IMPORTED_MODULE_8__[\"default\"].createLog(\"loadDocumentFile\", {\n        \"file\": file.name\n      });\n      _commandlog_js__WEBPACK_IMPORTED_MODULE_8__[\"default\"].appendOption(log);\n      _hdrpaint_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"].closeDialog();\n    });\n  }\n  static saveHdr(e) {\n    var a = e.target;\n    var buffer = hdrpaint.root_layer.img.createExr(3);\n    var blob = new Blob([buffer], {\n      type: \"application/octet-stream\"\n    });\n    a.href = window.URL.createObjectURL(blob);\n    a.target = '_blank';\n    a.download = \"preview_hdr.exr\";\n  }\n  static saveLdr(e) {\n    var a = e.target;\n    a.href = preview.toDataURL(\"image/png\");\n    a.target = '_blank';\n    a.download = \"preview_ldr.png\";\n  }\n}\n\n//# sourceURL=webpack://hdrpaint/./src/file.js?");

/***/ }),

/***/ "./src/hdrpaint.js":
/*!*************************!*\
  !*** ./src/hdrpaint.js ***!
  \*************************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var _lib_util_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./lib/util.js */ \"./src/lib/util.js\");\n/* harmony import */ var _lib_img_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./lib/img.js */ \"./src/lib/img.js\");\n/* harmony import */ var _layer_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./layer.js */ \"./src/layer.js\");\n/* harmony import */ var _commandlog_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./commandlog.js */ \"./src/commandlog.js\");\n/* harmony import */ var _lib_vector_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./lib/vector.js */ \"./src/lib/vector.js\");\n/* harmony import */ var _lib_mat43_js__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./lib/mat43.js */ \"./src/lib/mat43.js\");\nfunction _defineProperty(obj, key, value) { key = _toPropertyKey(key); if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\nfunction _toPropertyKey(arg) { var key = _toPrimitive(arg, \"string\"); return typeof key === \"symbol\" ? key : String(key); }\nfunction _toPrimitive(input, hint) { if (typeof input !== \"object\" || input === null) return input; var prim = input[Symbol.toPrimitive]; if (prim !== undefined) { var res = prim.call(input, hint || \"default\"); if (typeof res !== \"object\") return res; throw new TypeError(\"@@toPrimitive must return a primitive value.\"); } return (hint === \"string\" ? String : Number)(input); }\n\n\n\n\n\n\nclass Hdrpaint {\n  constructor() {\n    _defineProperty(this, \"onlyExecute\", function (command, param) {\n      if (param.layer_id && command !== \"changeLayerAttribute\") {\n        var layer = _layer_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"].findById(param.layer_id);\n        if (layer) {\n          if (layer.lock || !layer.display) {\n            return;\n          }\n        }\n      }\n      var commandObjs = this.commandObjs;\n      var obj = new commandObjs[command]();\n      obj.param = param;\n      obj.func();\n    });\n    //ブレンドファンクション\n    _defineProperty(this, \"blendfuncs\", {});\n    _defineProperty(this, \"blendfuncsname\", [\"normal\", \"mul\", \"add\", \"sub\", \"transmit\"]);\n    _defineProperty(this, \"addDialog\", function (id, html) {\n      var div = document.createElement(\"div\");\n      div.id = id;\n      div.style.display = \"none\";\n      div.classList.add(\"area\");\n      div.classList.add(\"dialog\");\n      div.insertAdjacentHTML('beforeend', html);\n      var dialog_parent = document.querySelector(\".dialog_parent\");\n      dialog_parent.appendChild(div);\n    });\n    //モディファイア登録\n    _defineProperty(this, \"modifier\", {});\n    _defineProperty(this, \"registModifier\", mod => {\n      var name = mod.name;\n      this.modifier[name] = mod;\n\n      //オプション設定コントロール作成\n      var div = document.createElement(\"div\");\n      div.id = \"div_\" + name;\n      div.classList.add(\"modifier_param\");\n      div.insertAdjacentHTML('beforeend', mod.option);\n      var nodes = div.querySelectorAll(\"*[name]\");\n      for (var i = 0; i < nodes.length; i++) {\n        var node = nodes[i];\n        var nodename = node.getAttribute(\"name\");\n        node.setAttribute(\"title\", nodename);\n        node.setAttribute(\"bind:\", \"selected_layer.\" + nodename);\n      }\n      var dialog_parent = document.querySelector(\"#modifier_param_area\");\n      dialog_parent.appendChild(div);\n\n      //var area = document.querySelector(\"#modifier_area\");\n      //var input= document.createElement(\"input\");\n      //input.type=\"button\";\n      //input.title=name;\n      //input.value=name;\n      //area.appendChild(input);\n\n      this.stylesheet.insertRule(` \n\t\t\t#modifier_param_area[modifier=\"${name}\"] div#div_${name}{\n\t\t\t\tdisplay:inline;\n\t\t\t}\n\t\t`, this.stylesheet.cssRules.length);\n      var generator_select = document.querySelector(\"#generator_select\");\n      var filter_select = document.querySelector(\"#filter_select\");\n      var option = document.createElement(\"option\");\n      option.innerHTML = name;\n      option.value = name;\n      if (mod.type === \"generator\") {\n        generator_select.appendChild(option);\n      } else {\n        filter_select.appendChild(option);\n      }\n    });\n    _defineProperty(this, \"clearSelectArea\", () => {\n      //選択解除\n      this.selected_area_enable = false;\n    });\n    this.root_layer = null; //最上位レイヤ\n    this.selected_tool = \"pen\"; //選択しているツール\n    this.selected_layer_only = false; //選択レイヤのみプレビューに表示\n    this.color = new _lib_vector_js__WEBPACK_IMPORTED_MODULE_4__.Vec4();\n    this.cursor_color = new _lib_vector_js__WEBPACK_IMPORTED_MODULE_4__.Vec4(); //カーソル下のピクセル色\n    //現在選択状態にあるブラシ\n    this.selected_brush = null;\n    this.Command = {};\n    this.commandObjs = {};\n    this.painted_mask = new Float32Array(1024 * 1024);\n    //レイヤ\n    this.layers = [];\n    //画像データ\n    this.imgs = [];\n    //選択レイヤ\n    this.selected_layer = null;\n    this.selected_layer_id = -1;\n    //選択範囲\n    this.select_rectangle = null; //{x:0,y:0,x2:0,y2:0};\n    this.mode = \"\";\n    this.layer_id_count = 0;\n    this.img_id_count = 0;\n\n    //全ブラシ\n    this.brushes = [];\n\n    //ブラシ設定\n    this.brush_status = {};\n    this.post_effect = {\n      ch_bloom: false,\n      bloom_power: 0.2,\n      bloom_size: 8,\n      ev: 0,\n      ch_gamma: false,\n      gamma: 2.2\n    };\n  }\n\n  // レイヤの範囲を表す点線 \n  refreshLayerRectangle() {\n    if (!this.selected_layer) return;\n    var rect = document.querySelector(\".layer_rectangle\");\n    var doc = this.doc;\n    var scale = doc.scale / 100;\n    var absolute = new _lib_vector_js__WEBPACK_IMPORTED_MODULE_4__.Vec2();\n    var mat43 = new _lib_mat43_js__WEBPACK_IMPORTED_MODULE_5__[\"default\"]();\n    this.selected_layer.getAbsoluteMatrix(mat43);\n    mat43[9] = mat43[9] * scale + doc.canvas_pos[0];\n    mat43[10] = mat43[10] * scale + doc.canvas_pos[1];\n    var l = new _lib_vector_js__WEBPACK_IMPORTED_MODULE_4__.Vec3();\n    var s = new _lib_vector_js__WEBPACK_IMPORTED_MODULE_4__.Vec3();\n    var e = new _lib_vector_js__WEBPACK_IMPORTED_MODULE_4__.Vec3();\n    _lib_mat43_js__WEBPACK_IMPORTED_MODULE_5__[\"default\"].toLSE(l, s, e, mat43);\n    var x = +this.selected_layer.size[0] * (s[0] - mat43[0]) - this.selected_layer.size[1] * mat43[3];\n    var y = -this.selected_layer.size[0] * mat43[1] + this.selected_layer.size[1] * (s[1] - mat43[4]);\n    l[0] -= x * 0.5 * scale;\n    l[1] -= y * 0.5 * scale;\n    rect.style.left = l[0] - 1 + \"px\";\n    rect.style.top = l[1] - 1 + \"px\";\n    rect.style.width = this.selected_layer.size[0] * s[0] * scale + \"px\";\n    rect.style.height = this.selected_layer.size[1] * s[1] * scale + \"px\";\n    if (e[0] < 0) e[2] = Math.PI - e[2];\n    rect.style.transform = \"rotate(\" + e[2] + \"rad)\";\n    rect.style.display = \"inline-block\";\n  }\n\n  //選択範囲を示す点線\n  refreshSelectedRectangle() {\n    if (!this.select_rectangle) return;\n    var rect = document.querySelector(\".select_rectangle\");\n    var rectangle = this.select_rectangle;\n    var doc = this.doc;\n    var scale = doc.scale / 100;\n    rect.style.left = rectangle.x * scale + doc.canvas_pos[0] - 1 + \"px\";\n    rect.style.top = rectangle.y * scale + doc.canvas_pos[1] - 1 + \"px\";\n    rect.style.width = rectangle.w * scale + \"px\";\n    rect.style.height = rectangle.h * scale + \"px\";\n    rect.style.display = \"inline-block\";\n  }\n\n  //領域取得\n  getSelectArea() {\n    //領域選択されていない場合はレイヤー全体を選択\n    var rectangle = {};\n    var layer = this.selected_layer;\n    if (!this.select_rectangle) {\n      rectangle.x = 0;\n      rectangle.y = 0;\n      rectangle.w = layer.size[0];\n      rectangle.h = layer.size[1];\n    } else {\n      var absolute = new _lib_vector_js__WEBPACK_IMPORTED_MODULE_4__.Vec2();\n      layer.getAbsolutePosition(absolute);\n      rectangle.x = this.select_rectangle.x - absolute[0];\n      rectangle.y = this.select_rectangle.y - absolute[1];\n      rectangle.w = this.select_rectangle.w + this.select_rectangle.x - absolute[0];\n      rectangle.h = this.select_rectangle.h + this.select_rectangle.y - absolute[1];\n    }\n    rectangle.x = Math.max(Math.min(rectangle.x, layer.size[0]), 0);\n    rectangle.y = Math.max(Math.min(rectangle.y, layer.size[1]), 0);\n    rectangle.w = Math.max(Math.min(rectangle.w, layer.size[0]), 0);\n    rectangle.h = Math.max(Math.min(rectangle.h, layer.size[1]), 0);\n    rectangle.w -= rectangle.x;\n    rectangle.h -= rectangle.y;\n    return rectangle;\n  }\n  selectLayer(target_layer_id) {\n    //アクティブレイヤ変更\n    var target_layer = _layer_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"].findById(target_layer_id);\n    this.selected_layer = target_layer;\n    this.selected_layer_id = target_layer_id;\n    _layer_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"].eachLayers(function (layer) {\n      if (target_layer !== layer) {\n        //アクティブレイヤ以外の表示を非アクティブにする\n        layer.dom.classList.remove(\"active\");\n      } else {\n        layer.dom.classList.add(\"active\");\n      }\n    });\n    if (inputs[\"selected_layer_only\"].checked) {\n      refreshPreview(1);\n    }\n  }\n  setLayerIdCount(id) {\n    this.layer_id_count = id;\n  }\n  getLayerById(id) {\n    return this.layers[id];\n  }\n  getImgById(id) {\n    return this.imgs[id];\n  }\n  createImg(width, height) {\n    var img = new _lib_img_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"](width, height);\n    this.img_id_count++;\n    img.id = this.img_id_count;\n    this.imgs[img.id] = img;\n    var data = img.data;\n    for (var i = 0; i < data.length; i += 4) {\n      data[i + 0] = 1;\n      data[i + 1] = 1;\n      data[i + 2] = 1;\n      data[i + 3] = 0;\n    }\n    return img;\n  }\n  createLayer(img_id, composite_flg) {\n    var layer = null;\n    if (composite_flg) {\n      layer = new this.modifier[\"composite\"]();\n      //グループレイヤの場合\n    } else {\n      layer = new _layer_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"]();\n    }\n    if (layer.type == 1) {\n      layer.dom.classList.add(\"group\");\n    }\n\n    //layer_div.addEventListener(\"click\",layerSelect);\n\n    layer.img_id = img_id;\n    var img = this.imgs[img_id];\n    //\tlayer.img=img;\n    if (img) {\n      _lib_vector_js__WEBPACK_IMPORTED_MODULE_4__.Vec2.setValues(layer.size, img.width, img.height);\n    }\n    this.layer_id_count++;\n    layer.id = this.layer_id_count;\n    layer.name = \"layer\" + (\"0000\" + layer.id).slice(-4);\n    layer.refreshDiv();\n    layer.registRefreshThumbnail();\n    this.layers[layer.id] = layer;\n    return layer;\n  }\n  createModifier(modifier_name) {\n    var layer = new this.modifier[modifier_name]();\n    layer.type = 2;\n    if (layer.children) {\n      layer.dom.classList.add(\"group\");\n    }\n    //layer.dom.classList.add(\"modifier\");\n\n    layer.img = null;\n    this.layer_id_count++;\n    layer.id = this.layer_id_count;\n    layer.modifier = modifier_name;\n    layer.name = modifier_name + (\"0000\" + layer.id).slice(-4);\n    layer.refreshDiv();\n    layer.registRefreshThumbnail();\n    this.layers[layer.id] = layer;\n    return layer;\n  }\n  createNewCompositeLayer(e) {\n    //新規コンポジットレイヤを作成\n    var data = this.getPosition();\n    var width = preview.width;\n    var height = preview.height;\n\n    //\t\tthis.executeCommand(\"createNewCompositeLayer\",{\"parent\":data.parent_layer.id,\"position\":data.position,\"width\":width,\"height\":height,\"composite_flg\":1});\n    this.executeCommand(\"createmodifier\", {\n      \"modifier\": \"composite\",\n      \"parent_layer_id\": data.parent_layer.id,\n      \"position\": data.position,\n      \"width\": data.parent_layer.size[0],\n      \"height\": data.parent_layer.size[1]\n    });\n  }\n  createNewModifier(e) {\n    if (e.target.value === \"\" || !e.target.value) {\n      return;\n    }\n    var modifier = e.target.value;\n    //新規モディファイア\n    var data = this.getPosition();\n    this.executeCommand(\"createmodifier\", {\n      \"modifier\": modifier,\n      \"parent_layer_id\": data.parent_layer.id,\n      \"position\": data.position,\n      \"width\": data.parent_layer.size[0],\n      \"height\": data.parent_layer.size[1]\n    });\n\n    //選択状態を元に戻す\n    var generator_select = document.querySelector(\"#generator_select\");\n    generator_select.options[0].selected = true;\n  }\n  copylayer(e) {\n    //レイヤコピー\n\n    var data = this.getPosition();\n    this.executeCommand(\"copylayer\", {\n      \"position\": data.position,\n      \"parent\": data.parent_layer.id,\n      \"src_layer_id\": this.selected_layer.id\n    });\n  }\n  redo() {\n    //リドゥ\n\n    var option_index = inputs[\"history\"].selectedIndex;\n    var options = inputs[\"history\"].options;\n    if (option_index === options.length - 1) {\n      return;\n    }\n    option_index++;\n    var option = options[option_index];\n    inputs[\"history\"].selectedIndex = option_index;\n    _commandlog_js__WEBPACK_IMPORTED_MODULE_3__[\"default\"].moveLog(parseInt(option.value));\n  }\n  undo() {\n    //アンドゥ\n\n    var option_index = inputs[\"history\"].selectedIndex;\n    var options = inputs[\"history\"].options;\n    if (option_index === 0) {\n      return;\n    }\n    var option = options[option_index - 1];\n    if (option.disabled) {\n      return;\n    }\n    option_index--;\n    inputs[\"history\"].selectedIndex = option_index;\n    _commandlog_js__WEBPACK_IMPORTED_MODULE_3__[\"default\"].moveLog(parseInt(option.value));\n  }\n  createNewLayer(e) {\n    //新規レイヤを作成\n\n    var data = this.getPosition();\n    var width = data.parent_layer.size[0];\n    var height = data.parent_layer.size[1];\n    this.executeCommand(\"createNewLayer\", {\n      \"position\": data.position,\n      \"parent\": data.parent_layer.id,\n      \"width\": width,\n      \"height\": height\n    });\n  }\n  getPosition() {\n    var data = {};\n    if (!this.selected_layer) {\n      data.parent_layer_id = Hdrpaint.root_layer.id;\n      data.parent_layer = Hdrpaint.root_layer;\n      data.position = Hdrpaint.root_layer.length;\n    } else {\n      var parent = _layer_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"].findById(this.selected_layer.parent);\n      if (this.selected_layer.children && this.selected_layer.dom.classList.contains(\"open\")) {\n        data.parent_layer_id = this.selected_layer.id;\n        data.parent_layer = this.selected_layer;\n        data.position = this.selected_layer.length;\n      } else {\n        data.parent_layer_id = parent.id;\n        data.parent_layer = parent;\n        data.position = parent.children.indexOf(this.selected_layer_id) + 1;\n      }\n    }\n    return data;\n  }\n  loadImageFile_(file) {\n    var data = this.getPosition();\n    var fu = img => {\n      var log = this.executeCommand(\"loadImage\", {\n        \"img\": img,\n        \"file\": file.name,\n        \"parent_layer_id\": data.parent_layer_id,\n        \"position\": data.position\n      });\n    };\n    if (/.*exr$/.test(file.name)) {\n      _lib_img_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].loadExr(file, 0, fu);\n    } else if (/^image\\//.test(file.type)) {\n      _lib_img_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].loadImg(file, 0, fu);\n    }\n  }\n  createDif(img, left, top, width, height) {\n    if (img instanceof _layer_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"]) {\n      img = img.img;\n    }\n    //更新領域の古い情報を保存\n    var dif_img = new _lib_img_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"](width, height);\n    _lib_img_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].copy(dif_img, 0, 0, img, left, top, width, height);\n    var dif = {};\n    dif.img = dif_img;\n    dif.x = left;\n    dif.y = top;\n    return dif;\n  }\n  removeLayer(layer_id) {\n    var layer = _layer_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"].findById(layer_id);\n    var parent_layer = _layer_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"].findById(layer.parent);\n    if (!parent_layer) return;\n    var children = parent_layer.children;\n    var idx = children.indexOf(layer_id);\n    children.splice(idx, 1);\n    if (layer == this.selected_layer) {\n      if (parent_layer.children.length > 0) {\n        if (parent_layer.children.length <= idx) {\n          idx = parent_layer.children.length - 1;\n        }\n        this.selectLayer(parent_layer.children[idx]);\n      }\n    }\n    parent_layer.refreshDiv();\n    parent_layer.bubbleComposite();\n\n    //this.layers[layer.id]=null;\n  }\n  executeCommand(command, param, flg) {\n    if (param.layer_id && command !== \"changeLayerAttribute\" && command !== \"moveLayer\") {\n      var layer = _layer_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"].findById(param.layer_id);\n      if (layer) {\n        if (layer.lock || !layer.display) {\n          return null;\n        }\n      }\n    }\n    var log = _commandlog_js__WEBPACK_IMPORTED_MODULE_3__[\"default\"].createLog(command, param, flg);\n    _commandlog_js__WEBPACK_IMPORTED_MODULE_3__[\"default\"].appendOption();\n    var commandObjs = this.commandObjs;\n    if (!log.obj) {\n      log.obj = new commandObjs[command]();\n    }\n    log.obj.param = param;\n    log.obj.func();\n    log.refreshLabel();\n    return log;\n  }\n  addFilter(id, name) {\n    var a = document.createElement(\"a\");\n    a.id = id;\n    _lib_util_js__WEBPACK_IMPORTED_MODULE_0__[\"default\"].setText(a, name);\n    a.setAttribute(\"href\", \"#\");\n    var area = document.getElementById(\"additional\");\n    area.appendChild(a);\n  }\n  showDialog(id) {\n    document.getElementById(id).style.display = \"inline\";\n    document.querySelector(\".dialog_parent\").style.display = \"flex\";\n  }\n  closeDialog() {\n    var parent = document.querySelector(\".dialog_parent\");\n    parent.style.display = \"none\";\n    for (var i = 0; i < parent.children.length; i++) {\n      parent.children[i].style.display = \"none\";\n    }\n  }\n}\nconst hdrpaint = new Hdrpaint();\nwindow.hdrpaint = hdrpaint;\n\n//動的スタイルシート生成\nvar newStyle = document.createElement('style');\nnewStyle.type = \"text/css\";\ndocument.getElementsByTagName('head').item(0).appendChild(newStyle);\nhdrpaint.stylesheet = document.styleSheets.item(document.styleSheets.length - 1);\n/* harmony default export */ __webpack_exports__[\"default\"] = (hdrpaint);\nhdrpaint.registModifier(_layer_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"]);\n\n//# sourceURL=webpack://hdrpaint/./src/hdrpaint.js?");

/***/ }),

/***/ "./src/index.js":
/*!**********************!*\
  !*** ./src/index.js ***!
  \**********************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var _main_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./main.js */ \"./src/main.js\");\n\n\n//# sourceURL=webpack://hdrpaint/./src/index.js?");

/***/ }),

/***/ "./src/layer.js":
/*!**********************!*\
  !*** ./src/layer.js ***!
  \**********************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": function() { return /* binding */ Layer; }\n/* harmony export */ });\n/* harmony import */ var _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./lib/vector.js */ \"./src/lib/vector.js\");\n/* harmony import */ var _lib_img_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./lib/img.js */ \"./src/lib/img.js\");\n/* harmony import */ var _redraw_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./redraw.js */ \"./src/redraw.js\");\n/* harmony import */ var _hdrpaint_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./hdrpaint.js */ \"./src/hdrpaint.js\");\n/* harmony import */ var _lib_util_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./lib/util.js */ \"./src/lib/util.js\");\n/* harmony import */ var _lib_mat43_js__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./lib/mat43.js */ \"./src/lib/mat43.js\");\n\n\nfunction _defineProperty(obj, key, value) { key = _toPropertyKey(key); if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\nfunction _toPropertyKey(arg) { var key = _toPrimitive(arg, \"string\"); return typeof key === \"symbol\" ? key : String(key); }\nfunction _toPrimitive(input, hint) { if (typeof input !== \"object\" || input === null) return input; var prim = input[Symbol.toPrimitive]; if (prim !== undefined) { var res = prim.call(input, hint || \"default\"); if (typeof res !== \"object\") return res; throw new TypeError(\"@@toPrimitive must return a primitive value.\"); } return (hint === \"string\" ? String : Number)(input); }\n\n\n\n\n\n\nvar arr = new _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec4();\nlet stackThumbnail = [];\nlet composite_img = new _lib_img_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"](512, 512);\nlet composite_area = new _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec4();\nvar drag_layer = null;\nvar refreshThumbnail = function () {\n  //サムネイル更新\n  if (Layer.enableRefreshThumbnail) {\n    var layer = stackThumbnail.shift();\n    layer.refreshThumbnail();\n  }\n  if (stackThumbnail.length > 0) {\n    window.requestAnimationFrame(function (e) {\n      refreshThumbnail();\n    });\n  }\n};\nvar getLayerFromDiv = function (div) {\n  //選択したdivのレイヤ本体を取得\n  var result_layer = null;\n  Layer.eachLayers(function (layer) {\n    if (layer.dom == div) {\n      result_layer = layer;\n      return true;\n    }\n  });\n  return result_layer;\n};\n//レイヤサムネイル作成用\nvar thumbnail_img = new _lib_img_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"](64, 64, 1);\n//ジェネレータサムネイル作成用\nvar gen_thumbnail_img = new _lib_img_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"](240, 40, 0);\nvar click = function (e) {\n  //レイヤー一覧クリック時、クリックされたものをアクティブ化する\n  var layer = getLayerFromDiv(e.currentTarget);\n  hdrpaint.selectLayer(layer.id);\n  e.stopPropagation();\n};\n\n//ドラッグ＆ドロップによるレイヤ順編集\nvar DragStart = function (event) {\n  //ドラッグ開始\n  drag_layer = getLayerFromDiv(event.currentTarget);\n  //     event.dataTransfer.setData(\"text\", drag_layer.id);\n  drag_layer.select;\n  event.stopPropagation();\n};\nvar DragOver = function (event) {\n  event.preventDefault();\n  // event.dataTransfer.dropEffect = \"move\";\n};\nvar DragEnter = function (event) {\n  //ドラッグ移動時\n  var drop_layer = getLayerFromDiv(event.currentTarget.parentNode);\n  if (!drop_layer) {\n    return;\n  }\n  event.stopPropagation();\n  if (drag_layer === drop_layer) {\n    //自分自身の場合は無視\n    return;\n  }\n  if (drag_layer.children) {\n    //グループレイヤドラッグ時は、自身の子になるかチェックし、その場合は無視\n    var flg = false;\n    Layer.bubble_func(drop_layer.id, function (layer) {\n      if (layer === drag_layer) {\n        flg = true;\n        return true;\n      }\n    });\n    if (flg) {\n      return;\n    }\n  }\n  var parent_layer = hdrpaint.getLayerById(drop_layer.parent); //Layer.findParent(drop_layer);\n  var position = parent_layer.children.indexOf(drop_layer);\n  var now_position = parent_layer.children.indexOf(drag_layer);\n  if (now_position < 0) {\n    position++;\n  }\n  _hdrpaint_js__WEBPACK_IMPORTED_MODULE_3__[\"default\"].executeCommand(\"moveLayer\", {\n    \"layer_id\": drag_layer.id,\n    \"parent_layer_id\": parent_layer.id,\n    \"position\": position\n  });\n};\nvar DragEnterChild = function (event) {\n  //ドラッグ移動時\n  var drop_layer = getLayerFromDiv(event.currentTarget);\n  event.stopPropagation();\n  var drag = parseInt(event.dataTransfer.getData(\"text\"));\n  var parent_layer = getLayerFromDiv(event.currentTarget.parentNode);\n  if (drag_layer.type !== 0) {\n    //グループレイヤドラッグ時は、自身の子になるかチェックし、その場合は無視\n    var flg = false;\n    Layer.bubble_func(parent_layer.id, function (layer) {\n      if (layer === drag_layer) {\n        flg = true;\n        return true;\n      }\n    });\n    if (flg) {\n      return;\n    }\n  }\n  var position = 0;\n  _hdrpaint_js__WEBPACK_IMPORTED_MODULE_3__[\"default\"].executeCommand(\"moveLayer\", {\n    \"layer_id\": drag_layer.id,\n    \"parent_layer_id\": parent_layer.id,\n    \"position\": position\n  });\n};\nvar opencloseClick = function (e) {\n  var layer = getLayerFromDiv(event.target.parentNode);\n  layer.dom.classList.toggle(\"open\");\n  e.preventDefault();\n  return false;\n};\nclass Layer {\n  constructor() {\n    this.id = -1;\n    this.name = \"\";\n    this.display = true;\n    this.lock = false;\n    this.power = 0.0;\n    this.alpha = 1.0;\n    this.blendfunc = \"normal\";\n    this.modifier = \"layer\";\n    this.div = null;\n    this.img = null;\n    this.width = 0;\n    this.height = 0;\n    this.img_id = -1;\n    this.mask_alpha = 0;\n    this.position = new _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3();\n    this.scale = new _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3();\n    _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.setValues(this.scale, 1, 1, 1);\n    this.angle = 0; //new Vec3();\n    this.size = new _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec2();\n    this.modifier_param = {};\n    this.type = 0; //1なら階層レイヤ ,2ならモデファイア\n    this.children = null; //子供レイヤ\n\n    var html = `\n\t\t\t\t<a href=\"#\" class=\"openclosebutton\">\n\t\t\t\t</a>\n\t\t\t\t<div class=\"layer_dragenter\" > </div>\n\t\t\t\t<div class=\"thumbnailouter\" >\n\t\t\t\t\t<img class=\"thumbnail\" >\n\t\t\t\t</div>\n\t\t\t\t<div class=\"name\"></div>\n\t\t\t\t<div class=\"layer_attributes\"></div>\n\t\t\t\t<div class=\"children\"></div>\n\t\t\t`;\n    var dom = document.createElement(\"div\");\n    dom.insertAdjacentHTML('beforeend', html);\n    dom.classList.add(\"layer\");\n    dom.classList.add(\"open\");\n    dom.setAttribute(\"draggable\", \"true\");\n    dom.addEventListener(\"dragstart\", DragStart);\n    dom.addEventListener(\"dragover\", DragOver);\n    dom.addEventListener(\"click\", click);\n    dom.querySelector(\".openclosebutton\").addEventListener(\"click\", opencloseClick);\n    dom.querySelector(\".layer_dragenter\").addEventListener(\"dragenter\", DragEnter);\n    dom.querySelector(\".children\").addEventListener(\"dragenter\", DragEnterChild);\n    this.dom = dom;\n    binder.bind(dom.querySelector(\".name\"), \"\", this, \"name\");\n  }\n  init() {}\n  getMatrix(mat43) {\n    var rot = new _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3();\n    rot[2] = this.angle / 360 * (Math.PI * 2);\n    _lib_mat43_js__WEBPACK_IMPORTED_MODULE_5__[\"default\"].fromLSE(mat43, this.position, this.scale, rot);\n    var x = this.size[0] * (1 - mat43[0]) - this.size[1] * mat43[3];\n    var y = -this.size[0] * mat43[1] + this.size[1] * (1 - mat43[4]);\n    mat43[9] += x * 0.5;\n    mat43[10] += y * 0.5;\n  }\n\n  //レイヤ合成開始前処理\n  before(area) {}\n  //レイヤ合成直前処理\n  beforeReflect() {}\n  //レイヤ合成処理\n  reflect(img, composite_area) {\n    var x = Math.max(img.offsetx, composite_area[0]);\n    var y = Math.max(img.offsety, composite_area[1]);\n    var x1 = Math.min(img.width + img.offsetx, composite_area[2] + composite_area[0]);\n    var y1 = Math.min(img.height + img.offsety, composite_area[3] + composite_area[1]);\n    var layer = this;\n    var img_data = img.data;\n    var img_width = img.width;\n    var layer_img = layer.img;\n    if (layer.img_id > 0) {\n      layer_img = hdrpaint.getImgById(layer.img_id);\n    }\n    var layer_img_data = layer_img.data;\n    var layer_alpha = layer.alpha;\n    var layer_power = Math.pow(2, layer.power);\n    var layer_img_width = layer_img.width;\n    var func = _hdrpaint_js__WEBPACK_IMPORTED_MODULE_3__[\"default\"].blendfuncs[layer.blendfunc];\n    var layer_position_x = layer.position[0];\n    var layer_position_y = layer.position[1];\n\n    //レイヤのクランプ\n    var cos = Math.abs(Math.cos(layer.angle / 360 * Math.PI * 2));\n    var sin = Math.abs(Math.sin(layer.angle / 360 * Math.PI * 2));\n    var width = cos * layer_img.width + sin * layer_img.height >> 1;\n    var height = sin * layer_img.width + cos * layer_img.height >> 1;\n    var left2 = Math.max(x, layer.position[0] + layer_img.width * 0.5 - width * layer.scale[0] | 0);\n    var top2 = Math.max(y, layer.position[1] + layer_img.height * 0.5 - height * layer.scale[1] | 0);\n    var right2 = Math.min(layer_img.width * 0.5 + width + layer_position_x | 0, x1);\n    var bottom2 = Math.min(layer_img.height * 0.5 + height + layer_position_y | 0, y1);\n    var pos = new _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3();\n    var pos2 = new _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3();\n    pos[2] = 1;\n    var matrix = new _lib_mat43_js__WEBPACK_IMPORTED_MODULE_5__[\"default\"]();\n    this.getMatrix(matrix);\n    _lib_mat43_js__WEBPACK_IMPORTED_MODULE_5__[\"default\"].getInv(matrix, matrix);\n    for (var yi = top2; yi < bottom2; yi++) {\n      var idx = (yi - img.offsety) * img_width + left2 - img.offsetx << 2;\n      pos[1] = yi;\n      for (var xi = left2; xi < right2; xi++) {\n        pos[0] = xi;\n        _lib_mat43_js__WEBPACK_IMPORTED_MODULE_5__[\"default\"].dotVec3(pos2, matrix, pos);\n        pos2[0] = pos2[0] + 0.5 << 0;\n        pos2[1] = pos2[1] + 0.5 << 0;\n        idx += 4;\n        if (pos2[0] < 0) continue;\n        if (pos2[0] >= layer_img.width) continue;\n        if (pos2[1] < 0) continue;\n        if (pos2[1] >= layer_img.height) continue;\n        var idx2 = pos2[1] * layer_img_width + pos2[0] << 2;\n        func(img_data, idx - 4, layer_img_data, idx2, layer_alpha, layer_power);\n      }\n    }\n  }\n  composite() {}\n  getPixel(ret, idx, x, y) {\n    if (!this.img) {\n      return;\n    }\n    if (x < 0 || y < 0 || x >= this.img.width || y >= this.img.height) {\n      return ret;\n    }\n    if (y === undefined) {\n      y = x;\n      x = idx;\n      idx = 0;\n    }\n    if (this.img.data) {\n      var data = this.img.data;\n      var idx2 = this.img.getIndex(x, y) << 2;\n      ret[idx + 0] = data[idx2];\n      ret[idx + 1] = data[idx2 + 1];\n      ret[idx + 2] = data[idx2 + 2];\n      ret[idx + 3] = data[idx2 + 3];\n    }\n    return ret;\n  }\n  static bubble_func(layer_id, f) {\n    var layer = Layer.findById(layer_id);\n    //親に伝搬する処理\n    f(layer);\n    //var parent_layer= Layer.findParent(layer);\n    var parent_layer = layer.parent;\n    if (parent_layer) {\n      Layer.bubble_func(parent_layer, f);\n    }\n  }\n  static eachLayers(f) {\n    if (!_hdrpaint_js__WEBPACK_IMPORTED_MODULE_3__[\"default\"].root_layer) {\n      return;\n    }\n    var cb = function (layer_id) {\n      var layer = Layer.findById(layer_id);\n      if (f(layer)) {\n        return true;\n      }\n      if (layer.type === 0) {\n        return false;\n      }\n      var layers = layer.children;\n      if (layers) {\n        for (var i = 0; i < layers.length; i++) {\n          if (cb(layers[i])) {\n            return true;\n          }\n        }\n      }\n      return false;\n    };\n    return cb(hdrpaint.root_layer.id);\n  }\n  static findById(layer_id) {\n    return hdrpaint.layers[layer_id];\n  }\n  static layerArray() {\n    var layers = [];\n    Layer.eachLayers(function (layer) {\n      layers.push(layer);\n    });\n    return layers;\n  }\n  refreshImg(x, y, w, h) {\n    var layer = this;\n    var left = 0;\n    var top = 0;\n    var right = 0;\n    var bottom = 0;\n    var layer_img = this.img;\n    if (this.img_id > 0) {\n      layer_img = hdrpaint.getImgById(this.img_id);\n    }\n    if (layer_img) {\n      right = layer.size[0] - 1;\n      bottom = layer.size[1] - 1;\n    } else {\n      right = _hdrpaint_js__WEBPACK_IMPORTED_MODULE_3__[\"default\"].root_layer.size[0] - 1;\n      bottom = _hdrpaint_js__WEBPACK_IMPORTED_MODULE_3__[\"default\"].root_layer.size[1] - 1;\n    }\n    if (typeof w !== 'undefined') {\n      //更新領域設定、はみ出している場合はクランプする\n      left = Math.max(left, x);\n      right = Math.min(right, x + w - 1);\n      top = Math.max(top, y);\n      bottom = Math.min(bottom, y + h - 1);\n    }\n    var mat43 = new _lib_mat43_js__WEBPACK_IMPORTED_MODULE_5__[\"default\"]();\n    this.getMatrix(mat43);\n    var poses = [];\n    poses.push(new _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3(left, top, 0));\n    poses.push(new _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3(left, bottom, 0));\n    poses.push(new _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3(right, bottom, 0));\n    poses.push(new _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3(right, top, 0));\n    _lib_mat43_js__WEBPACK_IMPORTED_MODULE_5__[\"default\"].dotVec3(poses[0], mat43, poses[0]);\n    left = poses[0][0];\n    right = poses[0][0];\n    bottom = poses[0][1];\n    top = poses[0][1];\n    for (var i = 1; i < poses.length; i++) {\n      _lib_mat43_js__WEBPACK_IMPORTED_MODULE_5__[\"default\"].dotVec3(poses[i], mat43, poses[i]);\n      left = Math.min(left, poses[i][0]);\n      right = Math.max(right, poses[i][0]);\n      top = Math.min(top, poses[i][1]);\n      bottom = Math.max(bottom, poses[i][1]);\n    }\n    left = Math.floor(left);\n    right = Math.ceil(right);\n    top = Math.floor(top);\n    bottom = Math.ceil(bottom);\n    if (layer.parent) {\n      var parent = Layer.findById(layer.parent);\n      parent.composite(left, top, right, bottom);\n    }\n    this.registRefreshThumbnail();\n  }\n  composite(left, top, right, bottom) {\n    this.refreshImg(left, top, right, bottom);\n  }\n  bubbleComposite(x, y, w, h) {\n    if (typeof x === 'undefined') {\n      x = 0;\n      y = 0;\n      w = this.size[0];\n      h = this.size[1];\n    }\n    var left = x;\n    var top = y;\n    var right = x + w - 1;\n    var bottom = y + h - 1;\n    left = Math.max(0, left);\n    top = Math.max(0, top);\n    var layer_img = this.img;\n    if (this.img_id > 0) {\n      layer_img = hdrpaint.getImgById(this.img_id);\n    }\n    if (layer_img) {\n      right = Math.min(layer_img.width - 1, right);\n      bottom = Math.min(layer_img.height - 1, bottom);\n    }\n    left = Math.floor(left);\n    right = Math.ceil(right);\n    top = Math.floor(top);\n    bottom = Math.ceil(bottom);\n    if (left == right || top == bottom) {\n      return;\n    }\n    if (this.type === 2) {\n      if (this.parent) {\n        var parent = Layer.findById(this.parent);\n        parent.bubbleComposite(left + this.position[0], top + this.position[1], right - left + 1, bottom - top + 1);\n      }\n      return;\n    }\n    if (typeof x === 'undefined') {\n      this.composite();\n    } else {\n      this.composite(left, top, right, bottom);\n    }\n    if (this.parent) {\n      var parent = Layer.findById(this.parent);\n      parent.bubbleComposite(left + this.position[0], top + this.position[1], right - left + 1, bottom - top + 1);\n    }\n  }\n  showDivParam() {\n    var layer = this;\n    var txt = \"\";\n    txt += \"offset:[\" + layer.position[0] + \",\" + layer.position[1] + \"]\" + \"size:[\" + layer.size[0] + \",\" + layer.size[1] + \"]<br>\";\n    layer.power = Number(layer.power);\n    txt += \"pow:\" + layer.power.toFixed(2) + \"\";\n    layer.alpha = Number(layer.alpha);\n    txt += \"α:\" + layer.alpha.toFixed(2) + \"<br>\";\n    return txt;\n  }\n  refreshDiv() {\n    var layer = this;\n    var layers_container = null;\n    if (!hdrpaint.root_layer) {\n      return;\n    }\n    ;\n    if (layer.id === hdrpaint.root_layer.id) {\n      layers_container = document.getElementById(\"layers_container\");\n    } else {\n      //layer.dom.className=\"layer\";\n      if (_hdrpaint_js__WEBPACK_IMPORTED_MODULE_3__[\"default\"].selected_layer_id === layer.id) {\n        layer.dom.classList.add(\"active\");\n      } else {\n        layer.dom.classList.remove(\"active\");\n      }\n      if (layer.type === 0 || !layer.children) {\n        layer.dom.classList.remove(\"group\");\n      } else {\n        layer.dom.classList.add(\"group\");\n      }\n      var div = layer.dom.getElementsByClassName(\"name\")[0];\n      var name = layer.name;\n      if (!this.display) {\n        name += \"(非表示)\";\n        layer.dom.classList.add(\"invisible\");\n      } else {\n        layer.dom.classList.remove(\"invisible\");\n      }\n      if (this.lock) {\n        name += \"(lock)\";\n        layer.dom.classList.add(\"lock\");\n      } else {\n        layer.dom.classList.remove(\"lock\");\n      }\n      if (this.mask_alpha) {\n        name += \"(αlock)\";\n      }\n      //div.innerHTML=name;\n\n      var span = layer.dom.getElementsByClassName(\"layer_attributes\")[0];\n      var txt = \"\";\n      if (layer.type === 2) {\n        txt += \"modifier:\" + layer.modifier + \"<br>\";\n      } else {\n        txt += \"func:\" + layer.blendfunc + \"<br>\";\n      }\n      txt += layer.showDivParam();\n      span.innerHTML = txt;\n      layers_container = layer.dom.getElementsByClassName(\"children\")[0];\n    }\n\n    //子レイヤ設定\n    while (layers_container.firstChild) layers_container.removeChild(layers_container.firstChild);\n    if (layer.children) {\n      for (var li = layer.children.length; li--;) {\n        var child = Layer.findById(layer.children[li]);\n        layers_container.appendChild(child.dom);\n      }\n    }\n\n    //\t\tif(layer === Hdrpaint.selected_layer){\n    //\t\t\tHdrpaint.refreshActiveLayerParam();\n    //\t\t}\n  }\n  append(idx, layer_id) {\n    var layer = Layer.findById(layer_id);\n    this.children.splice(idx, 0, layer_id);\n    layer.parent = this.id;\n    this.refreshDiv();\n    //refreshMain();\n    this.bubbleComposite();\n  }\n  refreshThumbnail() {\n    //レイヤサムネイル更新\n    var layer = this;\n    var sum = new _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec4();\n    //if(layer.children){\n\n    layer.dom.style.backgroundImage = \"none\";\n    //}\n\n    if (layer.type === 2) {\n      //ジェネレータレイヤ\n      var img = gen_thumbnail_img;\n      img.thumbnail = true;\n      var newx = img.width;\n      var newy = img.height;\n      img.offsetx = 0;\n      img.offsety = 0;\n      layer.reflect(img, [0, 0, img.width, img.height]);\n      layer.dom.style.backgroundImage = \"url(\" + img.toDataURL() + \"),url(./css/back.png)\";\n      return;\n    }\n    var img = this.img;\n    if (layer.img_id > 0) {\n      img = hdrpaint.getImgById(layer.img_id);\n    }\n    if (!img) {\n      return;\n    }\n    if (!img.data) {\n      return;\n    }\n    var img_data = img.data;\n    var layer_img = layer.dom.getElementsByTagName(\"img\")[0];\n    var r = img.width;\n    if (img.width < img.height) {\n      r = img.height;\n      layer_img.style.width = \"auto\";\n      layer_img.style.height = \"100%\";\n    } else {\n      layer_img.style.width = \"100%\";\n      layer_img.style.height = \"auto\";\n    }\n    r /= 64;\n    var newx = img.width / r | 0;\n    var newy = img.height / r | 0;\n    thumbnail_img.clear(0, 0, newx, newy);\n    var data = img.data;\n    var dst_data = thumbnail_img.data;\n    var _255 = 1 / 255;\n    var ev = Number(inputs[\"ev\"].value);\n    var ev2 = Math.pow(2, -ev) * 255;\n    var rr255 = 255 / (r * r);\n    for (var yi = 0; yi < newy; yi++) {\n      for (var xi = 0; xi < newx; xi++) {\n        _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec4.setValues(sum, 0, 0, 0, 0);\n        for (var yii = 0; yii < r; yii++) {\n          for (var xii = 0; xii < r; xii++) {\n            var idx = img.getIndex(xi * r + xii | 0, yi * r + yii | 0) << 2;\n            var alpha = data[idx + 3];\n            sum[0] += data[idx + 0] * alpha;\n            sum[1] += data[idx + 1] * alpha;\n            sum[2] += data[idx + 2] * alpha;\n            sum[3] += alpha;\n          }\n        }\n        var idx = thumbnail_img.getIndex(xi, yi) << 2;\n        var _r = ev2 / sum[3];\n        dst_data[idx] = sum[0] * _r;\n        dst_data[idx + 1] = sum[1] * _r;\n        dst_data[idx + 2] = sum[2] * _r;\n        dst_data[idx + 3] = sum[3] * rr255;\n      }\n    }\n    thumbnail_img.width = newx;\n    thumbnail_img.height = newy;\n    thumbnail_img.toBlob(blob => {\n      URL.revokeObjectURL(layer_img.src);\n      layer_img.src = URL.createObjectURL(blob);\n    });\n    thumbnail_img.width = 64;\n    thumbnail_img.height = 64;\n  }\n  getAbsoluteMatrix(mat) {\n    //レイヤの絶対座標取得\n    _lib_mat43_js__WEBPACK_IMPORTED_MODULE_5__[\"default\"].setInit(mat);\n    Layer.bubble_func(this.id, function (layer) {\n      var a = new _lib_mat43_js__WEBPACK_IMPORTED_MODULE_5__[\"default\"]();\n      layer.getMatrix(a);\n      _lib_mat43_js__WEBPACK_IMPORTED_MODULE_5__[\"default\"].dot(mat, a, mat);\n    });\n  }\n  getAbsolutePosition(p) {\n    //レイヤの絶対座標取得\n    _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec2.setValues(p, 0, 0);\n    Layer.bubble_func(this.id, function (layer) {\n      _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec2.add(p, p, layer.position);\n    });\n  }\n  toRelative(p) {\n    var mat43 = new _lib_mat43_js__WEBPACK_IMPORTED_MODULE_5__[\"default\"]();\n    this.getAbsoluteMatrix(mat43);\n    _lib_mat43_js__WEBPACK_IMPORTED_MODULE_5__[\"default\"].getInv(mat43, mat43);\n    _lib_mat43_js__WEBPACK_IMPORTED_MODULE_5__[\"default\"].dotVec3(p, mat43, p);\n  }\n  select() {\n    //レイヤを選択状態にする\n    _hdrpaint_js__WEBPACK_IMPORTED_MODULE_3__[\"default\"].selectLayer(this);\n  }\n  registRefreshThumbnail() {\n    if (stackThumbnail.indexOf(this) >= 0) {\n      return;\n    }\n    stackThumbnail.push(this);\n    if (stackThumbnail.length === 1) {\n      window.requestAnimationFrame(function (e) {\n        refreshThumbnail();\n      });\n    }\n  }\n}\n//レイヤ\n_defineProperty(Layer, \"name\", \"layer\");\n_defineProperty(Layer, \"type\", \"generator\");\n_defineProperty(Layer, \"option\", `\n\t\tサイズ<input type=\"text\" id=\"layer_width\" value=\"\" class=\"size\" name=\"width\">\n\t\t<input type=\"text\" id=\"layer_height\" value=\"\" class=\"size\" name=\"height\"><br>\n\t\t位置<input type=\"text\" id=\"layer_x\" value=\"\" class=\"size\" name=\"position.0\">\n\t\t<input type=\"text\" id=\"layer_y\" value=\"\" class=\"size\" name=\"position.1\"><br>\n\t\tスケール<input type=\"text\" id=\"scale.0\" value=\"\" class=\"size\" name=\"scale.0\">\n\t\t<input type=\"text\" id=\"scale.1\" value=\"\" class=\"size\" name=\"scale.1\"><br>\n\t\t回転<input class=\"slider\" min=\"0\" max=\"360\" id=\"angle\" value=\"\" class=\"size\" name=\"angle\"><br>\n\t\t<div id=\"div_blendfunc\">合成func<select type=\"text\" id=\"layer_blendfunc\" name=\"blendfunc\">\n\t\t</select></div>\n\t\tα<input class=\"slider\" id=\"layer_alpha\" max=\"1\" name=\"alpha\"/>\n\t\t<label><input type=\"checkbox\" id=\"layer_mask_alpha\" name=\"mask_alpha\"/>αロック</label><br>\n\t\t明るさ<input class=\"slider\" id=\"layer_power\" min=\"-10\" max=\"10\" name=\"power\"/><br>\n\t`);\n_defineProperty(Layer, \"enableRefreshThumbnail\", true);\n;\nLayer.prototype.type = {\n  IMAGE: 0,\n  COMPOSITE: 1,\n  MODIFIER: 2\n};\n\n//# sourceURL=webpack://hdrpaint/./src/layer.js?");

/***/ }),

/***/ "./src/lib/binder.js":
/*!***************************!*\
  !*** ./src/lib/binder.js ***!
  \***************************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": function() { return /* binding */ Binder; }\n/* harmony export */ });\n/* harmony import */ var _util_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./util.js */ \"./src/lib/util.js\");\n/* harmony import */ var _watcher_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./watcher.js */ \"./src/lib/watcher.js\");\n//バインド\n\n\n\nclass Bind {\n  constructor(node, variable) {\n    this.node = node;\n    this.attribute_name = \"\";\n    this.variables = [];\n    this.watches = [];\n  }\n  feedBack(value) {\n    if (value === undefined) {\n      var node = this.node;\n      if (node.getAttribute(\"type\") === \"checkbox\") {\n        value = node.checked;\n      } else if (node.getAttribute(\"type\") === \"radio\") {\n        value = node.value;\n      } else {\n        value = node.value;\n        if (node.hasAttribute(\"number\")) {\n          value = Number(value);\n        }\n      }\n    }\n    //バインド変数にコントロールの値をセットする\n    var val = this.task.watches[0].setValue(value);\n  }\n  refresh(values) {\n    //バインドされた変数の値をノード属性にセット\n    var bind = this;\n    var check = false;\n    var node = bind.node;\n    var value = values[0];\n    if (bind.func) {\n      value = bind.func(values);\n    }\n    if (bind.attribute_name !== \"\") {\n      if (bind.attribute_name == \"disabled\") {\n        if (!value) {\n          node.removeAttribute(bind.attribute_name);\n          return;\n        }\n      }\n      if (node.tagName === \"SELECT\" && bind.attribute_name === \"options\") {\n        while (node.firstChild) {\n          node.removeChild(node.firstChild);\n        }\n        var options = value;\n        if (!Array.isArray(options)) {\n          options = [];\n        }\n        for (var i = 0; i < options.length; i++) {\n          var op = options[i];\n          var option = document.createElement(\"option\");\n          option.value = op.value;\n          _util_js__WEBPACK_IMPORTED_MODULE_0__[\"default\"].setText(option, op.name);\n          node.appendChild(option);\n        }\n      } else {\n        node.setAttribute(bind.attribute_name, value);\n      }\n      return;\n    }\n    node.setAttribute(\"content\", value);\n    switch (node.tagName) {\n      case \"INPUT\":\n      case \"SELECT\":\n      case \"TEXTAREA\":\n        if (node.getAttribute(\"type\") === \"checkbox\") {\n          node.checked = value;\n        }\n        if (node.getAttribute(\"type\") === \"radio\") {\n          node.checked = Boolean(value === node.value);\n        } else {\n          node.value = value;\n        }\n        _util_js__WEBPACK_IMPORTED_MODULE_0__[\"default\"].fireEvent(node, \"input\");\n        break;\n      default:\n        if (value && (value instanceof HTMLElement || value.nodeName)) {\n          node.innerHTML = \"\";\n          node.appendChild(value);\n        } else {\n          node.textContent = value;\n        }\n    }\n  }\n}\nclass Binder {\n  constructor() {\n    this.binds = [];\n    this.variable_root = window;\n    this.watcher = new _watcher_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"]();\n  }\n  init(dom, _variable_root) {\n    //初期化&バインド\n    if (_variable_root) {\n      this.variable_root = _variable_root;\n    }\n    this.bindNodes(dom, this.variable_root);\n    this.watcher.init();\n  }\n  bind(node, attribute_name, variable_root, variable_names, func) {\n    var bind = this.binds.find(e => {\n      return e.node == node && e.attribute_name == attribute_name;\n    });\n    if (bind) {\n      return bind;\n    }\n    //ノードとバインド変数を渡してバインド情報を登録する\n    bind = new Bind();\n    bind.node = node;\n    bind.attribute_name = attribute_name;\n    if (!variable_root) {\n      variable_root = this.variable_root;\n    }\n    if (!Array.isArray(variable_names)) {\n      variable_names = [variable_names];\n    }\n    var variable_roots = [];\n    for (var i = 0; i < variable_names.length; i++) {\n      variable_roots.push(variable_root);\n    }\n    bind.func = func;\n    bind.binder = this;\n    this.binds.push(bind);\n    if (node.hasAttribute(\"feedback\") && bind.attribute_name == \"\") {\n      var f = node.getAttribute(\"feedback\");\n      if (f != null && f != \"\") {\n        bind.feedBack2 = Function(f);\n      }\n      node.addEventListener(\"change\", () => {\n        bind.feedBack();\n        if (bind.feedBack2) {\n          bind.feedBack2();\n        }\n      });\n    }\n\n    //\tvariable_names.forEach((name)=>{\n    //\t\tbind.watches.push(watcher.watch(variable_root,name));\n    //\t});\n    bind.task = this.watcher.watch(variable_roots, variable_names, watches => {\n      bind.refresh(watches);\n    });\n    return bind;\n  }\n  bindNodes(node, variable_root) {\n    var bindedNodes = node.querySelectorAll(\"*\");\n    bindedNodes.forEach(node => {\n      for (var i = 0; i < node.attributes.length; i++) {\n        var attribute_name = node.attributes[i].name;\n        if (attribute_name.indexOf(\":\") == -1) continue;\n        //if(attribute_name.indexOf(\"bind:\")!==0)continue;\n\n        var variable_names = node.getAttribute(attribute_name);\n        variable_names = variable_names.split(\",\");\n        attribute_name = attribute_name.replace(\":\", \"\");\n        attribute_name = attribute_name.replace(\"bind\", \"\");\n        var func = null;\n        if (node.hasAttribute(\"bindfunc\") && attribute_name == \"\") {\n          func = node.getAttribute(\"bindfunc\");\n          func = new Function('arg', func);\n        }\n        this.bind(node, attribute_name, null, variable_names, func);\n      }\n      ;\n    });\n  }\n}\n\n//# sourceURL=webpack://hdrpaint/./src/lib/binder.js?");

/***/ }),

/***/ "./src/lib/colorpicker.js":
/*!********************************!*\
  !*** ./src/lib/colorpicker.js ***!
  \********************************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": function() { return /* binding */ Colorpicker; }\n/* harmony export */ });\n/* harmony import */ var _vector_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./vector.js */ \"./src/lib/vector.js\");\n/* harmony import */ var _util_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./util.js */ \"./src/lib/util.js\");\n/* harmony import */ var _colorselector_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./colorselector.js */ \"./src/lib/colorselector.js\");\nfunction _classPrivateFieldInitSpec(obj, privateMap, value) { _checkPrivateRedeclaration(obj, privateMap); privateMap.set(obj, value); }\nfunction _checkPrivateRedeclaration(obj, privateCollection) { if (privateCollection.has(obj)) { throw new TypeError(\"Cannot initialize the same private elements twice on an object\"); } }\nfunction _classPrivateFieldGet(receiver, privateMap) { var descriptor = _classExtractFieldDescriptor(receiver, privateMap, \"get\"); return _classApplyDescriptorGet(receiver, descriptor); }\nfunction _classApplyDescriptorGet(receiver, descriptor) { if (descriptor.get) { return descriptor.get.call(receiver); } return descriptor.value; }\nfunction _classPrivateFieldSet(receiver, privateMap, value) { var descriptor = _classExtractFieldDescriptor(receiver, privateMap, \"set\"); _classApplyDescriptorSet(receiver, descriptor, value); return value; }\nfunction _classExtractFieldDescriptor(receiver, privateMap, action) { if (!privateMap.has(receiver)) { throw new TypeError(\"attempted to \" + action + \" private field on non-instance\"); } return privateMap.get(receiver); }\nfunction _classApplyDescriptorSet(receiver, descriptor, value) { if (descriptor.set) { descriptor.set.call(receiver, value); } else { if (!descriptor.writable) { throw new TypeError(\"attempted to set read only private field\"); } descriptor.value = value; } }\n\n\n\nwindow.Util = _util_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"];\n\n//カラーピッカー\nvar _safe = /*#__PURE__*/new WeakMap();\nvar _bindfunc = /*#__PURE__*/new WeakMap();\nvar _feedback = /*#__PURE__*/new WeakMap();\nclass Colorpicker {\n  constructor() {\n    _classPrivateFieldInitSpec(this, _safe, {\n      writable: true,\n      value: 0\n    });\n    _classPrivateFieldInitSpec(this, _bindfunc, {\n      writable: true,\n      value: `\nvar value = this.watches[0].getValue();\nif(!value){\n\tvalue =[0,0,0];\n}\nvar hex;\nhex = Util.rgb2hex(value);\n\nreturn hex;\n\t`\n    });\n    _classPrivateFieldInitSpec(this, _feedback, {\n      writable: true,\n      value: `\nvar cols=new Array(3);\n\nUtil.hex2rgb(cols,event.currentTarget.value);\nvar value = this.watches[0].getValue();\nvalue[0] = Number(cols[0]);\nvalue[1] = Number(cols[1]);\nvalue[2] = Number(cols[2]);\n\t`\n    });\n    this.colorselector = new _colorselector_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"](false);\n    var parentInput = null; //カラーピッカーが表示されている親コントロール\n  }\n  init(nodes) {\n    //カラーピッカー要素作成\n    var container = document.createElement(\"div\");\n    container.classList.add(\"colorpickerhdr_form\");\n    container.appendChild(this.colorselector.div);\n    document.body.appendChild(container);\n    this.container = container;\n    this.colorselector.changeCallback = () => {\n      this.changeCallback(this.parentInput);\n    };\n\n    //カラーピッカー表示非表示イベント\n    container.addEventListener(\"pointerdown\", evt => {\n      _classPrivateFieldSet(this, _safe, 1);\n    });\n    window.addEventListener(\"pointerdown\", evt => {\n      if (!_classPrivateFieldGet(this, _safe)) {\n        container.style.display = \"none\";\n      }\n      _classPrivateFieldSet(this, _safe, 0);\n    });\n    this.setBind(nodes);\n  }\n  setBind(nodes) {\n    //ページ読み込み時に className=\"colorpicker\"のinputタグを対象に\n    //カラーピッカーコントロール対応させる\n    Array.prototype.forEach.call(nodes, e => {\n      var node = e;\n      if (node.value === \"\") {\n        node.value = \"ffffff\";\n      }\n      node.addEventListener(\"click\", evt => {\n        this.showSelector(evt.currentTarget);\n      });\n      node.addEventListener(\"input\", evt => {\n        //内容変更時、背景色とカーソルをリフレッシュする\n        this.updateStyle(evt.currentTarget);\n      });\n      this.updateStyle(e);\n      for (var i = 0; i < node.attributes.length; i++) {\n        var attribute_name = node.attributes[i].name;\n        if (attribute_name.indexOf(\"bind:\") < 0) continue;\n        node.setAttribute(\"bindfunc\", _classPrivateFieldGet(this, _bindfunc));\n        if (node.hasAttribute(\"feedback\")) {\n          node.setAttribute(\"feedback\", _classPrivateFieldGet(this, _feedback));\n        }\n        break;\n      }\n    });\n  }\n  updateStyle(node) {\n    //テキストの内容を背景色にセット\n\n    var rgb = new _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec4();\n    _util_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].hex2rgb(rgb, node.value);\n    var rgba = _util_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].rgba(rgb[0] * 255, rgb[1] * 255, rgb[2] * 255, 1);\n    node.style.backgroundImage = \"linear-gradient( 0,\" + rgba + \",\" + rgba + \"),url(css/back.png)\";\n\n    //テキスト色を背景色に合わせて変える\n    node.style.color = 0.3 * rgb[0] + 0.6 * rgb[1] + 0.1 * rgb[2] < 0.5 ? \"white\" : \"black\";\n  }\n  changeCallback(node) {\n    //カラーピッカーで色が選択されたときに元コントロールに反映する処理\n    if (!node) {\n      return;\n    }\n    var rgb = new _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec4();\n    rgb[0] = this.colorselector.R_txt.value;\n    rgb[1] = this.colorselector.G_txt.value;\n    rgb[2] = this.colorselector.B_txt.value;\n    node.value = _util_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].rgb2hex(rgb);\n    _util_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].fireEvent(node, \"change\");\n    this.updateStyle(node);\n  }\n  showSelector(node) {\n    //インプットボックスがクリックされたときカラーピッカーを表示する\n    this.parentInput = node;\n    var container = this.container;\n    //クリック時、カラーピッカーを表示\n    //parentInput=this;\n    container.style.display = \"block\";\n    var rect = node.getBoundingClientRect();\n    container.style.left = rect.left + window.pageXOffset + \"px\";\n    container.style.top = rect.top + rect.height + window.pageYOffset + \"px\";\n\n    //カラーピッカーに現在値をセット\n    var rgba = new _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec4();\n    _util_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].str2rgba(rgba, node.value);\n    //rgb[3]=1;\n\n    this.colorselector.setColor(rgba);\n  }\n}\n;\n\n//# sourceURL=webpack://hdrpaint/./src/lib/colorpicker.js?");

/***/ }),

/***/ "./src/lib/colorpickerhdr.js":
/*!***********************************!*\
  !*** ./src/lib/colorpickerhdr.js ***!
  \***********************************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": function() { return /* binding */ ColorpickerHDR; }\n/* harmony export */ });\n/* harmony import */ var _vector_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./vector.js */ \"./src/lib/vector.js\");\n/* harmony import */ var _util_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./util.js */ \"./src/lib/util.js\");\n/* harmony import */ var _colorselector_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./colorselector.js */ \"./src/lib/colorselector.js\");\n/* harmony import */ var _colorpicker_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./colorpicker.js */ \"./src/lib/colorpicker.js\");\nfunction _classPrivateFieldInitSpec(obj, privateMap, value) { _checkPrivateRedeclaration(obj, privateMap); privateMap.set(obj, value); }\nfunction _checkPrivateRedeclaration(obj, privateCollection) { if (privateCollection.has(obj)) { throw new TypeError(\"Cannot initialize the same private elements twice on an object\"); } }\nfunction _classPrivateFieldGet(receiver, privateMap) { var descriptor = _classExtractFieldDescriptor(receiver, privateMap, \"get\"); return _classApplyDescriptorGet(receiver, descriptor); }\nfunction _classExtractFieldDescriptor(receiver, privateMap, action) { if (!privateMap.has(receiver)) { throw new TypeError(\"attempted to \" + action + \" private field on non-instance\"); } return privateMap.get(receiver); }\nfunction _classApplyDescriptorGet(receiver, descriptor) { if (descriptor.get) { return descriptor.get.call(receiver); } return descriptor.value; }\n\n\n\n\nvar _bindfunc = /*#__PURE__*/new WeakMap();\nvar _feedback = /*#__PURE__*/new WeakMap();\nclass ColorpickerHDR extends _colorpicker_js__WEBPACK_IMPORTED_MODULE_3__[\"default\"] {\n  //カラーピッカーHDR\n  constructor() {\n    super();\n    _classPrivateFieldInitSpec(this, _bindfunc, {\n      writable: true,\n      value: `\nvar value = this.task.watches[0].getValue();\nreturn value;\n\t`\n    });\n    _classPrivateFieldInitSpec(this, _feedback, {\n      writable: true,\n      value: `\nvar cols=new Array(3);\n\nUtil.hex2rgb(cols,event.currentTarget.value);\nvar value = this.task.watches[0].getValue();\nvalue[0] = Number(cols[0]);\nvalue[1] = Number(cols[1]);\nvalue[2] = Number(cols[2]);\n\t`\n    });\n    this.colorselector = new _colorselector_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"](true);\n  }\n  setBind(nodes) {\n    //ページ読み込み時に className=\"colorpicker\"のinputタグを対象に\n    //カラーピッカーコントロール対応させる\n    Array.prototype.forEach.call(nodes, e => {\n      var node = e;\n      if (node.value === \"\") {\n        node.value = \"1,1,1,1\";\n      }\n      node.addEventListener(\"click\", evt => {\n        this.showSelector(evt.currentTarget);\n      });\n      node.addEventListener(\"input\", evt => {\n        //内容変更時、背景色とカーソルをリフレッシュする\n        this.updateStyle(evt.currentTarget);\n      });\n      this.updateStyle(e);\n      for (var i = 0; i < node.attributes.length; i++) {\n        var attribute_name = node.attributes[i].name;\n        if (attribute_name.indexOf(\"bind:\") < 0) continue;\n        node.setAttribute(\"bindfunc\", _classPrivateFieldGet(this, _bindfunc));\n        if (node.hasAttribute(\"feedback\")) {\n          node.setAttribute(\"feedback\", _classPrivateFieldGet(this, _feedback));\n        }\n        break;\n      }\n    });\n  }\n  updateStyle(node) {\n    //テキストの内容を背景色にセット\n    var rgb = new _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec4();\n    var sp = node.value.split(\",\");\n    rgb[0] = Number(sp[0]);\n    rgb[1] = Number(sp[1]);\n    rgb[2] = Number(sp[2]);\n    rgb[3] = Number(sp[3]);\n    var rgba = _util_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].rgba(rgb[0] * 255, rgb[1] * 255, rgb[2] * 255, rgb[3]);\n    node.style.backgroundImage = \"linear-gradient( 0,\" + rgba + \",\" + rgba + \"),url(css/back.png)\";\n    node.style.color = 0.3 * rgb[0] + 0.6 * rgb[1] + 0.1 * rgb[2] < 0.5 ? \"white\" : \"black\";\n  }\n  changeCallback(node) {\n    if (!node) {\n      return;\n    }\n    node.value = this.colorselector.R_txt.value + \", \" + this.colorselector.G_txt.value + \", \" + this.colorselector.B_txt.value + \", \" + this.colorselector.A_txt.value;\n    _util_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].fireEvent(node, \"change\");\n    this.updateStyle(node);\n  }\n}\n;\n\n//# sourceURL=webpack://hdrpaint/./src/lib/colorpickerhdr.js?");

/***/ }),

/***/ "./src/lib/colorselector.js":
/*!**********************************!*\
  !*** ./src/lib/colorselector.js ***!
  \**********************************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": function() { return /* binding */ ColorSelector; }\n/* harmony export */ });\n/* harmony import */ var _vector_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./vector.js */ \"./src/lib/vector.js\");\n/* harmony import */ var _slider_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./slider.js */ \"./src/lib/slider.js\");\n/* harmony import */ var _util_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./util.js */ \"./src/lib/util.js\");\n/* harmony import */ var _img_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./img.js */ \"./src/lib/img.js\");\nfunction _defineProperty(obj, key, value) { key = _toPropertyKey(key); if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\nfunction _toPropertyKey(arg) { var key = _toPrimitive(arg, \"string\"); return typeof key === \"symbol\" ? key : String(key); }\nfunction _toPrimitive(input, hint) { if (typeof input !== \"object\" || input === null) return input; var prim = input[Symbol.toPrimitive]; if (prim !== undefined) { var res = prim.call(input, hint || \"default\"); if (typeof res !== \"object\") return res; throw new TypeError(\"@@toPrimitive must return a primitive value.\"); } return (hint === \"string\" ? String : Number)(input); }\n\n\n\n\n\n//カラーセレクタHDR\n\nvar img = new _img_js__WEBPACK_IMPORTED_MODULE_3__[\"default\"](128, 128, _img_js__WEBPACK_IMPORTED_MODULE_3__[\"default\"].FORMAT_UINT8);\nlet col = new _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3();\nlet col_org = new _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3();\n\n//色相画像作成\nvar img_h = {};\nvar data = img.data;\nvar idx = 0;\nfor (var yi = 0; yi < 128; yi++) {\n  col[0] = yi / 128;\n  col[1] = 1;\n  col[2] = 1;\n  _util_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"].hsv2rgb(col, col);\n  col[0] = col[0] * 255 | 0;\n  col[1] = col[1] * 255 | 0;\n  col[2] = col[2] * 255 | 0;\n  idx = img.getIndex(0, yi) << 2;\n  data[idx] = col[0];\n  data[idx + 1] = col[1];\n  data[idx + 2] = col[2];\n  data[idx + 3] = 255;\n}\nvar h_img_dataurl = null;\nimg.toBlob(blob => {\n  //\tURL.revokeObjectURL(h_img_dataurl);\n  h_img_dataurl = URL.createObjectURL(blob);\n  var nodes = document.querySelectorAll(\".cphdr_h_img\");\n  for (var i = 0; i < nodes.length; i++) {\n    nodes[i].src = h_img_dataurl;\n  }\n}, \"image/png\", 1.0, 0, 0, 1, 128);\nclass ColorSelector {\n  constructor(flg) {\n    _defineProperty(this, \"down\", e => {\n      if (!(e.buttons & 1)) {\n        this.drag_from = 0;\n      }\n      var hsv = this.hsv;\n      switch (this.drag_from) {\n        case 1:\n          var rect = this.sv_img.getBoundingClientRect();\n          hsv[2] = e.clientX - rect.left;\n          hsv[1] = e.clientY - rect.top;\n          hsv[2] /= img.width;\n          hsv[1] /= img.height;\n          hsv[1] = 1 - hsv[1];\n          hsv[1] = Math.min(Math.max(hsv[1], 0), 1);\n          hsv[2] = Math.min(Math.max(hsv[2], 0), 1);\n          break;\n        case 2:\n          var rect = this.h_img.getBoundingClientRect();\n          hsv[0] = e.clientY - rect.top;\n          hsv[0] = hsv[0] / this.h_img.height;\n          hsv[0] = Math.min(Math.max(hsv[0], 0), 1);\n          this.redrawSv();\n          break;\n        default:\n          return;\n      }\n      this.setCursor(hsv);\n      var vi = Math.pow(2, Number(this.Vi_txt.value));\n      _util_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"].hsv2rgb(col, hsv);\n      this.R_txt.value = (col[0] * vi).toFixed(3);\n      this.G_txt.value = (col[1] * vi).toFixed(3);\n      this.B_txt.value = (col[2] * vi).toFixed(3);\n      if (this.changeCallback) {\n        this.changeCallback();\n      }\n    });\n    this.dispflg = flg;\n    this.div = null;\n    this.sv_img = null;\n    this.h_img = null;\n    this.h_cursor = null;\n    this.s_cursor = null;\n    this.v_cursor = null;\n    this.R_txt = null;\n    this.G_txt = null;\n    this.B_txt = null;\n    this.A_txt = null;\n    this.Vi_txt = null;\n    this.changeCallback = null;\n    this.drag_from = 0;\n    this.hsv = new _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3();\n    this.parentInput = null; //カラーピッカーが表示されている親コントロール\n\n    var html = `\n\t\t\t\t<div class=\"div_main\">\n\t\t\t\t\t<div class=\"sv_parent\">\n\t\t\t\t\t\t<img class=\"cphdr_sv_img\" draggable=\"false\">\n\t\t\t\t\t\t<div class=\"cphdr_s_cursor cursor\"></div>\n\t\t\t\t\t\t<div class=\"cphdr_v_cursor cursor\"></div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class=\"sv_parent\">\n\t\t\t\t\t\t<img class=\"cphdr_h_img\" draggable=\"false\">\n\t\t\t\t\t\t<div class=\"cphdr_h_cursor cursor\" ></div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"color_status\">\n\t\t\t\t\t<ul>\n\t\t\t\t\t<li class=\"red\">R<input type=\"text\" class=\"cphdr_R_txt\" value=\"0.8\" /></li>\n\t\t\t\t\t<li class=\"green\">G<input type=\"text\" class=\"cphdr_G_txt\" value=\"0.2\"/></li>\n\t\t\t\t\t<li class=\"blue\">B<input type=\"text\" class=\"cphdr_B_txt\" value=\"0.2\"/></li>\n\t\t\t\t\t</ul>\n\t\t\t\t</div>\n\t\t\t\t<div id=\"txtarea\">\n\t\t\t\t<div>\n\t\t\t\t\t明るさ<input class=\"slider cphdr_Vi_txt\" min=\"-10\" max=\"10\" value=\"0\" step=\"0.01\"/>\n\t\t\t\t</div>\n\t\t\t\tA<input class=\"slider cphdr_A_txt\" max=\"1\" value=\"1\" step=\"0.001\"/>\n\t\t\t\t</div>\n\t\t`;\n    this.div = document.createElement(\"div\");\n    this.div.classList.add(\"colorselector\");\n    this.div.insertAdjacentHTML('beforeend', html);\n    this.sv_img = this.div.querySelector(\".cphdr_sv_img\");\n    this.h_img = this.div.querySelector(\".cphdr_h_img\");\n    this.h_cursor = this.div.querySelector(\".cphdr_h_cursor\");\n    this.s_cursor = this.div.querySelector(\".cphdr_s_cursor\");\n    this.v_cursor = this.div.querySelector(\".cphdr_v_cursor\");\n    this.R_txt = this.div.querySelector(\".cphdr_R_txt\");\n    this.G_txt = this.div.querySelector(\".cphdr_G_txt\");\n    this.B_txt = this.div.querySelector(\".cphdr_B_txt\");\n    this.Vi_txt = this.div.querySelector(\".cphdr_Vi_txt\");\n    this.A_txt = this.div.querySelector(\".cphdr_A_txt\");\n    _slider_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].init(this.div);\n    this.redrawSv(0);\n    if (!flg) {\n      var div = this.div.querySelector(\"#txtarea\");\n      div.style.display = \"none\";\n    }\n    this.div.querySelector(\".color_status\").addEventListener(\"change\", () => {\n      this.changeColor();\n    });\n    this.A_txt.addEventListener(\"change\", () => {\n      this.changeColor();\n    });\n    this.Vi_txt.addEventListener(\"change\", () => {\n      var vi = Math.pow(2, Number(this.Vi_txt.value));\n      _util_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"].hsv2rgb(col, this.hsv);\n      this.R_txt.value = (col[0] * vi).toFixed(3);\n      this.G_txt.value = (col[1] * vi).toFixed(3);\n      this.B_txt.value = (col[2] * vi).toFixed(3);\n      if (this.changeCallback) {\n        this.changeCallback();\n      }\n    });\n    this.sv_img.parentNode.addEventListener(\"pointerdown\", e => {\n      this.drag_from = 1;\n      this.down(e);\n    });\n    this.h_img.parentNode.addEventListener(\"pointerdown\", e => {\n      this.drag_from = 2;\n      this.down(e);\n    });\n    window.addEventListener(\"pointermove\", this.down);\n  }\n  redrawSv() {\n    var idx = 0;\n    col[0] = this.hsv[0];\n    col[1] = 1;\n    col[2] = 1;\n    _util_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"].hsv2rgb(col_org, col);\n    var data = img.data;\n    var alpha = Number(this.A_txt.value) * 255;\n    for (var yi = 0; yi < img.height; yi++) {\n      var yf = yi / img.height;\n      col[0] = (1 - col_org[0]) * yf + col_org[0];\n      col[1] = (1 - col_org[1]) * yf + col_org[1];\n      col[2] = (1 - col_org[2]) * yf + col_org[2];\n      _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.mul(col, col, 255 / img.width);\n      for (var xi = 0; xi < img.width; xi++) {\n        data[idx] = col[0] * xi;\n        data[idx + 1] = col[1] * xi;\n        data[idx + 2] = col[2] * xi;\n        data[idx + 3] = alpha;\n        idx += 4;\n      }\n    }\n    img.toBlob(blob => {\n      URL.revokeObjectURL(this.sv_img.src);\n      this.sv_img.src = URL.createObjectURL(blob);\n    }, \"image/png\");\n  }\n  setColor(c) {\n    this.R_txt.value = c[0];\n    this.G_txt.value = c[1];\n    this.B_txt.value = c[2];\n    this.A_txt.value = c[3];\n    _util_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"].fireEvent(this.A_txt, \"input\");\n    this.changeColor();\n  }\n  changeColor() {\n    var hsv = this.hsv;\n    col[0] = Number(this.R_txt.value);\n    col[1] = Number(this.G_txt.value);\n    col[2] = Number(this.B_txt.value);\n    var max = Math.max(Math.max(col[0], Math.max(col[1], col[2])), 1);\n    _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.mul(col, col, 1 / max);\n    _util_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"].rgb2hsv(hsv, col);\n    this.redrawSv();\n    this.setCursor(hsv);\n    this.Vi_txt.value = Math.log2(max);\n    _util_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"].fireEvent(this.Vi_txt, \"input\");\n    if (this.changeCallback) {\n      this.changeCallback();\n    }\n  }\n  setCursor(hsv) {\n    this.h_cursor.style.top = hsv[0] * 127 - 1 + \"px\";\n    this.s_cursor.style.top = (1 - hsv[1]) * 127 - 1 + \"px\";\n    this.v_cursor.style.left = hsv[2] * 127 - 1 + \"px\";\n  }\n}\n;\n\n//# sourceURL=webpack://hdrpaint/./src/lib/colorselector.js?");

/***/ }),

/***/ "./src/lib/datastream.js":
/*!*******************************!*\
  !*** ./src/lib/datastream.js ***!
  \*******************************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": function() { return /* binding */ DataStream; }\n/* harmony export */ });\n/* harmony import */ var _util_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./util.js */ \"./src/lib/util.js\");\n\nclass DataStream {\n  constructor(arraybuffer, offset, length) {\n    if (typeof arraybuffer === \"number\") {\n      this.byteBuffer = new Uint8Array(arraybuffer);\n    } else {\n      if (length) {\n        this.byteBuffer = new Uint8Array(arraybuffer, offset, length);\n      } else {\n        this.byteBuffer = new Uint8Array(arraybuffer);\n      }\n    }\n    this.dv = new DataView(this.byteBuffer.buffer, this.byteBuffer.byteOffset, this.byteBuffer.byteLength);\n    this.idx = 0;\n  }\n  getByteIndex() {\n    return this.idx >>> 3;\n  }\n  fill(value, n) {\n    //nバイト書き込む\n    for (var i = 0; i < n; i++) {\n      this.setUint8(value);\n    }\n    return;\n  }\n  setInt32(value, le) {\n    this.dv.setInt32(this.idx >> 3, value, le);\n    this.idx += 32;\n    return;\n  }\n  getInt32(le) {\n    var ret = this.dv.getInt32(this.idx >> 3, le);\n    this.idx += 32;\n    return ret;\n  }\n  setUint8(value) {\n    this.dv.setUint8(this.idx >> 3, value);\n    this.idx += 8;\n  }\n  getUint8(le) {\n    var ret = this.dv.getUint8(this.idx >> 3, le);\n    this.idx += 8;\n    return ret;\n  }\n  setUint32(value, le) {\n    this.dv.setUint32(this.idx >> 3, value, le);\n    this.idx += 32;\n    return;\n  }\n  getUint32(le) {\n    var ret = this.dv.getUint32(this.idx >> 3, le);\n    this.idx += 32;\n    return ret;\n  }\n  setUint16(value, le) {\n    this.dv.setUint16(this.idx >> 3, value, le);\n    this.idx += 16;\n    return;\n  }\n  getUint16(le) {\n    var ret = this.dv.getUint16(this.idx >> 3, le);\n    this.idx += 16;\n    return ret;\n  }\n  setUint64(value, le) {\n    var h = value / (65536 * 65536) | 0;\n    var l = value & 0xffffffff;\n    if (le) {\n      this.setUint32(l, le);\n      this.setUint32(h, le);\n    } else {\n      this.setUint32(h, le);\n      this.setUint32(l, le);\n    }\n  }\n  getUint64(le) {\n    var ret = this.getUint32(le);\n    var ret2 = this.getUint32(le);\n    if (le) {\n      return (ret2 << 32) + ret;\n    } else {\n      return (ret << 32) + ret2;\n    }\n  }\n  setFloat32(value, le) {\n    this.dv.setFloat32(this.idx >> 3, value, le);\n    this.idx += 32;\n  }\n  getFloat32(le) {\n    var ret = this.dv.getFloat32(this.idx >> 3, le);\n    this.idx += 32;\n    return ret;\n  }\n  setBytes(bytes) {\n    for (var si = 0; si < bytes.length; si++) {\n      this.setUint8(bytes[si]);\n    }\n    return;\n  }\n  getBytes(length) {\n    var array = new Uint8Array(length);\n    for (var si = 0; si < length; si++) {\n      array[si] = this.getUint8();\n    }\n    return array;\n  }\n  setTextBuf(str, flg) {\n    var utf8array = _util_js__WEBPACK_IMPORTED_MODULE_0__[\"default\"].stringToUtf8(str);\n    var dv = this.dv;\n    for (var si = 0; si < utf8array.length; si++) {\n      this.setUint8(utf8array[si]);\n    }\n    if (flg) {\n      this.setUint8(0);\n    }\n    return;\n  }\n  readTextBuf() {\n    var dv = this.dv;\n    var array = [];\n    var a;\n    while ((a = dv.getUint8(this.idx >> 3)) !== 0) {\n      array.push(a);\n      this.idx += 1 << 3;\n    }\n    this.idx += 1 << 3;\n    return _util_js__WEBPACK_IMPORTED_MODULE_0__[\"default\"].utf8ToString(array);\n  }\n  setFloat16(value, le) {\n    var dv = this.dv;\n    var s = -Math.sign(value) + 1 >> 1;\n    var val = Math.abs(value);\n    var e = Math.floor(Math.log2(val));\n    val = val / Math.pow(2, e) - 1;\n    var u = s << 15 | e + 15 << 10 | val * 1024 & 1023;\n    this.setUint16(u, le);\n\n    //\t\tthis.idx-=16;\n    //\t\tvar val2= this.readFloat16(le);\n  }\n  readFloat16(le) {\n    var dv = this.dv;\n    var data = this.getUint16(le);\n    if (data === 0) return 0.0;\n    var sign = data >> 15 & 1;\n    sign = 1 - sign * 2;\n    var idx = (data >> 10 & 31) - 15;\n    var b = (data & 1023) * 1.0 / 1024.0 + 1.0;\n    return sign * b * Math.pow(2.0, idx);\n  }\n  outputBit(bit) {\n    //1ビットouput_bufferに書き込む\n    //書き込んだあとindexを1ビットすすめる\n    this.byteBuffer[this.idx >> 3] &= ~(1 << (this.idx & 7));\n    this.byteBuffer[this.idx >> 3] |= bit << (this.idx & 7);\n    this.idx++;\n  }\n  outputBits(bits, len) {\n    //ビット列をoutput_bufferに書き込む\n    for (var i = 0; i < len; i++) {\n      this.outputBit(bits >> i & 1);\n    }\n  }\n  outputBitsReverse(bits, len) {\n    //ビット列を逆順(上位ビットから順番)にoutput_bufferに書き込む\n    //ハフマン符号格納用\n\n    for (var i = len - 1; i >= 0; i--) {\n      this.outputBit(bits >> i & 1);\n    }\n  }\n  readBit() {\n    //bufferからoutput_indexの位置のビットを読み込み\n    //読み込んだあとoutput_indexを1つすすめる\n    var bit = this.byteBuffer[this.idx >> 3] >> (this.idx & 7) & 1;\n    this.idx++;\n    return bit;\n  }\n  readBits(len) {\n    //output_bufferからlen分読み込み\n    var bits = 0;\n    for (var i = 0; i < len; i++) {\n      bits = bits | this.readBit() << i;\n    }\n    return bits;\n  }\n  readBitsReverse(len) {\n    //output_bufferからlen分読み込み\n    //読み込んだビットは高次ビットから格納される\n    //ハフマン符号読み込み用\n    var bits = 0;\n    for (var i = 0; i < len; i++) {\n      bits = bits << 1 | this.readBit();\n    }\n    return bits;\n  }\n}\n\n//# sourceURL=webpack://hdrpaint/./src/lib/datastream.js?");

/***/ }),

/***/ "./src/lib/deflate.js":
/*!****************************!*\
  !*** ./src/lib/deflate.js ***!
  \****************************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": function() { return /* binding */ Deflate; }\n/* harmony export */ });\n/* harmony import */ var _datastream_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./datastream.js */ \"./src/lib/datastream.js\");\n\nvar clen_huffmans = []; //データ長データ用ハフマン符号情報\nvar lit_huffmans = []; //リテラル/長さ用ハフマン符号情報\nvar dist_huffmans = []; //距離用ハフマン符号情報\nconst MAX_BITS = 15; //ハフマン符号に使う最大ビット長\n\nclass Deflate {\n  constructor() {}\n  static compress(arrayBuffer, comp_mode, block) {\n    //deflate圧縮を行う\n\n    var result;\n    //ブロックを作成\n    if (!block) {\n      result = encBlock(arrayBuffer, 0, arrayBuffer.length, 1, comp_mode);\n    } else {\n      result = [];\n      var idx = 0;\n      while (idx < arrayBuffer.length) {\n        var size = Math.min(block, arrayBuffer.length - idx);\n        if (idx + size >= arrayBuffer.length) {\n          final = 1;\n        } else {\n          final = 0;\n        }\n        a = encBlock(arrayBuffer, idx, size, final, comp_mode);\n        result = result.concat(a);\n        idx += size;\n      }\n    }\n    return result;\n  }\n  static expand(compress_array_buffer, offset, length) {\n    //Deflate圧縮された情報を伸長する\n    var ds = new _datastream_js__WEBPACK_IMPORTED_MODULE_0__[\"default\"](compress_array_buffer, offset, length);\n    var decdata = [];\n    var bfinal = 0;\n\n    //最終ブロックを伸長した後はループを抜ける\n    while (!bfinal) {\n      bfinal = ds.readBit();\n      var compless_type = ds.readBits(2);\n      if (compless_type === 0) {\n        //無圧縮\n        if (ds.idx & 7) {\n          ds.idx = (ds.idx & ~7) + 8;\n        } else {\n          ds.idx = ds.idx & ~7;\n        }\n        var len = ds.readBits(16);\n        ds.readBits(16);\n        for (var i = 0; i < len; i++) {\n          decdata.push(ds.readBits(8));\n        }\n        //ds.idx+=len*8;\n      } else if (compless_type === 1 || compless_type === 2) {\n        var lenlist = [];\n        if (compless_type === 1) {\n          //固定ハフマン\n          for (var i = 0; i <= 143; i++) {\n            lenlist[i] = 8;\n          }\n          for (var i = 144; i <= 255; i++) {\n            lenlist[i] = 9;\n          }\n          for (var i = 256; i <= 279; i++) {\n            lenlist[i] = 7;\n          }\n          for (var i = 280; i <= 287; i++) {\n            lenlist[i] = 8;\n          }\n          lit_huffmans = createHuffmans(lenlist);\n          lenlist = [];\n          for (var i = 0; i <= 31; i++) {\n            lenlist[i] = 5;\n          }\n          dist_huffmans = createHuffmans(lenlist);\n        } else {\n          //ダイナミックハフマン\n          var hlit = ds.readBits(5);\n          var hdist = ds.readBits(5);\n          var hclen = ds.readBits(4);\n\n          //コード長コード復号\n          var idx = [16, 17, 18, 0, 8, 7, 9, 6, 10, 5, 11, 4, 12, 3, 13, 2, 14, 1, 15];\n          for (var i = 0; i < idx.length; i++) {\n            if (i < hclen + 4) {\n              lenlist[idx[i]] = ds.readBits(3);\n            } else {\n              lenlist[idx[i]] = 0;\n            }\n          }\n          var clen_huffmans = createHuffmans(lenlist);\n\n          //長さビット長リスト復元\n          //距離ビット長リスト復元\n          var lenlist2 = decodeClen(ds, hlit + hdist + 258, clen_huffmans);\n          lenlist = lenlist2.slice(0, hlit + 257);\n          lit_huffmans = createHuffmans(lenlist);\n          lenlist = lenlist2.slice(hlit + 257);\n          dist_huffmans = createHuffmans(lenlist);\n        }\n        while (1) {\n          var value = readHuffman(ds, lit_huffmans);\n          if (value < 256) {\n            //リテラル\n            decdata.push(value);\n          } else {\n            if (value == 256) {\n              //終了符号\n              break;\n            }\n\n            //長さ\n            if (value === 285) {\n              value = 255;\n            } else {\n              var extra_bits = value - 261;\n              if (extra_bits >= 0) {\n                extra_bits = extra_bits >> 2;\n                value = value - 257;\n                var offset = 4 + extra_bits * 4;\n                var extra_data = ds.readBits(extra_bits);\n                value = (value - offset << extra_bits) + (4 << extra_bits) + extra_data;\n              } else {\n                value = value - 257;\n              }\n            }\n            //len=value+3;\n            decdata.push(-(value + 3)); //-len\n\n            //距離\n            value = readHuffman(ds, dist_huffmans);\n            extra_bits = value - 2;\n            if (extra_bits >= 0) {\n              extra_bits = extra_bits >> 1;\n              var offset = 2 + extra_bits * 2;\n              var extra_data = ds.readBits(extra_bits);\n              value = (value - offset << extra_bits) + (2 << extra_bits) + extra_data;\n            }\n            //dist=value+1;\n            decdata.push(value + 1); //dist\n          }\n        }\n        decdata = expandLZ77(decdata);\n      }\n    }\n    return decdata;\n  }\n}\nvar encBlock = function (src, offset, size, final, comp_type) {\n  //1ブロック分出力する\n\n  //出力用ストリーム\n  var ds = new _datastream_js__WEBPACK_IMPORTED_MODULE_0__[\"default\"](new ArrayBuffer(size * 2)); //元サイズの2倍くらいあれば多分大丈夫\n\n  //BFINAL\n  ds.outputBit(final);\n\n  //complession type\n  ds.outputBits(comp_type, 2);\n  if (comp_type === 0) {\n    //無圧縮モード\n\n    //バイト頭まで移動\n    if (ds.idx & 7) {\n      ds.idx = (ds.idx & ~7) + 8;\n    } else {\n      ds.idx = dx.idx & ~7;\n    }\n    var len = size;\n    ds.outputBits(len, 16);\n    ds.outputBits(~len, 16);\n    for (var i = 0; i < src.length; i++) {\n      ds.outputBits(src[i + offset], 8);\n    }\n  } else {\n    var lit_list = []; //リテラル/長さ用のハフマン符号を作るための符号長リスト\n    var dist_list = []; //距離用のハフマン符号を作るための符号長リスト\n    var clen_list = []; //符号長用のハフマン符号リストを作成\n\n    //LZ77圧縮を行う\n    var lz77 = compressLZ77(src, offset, size);\n    if (comp_type === 1) {\n      //固定ハフマン符号圧縮\n\n      //リテラル/長さ用のハフマン符号を作るための符号長リスト\n      for (var i = 0; i <= 143; i++) {\n        lit_list[i] = 8;\n      }\n      for (var i = 144; i <= 255; i++) {\n        lit_list[i] = 9;\n      }\n      for (var i = 256; i <= 279; i++) {\n        lit_list[i] = 7;\n      }\n      for (var i = 280; i <= 287; i++) {\n        lit_list[i] = 8;\n      }\n\n      //距離用のハフマン符号を作るための符号長リスト\n      for (var i = 0; i <= 31; i++) {\n        dist_list[i] = 5;\n      }\n    } else if (comp_type === 2) {\n      //カスタムハフマン符号圧縮\n\n      //符号長用のハフマン符号を作るための符号長リスト\n      for (var i = 0; i < 19; i++) {\n        clen_list.push(5);\n      }\n      //符号長用のハフマン符号リストを作成\n      clen_huffmans = createHuffmans(clen_list);\n\n      //リテラル/長さ用のハフマン符号を作るための符号長リスト\n      for (var i = 0; i <= 143; i++) {\n        lit_list[i] = 9;\n      }\n      for (var i = 144; i <= 255; i++) {\n        lit_list[i] = 8;\n      }\n      for (var i = 256; i <= 279; i++) {\n        lit_list[i] = 8;\n      }\n      for (var i = 280; i <= 287; i++) {\n        lit_list[i] = 7;\n      }\n\n      //距離用のハフマン符号を作るための符号長リスト\n      //for(var i=0;i<=10;i++){ dist_list[i]=4;}\n      //for(var i=11;i<=20;i++){ dist_list[i]=5;}\n      //for(var i=21;i<=31;i++){ dist_list[i]=6;}\n      for (var i = 0; i <= 31; i++) {\n        dist_list[i] = 5;\n      }\n\n      //リテラル/長さ用符号長リスト要素数を出力\n      ds.outputBits(lit_list.length - 257, 5);\n      //距離用符号長リスト要素数を出力\n      ds.outputBits(dist_list.length - 1, 5);\n      //符号長ハフマン符号用符号長リスト要素数を出力\n      ds.outputBits(clen_list.length - 4, 4);\n\n      //符号長リストから符号長用ハフマン符号を作成\n      for (var i = 0; i < clen_list.length; i++) {\n        ds.outputBits(clen_list[i], 3);\n      }\n\n      //符号長用ハフマン符号を用いてリテラル/長さ符号長リストを出力\n      var enc = encodeClen(lit_list, clen_huffmans);\n      outputClen(ds, enc, clen_huffmans);\n\n      //符号長用ハフマン符号を用いて距離符号長リストを出力\n      enc = encodeClen(dist_list, clen_huffmans);\n      outputClen(ds, enc, clen_huffmans);\n    }\n    //符号長リストからリテラル/長さハフマン符号を作成\n    lit_huffmans = createHuffmans(lit_list);\n\n    //符号長リストから距離ハフマン符号を作成\n    dist_huffmans = createHuffmans(dist_list);\n\n    //LZ77で圧縮されたデータをハフマン符号化し出力\n    for (var i = 0; i < lz77.length; i++) {\n      //if(!isNaN(src[i])){\n      if (lz77[i] >= 0) {\n        //リテラルの場合、リテラル/長さ用ハフマン符号を使って出力\n        outputHuffman(ds, lz77[i], lit_huffmans);\n      } else {\n        //繰り返し情報の場合、長さ、距離を符号+拡張情報の形に変えた後\n        //それぞれのハフマン符号を使って出力\n\n        //長さを符号+拡張情報化\n        var len = -lz77[i];\n        i++;\n        var dist = lz77[i];\n        var extra_bits = 0;\n        var extra_data = 0;\n        var code = 285;\n        if (len < 258) {\n          extra_bits = (Math.log2(Math.max(len - 3, 4)) | 0) - 2;\n          code = extra_bits * 4 + (len - 3 >> extra_bits) + 257;\n          extra_data = len - 3 & (1 << extra_bits) - 1;\n        }\n\n        //長さ符号をハフマン符号を使って出力\n        outputHuffman(ds, code, lit_huffmans);\n        //拡張情報はそのまま出力\n        ds.outputBits(extra_data, extra_bits);\n\n        //距離を符号+拡張情報化\n        extra_bits = (Math.log2(Math.max(dist - 1, 2)) | 0) - 1;\n        code = extra_bits * 2 + (dist - 1 >> extra_bits);\n        var extra_data = dist - 1 & (1 << extra_bits) - 1;\n\n        //距離符号をハフマン符号を使って出力\n        outputHuffman(ds, code, dist_huffmans);\n        ///拡張情報はそのまま出力\n        ds.outputBits(extra_data, extra_bits);\n      }\n    }\n    //ブロック終了符号(256)をリテラル/長さハフマン符号を使って出力\n    outputHuffman(ds, 256, lit_huffmans);\n  }\n\n  //サイズぴったしに切り抜く\n  //\t\tvar result = new Uint8Array(Math.ceil(ds.idx/8));\n  //\t\tfor(var i=0;i<result.length;i++){\n  //\t\t\tresult[i]=ds.byteBuffer[i];\n  //\t\t}\n  //\t\treturn result;\n\n  return Array.from(ds.byteBuffer).slice(0, Math.ceil(ds.idx / 8));\n};\nvar createHuffmans = function (lenlist) {\n  //ビット長リストからハフマン符号情報を作成する\n  var enc_huffmans = [];\n  var max_bits = 0;\n  for (var i = 0; i < lenlist.length; i++) {\n    var t = {};\n    t.Len = lenlist[i];\n    t.Code = 0;\n    enc_huffmans.push(t);\n    if (max_bits < lenlist[i]) {\n      max_bits = lenlist[i];\n    }\n  }\n  var bl_count = new Array(max_bits + 1);\n  for (var i = 0; i < bl_count.length; i++) {\n    bl_count[i] = 0;\n  }\n  for (var i = 0; i < enc_huffmans.length; i++) {\n    bl_count[enc_huffmans[i].Len]++;\n  }\n  var code = 0;\n  var next_code = new Array(max_bits + 1);\n  bl_count[0] = 0;\n  for (var bits = 1; bits < next_code.length; bits++) {\n    code = code + bl_count[bits - 1] << 1;\n    next_code[bits] = code;\n  }\n  for (var n = 0; n < enc_huffmans.length; n++) {\n    var len = enc_huffmans[n].Len;\n    if (len != 0) {\n      enc_huffmans[n].Code = next_code[len];\n      next_code[len]++;\n    }\n  }\n  var dec_huffmans = {};\n  for (var i = 0; i < enc_huffmans.length; i++) {\n    if (enc_huffmans[i].Len) {\n      dec_huffmans[enc_huffmans[i].Code] = i;\n    }\n  }\n  var huffmans = {};\n  huffmans.enc_huffmans = enc_huffmans;\n  huffmans.dec_huffmans = dec_huffmans;\n  return huffmans;\n};\nvar readHuffman = function (dv, tree) {\n  //ハフマン符号のどれかに一致するまで\n  //output_bufferから1バイトずつ読みこみ\n  //一致したハフマン符号をデコードした値を返す\n\n  var dec_huffmans = tree.dec_huffmans;\n  var enc_huffmans = tree.enc_huffmans;\n  for (var i = 1; i <= MAX_BITS; i++) {\n    var value = dv.readBitsReverse(i);\n    var deccode = dec_huffmans[value];\n    if (deccode != null) {\n      if (enc_huffmans[deccode].Len === i) {\n        return deccode;\n      }\n    }\n    dv.idx -= i; //バッファのインデックスを戻す\n  }\n  return null;\n};\nvar encodeClen = function (lenlist) {\n  //符号長リストを0~18の符号列に変換する\n\n  var clen = [];\n  for (var i = 0; i < lenlist.length; i++) {\n    var target = lenlist[i];\n    var count = 1;\n    for (; count + i < lenlist.length && target === lenlist[i + count]; count++) {}\n    i += count - 1;\n    if (target === 0) {\n      while (count) {\n        if (count < 3) {\n          clen.push(0);\n          count -= 1;\n        } else if (count < 11) {\n          clen.push(17);\n          clen.push(count - 3);\n          count = 0;\n        } else if (count < 139) {\n          clen.push(18);\n          clen.push(count - 11);\n          count = 0;\n        } else {\n          clen.push(18);\n          clen.push(127);\n          count -= 138;\n        }\n      }\n    } else {\n      clen.push(target);\n      count -= 1;\n      while (count) {\n        if (count < 3) {\n          clen.push(target);\n          count -= 1;\n        } else if (count < 7) {\n          clen.push(16);\n          clen.push(count - 3);\n          count = 0;\n        } else {\n          clen.push(16);\n          clen.push(3);\n          count -= 6;\n        }\n      }\n    }\n  }\n  return clen;\n};\nvar decodeClen = function (ds, size, clen_huffmans) {\n  //ハフマン符号化された0~18の符号列から\n  //符号長リストを復元する\n\n  var lenlist = [];\n  while (1) {\n    if (lenlist.length >= size) {\n      break;\n    }\n    var value = readHuffman(ds, clen_huffmans);\n    if (value <= 15) {\n      lenlist.push(value);\n    } else if (value === 16) {\n      //直前値3~6コピー\n      var extra = ds.readBits(2);\n      var org = lenlist[lenlist.length - 1];\n      for (var j = 0; j < extra + 3; j++) {\n        lenlist.push(org);\n      }\n    } else if (value === 17) {\n      //3~10ゼロ埋め\n      var extra = ds.readBits(3);\n      for (var j = 0; j < extra + 3; j++) {\n        lenlist.push(0);\n      }\n    } else if (value === 18) {\n      //11~138ゼロ埋め\n      var extra = ds.readBits(7);\n      for (var j = 0; j < extra + 11; j++) {\n        lenlist.push(0);\n      }\n    }\n  }\n  return lenlist;\n};\nvar outputHuffman = function (ds, value, tree) {\n  //値をハフマン符号化しoutput_bufferに書き込む\n  var t = tree.enc_huffmans[value];\n  ds.outputBitsReverse(t.Code, t.Len);\n};\nvar outputClen = function (ds, src, tree) {\n  //コード長をハフマン符号化しoutput_bufferに書き込む\n  for (var i = 0; i < src.length; i++) {\n    var value = src[i];\n    if (value <= 15) {\n      outputHuffman(ds, value, tree);\n    } else if (value === 16) {\n      outputHuffman(ds, value, tree);\n      i++;\n      ds.outputBits(src[i], 2);\n    } else if (value === 17) {\n      outputHuffman(ds, value, tree);\n      i++;\n      ds.outputBits(src[i], 3);\n    } else if (value === 18) {\n      outputHuffman(ds, value, tree);\n      i++;\n      ds.outputBits(src[i], 7);\n    }\n  }\n};\nclass Queue {\n  constructor() {\n    this.front = [];\n    this.behind = [];\n  }\n  push(value) {\n    this.front.push(value);\n  }\n  shift() {\n    if (this.behind.length === 0) {\n      var buf = this.behind;\n      this.behind = this.front;\n      this.front = buf;\n      this.behind.reverse();\n    }\n    return this.behind.pop();\n  }\n  each(f) {\n    for (var i = this.behind.length; i--;) {\n      if (f(this.behind[i])) {\n        return;\n      }\n    }\n    for (var i = 0; i < this.front.length; i++) {\n      if (f(this.front[i])) {\n        return;\n      }\n    }\n  }\n  each_inv1(f) {\n    var i = this.front.length;\n    if (i > 0) i--;\n    for (; i--;) {\n      if (f(this.front[i])) {\n        return;\n      }\n    }\n    i = 0;\n    if (this.front.length === 0) {\n      i = 1;\n    }\n    for (; i < this.behind.length; i++) {\n      if (f(this.behind[i])) {\n        return;\n      }\n    }\n  }\n  each_inv(f) {\n    var flg = false;\n    for (var i = this.front.length; i--;) {\n      if (f(this.front[i])) {\n        return;\n      }\n    }\n    for (var i = 0; i < this.behind.length; i++) {\n      if (f(this.behind[i])) {\n        return;\n      }\n    }\n  }\n}\nvar setmap = function (maps, u8a, i) {\n  var key = (u8a[i] << 16) + (u8a[i + 1] << 8) + u8a[i + 2];\n  if (!(key in maps)) {\n    maps[key] = new Queue();\n  }\n  maps[key].push(i);\n};\nvar removemap = function (maps, u8a, i) {\n  maps[(u8a[i] << 16) + (u8a[i + 1] << 8) + u8a[i + 2]].shift();\n};\nvar compressLZ77 = function (u8a, offset, size) {\n  //LZ77で圧縮する\n  var result = new Array(size);\n  var idx = 0;\n  var maps = {};\n  var imax = offset + size - 2;\n  var dataview = new DataView(u8a.buffer);\n  var i = Math.max(0, offset - 32768);\n  for (; i < offset; i++) {\n    setmap(maps, u8a, i);\n  }\n  var imax = size - 2;\n  for (var i = 0; i < imax; i++) {\n    //先頭から走査\n    var offseti = offset + i;\n    var dist = 0;\n    var len_max = 2;\n    var kmax = Math.min(size - i, 258) + offseti;\n    var kmax2 = kmax - 4;\n    var key = (u8a[offseti] << 16) + (u8a[offseti + 1] << 8) + u8a[offseti + 2];\n    var map = maps[key];\n    if (map) map.each_inv(function (f) {\n      var j = offseti - f;\n      var k = offseti;\n      for (; k < kmax2; k += 4) {\n        if (dataview.getUint32(k) !== dataview.getUint32(k - j)) {\n          break;\n        }\n      }\n      for (; k < kmax; k++) {\n        if (dataview.getUint8(k) !== dataview.getUint8(k - j)) {\n          break;\n        }\n      }\n      if (k - offseti <= len_max) {\n        return false;\n      }\n      dist = j;\n      len_max = k - offseti;\n      if (k === kmax) {\n        return true;\n      }\n    });\n    if (dist) {\n      result[idx] = -len_max;\n      idx++;\n      result[idx] = dist;\n      i += len_max - 1;\n\n      //マップ追加\n      for (j = 0; j < len_max; j++) {\n        setmap(maps, u8a, j + offseti);\n      }\n      //マップ削除\n      var jmax = offseti - 32768 + len_max;\n      j = Math.max(0, offseti - 32768);\n      for (; j < jmax; j++) {\n        removemap(maps, u8a, j);\n      }\n    } else {\n      result[idx] = u8a[offseti];\n\n      //マップ追加\n      setmap(maps, u8a, offseti);\n\n      //マップ削除\n      var j = offseti - 32768;\n      if (j >= 0) {\n        removemap(maps, u8a, j);\n      }\n    }\n    idx++;\n  }\n  for (; i < size; i++) {\n    result[idx] = u8a[offset + i];\n    idx++;\n  }\n  result.length = idx;\n  return result;\n};\nvar compressLZ77_ = function (u8a, offset, size) {\n  //LZ77で圧縮する\n  var result = new Array(size);\n  var idx = 0;\n  var maps = {};\n  var imax = offset + size - 2;\n  var i = Math.max(0, offset - 32768);\n  for (; i < imax; i++) {\n    var key = (u8a[i] << 16) + (u8a[i + 1] << 8) + u8a[i + 2];\n    if (!maps[key]) {\n      maps[key] = [];\n    }\n    maps[key].push(i);\n  }\n  var imax = size - 2;\n  for (var i = 0; i < imax; i++) {\n    //先頭から走査\n    var dist = 0;\n    var len_max = 2;\n    var offseti = offset + i;\n    var kmax = Math.min(size - i, 258);\n    var key = (u8a[offseti] << 16) + (u8a[offseti + 1] << 8) + u8a[offseti + 2];\n    var map = maps[key];\n    for (var m = map.length; m--;) {\n      var j = offseti - map[m];\n      if (j <= 0) {\n        continue;\n      }\n      if (j > 32768) {\n        continue;\n      }\n      ;\n      var offsetj = offseti - j;\n      var k = 3;\n      for (; k < kmax; k++) {\n        if (u8a[offseti + k] !== u8a[offsetj + k]) {\n          break;\n        }\n      }\n      if (k <= len_max) {\n        continue;\n      }\n      dist = j;\n      len_max = k;\n      if (len_max === kmax) {\n        break;\n      }\n    }\n    if (dist) {\n      result[idx] = -len_max;\n      idx++;\n      result[idx] = dist;\n      i += len_max - 1;\n    } else {\n      result[idx] = u8a[offseti];\n    }\n    idx++;\n  }\n  for (; i < size; i++) {\n    result[idx] = u8a[offset + i];\n    idx++;\n  }\n  result.length = idx;\n  return result;\n};\nvar expandLZ77 = function (data, exist_data) {\n  //LZ77圧縮データを伸長する\n  var decoded_data;\n  if (exist_data) {\n    decoded_data = exist_data;\n  } else {\n    decoded_data = [];\n  }\n  for (var i = 0; i < data.length; i++) {\n    if (data[i] >= 0) {\n      //リテラルの場合そのまま出力\n      decoded_data.push(data[i]);\n    } else {\n      //繰り返しの場合それを出力\n      var len = -data[i];\n      i++;\n      var dist = data[i];\n      var idx = decoded_data.length - dist;\n      for (var j = 0; j < len; j++) {\n        decoded_data.push(decoded_data[idx + j]);\n      }\n    }\n  }\n  return decoded_data;\n};\nvar formatBinary = function (array_buffer) {\n  var src = new Uint8Array(array_buffer);\n  var result = \"\";\n  for (var i = 0; i < src.length; i++) {\n    if (i !== 0) {\n      result += \",\";\n    }\n    result += ('00000000' + src[i].toString(2)).slice(-8);\n  }\n  return result;\n};\nvar formatHuffmans = function (huffmans) {\n  var result = \"\";\n  for (var i = 0; i < huffmans.length && i < 3; i++) {\n    if (i !== 0) {\n      result += \",\";\n    }\n    result += ('0000000000' + huffmans[i].Code.toString(2)).slice(-huffmans[i].Len);\n  }\n  return result;\n};\nvar format = function (src) {\n  //\n  var result = \"\";\n  for (var i = 0; i < src.length; i++) {\n    if (i !== 0) {\n      result += \",\";\n    }\n    if (isNaN(src[i])) {\n      result += \"&lt;\" + src[i].len.toString(10) + \",\" + src[i].dist.toString(10) + \"&gt;\";\n    } else {\n      result += src[i].toString(10);\n    }\n  }\n  return result;\n};\n\n//# sourceURL=webpack://hdrpaint/./src/lib/deflate.js?");

/***/ }),

/***/ "./src/lib/fpsman.js":
/*!***************************!*\
  !*** ./src/lib/fpsman.js ***!
  \***************************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": function() { return /* binding */ Fpsman; }\n/* harmony export */ });\nfunction _defineProperty(obj, key, value) { key = _toPropertyKey(key); if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\nfunction _toPropertyKey(arg) { var key = _toPrimitive(arg, \"string\"); return typeof key === \"symbol\" ? key : String(key); }\nfunction _toPrimitive(input, hint) { if (typeof input !== \"object\" || input === null) return input; var prim = input[Symbol.toPrimitive]; if (prim !== undefined) { var res = prim.call(input, hint || \"default\"); if (typeof res !== \"object\") return res; throw new TypeError(\"@@toPrimitive must return a primitive value.\"); } return (hint === \"string\" ? String : Number)(input); }\nfunction _classPrivateFieldInitSpec(obj, privateMap, value) { _checkPrivateRedeclaration(obj, privateMap); privateMap.set(obj, value); }\nfunction _checkPrivateRedeclaration(obj, privateCollection) { if (privateCollection.has(obj)) { throw new TypeError(\"Cannot initialize the same private elements twice on an object\"); } }\nfunction _classPrivateFieldGet(receiver, privateMap) { var descriptor = _classExtractFieldDescriptor(receiver, privateMap, \"get\"); return _classApplyDescriptorGet(receiver, descriptor); }\nfunction _classApplyDescriptorGet(receiver, descriptor) { if (descriptor.get) { return descriptor.get.call(receiver); } return descriptor.value; }\nfunction _classPrivateFieldSet(receiver, privateMap, value) { var descriptor = _classExtractFieldDescriptor(receiver, privateMap, \"set\"); _classApplyDescriptorSet(receiver, descriptor, value); return value; }\nfunction _classExtractFieldDescriptor(receiver, privateMap, action) { if (!privateMap.has(receiver)) { throw new TypeError(\"attempted to \" + action + \" private field on non-instance\"); } return privateMap.get(receiver); }\nfunction _classApplyDescriptorSet(receiver, descriptor, value) { if (descriptor.set) { descriptor.set.call(receiver, value); } else { if (!descriptor.writable) { throw new TypeError(\"attempted to set read only private field\"); } descriptor.value = value; } }\nvar _fps = /*#__PURE__*/new WeakMap();\nvar _spf = /*#__PURE__*/new WeakMap();\nvar _fpserror = /*#__PURE__*/new WeakMap();\nvar _fpserrordelta = /*#__PURE__*/new WeakMap();\nvar _nextsleep = /*#__PURE__*/new WeakMap();\nvar _mainfunc = /*#__PURE__*/new WeakMap();\nclass Fpsman {\n  //1frameごとに実行する関数\n\n  constructor(fps, mainfunc) {\n    _classPrivateFieldInitSpec(this, _fps, {\n      writable: true,\n      value: void 0\n    });\n    _classPrivateFieldInitSpec(this, _spf, {\n      writable: true,\n      value: void 0\n    });\n    //1frameあたりの時間[ms]\n    _classPrivateFieldInitSpec(this, _fpserror, {\n      writable: true,\n      value: void 0\n    });\n    //蓄積誤差[ms]\n    _classPrivateFieldInitSpec(this, _fpserrordelta, {\n      writable: true,\n      value: void 0\n    });\n    //1secあたりの想定誤差[ms]\n    _classPrivateFieldInitSpec(this, _nextsleep, {\n      writable: true,\n      value: void 0\n    });\n    //次回実行時間\n    _classPrivateFieldInitSpec(this, _mainfunc, {\n      writable: true,\n      value: void 0\n    });\n    _defineProperty(this, \"mainloop\", () => {\n      var nowTime = performance.now(); //現在時間\n      var dt = _classPrivateFieldGet(this, _nextsleep) - nowTime; //想定時間との差異\n\n      //時間差異が1frameぶんより大きい場合は次回の呼び出し時間を補正する\n      if (dt > _classPrivateFieldGet(this, _spf)) dt = _classPrivateFieldGet(this, _spf);\n      if (dt < -_classPrivateFieldGet(this, _spf)) dt = -_classPrivateFieldGet(this, _spf);\n\n      //ミリ秒で割り切れない分の誤差の端数処理\n      _classPrivateFieldSet(this, _fpserror, _classPrivateFieldGet(this, _fpserror) + _classPrivateFieldGet(this, _fpserrordelta));\n      if (_classPrivateFieldGet(this, _fpserror) >= _classPrivateFieldGet(this, _fps)) {\n        //時間誤差が1msを超えたら次回1ms増やす\n        _classPrivateFieldSet(this, _fpserror, _classPrivateFieldGet(this, _fpserror) - _classPrivateFieldGet(this, _fps));\n        dt += 1;\n      }\n\n      //次回実行時間\n      _classPrivateFieldSet(this, _nextsleep, nowTime + _classPrivateFieldGet(this, _spf) + dt);\n      _classPrivateFieldGet(this, _mainfunc).call(this); //メイン処理\n\n      nowTime = performance.now(); //現在時間再取得\n\n      dt = Math.max(1, _classPrivateFieldGet(this, _nextsleep) - nowTime); //次回実行時間の差異を取得(最低1ms)\n\n      setTimeout(this.mainloop, dt);\n    });\n    this.setFps(fps);\n    _classPrivateFieldSet(this, _mainfunc, mainfunc);\n  }\n  setFps(fps) {\n    if (_classPrivateFieldGet(this, _fps) === fps) {\n      return;\n    }\n    _classPrivateFieldSet(this, _fps, fps | 0);\n    _classPrivateFieldSet(this, _spf, 1000 / _classPrivateFieldGet(this, _fps) | 0);\n    _classPrivateFieldSet(this, _fpserror, 0);\n    _classPrivateFieldSet(this, _fpserrordelta, 1000 % _classPrivateFieldGet(this, _fps));\n    _classPrivateFieldSet(this, _nextsleep, 0);\n  }\n}\n\n//# sourceURL=webpack://hdrpaint/./src/lib/fpsman.js?");

/***/ }),

/***/ "./src/lib/img.js":
/*!************************!*\
  !*** ./src/lib/img.js ***!
  \************************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": function() { return /* binding */ Img; }\n/* harmony export */ });\n/* harmony import */ var _util_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./util.js */ \"./src/lib/util.js\");\n/* harmony import */ var _vector_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./vector.js */ \"./src/lib/vector.js\");\n/* harmony import */ var _openexr_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./openexr.js */ \"./src/lib/openexr.js\");\n\n\nfunction _defineProperty(obj, key, value) { key = _toPropertyKey(key); if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\nfunction _toPropertyKey(arg) { var key = _toPrimitive(arg, \"string\"); return typeof key === \"symbol\" ? key : String(key); }\nfunction _toPrimitive(input, hint) { if (typeof input !== \"object\" || input === null) return input; var prim = input[Symbol.toPrimitive]; if (prim !== undefined) { var res = prim.call(input, hint || \"default\"); if (typeof res !== \"object\") return res; throw new TypeError(\"@@toPrimitive must return a primitive value.\"); } return (hint === \"string\" ? String : Number)(input); }\n\n\n\nlet ctx, canvas, ctx_imagedata;\ncanvas = document.createElement('canvas');\ncanvas.width = 1;\ncanvas.height = 1;\nctx = canvas.getContext('2d');\nctx_imagedata = ctx.createImageData(canvas.width, canvas.height);\nlet FORMAT_FLOAT32 = 0;\nlet FORMAT_UINT8 = 1;\nlet ret_data = new _vector_js__WEBPACK_IMPORTED_MODULE_1__.Vec4();\nlet add = (dst, src, idx, idx2, idx3, r) => {\n  //var a2 = src[idx2+3];\n  //var a3 = src[idx3+3];\n  dst[idx + 0] += (src[idx2 + 0] + src[idx3 + 0]) * r;\n  dst[idx + 1] += (src[idx2 + 1] + src[idx3 + 1]) * r;\n  dst[idx + 2] += (src[idx2 + 2] + src[idx3 + 2]) * r;\n  dst[idx + 3] += (src[idx2 + 3] + src[idx3 + 3]) * r;\n};\nlet mul = (dst, idx) => {\n  var a = dst[idx + 3];\n  if (a === 0 || a === 1) {\n    return;\n  }\n  a = 1 / a;\n  dst[idx + 0] *= a;\n  dst[idx + 1] *= a;\n  dst[idx + 2] *= a;\n};\nclass Img {\n  //イメージ\n  constructor(_x, _y, format) {\n    _defineProperty(this, \"toDataURL\", function (p1, p2, x, y, w, h) {\n      return this.toCanvas(x, y, w, h).toDataURL(p1, p2);\n    });\n    _defineProperty(this, \"toBlob\", function (f, p1, p2, x, y, w, h) {\n      return this.toCanvas(x, y, w, h).toBlob(f, p1, p2);\n    });\n    _defineProperty(this, \"toBMP\", function () {\n      var height = this.height;\n      var width = this.width;\n      var l = height * (width * 4 + 1 >>> 2 << 2) * 2 + 14 + 40;\n      var dv = new DataStream(l);\n      //0x0000　(2)\tbfType\tファイルタイプ　通常は'BM'\n      dv.setTextBuf(\"BM\", 0);\n      //0x0002　(4)\tbfSize\tファイルサイズ (byte)\n      dv.setUint32(l, true);\n      //0x0006　(2)\tbfReserved1\t予約領域　常に 0\n      dv.setUint16(0, true);\n      //0x0008　(2)\tbfReserved2\t予約領域　常に 0\n      dv.setUint16(0, true);\n      //0x000A　(4)\tbfOffBits\tファイル先頭から画像データまでのオフセット (byte)\n      dv.setUint32(12 + 42, true);\n\n      //ヘッダサイズ\n      dv.setUint32(40, true);\n      //画像幅\n      dv.setUint32(this.width, true);\n      //画像高さ\n      dv.setUint32(this.height, true);\n      //プレーン数\n      dv.setUint16(1, true);\n      //1画素あたり\n      dv.setUint16(32, true);\n      //圧縮\n      dv.setUint32(0, true);\n      //画像サイズ\n      dv.setUint32(this.data.length, true);\n      //横解像度\n      dv.setUint32(0, true);\n      //縦解像度\n      dv.setUint32(0, true);\n      //パレット\n      dv.setUint32(0, true);\n      //重要パレット\n      dv.setUint32(0, true);\n      var data = this.data;\n      switch (this.format) {\n        case 1:\n          for (var yi = height; yi--;) {\n            var idx = yi * width << 2;\n            for (var xi = 0; xi < width; xi++) {\n              dv.setUint8(data[idx + 2], true);\n              dv.setUint8(data[idx + 1], true);\n              dv.setUint8(data[idx + 0], true);\n              dv.setUint8(data[idx + 3], true);\n              idx += 4;\n            }\n          }\n          break;\n        default:\n          break;\n      }\n      //var blob = new Blob([dv.byteBuffer], {type: \"application/octet-stream\"});\n      //return  window.URL.createObjectURL(blob);\n      return dv.byteBuffer;\n      //var b64= btoa(String.fromCharCode.apply(null,dv.byteBuffer));\n      //return \"data:image/bmp;base64,\"+b64;\n    });\n    if (!_x) {\n      _x = 0;\n      _y = 0;\n    }\n    this.width = _x;\n    this.height = _y;\n    this.data = null;\n    this.format = format;\n    if (this.width) {\n      switch (this.format) {\n        case FORMAT_UINT8:\n          this.imagedata = ctx.createImageData(this.width, this.height);\n          this.data = this.imagedata.data; //new Uint8Array(this.width*this.height<<2);\n          this.rgba = new Uint32Array(this.data.buffer);\n          break;\n        default:\n          this.data = new Float32Array(this.width * this.height << 2);\n          break;\n      }\n    }\n  }\n  static packR11G11B10(result, raw) {\n    //浮動小数をR11G11B10にパック\n    var idx = _vector_js__WEBPACK_IMPORTED_MODULE_1__.Vec3.alloc();\n    var num = _vector_js__WEBPACK_IMPORTED_MODULE_1__.Vec3.alloc();\n    idx[0] = Math.floor(Math.log2(Math.max(raw[0], 0.00001)));\n    idx[1] = Math.floor(Math.log2(Math.max(raw[1], 0.00001)));\n    idx[2] = Math.floor(Math.log2(Math.max(raw[2], 0.00001)));\n    idx[0] = Math.max(Math.min(idx[0], 16.0), -15.0);\n    idx[1] = Math.max(Math.min(idx[1], 16.0), -15.0);\n    idx[2] = Math.max(Math.min(idx[2], 16.0), -15.0);\n    num[0] = Math.max(raw[0] * Math.pow(2, -idx[0]) - 1.0, 0.0);\n    num[1] = Math.max(raw[1] * Math.pow(2, -idx[1]) - 1.0, 0.0);\n    num[2] = Math.max(raw[2] * Math.pow(2, -idx[2]) - 1.0, 0.0);\n    var geta = 15.0;\n    result[0] = (idx[0] + geta << 3) + Math.floor(num[0] * 8);\n    result[1] = (idx[1] + geta << 3) + Math.floor(num[1] * 8);\n    result[2] = (idx[2] + geta << 3) + Math.floor(fract(num[0] * 8) * 8);\n    result[3] = (num[2] * 32 << 3) + Math.floor(fract(num[1] * 8) * 8);\n    //Vec4.mul(result,result,1/255);\n    _vector_js__WEBPACK_IMPORTED_MODULE_1__.Vec3.free(2);\n  }\n  scan(f, x, y, w, h) {\n    var data = this.data;\n    if (x === undefined) {\n      x = 0;\n      y = 0;\n      w = this.width;\n      h = this.height;\n    }\n    for (var yi = 0; yi < h; yi++) {\n      var idx = this.getIndex(x, yi + y) << 2;\n      for (var xi = 0; xi < w; xi++) {\n        f(data, idx, x + xi, y + yi);\n        //data[idx ] =  ret_data[0];\n        //data[idx+1] = ret_data[1];\n        //data[idx+2] = ret_data[2];\n        //data[idx+3] = ret_data[3];\n        idx += 4;\n      }\n    }\n  }\n  static copy(dst, dst_x, dst_y, src, src_x, src_y, src_w, src_h, f) {\n    var dst_data = dst.data;\n    var dst_width = dst.width;\n    var src_data = src.data;\n    var src_width = src.width;\n    if (src_w + src_x > src.width) {\n      src_w = src.width - src_x;\n    }\n    if (src_h + src_y > src.height) {\n      src_h = src.height - src_y;\n    }\n    var left = dst_x;\n    var right = dst_x + src_w;\n    var top = dst_y;\n    var bottom = dst_y + src_h;\n    if (src_x < 0) {\n      left -= src_x;\n      src_x = 0;\n    }\n    if (src_y < 0) {\n      top -= src_y;\n      src_y = 0;\n    }\n    if (left < 0) {\n      src_x -= left;\n      left = 0;\n    }\n    if (top < 0) {\n      src_y -= top;\n      top = 0;\n    }\n    if (right > dst.width) {\n      right = dst.width;\n    }\n    if (bottom > dst.height) {\n      bottom = dst.height;\n    }\n    if (dst.type === FORMAT_UINT8 && src.type === FORMAT_UINT8) {\n      for (var yi = top; yi < bottom; yi++) {\n        var dst_idx = dst.getIndex(left, yi);\n        var src_idx = src.getIndex(src_x, src_y + yi - top);\n        for (var xi = left; xi < right; xi++) {\n          dst.rgba[dst_idx] = src.rgba[src_idx];\n          dst_idx++;\n          src_idx++;\n        }\n      }\n    } else {\n      for (var yi = top; yi < bottom; yi++) {\n        var dst_idx = dst.getIndex(left, yi);\n        var src_idx = src.getIndex(src_x, src_y + yi - top);\n        dst_idx <<= 2;\n        src_idx <<= 2;\n        for (var xi = left; xi < right; xi++) {\n          dst_data[dst_idx + 0] = src_data[src_idx + 0];\n          dst_data[dst_idx + 1] = src_data[src_idx + 1];\n          dst_data[dst_idx + 2] = src_data[src_idx + 2];\n          dst_data[dst_idx + 3] = src_data[src_idx + 3];\n          dst_idx += 4;\n          src_idx += 4;\n        }\n      }\n    }\n  }\n  copy(dst_x, dst_y, src, src_x, src_y, src_w, src_h) {\n    Img.copy(this, dst_x, dst_y, src, src_x, src_y, src_w, src_h);\n  }\n  getIndex(x, y) {\n    return y * this.width + x;\n  }\n  getIndexLoop(x, y) {\n    var xx = x % this.width;\n    var yy = y % this.height;\n    if (xx < 0) xx += this.width;\n    if (yy < 0) yy += this.height;\n    return yy * this.width + xx;\n  }\n  createExr(compression) {\n    var img = this;\n    var obj = {};\n    obj.width = img.width;\n    obj.height = img.height;\n    obj.attributes = [];\n    obj.attributes[\"compression\"] = compression;\n    obj.attributes[\"dataWindow\"] = {\n      xMin: 0,\n      yMin: 0,\n      xMax: img.width - 1,\n      yMax: img.height - 1\n    };\n    obj.attributes[\"displayWindow\"] = {\n      xMin: 0,\n      yMin: 0,\n      xMax: img.width - 1,\n      yMax: img.height - 1\n    };\n    obj.attributes[\"lineOrder\"] = 0;\n    obj.attributes[\"pixelAspectRatio\"] = 1;\n    obj.attributes[\"screenWindowCenter\"] = [0, 0];\n    obj.attributes[\"screenWindowWidth\"] = 1;\n    //\t\tobj.attributes[\"chromaticities\"]=[0.1,0.1,0.1,0.2,0.3,0.4,0.5,0.6];\n\n    var size = img.width * img.height;\n    var channels = [];\n    for (var i = 0; i < 4; i++) {\n      var channel = {};\n      channel.data = new Float32Array(size);\n      channel.pixel_type = 1;\n      channel.pLiner = 0;\n      channel.reserved = 0;\n      channel.xSampling = 1;\n      channel.ySampling = 1;\n      channels.push(channel);\n    }\n    channels[0].name = \"A\";\n    channels[1].name = \"B\";\n    channels[2].name = \"G\";\n    channels[3].name = \"R\";\n    var img_data = img.data;\n    for (var i = 0; i < size; i++) {\n      var idx = i << 2;\n      channels[0].data[i] = img_data[idx + 3];\n      channels[1].data[i] = img_data[idx + 2];\n      channels[2].data[i] = img_data[idx + 1];\n      channels[3].data[i] = img_data[idx + 0];\n    }\n    obj.attributes.channels = channels;\n    return _openexr_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"].toArrayBuffer(obj);\n  }\n  static loadImg(url, format, func) {\n    if (typeof url !== \"string\") {\n      _util_js__WEBPACK_IMPORTED_MODULE_0__[\"default\"].loadFile(url, function (url) {\n        Img.loadImg(url, format, func);\n      });\n      return null;\n    }\n    if (url.indexOf(\".exr\") >= 0) {\n      //exrファイルの場合\n      return Img.loadExr(url, format, func);\n    }\n    var image = new Image();\n    image.src = url;\n    var img = new this();\n    img.name = url;\n    img.format = format;\n    _util_js__WEBPACK_IMPORTED_MODULE_0__[\"default\"].loadingCount++;\n    image.onload = function (e) {\n      img.width = image.width;\n      img.height = image.height;\n      if (canvas.width < img.width || canvas.height < img.height) {\n        //開いた画像がキャンバスより大きい場合は広げる\n        if (canvas.width < img.width) {\n          canvas.width = img.width;\n        }\n        if (canvas.height < img.height) {\n          canvas.height = img.height;\n        }\n        ctx_imagedata = ctx.createImageData(canvas.width, canvas.height);\n      }\n\n      //ピクセルデータ取得\n      ctx.clearRect(0, 0, canvas.width, canvas.height);\n      ctx.drawImage(image, 0, 0);\n      var data = ctx.getImageData(0, 0, img.width, img.height).data;\n      switch (img.format) {\n        case 1:\n          img.data = new Uint8Array(img.width * img.height * 4);\n          img.rgba = new Uint32Array(img.data.buffer);\n          for (var di = 0; di < img.width * img.height * 4; di++) {\n            img.data[di] = data[di];\n          }\n          break;\n        default:\n          img.data = new Float32Array(img.width * img.height * 4);\n          var r = 1.0 / 255.0;\n          for (var di = 0; di < img.width * img.height * 4; di++) {\n            img.data[di] = data[di] * r;\n          }\n      }\n      if (func) {\n        func(img);\n      }\n      _util_js__WEBPACK_IMPORTED_MODULE_0__[\"default\"].loadingCount--;\n    };\n    image.onerror = function () {\n      //エラーの場合減らす\n      _util_js__WEBPACK_IMPORTED_MODULE_0__[\"default\"].loadingCount--;\n    };\n    return img;\n  }\n  static loadExr(url, format, func) {\n    var img = new Img();\n    img.name = url;\n    img.format = format;\n    var f = function (buffer) {\n      var obj = {};\n      _openexr_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"].fromArrayBuffer(obj, buffer);\n      img.width = obj.width;\n      img.height = obj.height;\n      img.data = new Float32Array(img.width * img.height * 4);\n      img.type = \"float\";\n\n      //RGBAチャンネルの情報をdataにセットする\n      var channels = obj.attributes.channels;\n      var data = img.data;\n      var cindex = {};\n      cindex[\"R\"] = -1;\n      cindex[\"G\"] = -1;\n      cindex[\"B\"] = -1;\n      cindex[\"A\"] = -1;\n      for (var i = 0; i < channels.length; i++) {\n        cindex[channels[i].name] = i;\n      }\n      var r = cindex[\"R\"];\n      var g = cindex[\"G\"];\n      var b = cindex[\"B\"];\n      var size = img.width * img.height * 4;\n      for (var i = 0; i < size; i += 4) {\n        data[i] = channels[r].data[i >> 2];\n        data[i + 1] = channels[g].data[i >> 2];\n        data[i + 2] = channels[b].data[i >> 2];\n      }\n      var a = cindex[\"A\"];\n      if (a >= 0) {\n        for (var i = 0; i < size; i += 4) {\n          data[i + 3] = channels[a].data[i >> 2];\n        }\n      } else {\n        for (var i = 0; i < size; i += 4) {\n          data[i + 3] = 1;\n        }\n      }\n      if (img.format === 1) {\n        var a = new _vector_js__WEBPACK_IMPORTED_MODULE_1__.Vec3();\n        var b = new _vector_js__WEBPACK_IMPORTED_MODULE_1__.Vec4();\n        var uint8 = new Uint8Array(size);\n        for (var i = 0; i < size; i += 4) {\n          _vector_js__WEBPACK_IMPORTED_MODULE_1__.Vec3.setValue(a, data[i], data[i + 1], data[i + 2]);\n          Img.packR11G11B10(b, a);\n          uint8[i] = b[0];\n          uint8[i + 1] = b[1];\n          uint8[i + 2] = b[2];\n          uint8[i + 3] = b[3];\n        }\n        img.data = uint8;\n      }\n      if (func) {\n        func(img);\n      }\n    };\n    if (typeof url === \"string\") {\n      _util_js__WEBPACK_IMPORTED_MODULE_0__[\"default\"].loadBinary(url, function (buffer) {\n        f(buffer);\n      });\n    } else {\n      if (url.byteLength) {\n        f(url);\n      } else {\n        _util_js__WEBPACK_IMPORTED_MODULE_0__[\"default\"].loadBinary(url, function (buffer) {\n          f(buffer);\n        });\n      }\n    }\n    return img;\n  }\n  fill(r, g, b, a, x, y, w, h) {\n    var data = this.data;\n    if (x === undefined) {\n      var size = data.length;\n      for (var i = 0; i < size; i += 4) {\n        data[idx + 0] = r;\n        data[idx + 1] = g;\n        data[idx + 2] = b;\n        data[idx + 3] = a;\n      }\n    } else {\n      var img_width = this.width;\n      var bottom = Math.min(this.height, y + h);\n      var right = Math.min(img_width, x + w);\n      for (var yi = y; yi < bottom; yi++) {\n        var idx = yi * img_width + x << 2;\n        var max = yi * img_width + right << 2;\n        for (; idx < max; idx += 4) {\n          data[idx + 0] = r;\n          data[idx + 1] = g;\n          data[idx + 2] = b;\n          data[idx + 3] = a;\n        }\n      }\n    }\n  }\n  clear(x, y, w, h) {\n    //透明でクリア\n    var data = this.data;\n    if (x === undefined) {\n      var size = data.length;\n      data.fill(0);\n    } else {\n      var img_width = this.width;\n      var bottom = Math.min(this.height, y + h);\n      var right = Math.min(img_width, x + w);\n      for (var yi = y; yi < bottom; yi++) {\n        var idx = yi * img_width + x << 2;\n        var max = yi * img_width + right << 2;\n        data.fill(0, idx, max);\n        //\t\t\t\tfor(;idx<max;idx+=4){\n        //\t\t\t\t\tdata[idx+0]=1;\n        //\t\t\t\t\tdata[idx+1]=1;\n        //\t\t\t\t\tdata[idx+2]=1;\n        //\t\t\t\t\tdata[idx+3]=0;\n        //\t\t\t\t}\n      }\n    }\n  }\n  toCanvas(x, y, w, h) {\n    if (x === undefined) {\n      x = 0;\n      y = 0;\n      w = this.width;\n      h = this.height;\n    }\n    canvas.width = w;\n    canvas.height = h;\n    ctx.putImageData(this.toImageData(), 0, 0, x, y, w, h);\n    return canvas;\n  }\n  toImageData() {\n    var ctx_imagedata;\n    var data = this.data;\n    switch (this.format) {\n      case FORMAT_UINT8:\n        ctx_imagedata = this.imagedata;\n        //for(var yi=0;yi<this.height;yi++){\n        //\tfor(var xi=0;xi<this.width;xi++){\n        //\t\tvar idx=yi*this.width + xi<<2;\n        //\t\tfor(var ii=0;ii<4;ii++){\n        //\t\t\tctx_imagedata.data[idx+ii]=data[idx+ii];\n        //\t\t}\n        //\t}\n        //}\n        break;\n      default:\n        ctx_imagedata = ctx.createImageData(this.width, this.height);\n        for (var yi = 0; yi < this.height; yi++) {\n          for (var xi = 0; xi < this.width; xi++) {\n            var idx = yi * this.width + xi << 2;\n            for (var ii = 0; ii < 4; ii++) {\n              ctx_imagedata.data[idx + ii] = data[idx + ii] * 255.0;\n            }\n          }\n        }\n        break;\n    }\n    return ctx_imagedata;\n  }\n  gauss(d, size, left, top, w, h) {\n    if (!size) return;\n    var src = this;\n    d = Math.max(1, d);\n    var MAX = size | 0;\n    if (buffer_img.data.length < src.data.length) {\n      buffer_img = new Img(src.width, src.height);\n    }\n    buffer_img.width = src.width;\n    buffer_img.height = src.height;\n    var dst = buffer_img;\n    var right = left + w - 1;\n    var bottom = top + h - 1;\n\n    //係数作成\n    var weight = new Array(MAX);\n    var t = 0.0;\n    for (var i = 0; i < weight.length; i++) {\n      var r = i;\n      var we = Math.exp(-(r * r) / (2 * d * d));\n      weight[i] = we;\n      if (i > 0) {\n        we *= 2.0;\n      }\n      t += we;\n    }\n    for (i = 0; i < weight.length; i++) {\n      weight[i] /= t;\n    }\n    var height = src.height;\n    var width = src.width;\n    var data = src.data;\n    var dstdata = dst.data;\n\n    //横ぼかし\n    var top2 = Math.max(0, top - size);\n    var bottom2 = Math.min(src.height, bottom + size + 1);\n    for (var y = top2; y < bottom2; y++) {\n      var yidx = y * width;\n      for (var idx = yidx + left << 2, idxmax = yidx + (right + 1) << 2; idx < idxmax; idx += 4) {\n        var a = data[idx + 3];\n        data[idx + 0] *= a;\n        data[idx + 1] *= a;\n        data[idx + 2] *= a;\n      }\n      var x = left;\n      var idx = yidx + left << 2;\n      var max = yidx + right + 1 << 2;\n      var r = weight[0];\n      var maxidx = y * width + (width - 1) << 2;\n      var minidx = y * width << 2;\n      for (; idx < max; idx += 4) {\n        dstdata[idx + 0] = data[idx + 0] * r;\n        dstdata[idx + 1] = data[idx + 1] * r;\n        dstdata[idx + 2] = data[idx + 2] * r;\n        dstdata[idx + 3] = data[idx + 3] * r;\n      }\n      max = Math.min(MAX, right + 1);\n      for (; x < max; x++) {\n        var idx = yidx + x << 2;\n        var idx2 = idx;\n        var idx3 = idx;\n        for (var i = 1; i < MAX; i++) {\n          idx2 = Math.max(idx2 - 4, minidx);\n          idx3 = Math.min(idx3 + 4, maxidx);\n          var r = weight[i];\n          dstdata[idx + 0] += (data[idx2 + 0] + data[idx3 + 0]) * r;\n          dstdata[idx + 1] += (data[idx2 + 1] + data[idx3 + 1]) * r;\n          dstdata[idx + 2] += (data[idx2 + 2] + data[idx3 + 2]) * r;\n          dstdata[idx + 3] += (data[idx2 + 3] + data[idx3 + 3]) * r;\n        }\n      }\n      max = Math.min(width - MAX, right + 1);\n      for (; x < max; x++) {\n        var idx = yidx + x << 2;\n        var idx2 = idx;\n        var idx3 = idx;\n        for (var i = 1; i < MAX; i++) {\n          idx2 -= 4;\n          idx3 += 4;\n          var r = weight[i];\n          dstdata[idx + 0] += (data[idx2 + 0] + data[idx3 + 0]) * r;\n          dstdata[idx + 1] += (data[idx2 + 1] + data[idx3 + 1]) * r;\n          dstdata[idx + 2] += (data[idx2 + 2] + data[idx3 + 2]) * r;\n          dstdata[idx + 3] += (data[idx2 + 3] + data[idx3 + 3]) * r;\n        }\n      }\n      var max = Math.min(right + 1, width);\n      for (; x < max; x++) {\n        var idx = yidx + x << 2;\n        var idx2 = idx;\n        var idx3 = idx;\n        for (var i = 1; i < MAX; i++) {\n          idx2 = Math.max(idx2 - 4, minidx);\n          idx3 = Math.min(idx3 + 4, maxidx);\n          var r = weight[i];\n          dstdata[idx + 0] += (data[idx2 + 0] + data[idx3 + 0]) * r;\n          dstdata[idx + 1] += (data[idx2 + 1] + data[idx3 + 1]) * r;\n          dstdata[idx + 2] += (data[idx2 + 2] + data[idx3 + 2]) * r;\n          dstdata[idx + 3] += (data[idx2 + 3] + data[idx3 + 3]) * r;\n        }\n      }\n    }\n\n    //縦ぼかし\n    data = dst.data;\n    dstdata = src.data;\n    for (var x = left; x < right + 1; x++) {\n      var width4 = width << 2;\n      var idx = top * width + x << 2;\n      var max = (bottom + 1) * width + x << 2;\n      var r = weight[0];\n      for (; idx < max; idx += width * 4) {\n        dstdata[idx + 0] = data[idx + 0] * r;\n        dstdata[idx + 1] = data[idx + 1] * r;\n        dstdata[idx + 2] = data[idx + 2] * r;\n        dstdata[idx + 3] = data[idx + 3] * r;\n      }\n      y = top;\n      max = Math.min(MAX, bottom + 1);\n      var maxidx = (height - 1) * width + x << 2;\n      var minidx = x << 2;\n      for (; y < max; y++) {\n        idx = y * width + x << 2;\n        idx2 = idx;\n        idx3 = idx;\n        for (var i = 1; i < MAX; i++) {\n          idx2 = Math.max(idx2 - width4, minidx);\n          idx3 = Math.min(idx3 + width4, maxidx);\n          var r = weight[i];\n          dstdata[idx + 0] += (data[idx2 + 0] + data[idx3 + 0]) * r;\n          dstdata[idx + 1] += (data[idx2 + 1] + data[idx3 + 1]) * r;\n          dstdata[idx + 2] += (data[idx2 + 2] + data[idx3 + 2]) * r;\n          dstdata[idx + 3] += (data[idx2 + 3] + data[idx3 + 3]) * r;\n        }\n      }\n      max = Math.min(height - MAX, bottom + 1);\n      for (; y < max; y++) {\n        idx = y * width + x << 2;\n        var idx2 = idx;\n        var idx3 = idx;\n        var aaa = width << 2;\n        for (var i = 1; i < MAX; i++) {\n          idx2 -= width4;\n          idx3 += width4;\n          var r = weight[i];\n          dstdata[idx + 0] += (data[idx2 + 0] + data[idx3 + 0]) * r;\n          dstdata[idx + 1] += (data[idx2 + 1] + data[idx3 + 1]) * r;\n          dstdata[idx + 2] += (data[idx2 + 2] + data[idx3 + 2]) * r;\n          dstdata[idx + 3] += (data[idx2 + 3] + data[idx3 + 3]) * r;\n        }\n      }\n      max = Math.min(height, bottom + 1);\n      for (; y < max; y++) {\n        idx = y * width + x << 2;\n        idx2 = idx;\n        idx3 = idx;\n        for (var i = 1; i < MAX; i++) {\n          idx2 = Math.max(idx2 - width4, minidx);\n          idx3 = Math.min(idx3 + width4, maxidx);\n          //var idx2= Math.max(y-i,0) *width+ x  <<2;\n          //var idx3= Math.min(y+i,height-1)*width+x <<2;\n          var r = weight[i];\n          dstdata[idx + 0] += (data[idx2 + 0] + data[idx3 + 0]) * r;\n          dstdata[idx + 1] += (data[idx2 + 1] + data[idx3 + 1]) * r;\n          dstdata[idx + 2] += (data[idx2 + 2] + data[idx3 + 2]) * r;\n          dstdata[idx + 3] += (data[idx2 + 3] + data[idx3 + 3]) * r;\n        }\n      }\n      for (var idx = top * width + x << 2, idxmax = (bottom + 1) * width + x << 2; idx < idxmax; idx += 4 * width) {\n        var a = dstdata[idx + 3];\n        if (a > 0 && a < 1) {\n          a = 1 / a;\n          dstdata[idx + 0] *= a;\n          dstdata[idx + 1] *= a;\n          dstdata[idx + 2] *= a;\n        }\n      }\n    }\n  }\n}\n_defineProperty(Img, \"FORMAT_FLOAT32\", 0);\n_defineProperty(Img, \"FORMAT_UINT8\", 1);\nfunction fract(a) {\n  return a - Math.floor(a);\n}\nlet buffer_img = new Img(1024, 1024);\n\n//# sourceURL=webpack://hdrpaint/./src/lib/img.js?");

/***/ }),

/***/ "./src/lib/mat22.js":
/*!**************************!*\
  !*** ./src/lib/mat22.js ***!
  \**************************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": function() { return /* binding */ Mat22; }\n/* harmony export */ });\nclass Mat22 {\n  constructor() {\n    var res = new Float32Array([1, 0, 0, 1]);\n    return res;\n  }\n  static scalar(a) {\n    return Math.sqrt(a[0] * a[0] + a[1] * a[1]);\n  }\n  static mul(a, b, c) {\n    a[0] = b[0] * c;\n    a[1] = b[1] * c;\n    a[2] = b[2] * c;\n    a[3] = b[3] * c;\n  }\n  static dotVec2(a, b, c) {\n    a[0] = b[0] * c[0] + b[2] * c[1];\n    a[1] = b[1] * c[0] + b[3] * c[1];\n  }\n  static dot(a, b, c) {\n    var m0 = b[0] * c[0] + b[2] * c[1];\n    var m1 = b[1] * c[0] + b[3] * c[1];\n    var m2 = b[0] * c[2] + b[2] * c[3];\n    var m3 = b[1] * c[2] + b[3] * c[3];\n    a[0] = m0;\n    a[1] = m1;\n    a[2] = m2;\n    a[3] = m3;\n  }\n}\n\n//# sourceURL=webpack://hdrpaint/./src/lib/mat22.js?");

/***/ }),

/***/ "./src/lib/mat43.js":
/*!**************************!*\
  !*** ./src/lib/mat43.js ***!
  \**************************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": function() { return /* binding */ Mat43; }\n/* harmony export */ });\n/* harmony import */ var _vector_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./vector.js */ \"./src/lib/vector.js\");\nfunction _defineProperty(obj, key, value) { key = _toPropertyKey(key); if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\nfunction _toPropertyKey(arg) { var key = _toPrimitive(arg, \"string\"); return typeof key === \"symbol\" ? key : String(key); }\nfunction _toPrimitive(input, hint) { if (typeof input !== \"object\" || input === null) return input; var prim = input[Symbol.toPrimitive]; if (prim !== undefined) { var res = prim.call(input, hint || \"default\"); if (typeof res !== \"object\") return res; throw new TypeError(\"@@toPrimitive must return a primitive value.\"); } return (hint === \"string\" ? String : Number)(input); }\n\nvar buf = new Float32Array(12);\nclass Mat43 {\n  //|0 3 6 9 |\n  //|1 4 7 10|\n  //|2 5 8 11|\n  constructor() {\n    var o = new Float32Array(12);\n    Mat43.setInit(o);\n    return o;\n  }\n  static setInit(mat) {\n    mat[0] = 1.0;\n    mat[1] = 0.0;\n    mat[2] = 0.0;\n    mat[3] = 0.0;\n    mat[4] = 1.0;\n    mat[5] = 0.0;\n    mat[6] = 0.0;\n    mat[7] = 0.0;\n    mat[8] = 1.0;\n    mat[9] = 0.0;\n    mat[10] = 0.0;\n    mat[11] = 0.0;\n  }\n  static setValue(obj, a0, a1, a2, a3, a4, a5, a6, a7, a8, a9, a10, a11) {\n    obj[0] = a0;\n    obj[1] = a1;\n    obj[2] = a2;\n    obj[3] = a3;\n    obj[4] = a4;\n    obj[5] = a5;\n    obj[6] = a6;\n    obj[7] = a7;\n    obj[8] = a8;\n    obj[9] = a9;\n    obj[10] = a10;\n    obj[11] = a11;\n  }\n  static copy(a, b) {\n    a[0] = b[0];\n    a[1] = b[1];\n    a[2] = b[2];\n    a[3] = b[3];\n    a[4] = b[4];\n    a[5] = b[5];\n    a[6] = b[6];\n    a[7] = b[7];\n    a[8] = b[8];\n    a[9] = b[9];\n    a[10] = b[10];\n    a[11] = b[11];\n  }\n  static copyMat44(a, b) {\n    a[0] = b[0];\n    a[1] = b[1];\n    a[2] = b[2];\n    a[3] = b[4];\n    a[4] = b[5];\n    a[5] = b[6];\n    a[6] = b[8];\n    a[7] = b[9];\n    a[8] = b[10];\n    a[9] = b[12];\n    a[10] = b[13];\n    a[11] = b[14];\n  }\n  static mul(a, b, c) {\n    a[0] = b[0] * c;\n    a[1] = b[1] * c;\n    a[2] = b[2] * c;\n    a[3] = b[3] * c;\n    a[4] = b[4] * c;\n    a[5] = b[5] * c;\n    a[6] = b[6] * c;\n    a[7] = b[7] * c;\n    a[8] = b[8] * c;\n    a[9] = b[9] * c;\n    a[10] = b[10] * c;\n    a[11] = b[11] * c;\n  }\n  static dotVec4(a, b, c) {\n    var buf0 = c[0];\n    var buf1 = c[1];\n    var buf2 = c[2];\n    var buf3 = c[3];\n    a[0] = b[0] * buf0 + b[3] * buf1 + b[6] * buf2 + b[9] * buf3;\n    a[1] = b[1] * buf0 + b[4] * buf1 + b[7] * buf2 + b[10] * buf3;\n    a[2] = b[2] * buf0 + b[5] * buf1 + b[8] * buf2 + b[11] * buf3;\n    a[3] = buf3;\n  }\n  static dot(a, b, c) {\n    buf[0] = b[0] * c[0] + b[3] * c[1] + b[6] * c[2];\n    buf[1] = b[1] * c[0] + b[4] * c[1] + b[7] * c[2];\n    buf[2] = b[2] * c[0] + b[5] * c[1] + b[8] * c[2];\n    buf[3] = b[0] * c[3] + b[3] * c[4] + b[6] * c[5];\n    buf[4] = b[1] * c[3] + b[4] * c[4] + b[7] * c[5];\n    buf[5] = b[2] * c[3] + b[5] * c[4] + b[8] * c[5];\n    buf[6] = b[0] * c[6] + b[3] * c[7] + b[6] * c[8];\n    buf[7] = b[1] * c[6] + b[4] * c[7] + b[7] * c[8];\n    buf[8] = b[2] * c[6] + b[5] * c[7] + b[8] * c[8];\n    buf[9] = b[0] * c[9] + b[3] * c[10] + b[6] * c[11] + b[9];\n    buf[10] = b[1] * c[9] + b[4] * c[10] + b[7] * c[11] + b[10];\n    buf[11] = b[2] * c[9] + b[5] * c[10] + b[8] * c[11] + b[11];\n    a.set(buf);\n    //if(a == b){\n    //\tvar buf0 = b[0];\n    //\tvar buf1 = b[1];\n    //\tvar buf2 = b[2];\n    //\tvar buf3 = b[3];\n    //\tvar buf4 = b[4];\n    //\tvar buf5 = b[5];\n    //\tvar buf6 = b[6];\n    //\tvar buf7 = b[7];\n    //\tvar buf8 = b[8];\n    //\tvar buf9 = b[9];\n    //\tvar buf10 = b[10];\n    //\tvar buf11 = b[11];\n\n    //\ta[0]=buf0*c[0] + buf3*c[1] + buf6*c[2];\n    //\ta[1]=buf1*c[0] + buf4*c[1] + buf7*c[2];\n    //\ta[2]=buf2*c[0] + buf5*c[1] + buf8*c[2];\n\n    //\ta[3]=buf0*c[3] + buf3*c[4] + buf6*c[5];\n    //\ta[4]=buf1*c[3] + buf4*c[4] + buf7*c[5];\n    //\ta[5]=buf2*c[3] + buf5*c[4] + buf8*c[5];\n\n    //\ta[6]=buf0*c[6] + buf3*c[7] + buf6*c[8];\n    //\ta[7]=buf1*c[6] + buf4*c[7] + buf7*c[8];\n    //\ta[8]=buf2*c[6] + buf5*c[7] + buf8*c[8];\n\n    //\ta[9]=buf0*c[9] + buf3*c[10] + buf6*c[11] + buf9;\n    //\ta[10]=buf1*c[9] + buf4*c[10] + buf7*c[11] + buf10;\n    //\ta[11]=buf2*c[9] + buf5*c[10] + buf8*c[11] + buf11;\n    //}else{\n    //\tvar buf0 = c[0];\n    //\tvar buf1 = c[1];\n    //\tvar buf2 = c[2];\n    //\tvar buf3 = c[3];\n    //\tvar buf4 = c[4];\n    //\tvar buf5 = c[5];\n    //\tvar buf6 = c[6];\n    //\tvar buf7 = c[7];\n    //\tvar buf8 = c[8];\n    //\tvar buf9 = c[9];\n    //\tvar buf10 = c[10];\n    //\tvar buf11 = c[11];\n\n    //\ta[0]=b[0]*buf0 + b[3]*buf1 + b[6]*buf2;\n    //\ta[1]=b[1]*buf0 + b[4]*buf1 + b[7]*buf2;\n    //\ta[2]=b[2]*buf0 + b[5]*buf1 + b[8]*buf2;\n\n    //\ta[3]=b[0]*buf3 + b[3]*buf4 + b[6]*buf5;\n    //\ta[4]=b[1]*buf3 + b[4]*buf4 + b[7]*buf5;\n    //\ta[5]=b[2]*buf3 + b[5]*buf4 + b[8]*buf5;\n\n    //\ta[6]=b[0]*buf6 + b[3]*buf7 + b[6]*buf8;\n    //\ta[7]=b[1]*buf6 + b[4]*buf7 + b[7]*buf8;\n    //\ta[8]=b[2]*buf6 + b[5]*buf7 + b[8]*buf8;\n\n    //\ta[9]=b[0]*buf9 + b[3]*buf10 + b[6]*buf11 + b[9];\n    //\ta[10]=b[1]*buf9 + b[4]*buf10 + b[7]*buf11 + b[10];\n    //\ta[11]=b[2]*buf9 + b[5]*buf10 + b[8]*buf11 + b[11];\n    //}\n  }\n  static dotMat44Mat43(a, b, c) {\n    var buf0 = b[0] * c[0] + b[4] * c[1] + b[8] * c[2];\n    var buf1 = b[1] * c[0] + b[5] * c[1] + b[9] * c[2];\n    var buf2 = b[2] * c[0] + b[6] * c[1] + b[10] * c[2];\n    var buf3 = b[0] * c[3] + b[4] * c[4] + b[8] * c[5];\n    var buf4 = b[1] * c[3] + b[5] * c[4] + b[9] * c[5];\n    var buf5 = b[2] * c[3] + b[6] * c[4] + b[10] * c[5];\n    var buf6 = b[0] * c[6] + b[4] * c[7] + b[8] * c[8];\n    var buf7 = b[1] * c[6] + b[5] * c[7] + b[9] * c[8];\n    var buf8 = b[2] * c[6] + b[6] * c[7] + b[10] * c[8];\n    var buf9 = b[0] * c[9] + b[4] * c[10] + b[8] * c[11] + b[12];\n    var buf10 = b[1] * c[9] + b[5] * c[10] + b[9] * c[11] + b[13];\n    var buf11 = b[2] * c[9] + b[6] * c[10] + b[10] * c[11] + b[14];\n    a[0] = buf0;\n    a[1] = buf1;\n    a[2] = buf2;\n    a[3] = buf3;\n    a[4] = buf4;\n    a[5] = buf5;\n    a[6] = buf6;\n    a[7] = buf7;\n    a[8] = buf8;\n    a[9] = buf9;\n    a[10] = buf10;\n    a[11] = buf11;\n  }\n  static fromRotVector(ret, r, x, y, z) {\n    var SIN = Math.sin(r);\n    var COS = Math.cos(r);\n    ret[0] = x * x * (1 - COS) + COS;\n    ret[3] = x * y * (1 - COS) - z * SIN;\n    ret[6] = z * x * (1 - COS) + y * SIN;\n    ret[1] = x * y * (1 - COS) + z * SIN;\n    ret[4] = y * y * (1 - COS) + COS;\n    ret[7] = y * z * (1 - COS) - x * SIN;\n    ret[2] = z * x * (1 - COS) - y * SIN;\n    ret[5] = y * z * (1 - COS) + x * SIN;\n    ret[8] = z * z * (1 - COS) + COS;\n    ret[9] = ret[10] = ret[11] = 0.0;\n  }\n  static getRotVector(target, angle) {\n    var bM = this.alloc();\n    var dx = angle[0];\n    var dy = angle[1];\n    var dz = angle[2];\n    var ax = Math.atan2(dy, dz) + Math.PI;\n    var ay = Math.atan2(dx, dz);\n    var az = 0;\n    this.fromRotVector(target, -az, 0, 0, 1);\n    this.fromRotVector(bM, -ax, 1, 0, 0);\n    this.dot(target, target, bM);\n    this.fromRotVector(bM, -ay, 0, 1, 0);\n    this.dot(target, target, bM);\n    this.free(1);\n  }\n  static determinant(b) {\n    return b[0] * b[4] * b[8] + b[3] * b[7] * b[2] + b[6] * b[1] * b[5] - b[0] * b[7] * b[5] - b[3] * b[1] * b[8] - b[6] * b[4] * b[2];\n  }\n  static getInv(a, b) {\n    var det = b[0] * b[4] * b[8] + b[3] * b[7] * b[2] + b[6] * b[1] * b[5] - b[0] * b[7] * b[5] - b[3] * b[1] * b[8] - b[6] * b[4] * b[2];\n    if (Math.abs(det) === 0) {\n      return;\n    }\n    det = 1 / det;\n    var buf0 = b[0];\n    var buf1 = b[1];\n    var buf2 = b[2];\n    var buf3 = b[3];\n    var buf4 = b[4];\n    var buf5 = b[5];\n    var buf6 = b[6];\n    var buf7 = b[7];\n    var buf8 = b[8];\n    var buf9 = b[9];\n    var buf10 = b[10];\n    var buf11 = b[11];\n    a[0] = (buf4 * buf8 - buf7 * buf5) * det;\n    a[1] = (buf2 * buf7 - buf1 * buf8) * det;\n    a[2] = (buf1 * buf5 - buf4 * buf2) * det;\n    a[3] = (buf6 * buf5 - buf3 * buf8) * det;\n    a[4] = (buf0 * buf8 - buf6 * buf2) * det;\n    a[5] = (buf3 * buf2 - buf0 * buf5) * det;\n    a[6] = (buf3 * buf7 - buf4 * buf6) * det;\n    a[7] = (buf6 * buf1 - buf0 * buf7) * det;\n    a[8] = (buf0 * buf4 - buf3 * buf1) * det;\n    a[9] = (buf3 * buf10 * buf8 + buf6 * buf4 * buf11 + buf9 * buf7 * buf5 - buf3 * buf7 * buf11 - buf6 * buf10 * buf5 - buf9 * buf4 * buf8) * det;\n    a[10] = (buf0 * buf7 * buf11 + buf6 * buf10 * buf2 + buf9 * buf1 * buf8 - buf0 * buf10 * buf8 - buf6 * buf1 * buf11 - buf9 * buf7 * buf2) * det;\n    a[11] = (buf0 * buf10 * buf5 + buf3 * buf1 * buf11 + buf9 * buf4 * buf2 - buf0 * buf4 * buf11 - buf3 * buf10 * buf2 - buf9 * buf1 * buf5) * det;\n  }\n  static fromQuat(a, b) {\n    var x2 = b[1] * b[1] * 2.0;\n    var y2 = b[2] * b[2] * 2.0;\n    var z2 = b[3] * b[3] * 2.0;\n    var xy = b[1] * b[2] * 2.0;\n    var yz = b[2] * b[3] * 2.0;\n    var zx = b[3] * b[1] * 2.0;\n    var xw = b[1] * b[0] * 2.0;\n    var yw = b[2] * b[0] * 2.0;\n    var zw = b[3] * b[0] * 2.0;\n    a[0] = 1.0 - y2 - z2;\n    a[1] = xy + zw;\n    a[2] = zx - yw;\n    a[3] = xy - zw;\n    a[4] = 1.0 - z2 - x2;\n    a[5] = yz + xw;\n    a[6] = zx + yw;\n    a[7] = yz - xw;\n    a[8] = 1.0 - x2 - y2;\n    a[9] = a[10] = a[11] = 0.0;\n  }\n\n  //eulerAngleから行列を作る (XZY)\n  static fromEuler(m, e) {\n    var buf = Mat43.alloc();\n    this.fromRotVector(m, e[0], 1, 0, 0);\n    this.fromRotVector(buf, e[2], 0, 0, 1);\n    this.dot(m, buf, m);\n    this.fromRotVector(buf, e[1], 0, 1, 0);\n    this.dot(m, buf, m);\n    Mat43.free(1);\n  }\n\n  //location,scale,eulerAnlge から行列を作る\n  static fromLSE(m, l, s, e) {\n    Mat43.fromEuler(m, e);\n    m[0] *= s[0];\n    m[1] *= s[0];\n    m[2] *= s[0];\n    m[3] *= s[1];\n    m[4] *= s[1];\n    m[5] *= s[1];\n    m[6] *= s[2];\n    m[7] *= s[2];\n    m[8] *= s[2];\n    m[9] = l[0];\n    m[10] = l[1];\n    m[11] = l[2];\n  }\n\n  //location,scale,quartanionから行列を作る\n  static fromLSR(m, l, s, r) {\n    Mat43.fromQuat(m, r);\n    m[0] *= s[0];\n    m[1] *= s[0];\n    m[2] *= s[0];\n    m[3] *= s[1];\n    m[4] *= s[1];\n    m[5] *= s[1];\n    m[6] *= s[2];\n    m[7] *= s[2];\n    m[8] *= s[2];\n    m[9] = l[0];\n    m[10] = l[1];\n    m[11] = l[2];\n  }\n  //行列をlocation,scale,quartanionに分ける\n  static toLSR(l, s, r, m) {\n    _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.setValue(l, m[9], m[10], m[11]);\n    _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.setValue(s, Math.sqrt(m[0] * m[0] + m[1] * m[1] + m[2] * m[2]), Math.sqrt(m[3] * m[3] + m[4] * m[4] + m[5] * m[5]), Math.sqrt(m[6] * m[6] + m[7] * m[7] + m[8] * m[8]));\n    var invx = 1 / s[0];\n    var invy = 1 / s[1];\n    var invz = 1 / s[2];\n    var m33 = new _vector_js__WEBPACK_IMPORTED_MODULE_0__.Mat33();\n    m33[0] = m[0] * invx;\n    m33[1] = m[1] * invx;\n    m33[2] = m[2] * invx;\n    m33[3] = m[3] * invy;\n    m33[4] = m[4] * invy;\n    m33[5] = m[5] * invy;\n    m33[6] = m[6] * invz;\n    m33[7] = m[7] * invz;\n    m33[8] = m[8] * invz;\n    _vector_js__WEBPACK_IMPORTED_MODULE_0__.Mat33.getRotQuat(r, m33);\n  }\n  static toLSE(l, s, e, m) {\n    _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.setValue(l, m[9], m[10], m[11]);\n    _vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3.setValue(s, Math.sqrt(m[0] * m[0] + m[1] * m[1] + m[2] * m[2]), Math.sqrt(m[3] * m[3] + m[4] * m[4] + m[5] * m[5]), Math.sqrt(m[6] * m[6] + m[7] * m[7] + m[8] * m[8]));\n    var invx = 1 / s[0];\n    var invy = 1 / s[1];\n    var invz = 1 / s[2];\n    var m33 = new _vector_js__WEBPACK_IMPORTED_MODULE_0__.Mat33();\n    m33[0] = m[0] * invx;\n    m33[1] = m[1] * invx;\n    m33[2] = m[2] * invx;\n    m33[3] = m[3] * invy;\n    m33[4] = m[4] * invy;\n    m33[5] = m[5] * invy;\n    m33[6] = m[6] * invz;\n    m33[7] = m[7] * invz;\n    m33[8] = m[8] * invz;\n    _vector_js__WEBPACK_IMPORTED_MODULE_0__.Mat33.getEuler(e, m33);\n  }\n  static toMat44csv(m) {\n    return m[0] + \",\" + m[1] + \",\" + m[2] + \",0\" + \",\" + m[3] + \",\" + m[4] + \",\" + m[5] + \",0\" + \",\" + m[6] + \",\" + m[7] + \",\" + m[8] + \",0\" + \",\" + m[9] + \",\" + m[10] + \",\" + m[11] + \",1\";\n  }\n}\n_defineProperty(Mat43, \"dotVec3\", function (a, b, c) {\n  var buf0 = c[0];\n  var buf1 = c[1];\n  var buf2 = c[2];\n  a[0] = b[0] * buf0 + b[3] * buf1 + b[6] * buf2 + b[9];\n  a[1] = b[1] * buf0 + b[4] * buf1 + b[7] * buf2 + b[10];\n  a[2] = b[2] * buf0 + b[5] * buf1 + b[8] * buf2 + b[11];\n});\n_defineProperty(Mat43, \"dotMat33Vec3\", function (a, b, c) {\n  var buf0 = c[0];\n  var buf1 = c[1];\n  var buf2 = c[2];\n  a[0] = b[0] * buf0 + b[3] * buf1 + b[6] * buf2;\n  a[1] = b[1] * buf0 + b[4] * buf1 + b[7] * buf2;\n  a[2] = b[2] * buf0 + b[5] * buf1 + b[8] * buf2;\n});\n\n//# sourceURL=webpack://hdrpaint/./src/lib/mat43.js?");

/***/ }),

/***/ "./src/lib/noise.js":
/*!**************************!*\
  !*** ./src/lib/noise.js ***!
  \**************************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": function() { return /* binding */ Noise; }\n/* harmony export */ });\nfunction _defineProperty(obj, key, value) { key = _toPropertyKey(key); if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\nfunction _toPropertyKey(arg) { var key = _toPrimitive(arg, \"string\"); return typeof key === \"symbol\" ? key : String(key); }\nfunction _toPrimitive(input, hint) { if (typeof input !== \"object\" || input === null) return input; var prim = input[Symbol.toPrimitive]; if (prim !== undefined) { var res = prim.call(input, hint || \"default\"); if (typeof res !== \"object\") return res; throw new TypeError(\"@@toPrimitive must return a primitive value.\"); } return (hint === \"string\" ? String : Number)(input); }\nvar ROOT3_2 = Math.sqrt(3) / 2;\nvar _ROOT3_2 = 1 / ROOT3_2;\nvar F3 = 1.0 / 3.0;\nvar G3 = -1.0 / 6.0;\nvar hash3 = function (x, y, z) {\n  return h[x + h[y + h[z & 0xff] & 0xff] & 0xff];\n};\nclass Noise {\n  constructor() {}\n  static valuenoise(x, y, z) {\n    var x_d = x - (x | 0);\n    var y_d = y - (y | 0);\n    var z_d = z - (z | 0);\n    var x_i = x & 0xff;\n    var y_i = y & 0xff;\n    var z_i = z & 0xff;\n    var x_f = fade(x_d);\n    var y_f = fade(y_d);\n    var z_f = fade(z_d);\n    var r = lerp(z_f, lerp(y_f, lerp(x_f, hash256(x_i, y_i, z_i), hash256(x_i + 1, y_i, z_i)), lerp(x_f, hash256(x_i, y_i + 1, z_i), hash256(x_i + 1, y_i + 1, z_i))), lerp(y_f, lerp(x_f, hash256(x_i, y_i, z_i + 1), hash256(x_i + 1, y_i, z_i + 1)), lerp(x_f, hash256(x_i, y_i + 1, z_i + 1), hash256(x_i + 1, y_i + 1, z_i + 1))));\n    return r * _NIGORO;\n  }\n  static perlinnoise(x, y, z) {\n    var x_d = x - (x | 0);\n    var y_d = y - (y | 0);\n    var z_d = z - (z | 0);\n    var x_i = x & 0xff;\n    var y_i = y & 0xff;\n    var z_i = z & 0xff;\n    var x_f = fade(x_d);\n    var y_f = fade(y_d);\n    var z_f = fade(z_d);\n    var r = lerp(z_f, lerp(y_f, lerp(x_f, grad(hash256(x_i, y_i, z_i), x_d, y_d, z_d), grad(hash256(x_i + 1, y_i, z_i), x_d - 1, y_d, z_d)), lerp(x_f, grad(hash256(x_i, y_i + 1, z_i), x_d, y_d - 1, z_d), grad(hash256(x_i + 1, y_i + 1, z_i), x_d - 1, y_d - 1, z_d))), lerp(y_f, lerp(x_f, grad(hash256(x_i, y_i, z_i + 1), x_d, y_d, z_d - 1), grad(hash256(x_i + 1, y_i, z_i + 1), x_d - 1, y_d, z_d - 1)), lerp(x_f, grad(hash256(x_i, y_i + 1, z_i + 1), x_d, y_d - 1, z_d - 1), grad(hash256(x_i + 1, y_i + 1, z_i + 1), x_d - 1, y_d - 1, z_d - 1))));\n    return r * 0.5 + 0.5;\n  }\n}\n_defineProperty(Noise, \"simplexnoise\", function (xin, yin, zin) {\n  var s = (xin + yin + zin) * F3;\n  var i = Math.floor(xin + s);\n  var j = Math.floor(yin + s);\n  var k = Math.floor(zin + s);\n  var t = (i + j + k) * G3;\n  var x0 = xin - (i + t);\n  var y0 = yin - (j + t);\n  var z0 = zin - (k + t);\n  var i1, j1, k1;\n  var i2, j2, k2;\n  if (x0 >= y0) {\n    if (y0 >= z0) {\n      i1 = 1;\n      j1 = 0;\n      k1 = 0;\n      i2 = 1;\n      j2 = 1;\n      k2 = 0;\n    } else if (x0 >= z0) {\n      i1 = 1;\n      j1 = 0;\n      k1 = 0;\n      i2 = 1;\n      j2 = 0;\n      k2 = 1;\n    } else {\n      i1 = 0;\n      j1 = 0;\n      k1 = 1;\n      i2 = 1;\n      j2 = 0;\n      k2 = 1;\n    }\n  } else {\n    if (y0 < z0) {\n      i1 = 0;\n      j1 = 0;\n      k1 = 1;\n      i2 = 0;\n      j2 = 1;\n      k2 = 1;\n    } else if (x0 < z0) {\n      i1 = 0;\n      j1 = 1;\n      k1 = 0;\n      i2 = 0;\n      j2 = 1;\n      k2 = 1;\n    } else {\n      i1 = 0;\n      j1 = 1;\n      k1 = 0;\n      i2 = 1;\n      j2 = 1;\n      k2 = 0;\n    }\n  }\n  var x1 = x0 - (i1 + G3);\n  var y1 = y0 - (j1 + G3);\n  var z1 = z0 - (k1 + G3);\n  var x2 = x0 - (i2 + 2.0 * G3);\n  var y2 = y0 - (j2 + 2.0 * G3);\n  var z2 = z0 - (k2 + 2.0 * G3);\n  var x3 = x0 - (1.0 + 3.0 * G3);\n  var y3 = y0 - (1.0 + 3.0 * G3);\n  var z3 = z0 - (1.0 + 3.0 * G3);\n  var v = fade2(Math.max(0.5 - (x0 * x0 + y0 * y0 + z0 * z0), 0)) * grad(hash3(i, j, k), x0, y0, z0) + fade2(Math.max(0.5 - (x1 * x1 + y1 * y1 + z1 * z1), 0)) * grad(hash3(i + i1, j + j1, k + k1), x1, y1, z1) + fade2(Math.max(0.5 - (x2 * x2 + y2 * y2 + z2 * z2), 0)) * grad(hash3(i + i2, j + j2, k + k2), x2, y2, z2) + fade2(Math.max(0.5 - (x3 * x3 + y3 * y3 + z3 * z3), 0)) * grad(hash3(i + 1, j + 1, k + 1), x3, y3, z3);\n  return v * 10 * 0.5 + 0.5;\n});\nvar _NIGORO = 1 / 256;\nvar MAX = (1 << 30) - 1;\nvar _MAX = 1 / MAX;\nvar h = [151, 160, 137, 91, 90, 15, 131, 13, 201, 95, 96, 53, 194, 233, 7, 225, 140, 36, 103, 30, 69, 142, 8, 99, 37, 240, 21, 10, 23, 190, 6, 148, 247, 120, 234, 75, 0, 26, 197, 62, 94, 252, 219, 203, 117, 35, 11, 32, 57, 177, 33, 88, 237, 149, 56, 87, 174, 20, 125, 136, 171, 168, 68, 175, 74, 165, 71, 134, 139, 48, 27, 166, 77, 146, 158, 231, 83, 111, 229, 122, 60, 211, 133, 230, 220, 105, 92, 41, 55, 46, 245, 40, 244, 102, 143, 54, 65, 25, 63, 161, 1, 216, 80, 73, 209, 76, 132, 187, 208, 89, 18, 169, 200, 196, 135, 130, 116, 188, 159, 86, 164, 100, 109, 198, 173, 186, 3, 64, 52, 217, 226, 250, 124, 123, 5, 202, 38, 147, 118, 126, 255, 82, 85, 212, 207, 206, 59, 227, 47, 16, 58, 17, 182, 189, 28, 42, 223, 183, 170, 213, 119, 248, 152, 2, 44, 154, 163, 70, 221, 153, 101, 155, 167, 43, 172, 9, 129, 22, 39, 253, 19, 98, 108, 110, 79, 113, 224, 232, 178, 185, 112, 104, 218, 246, 97, 228, 251, 34, 242, 193, 238, 210, 144, 12, 191, 179, 162, 241, 81, 51, 145, 235, 249, 14, 239, 107, 49, 192, 214, 31, 181, 199, 106, 157, 184, 84, 204, 176, 115, 121, 50, 45, 127, 4, 150, 254, 138, 236, 205, 93, 222, 114, 67, 29, 24, 72, 243, 141, 128, 195, 78, 66, 215, 61, 156, 180];\nh = h.concat(h);\nvar hash256 = function (x, y, z) {\n  return h[h[h[x] + y] + z];\n};\nvar hashInt = function (x, y, z) {\n  return xor(xor(xor(x * 123) + y * 5678) + z * 1234) & MAX;\n};\nvar xor = function (y) {\n  y = y ^ y << 13;\n  y = y ^ y >> 17;\n  return y ^ y << 5;\n};\nvar fade = function (t) {\n  return t * t * t * (t * (t * 6 - 15) + 10);\n};\nvar fade2 = function (t) {\n  return t * t;\n};\nvar grad = function (hash, x, y, z) {\n  switch (hash & 0xf) {\n    case 0x0:\n      return x + y;\n    case 0x1:\n      return -x + y;\n    case 0x2:\n      return x - y;\n    case 0x3:\n      return -x - y;\n    case 0x4:\n      return x + z;\n    case 0x5:\n      return -x + z;\n    case 0x6:\n      return x - z;\n    case 0x7:\n      return -x - z;\n    case 0x8:\n      return y + z;\n    case 0x9:\n      return -y + z;\n    case 0xa:\n      return y - z;\n    case 0xb:\n      return -y - z;\n    case 0xc:\n      return y + x;\n    case 0xd:\n      return -y + z;\n    case 0xe:\n      return y - x;\n    case 0xf:\n      return -y - z;\n    default:\n      return 0;\n  }\n};\nvar lerp = function (r, a, b) {\n  return a * (1 - r) + b * r;\n};\n\n//# sourceURL=webpack://hdrpaint/./src/lib/noise.js?");

/***/ }),

/***/ "./src/lib/openexr.js":
/*!****************************!*\
  !*** ./src/lib/openexr.js ***!
  \****************************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": function() { return /* binding */ OpenEXR; }\n/* harmony export */ });\n/* harmony import */ var _datastream_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./datastream.js */ \"./src/lib/datastream.js\");\n/* harmony import */ var _zlib_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./zlib.js */ \"./src/lib/zlib.js\");\n\n\nclass OpenEXR {\n  constructor() {}\n  static toArrayBuffer(obj) {\n    var channels = obj.attributes.channels;\n    var width = obj.attributes.dataWindow.xMax - obj.attributes.dataWindow.xMin + 1;\n    var height = obj.attributes.dataWindow.yMax - obj.attributes.dataWindow.yMin + 1;\n    var dv = new _datastream_js__WEBPACK_IMPORTED_MODULE_0__[\"default\"](height * (8 + 8 + width * 2 * channels.length) + 400);\n    //Magic Number\n    dv.setUint32(20000630, true);\n\n    //Version Field\n    dv.setUint16(2, true);\n    dv.setUint16(0, true);\n\n    //header\n    var attributes = obj.attributes;\n    var keys = Object.keys(attributes);\n    for (var ai = 0; ai < keys.length; ai++) {\n      var attribute_name = keys[ai];\n      var attribute = attributes[attribute_name];\n      dv.setTextBuf(attribute_name, true);\n      var attribute_type = \"\";\n      var attribute_size_index = 0;\n      switch (attribute_name) {\n        case \"channels\":\n          attribute_type = \"chlist\";\n          break;\n        case \"compression\":\n          attribute_type = \"compression\";\n          break;\n        case \"dataWindow\":\n        case \"displayWindow\":\n          attribute_type = \"box2i\";\n          break;\n        case \"lineOrder\":\n          attribute_type = \"lineOrder\";\n          break;\n        case \"pixelAspectRatio\":\n          attribute_type = \"float\";\n          break;\n        case \"screenWindowCenter\":\n          attribute_type = \"v2f\";\n          break;\n        case \"screenWindowWidth\":\n          attribute_type = \"float\";\n          break;\n        case \"chromaticities\":\n          attribute_type = \"chromaticities\";\n          break;\n      }\n      dv.setTextBuf(attribute_type, true);\n      attribute_size_index = dv.idx;\n      dv.idx += 32;\n      if (attribute_type === \"box2i\") {\n        dv.setInt32(attribute.xMin, true);\n        dv.setInt32(attribute.yMin, true);\n        dv.setInt32(attribute.xMax, true);\n        dv.setInt32(attribute.yMax, true);\n      } else if (attribute_type === \"box2f\") {\n        dv.setFloat32(attribute.xMin, true);\n        dv.setFloat32(attribute.yMin, true);\n        dv.setFloat32(attribute.xMax, true);\n        dv.setFloat32(attribute.yMax, true);\n      } else if (attribute_type === \"chlist\") {\n        channels = attribute;\n        for (var ci = 0; ci < channels.length; ci++) {\n          var channel = channels[ci];\n          dv.setTextBuf(channel.name, true);\n          dv.setInt32(channel.pixel_type, true); //pixel type\n          dv.setUint8(channel.pLiner, true); //pliner\n          dv.setUint8(0, true); //reserved\n          dv.setUint8(0, true); //reserved\n          dv.setUint8(0, true); //reserved\n          dv.setInt32(channel.xSampling, true); //xSampling\n          dv.setInt32(channel.ySampling, true); //YSampling\n        }\n        dv.setTextBuf(\"\", true);\n      } else if (attribute_type === \"compression\") {\n        dv.setUint8(attribute);\n      } else if (attribute_type === \"double\") {\n        dv.setFloat64(attribute, true);\n      } else if (attribute_type === \"float\") {\n        dv.setFloat32(attribute, true);\n      } else if (attribute_type === \"int\") {\n        dv.setInt32(attribute, true);\n      } else if (attribute_type === \"lineOrder\") {\n        dv.getUint8(0, true);\n      } else if (attribute_type === \"string\") {\n        dv.setTextBuf(attribute, true);\n      } else if (attribute_type === \"v2i\") {\n        dv.setInt32(attribute[0], true);\n        dv.setInt32(attribute[1], true);\n      } else if (attribute_type === \"v2f\") {\n        dv.setFloat32(attribute[0], true);\n        dv.setFloat32(attribute[1], true);\n      } else if (attribute_type === \"chromaticities\") {\n        for (var vi = 0; vi < 8; vi++) {\n          dv.setFloat32(attribute[vi], true);\n        }\n      }\n      var a = dv.idx;\n      dv.idx = attribute_size_index;\n      dv.setUint32((a - attribute_size_index >> 3) - 4, true);\n      dv.idx = a;\n    }\n    dv.setTextBuf(\"\", true);\n    var offset_scan_line_idx = dv.idx;\n    dv.idx += 64 * obj.height;\n    var data_idx = dv.idx;\n    var line_size = obj.width * 2 * channels.length;\n    var linemax = 1;\n    if (obj.attributes.compression === 3) {\n      linemax = 16;\n    }\n    var data_stream = new _datastream_js__WEBPACK_IMPORTED_MODULE_0__[\"default\"](new ArrayBuffer(line_size * linemax));\n    for (var li = 0; li < height;) {\n      data_idx = dv.idx;\n      dv.idx = offset_scan_line_idx;\n      dv.setUint64(data_idx >> 3, true);\n      offset_scan_line_idx = dv.idx;\n      dv.idx = data_idx;\n      dv.setUint32(li, true);\n      data_stream.idx = 0;\n      var linemax_ = Math.min(linemax, height - li);\n      for (var l = 0; l < linemax_; l++) {\n        var idx = li * width;\n        for (var ci = 0; ci < channels.length; ci++) {\n          var channel_data = channels[ci].data;\n          for (var xi = 0; xi < width; xi++) {\n            data_stream.setFloat16(channel_data[idx + xi], true);\n          }\n        }\n        li++;\n      }\n      var data = new Uint8Array(data_stream.dv.buffer, 0, linemax_ * line_size);\n      if (obj.attributes.compression) {\n        var offset = data.length >> 1;\n        var data2 = new Uint8Array(data.length);\n        for (var di = 0; di < offset; di++) {\n          //上位バイトと下位バイトを分ける\n          data2[di] = data[di << 1];\n          data2[di + offset] = data[(di << 1) + 1];\n        }\n        for (var di = data2.length - 1; di > 0; di--) {\n          //差分情報作成\n          data2[di] = data2[di] - data2[di - 1] + 128 & 0xff;\n        }\n        data = _zlib_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].compress(data2, 1);\n      }\n      dv.setUint32(data.length, true);\n      dv.setBytes(data);\n    }\n    return dv.byteBuffer.buffer.slice(0, dv.idx >> 3);\n  }\n  static fromArrayBuffer(obj, arrayBuffer) {\n    var dv = new _datastream_js__WEBPACK_IMPORTED_MODULE_0__[\"default\"](arrayBuffer);\n\n    //Magic Number\n    var c = dv.getUint32(true);\n    if (c !== 20000630) {\n      alert(\"exrファイルのマジックナンバーと違う\");\n      return;\n    }\n\n    //Version Field\n    c = dv.getUint16(true);\n    //if(c !== 2){\n    //\talert(\"SIngle-part scan line 以外は対応してません\");\n    //\treturn;\n    //}\n    var cc = dv.getUint16(true);\n    //dv.idx+=2<<3;\n\n    //header\n    var attributes = [];\n    while (1) {\n      var attribute_name = dv.readTextBuf();\n      if (attribute_name === \"\") {\n        //空文字ならヘッダー終了\n        break;\n      }\n      var attribute_type = dv.readTextBuf();\n      var value = null;\n      var attribute_size = dv.getUint32(true);\n      var idxOld = dv.idx;\n      if (attribute_type === \"box2i\") {\n        value = {};\n        value.xMin = dv.getInt32(true);\n        value.yMin = dv.getInt32(true);\n        value.xMax = dv.getInt32(true);\n        value.yMax = dv.getInt32(true);\n      } else if (attribute_type === \"box2f\") {\n        value = {};\n        value.xMin = dv.getFloat32(true);\n        value.yMin = dv.getFloat32(true);\n        value.xMax = dv.getFloat32(true);\n        value.yMax = dv.getFloat32(true);\n      } else if (attribute_type === \"chlist\") {\n        value = [];\n        while (1) {\n          var ch = [];\n          ch.name = dv.readTextBuf();\n          if (ch.name === \"\") {\n            break;\n          }\n          ch.pixel_type = dv.getInt32(true);\n          ch.pLinear = dv.getUint8(true);\n          ch.reserved = dv.getUint8(true);\n          dv.idx += 2 << 3;\n          ch.xSampling = dv.getInt32(true);\n          ch.ySampling = dv.getInt32(true);\n          value.push(ch);\n        }\n      } else if (attribute_type === \"compression\") {\n        value = dv.getUint8(true);\n      } else if (attribute_type === \"double\") {\n        value = dv.getFloat64(true);\n      } else if (attribute_type === \"float\") {\n        value = dv.getFloat32(true);\n      } else if (attribute_type === \"int\") {\n        value = dv.getInt32(true);\n      } else if (attribute_type === \"lineOrder\") {\n        value = dv.getUint8(true);\n      } else if (attribute_type === \"string\") {\n        value = \"\";\n        for (var i = 0; i < attribute_size; i++) {\n          value += String.fromCharCode(dv.getUint8(true));\n        }\n        //\t\t\tidx+=value.length+1;\n      } else if (attribute_type === \"v2i\") {\n        value = [];\n        value.push(dv.getInt32(true));\n        value.push(dv.getInt32(true));\n      } else if (attribute_type === \"v2f\") {\n        value = [];\n        value.push(dv.getFloat32(true));\n        value.push(dv.getFloat32(true));\n      } else if (attribute_type === \"chromaticities\") {\n        value = [];\n        for (var vi = 0; vi < 8; vi++) {\n          value.push(dv.getFloat32(true));\n        }\n      }\n      attributes[attribute_name] = value;\n      dv.idx = idxOld + (attribute_size << 3);\n    }\n\n    //データ部\n    var channels = attributes.channels;\n    obj.width = attributes.dataWindow.xMax - attributes.dataWindow.xMin + 1;\n    obj.height = attributes.dataWindow.yMax - attributes.dataWindow.yMin + 1;\n    var datasize = obj.width * obj.height;\n    //メモリ確保\n    for (var i = 0; i < channels.length; i++) {\n      var channel = channels[i];\n      if (channel.pixel_type === 0) {\n        channel.data = new Uint8Array(datasize);\n      }\n      if (channel.pixel_type === 1) {\n        channel.data = new Float32Array(datasize);\n      }\n      if (channel.pixel_type === 2) {\n        channel.data = new Float32Array(datasize);\n      }\n    }\n    //ライン読み込み\n    for (var i = 0; i < obj.height; i++) {\n      var offset = dv.getUint64(true);\n      var oldIdx = dv.idx;\n      dv.idx = offset << 3;\n      var y = dv.getUint32(true);\n      var pixel_data_size = dv.getUint32(true);\n      var linedata;\n      var linemax = 1;\n      if (attributes.compression === 0) {\n        linedata = new _datastream_js__WEBPACK_IMPORTED_MODULE_0__[\"default\"](dv.dv.buffer, dv.idx >> 3, pixel_data_size);\n      }\n      if (attributes.compression === 2 || attributes.compression === 3) {\n        //zip展開\n        var data = _zlib_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].expand(dv.dv.buffer, dv.idx >> 3, pixel_data_size);\n      }\n      if (attributes.compression === 3) {\n        linemax = Math.min(obj.height - y, 16); //compression=3のときは16行固定\n      }\n      if (attributes.compression === 3 || attributes.compression === 2) {\n        //zip圧縮されていた場合はデータが加工されているので復元\n        var data2 = new Uint8Array(data.length);\n        for (var di = 1; di < data.length; di++) {\n          //差分情報から実際の値を復元\n          data[di] = data[di - 1] - 128 + data[di] & 0xff;\n        }\n        var offset = data.length >> 1;\n        for (var di = 0; di < offset; di++) {\n          //上位バイトと下位バイトをくっつける\n          data2[di << 1] = data[di];\n          data2[(di << 1) + 1] = data[di + offset];\n        }\n        linedata = new _datastream_js__WEBPACK_IMPORTED_MODULE_0__[\"default\"](data2.buffer);\n      }\n      for (var line = 0; line < linemax; line++) {\n        for (var ci = 0; ci < channels.length; ci++) {\n          var channel = channels[ci];\n          var data = channel.data;\n          var didx = (y + line) * obj.width;\n          if (channel.pixel_type == 0) {\n            for (var xi = 0; xi < obj.width; xi++) {\n              channel.data[didx + xi] = linedata.getUint8(true);\n            }\n          } else if (channel.pixel_type == 1) {\n            for (var xi = 0; xi < obj.width; xi++) {\n              channel.data[didx + xi] = linedata.readFloat16(true);\n            }\n          } else if (channel.pixel_type == 2) {\n            for (var xi = 0; xi < obj.width; xi++) {\n              channel.data[didx + xi] = linedata.getFloat32(true);\n            }\n          }\n        }\n      }\n      dv.idx = oldIdx;\n      i += linemax - 1;\n    }\n    obj.attributes = attributes;\n  }\n}\n\n//# sourceURL=webpack://hdrpaint/./src/lib/openexr.js?");

/***/ }),

/***/ "./src/lib/pool.js":
/*!*************************!*\
  !*** ./src/lib/pool.js ***!
  \*************************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": function() { return /* binding */ pooling; }\n/* harmony export */ });\nfunction pooling(ret) {\n  //プール\n  ret.poolIndex = 0;\n  ret.pool = [];\n  for (var j = 0; j < 64; j++) {\n    ret.pool.push(new ret());\n  }\n  ret.alloc = function () {\n    this.poolIndex++;\n    //if(this.poolIndex>128){\n    //\talert(this+ \"poolIndex leak!?\");\n    //}\n    //if(this.poolIndex>this.pool.length){\n    //\tfor(var i=0;i<16;i++){\n    //\t\tthis.pool.push(new this());\n    //\t}\n    //}\n    return this.pool[this.poolIndex - 1];\n  };\n  ret.free = function (num) {\n    this.poolIndex -= num;\n    //if(this.poolIndex<0){\n    //\talert(this+\"poolIndex okashii!\");\n    //}\n  };\n}\n\n//# sourceURL=webpack://hdrpaint/./src/lib/pool.js?");

/***/ }),

/***/ "./src/lib/slider.js":
/*!***************************!*\
  !*** ./src/lib/slider.js ***!
  \***************************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": function() { return /* binding */ Slider; }\n/* harmony export */ });\n/* harmony import */ var _util_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./util.js */ \"./src/lib/util.js\");\nvar _class;\nfunction _defineProperty(obj, key, value) { key = _toPropertyKey(key); if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\nfunction _toPropertyKey(arg) { var key = _toPrimitive(arg, \"string\"); return typeof key === \"symbol\" ? key : String(key); }\nfunction _toPrimitive(input, hint) { if (typeof input !== \"object\" || input === null) return input; var prim = input[Symbol.toPrimitive]; if (prim !== undefined) { var res = prim.call(input, hint || \"default\"); if (typeof res !== \"object\") return res; throw new TypeError(\"@@toPrimitive must return a primitive value.\"); } return (hint === \"string\" ? String : Number)(input); }\n\nvar drag_target = null;\n\n//ドラッグ時処理\nvar drag = function (evt) {\n  if (!evt) {\n    evt = window.event;\n  }\n  if (!(evt.buttons & 1)) {\n    drag_target = null;\n  }\n  if (!drag_target) {\n    return;\n  }\n  var slider = drag_target;\n  var tumami = drag_target.tumami;\n  var mizo = slider.mizo;\n  var left = evt.clientX;\n  var rect = mizo.getBoundingClientRect();\n  var width = tumami.offsetWidth / 2 * 0;\n  var value = Math.round(left - rect.left - width);\n  value /= mizo.clientWidth;\n  value = Math.max(Math.min(value, 1), 0);\n  value = value * (slider.max - slider.min) + slider.min;\n  if (slider.step) {\n    value = Math.ceil(value / slider.step) * slider.step;\n  }\n  slider.input.value = value;\n  slider.setTumami();\n  _util_js__WEBPACK_IMPORTED_MODULE_0__[\"default\"].fireEvent(slider.input, \"change\");\n  return false;\n};\nvar createDiv = function (slider) {\n  return div;\n};\nvar replace = function (node, slider) {\n  //対象のノードオブジェクトをスライダに置き換える\n\n  node.parentNode.replaceChild(slider.node, node);\n  //node.setAttribute(\"class\",\"js-text\");\n  node.classList.remove(\"slider\");\n  node.setAttribute(\"number\", \"\");\n  node.setAttribute(\"type\", \"text\");\n  slider.node.replaceChild(node, slider.input);\n  slider.input = node;\n  node.addEventListener(\"input\", slider.changeValue);\n  //input.id=node.id;\n\n  slider.min = Number(node.getAttribute(\"min\"));\n  slider.max = Number(node.getAttribute(\"max\"));\n  if (slider.min === slider.max) {\n    slider.max = slider.min + 1;\n  }\n  slider.step = Number(node.getAttribute(\"step\"));\n  slider.setTumami();\n};\nclass Slider {\n  //スライダーコントロール\n  constructor() {\n    _defineProperty(this, \"setTumami\", () => {\n      var slider = this;\n      var tumami = this.tumami;\n      var mizo = this.mizo;\n      var value = Number(this.input.value);\n      value = (value - slider.min) / (slider.max - slider.min);\n      var max = mizo.offsetWidth;\n      var w = tumami.offsetWidth;\n      if (w == 0) w = 15;\n      if (max == 0) max = 100;\n      tumami.style.left = value * max - w / 2 + 'px';\n    });\n    _defineProperty(this, \"changeValue\", () => {\n      this.setTumami();\n    });\n    this.min = 0;\n    this.max = 1;\n    this.step = 0.1;\n\n    //テキストエリア+スライダー\n    var div = document.createElement(\"span\");\n    div.setAttribute(\"class\", \"js-slider\");\n    div.insertAdjacentHTML('beforeend', `<input type=\"text\"  class=\"js-text\">\n\t\t\t\t<div class=\"js-slider3\">\n\t\t\t\t\t<span class=\"js-slider2\" ></span>\n\t\t\t\t\t<input type=\"button\"  class=\"tumami\">\n\t\t\t\t</div> `);\n    this.input = div.querySelector('.js-text');\n    //溝\n    this.mizo = div.querySelector('.js-slider3');\n    //クリック時ツマミ移動\n    this.mizo.addEventListener(\"pointerdown\", evt => {\n      drag_target = this;\n      drag(evt);\n      drag_target = null;\n    });\n    var _tumami = div.querySelector('.tumami');\n    this.tumami = _tumami;\n\n    //ドラッグ開始\n    _tumami.addEventListener(\"pointerdown\", evt => {\n      drag_target = this;\n      evt.stopPropagation();\n    });\n\n    //デフォルト処理無効\n    _tumami.addEventListener(\"touchmove\", function (evt) {\n      evt.preventDefault();\n    });\n\n    //値直接変更時にツマミ反映\n    this.node = div;\n    this.setTumami();\n  }\n}\n_class = Slider;\n_defineProperty(Slider, \"init\", function (dom) {\n  if (!dom) {\n    dom = document;\n  }\n  var e = dom.querySelectorAll('input.slider');\n  for (var i = 0; i < e.length; i += 1) {\n    var node = e[i];\n    var slider = new _class();\n    replace(node, slider);\n  }\n});\nwindow.addEventListener(\"pointermove\", drag);\nwindow.addEventListener(\"load\", function (e) {\n  Slider.init();\n});\n\n//# sourceURL=webpack://hdrpaint/./src/lib/slider.js?");

/***/ }),

/***/ "./src/lib/util.js":
/*!*************************!*\
  !*** ./src/lib/util.js ***!
  \*************************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": function() { return /* binding */ Util; }\n/* harmony export */ });\n/* harmony import */ var _fpsman_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./fpsman.js */ \"./src/lib/fpsman.js\");\n\n\nfunction _defineProperty(obj, key, value) { key = _toPropertyKey(key); if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\nfunction _toPropertyKey(arg) { var key = _toPrimitive(arg, \"string\"); return typeof key === \"symbol\" ? key : String(key); }\nfunction _toPrimitive(input, hint) { if (typeof input !== \"object\" || input === null) return input; var prim = input[Symbol.toPrimitive]; if (prim !== undefined) { var res = prim.call(input, hint || \"default\"); if (typeof res !== \"object\") return res; throw new TypeError(\"@@toPrimitive must return a primitive value.\"); } return (hint === \"string\" ? String : Number)(input); }\n\nwindow.globalParam = {};\nvar myIE = document.all; //IEflg\nvar ua = window.navigator.userAgent.toLowerCase();\nif (ua.indexOf(\"windows\" !== -1)) {\n  globalParam.windows = 1;\n}\nvar i = 0,\n  keymap = new Array(256);\n[37, 38, 39, 40, ' '.charCodeAt(0), 'X'.charCodeAt(0), 'C'.charCodeAt(0), 'V'.charCodeAt(0), 'A'.charCodeAt(0) //8\n, 'W'.charCodeAt(0), 'D'.charCodeAt(0), 'S'.charCodeAt(0), 'F'.charCodeAt(0), 'G'.charCodeAt(0), 'H'.charCodeAt(0), 'J'.charCodeAt(0)].forEach((e, idx) => {\n  keymap[e] = idx;\n});\nvar virtualPad = null;\nvar virtualPadP = null;\nvar virtualBtn = null;\nclass Util {\n  static getLoadingCount() {\n    return Util.loadingCount;\n  }\n  static mainloop() {\n    var dx, dy;\n    Util.tap = 0;\n    if (Util.pressOn) {\n      Util.pressCount = Util.pressCount + 1;\n      if (Util.pressCount == 1) {\n        Util.oldcursorX2 = Util.cursorX;\n        Util.oldcursorY2 = Util.cursorY;\n        Util.oldcursorX = Util.cursorX;\n        Util.oldcursorY = Util.cursorY;\n      }\n    } else if (Util.pressCount > 0) {\n      dx = Util.cursorX - Util.oldcursorX2;\n      dy = Util.cursorY - Util.oldcursorY2;\n      if (Util.pressCount < 10 && dx * dx + dy * dy < 16) {\n        Util.tap = 1;\n      }\n      Util.pressCount = -1;\n    } else Util.pressCount = 0;\n    if (Util.pressOnRight) {\n      Util.pressCountRight += 1;\n    } else {\n      Util.pressCountRight = 0;\n    }\n\n    //if(loadingCount ==0){\n    Util.mainfunc();\n    //}\n    Util.oldcursorX = Util.cursorX;\n    Util.oldcursorY = Util.cursorY;\n    var i;\n    for (i = Util.keyflag.length; i--;) {\n      Util.keyflagOld[i] = Util.keyflag[i];\n    }\n  }\n  static loadImage(url, norepeat, func) {\n    var image = new Image();\n    var flg = true;\n    if (globalParam.files) for (var i = 0, f; f = globalParam.files[i]; i++) {\n      if (escape(f.name) == url) {\n        //ローカルファイルの場合\n        var reader = new FileReader();\n        reader.onload = function (e) {\n          image.src = e.target.result;\n        };\n        reader.readAsDataURL(f);\n        flg = false;\n        break;\n      }\n    }\n    if (flg) {\n      //リモートファイルの場合\n      image.src = url;\n    }\n\n    //ロードカウンタを増やす\n    Util.loadingCount++;\n    image.onerror = function () {\n      //エラーの場合減らす\n      Util.loadingCount--;\n    };\n    console.log(\"load start\", url);\n\n    //読み込みが終わっていない場合はイベントリスナ登録\n    image.addEventListener(\"load\", function (e) {\n      if (!image.pat) {\n        console.log(\"load end\", image);\n        //ロード処理(1回のみ)\n        //ロードカウンタを減らす\n        Util.loadingCount--;\n        if (norepeat) {\n          image.pat = Util.ctx.createPattern(image, \"no-repeat\");\n        } else {\n          image.pat = Util.ctx.createPattern(image, \"repeat\");\n        }\n        Util.imagedatacontext.clearRect(0, 0, Util.imagedatacanvas.width, Util.imagedatacanvas.height);\n        Util.imagedatacontext.drawImage(image, 0, 0);\n        if (Util.imagedatacontext.getImageData) {\n          image.imagedata = Util.imagedatacontext.getImageData(0, 0, image.width, image.height);\n        }\n      }\n      if (func) {\n        //コールバック指定がある場合は行う\n        func(image);\n      }\n    });\n    return image;\n  }\n  static getDir(url) {\n    var res = /.*\\//.exec(url);\n    return res ? res[0] : \"\";\n  }\n  static loadText(url, callback) {\n    var flg = true;\n    var filename_ex = url.match(\"([^/]+?)([\\?#;].*)?$\")[1];\n    if (globalParam.files) {\n      for (var i = 0, f; f = globalParam.files[i]; i++) {\n        if (escape(f.name) == filename_ex) {\n          var reader = new FileReader();\n          reader.onload = function (e) {\n            var buf = e.target.result;\n            if (callback) {\n              callback(buf);\n            }\n          };\n          reader.readAsText(f);\n          flg = false;\n          break;\n        }\n      }\n    }\n    if (!flg) {\n      return null;\n    }\n    var request = Util.createXMLHttpRequest();\n    request.open(\"GET\", url, true);\n    request.onload = function (e) {\n      if (request.status == 200 || request.status == 304) {\n        var buf = request.responseText;\n        if (callback) {\n          callback(buf);\n        }\n      } else {\n        if (callback) {\n          callback(null);\n        }\n      }\n      Util.loadingCount--;\n      console.log(\"loadtext end\", Util.loadingCount);\n    };\n    request.onerror = function (e) {\n      if (callback) {\n        callback(null);\n      }\n      Util.loadingCount--;\n      console.log(\"loadtext failed\", Util.loadingCount);\n    };\n    console.log(\"loadtext start\", url);\n    Util.loadingCount++;\n    request.send(\"\");\n    return request;\n  }\n  static loadFile(file, callback) {\n    var reader = new FileReader();\n    reader.onload = function (e) {\n      if (callback) {\n        callback(e.target.result);\n      }\n    };\n    reader.readAsDataURL(file);\n  }\n  static loadBinary(url, _callback) {\n    if (typeof url !== \"string\") {\n      Util.loadFile(url, function (url) {\n        Util.loadBinary(url, _callback);\n      });\n      return null;\n    }\n    var callback = _callback;\n    var cfunc = function (buf) {\n      if (callback) {\n        callback(buf);\n      }\n      Util.loadingCount--;\n      console.log(\"loadbinary end\", Util.loadingCount);\n    };\n    console.log(\"loadbinary start\", url);\n    Util.loadingCount++;\n    var request = Util.createXMLHttpRequest();\n    request.open(\"GET\", url, true);\n    request.responseType = \"arraybuffer\";\n    request.onload = function (e) {\n      cfunc(request.response);\n    };\n    request.send(\"\");\n  }\n  static rgb(r, g, b) {\n    r = (0x100 | r * 255).toString(16);\n    g = (0x100 | g * 255).toString(16);\n    b = (0x100 | b * 255).toString(16);\n    return \"#\" + r.slice(-2) + g.slice(-2) + b.slice(-2);\n  }\n  static str2rgba(rgba, str) {\n    var sp = str.split(\",\");\n    rgba[0] = Number(sp[0]);\n    rgba[1] = Number(sp[1]);\n    rgba[2] = Number(sp[2]);\n    rgba[3] = Number(sp[3]);\n    return rgba;\n  }\n  static rgba(r, g, b, a) {\n    return 'rgba(' + r + ',' + g + ',' + b + ',' + a + ')';\n  }\n  static hsv2rgb(rgb, hsv) {\n    //hsvをrgbに変換\n    var f;\n    var i, p, q, t;\n    var v = hsv[2];\n    var h = hsv[0];\n    var s = hsv[1];\n    i = (h * 6 | 0) % 6;\n    f = h * 6 - (h * 6 | 0);\n    p = v * (1.0 - s);\n    q = v * (1.0 - s * f);\n    t = v * (1.0 - s * (1.0 - f));\n    switch (i) {\n      case 0:\n        rgb[0] = v;\n        rgb[1] = t;\n        rgb[2] = p;\n        break;\n      case 1:\n        rgb[0] = q;\n        rgb[1] = v;\n        rgb[2] = p;\n        break;\n      case 2:\n        rgb[0] = p;\n        rgb[1] = v;\n        rgb[2] = t;\n        break;\n      case 3:\n        rgb[0] = p;\n        rgb[1] = q;\n        rgb[2] = v;\n        break;\n      case 4:\n        rgb[0] = t;\n        rgb[1] = p;\n        rgb[2] = v;\n        break;\n      case 5:\n        rgb[0] = v;\n        rgb[1] = p;\n        rgb[2] = q;\n        break;\n    }\n    return rgb;\n  }\n  static rgb2hex(rgb) {\n    //rgbを16進数の文字列に変換\n    var r = (0x100 | rgb[0] * 255).toString(16);\n    var g = (0x100 | rgb[1] * 255).toString(16);\n    var b = (0x100 | rgb[2] * 255).toString(16);\n    return r.slice(-2) + g.slice(-2) + b.slice(-2);\n  }\n  static rgb2hsv(hsv, rgb) {\n    //rgbをhsvに変換\n    var max = Math.max(rgb[0], Math.max(rgb[1], rgb[2]));\n    var min = Math.min(rgb[0], Math.min(rgb[1], rgb[2]));\n    if (max == min) {\n      hsv[0] = 0;\n    } else if (max == rgb[0]) {\n      hsv[0] = 1 / 6 * (rgb[1] - rgb[2]) / (max - min) + 1;\n    } else if (max == rgb[1]) {\n      hsv[0] = 1 / 6 * (rgb[2] - rgb[0]) / (max - min) + 2 / 6;\n    } else if (max == rgb[2]) {\n      hsv[0] = 1 / 6 * (rgb[0] - rgb[1]) / (max - min) + 4 / 6;\n    }\n    hsv[0] -= hsv[0] | 0;\n    if (max == 0) {\n      hsv[1] = 0;\n    } else {\n      hsv[1] = (max - min) / max;\n    }\n    hsv[2] = max;\n    return hsv;\n  }\n  static init(canvas, canvasgl, _inputarea) {\n    Util.canvasgl = canvasgl;\n    Util.canvas = canvas;\n    if (!Util.canvas || !Util.canvas.getContext) {\n      return false;\n    }\n    Util.SCREEN_W = Util.canvas.getAttribute('width');\n    Util.SCREEN_H = Util.canvas.getAttribute('height');\n    Util.ctx = Util.canvas.getContext('2d');\n    Util.ctx.clearRect(0, 0, Util.SCREEN_W, Util.SCREEN_H);\n    Util.imagedatacanvas = Util.createCanvas(1024, 1024);\n    Util.imagedatacontext = Util.imagedatacanvas.getContext('2d');\n    var inputarea = _inputarea;\n    if (inputarea) {\n      inputarea.onselect = function () {\n        return false;\n      };\n      inputarea.onselectstart = function () {\n        return false;\n      };\n    }\n    var setCursor = function (x, y) {\n      var target = Util.canvasgl;\n      var scalex = 0;\n      var scaley = 0;\n      if (target.clientWidth > 0) {\n        scalex = target.width / target.clientWidth;\n        scaley = target.height / target.clientHeight;\n      }\n      var rect = target.getBoundingClientRect();\n      //if(e.currentTarget.getBoundingClientRect){\n      //}\n      Util.cursorX = (x - rect.left) * scalex;\n      Util.cursorY = (y - rect.top) * scaley;\n    };\n    var tap = function () {};\n    var tapout = function () {\n      Util.padX = 0;\n      Util.padY = 0;\n      virtualPad.style.display = \"none\";\n    };\n    Util.mouseMove = function (elem, func) {\n      if (!elem) return;\n      elem.addEventListener(\"pointermove\", function (e) {\n        e = e || window.event;\n        func(e);\n        e.preventDefault();\n      }, false);\n    };\n    Util.mouseDown = function (elem, func) {\n      if (!elem) return;\n      elem.addEventListener(\"pointerdown\", function (e) {\n        e = e || window.event;\n        func(e);\n        e.preventDefault();\n      });\n    };\n    Util.mouseUp = function (elem, func) {\n      elem.addEventListener(\"pointerup\", function (e) {\n        e = e || window.event;\n        func(e);\n      });\n    };\n    Util.mouseMove(inputarea, function (e) {\n      setCursor(e.pageX, e.pageY);\n      if (virtualPad.style.display === \"block\") {\n        var target = e.currentTarget;\n        Util.padX = (e.cursorX - virtualPad.offsetLeft) / virtualPad.offsetWidth * 2 - 1;\n        Util.padY = (e.cursorY - virtualPad.offsetTop) / virtualPad.offsetHeight * 2 - 1;\n        var l = Util.padX * Util.padX + Util.padY * Util.padY;\n        if (l > 1.0) {\n          l = Math.sqrt(l);\n          Util.padX = Util.padX / l;\n          Util.padY = Util.padY / l;\n\n          //\t\t\t\t\tvirtualPad.style.left = e.relativeX - Util.padX * virtualPad.offsetWidth*0.5 + \"px\";\n          //\t\t\t\t\tvirtualPad.style.top= e.relativeY - Util.padY * virtualPad.offsetHeight*0.5 + \"px\";\n        }\n        setPad();\n      }\n    });\n    Util.mouseDown(inputarea, function (e) {\n      setCursor(e.pageX, e.pageY);\n      switch (e.button) {\n        case 0:\n          Util.pressOn = 1;\n          break;\n        case 2:\n          Util.pressOnRight = 1;\n          break;\n      }\n    });\n    Util.mouseUp(window, function (e) {\n      setCursor(e.pageX, e.pageY);\n      switch (e.button) {\n        case 0:\n          Util.pressOn = 0;\n          tapout();\n          break;\n        case 2:\n          Util.pressOnRight = 0;\n          break;\n      }\n      Util.keyflag[4] = 0;\n    });\n\n    //バーチャルパッド\n    var setPad = function () {\n      virtualPadP.style.left = (Util.padX + 1.0) * 50 + \"%\";\n      virtualPadP.style.top = (Util.padY + 1.0) * 50 + \"%\";\n    };\n    var varea = document.getElementById(\"vertualPadArea\");\n    Util.mouseDown(varea, function (e) {\n      switch (e.button) {\n        case 0:\n          virtualPad.style.display = \"block\";\n          Util.padX = 0;\n          Util.padY = 0;\n          //\t\t\t\tvirtualPad.style.left = e.relativeX+\"px\";\n          //\t\t\t\tvirtualPad.style.top= e.relativeY+ \"px\";\n          setPad();\n          e.stopPropagation();\n          break;\n      }\n    });\n    if (navigator.userAgent.match(/iPhone/i) || navigator.userAgent.match(/iPod/i) || navigator.userAgent.match(/Android/i)) {} else {\n      var wheelfunc = function (e) {\n        e = e || window.event;\n        if (e.wheelDelta) {\n          Util.wheelDelta = e.wheelDelta / 120;\n          if (window.opera) Util.wheelDelta = -Util.wheelDelta;\n        } else if (e.detail) {\n          Util.wheelDelta = -e.detail / 3;\n        }\n        if (e.preventDefault) e.preventDefault();\n        //e.returnValue = false\n      };\n      if (window.addEventListener) window.addEventListener('DOMMouseScroll', wheelfunc, {\n        passive: true\n      });else if (document.attachEvent) document.attachEvent('onmousewheel', wheelfunc);else if (inputarea) inputarea.onmousewheel = wheelfunc;\n      document.body.onkeydown = function (e) {\n        e = e || window.event;\n        var code = e.keyCode;\n        if (Util.keymap[code] != null) {\n          Util.keyflag[Util.keymap[code]] = 1;\n        }\n        if (code == 13) {\n          Util.canvasgl.webkitRequestFullScreen(Element.ALLOW_KEYBOARD_INPUT);\n          if (window.parent.screen.width / Util.canvasgl.width > window.parent.screen.height / Util.canvasgl.height) {\n            canvasgl.style.width = \"auto\";\n            canvasgl.style.height = \"100%\";\n          } else {\n            canvasgl.style.width = \"100%\";\n            canvasgl.style.height = \"auto\";\n          }\n        }\n      };\n      document.body.onkeyup = function (e) {\n        e = e || window.event;\n        var code = e.keyCode;\n        if (Util.keymap[code] != null) {\n          Util.keyflag[Util.keymap[code]] = 0;\n        }\n      };\n      document.body.onblur = function (e) {\n        e = e || window.event;\n        var code = e.keyCode;\n        for (var i = 0; i < Util.keyflag.length; i++) {\n          Util.keyflag[i] = 0;\n        }\n      };\n    }\n    virtualPad = document.createElement(\"div\");\n    virtualPad.style.backgroundColor = \"#ff0000\";\n    virtualPad.style.opacity = \"0.3\";\n    virtualPad.style.width = \"256px\";\n    virtualPad.style.height = \"256px\";\n    virtualPad.style.position = \"absolute\";\n    virtualPad.style.left = \"10px\";\n    virtualPad.style.top = \"10px\";\n    virtualPad.style.borderRadius = \"50%\";\n    virtualPad.style.zIndex = \"10\";\n    virtualPad.style.display = \"none\";\n    virtualPad.style.marginLeft = \"-128px\";\n    virtualPad.style.marginTop = \"-128px\";\n    if (inputarea) inputarea.appendChild(virtualPad);\n    virtualPadP = document.createElement(\"div\");\n    virtualPadP.style.backgroundColor = \"#00ff00\";\n    virtualPadP.style.width = \"32px\";\n    virtualPadP.style.height = \"32px\";\n    virtualPadP.style.position = \"absolute\";\n    virtualPadP.style.borderRadius = \"50%\";\n    virtualPadP.style.marginLeft = \"-16px\";\n    virtualPadP.style.marginTop = \"-16px\";\n    virtualPad.appendChild(virtualPadP);\n    virtualBtn = document.createElement(\"div\");\n    virtualBtn.style.backgroundColor = \"#0000ff\";\n    virtualBtn.style.opacity = \"0.25\";\n    virtualBtn.style.width = \"256px\";\n    virtualBtn.style.height = \"256px\";\n    virtualBtn.style.position = \"absolute\";\n    virtualBtn.style.right = \"10%\";\n    virtualBtn.style.bottom = \"20%\";\n    virtualBtn.style.borderRadius = \"50%\";\n    virtualBtn.style.zIndex = \"100\";\n    virtualBtn.style.display = \"none\";\n    virtualBtn.innerHTML = \"jump\";\n    if (inputarea) inputarea.appendChild(virtualBtn);\n    if (Util.enableVirtualBtn) {\n      virtualBtn.style.display = \"inline\";\n    }\n    if (navigator.userAgent.match(/iPhone/i) || navigator.userAgent.match(/iPod/i) || navigator.userAgent.match(/Android/i)) {\n      virtualBtn.addEventListener(\"touchstart\", function (e) {\n        e = e || window.event;\n        Util.keyflag[4] = 1;\n      }, false);\n      window.addEventListener(\"touchend\", function (e) {\n        e = e || window.event;\n        Util.keyflag[4] = 0;\n      }, false);\n      virtualBtn.addEventListener(\"touchmove\", function (e) {}, false);\n      virtualBtn.addEventListener(\"touchend\", function (e) {\n        Util.keyflag[4] = 0;\n      }, false);\n    } else {\n      virtualBtn.onmousedown = function (e) {\n        e = e || window.event;\n        Util.keyflag[4] = 1;\n        //e.stopPropagation();\n      };\n      virtualBtn.onmouseup = function (e) {\n        e = e || window.event;\n        Util.keyflag[4] = 0;\n      };\n    }\n  }\n  static setFps(argfps, mf) {\n    Util.mainfunc = mf;\n    Util.fpsman = new _fpsman_js__WEBPACK_IMPORTED_MODULE_0__[\"default\"](argfps, () => {\n      Util.mainloop();\n    });\n    Util.pressCount = 0;\n  }\n  static drawText(target, x, y, text, img, sizex, sizey) {\n    var dx = x;\n    var dy = y;\n    var i, max;\n    var sx, sy;\n    for (i = 0, max = text.length; i < max; i++) {\n      sx = text.charCodeAt(i) - 32;\n      sy = (sx >> 4) * sizex;\n      sx = (sx & 0xf) * sizey;\n      target.drawImage(img, sx, sy, sizex, sizey, dx, dy, sizex, sizey);\n      dx = dx + sizex;\n    }\n  }\n  static convertURLcode(str) {\n    var imax = str.length,\n      jmax,\n      i,\n      j,\n      charcode,\n      percent = '%'.charCodeAt(0),\n      decode = \"\",\n      sub;\n    for (i = 0; i < imax; i++) {\n      charcode = str.charCodeAt(i);\n      if (charcode == percent) {\n        i++;\n        charcode = parseInt(str.slice(i, i + 2), 16);\n        if ((charcode & 0xF0) == 0xE0) {\n          jmax = 2;\n          charcode = charcode & 0xf;\n        } else if ((charcode & 0xE0) == 0xC0) {\n          jmax = 1;\n          charcode = charcode & 0x1f;\n        } else {\n          jmax = 0;\n        }\n        i += 1;\n        for (j = 0; j < jmax; j++) {\n          i += 2;\n          charcode <<= 6;\n          charcode |= parseInt(str.slice(i, i + 2), 16) & 0x3f;\n          i += 1;\n        }\n      }\n      decode += String.fromCharCode(charcode);\n    }\n    return decode;\n  }\n  static fireEvent(elem, eventname, evt) {\n    if (document.all) {\n      elem.fireEvent(\"on\" + eventname);\n    } else {\n      if (!evt) {\n        evt = document.createEvent(\"Event\");\n      }\n      evt.initEvent(eventname, true, true);\n      elem.dispatchEvent(evt);\n    }\n  }\n  static setText(elem, text) {\n    elem.innerText = text;\n    //elem.textContent=text;\n    //elem.innerHTML=text;\n  }\n  static getText(elem) {\n    return elem.textContent ? elem.textContent : elem.innerText;\n  }\n  static stringToUtf8(str) {\n    var utf8str = unescape(encodeURIComponent(str));\n    var utf8array = new Uint8Array(utf8str.length);\n    for (var i = 0; i < utf8str.length; i++) {\n      utf8array[i] = utf8str.charCodeAt(i);\n    }\n    return utf8array;\n  }\n  static utf8ToString(array) {\n    var str = \"\";\n    for (var i = 0; i < array.length; i++) {\n      str += String.fromCharCode(array[i]);\n    }\n    return decodeURIComponent(escape(str));\n  }\n  static toArray(val) {\n    if (!Array.isArray(val)) {\n      return [val];\n    }\n    return val;\n  }\n}\n_defineProperty(Util, \"SCREEN_W\", void 0);\n_defineProperty(Util, \"SCREEN_H\", void 0);\n_defineProperty(Util, \"imagedatacanvas\", void 0);\n_defineProperty(Util, \"imagedatacontext\", void 0);\n_defineProperty(Util, \"loadingCount\", 0);\n_defineProperty(Util, \"ctx\", null);\n_defineProperty(Util, \"canvas\", null);\n_defineProperty(Util, \"canvasgl\", null);\n_defineProperty(Util, \"cursorX\", 0);\n_defineProperty(Util, \"cursorY\", 0);\n_defineProperty(Util, \"padX\", 0);\n_defineProperty(Util, \"padY\", 0);\n_defineProperty(Util, \"wheelDelta\", 0);\n_defineProperty(Util, \"pressOn\", 0);\n_defineProperty(Util, \"pressCount\", 0);\n_defineProperty(Util, \"pressOnRight\", 0);\n_defineProperty(Util, \"pressCountRight\", 0);\n_defineProperty(Util, \"oldcursorX\", 0);\n_defineProperty(Util, \"oldcursorY\", 0);\n_defineProperty(Util, \"screenscale\", 1);\n_defineProperty(Util, \"tap\", 0);\n_defineProperty(Util, \"keyflag\", [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]);\n_defineProperty(Util, \"keyflagOld\", [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]);\n_defineProperty(Util, \"keymap\", keymap);\n_defineProperty(Util, \"enablePad\", 1);\n_defineProperty(Util, \"createCanvas\", function (width, height) {\n  var canvas = document.createElement(\"canvas\");\n  if (typeof G_vmlCanvasManager !== 'undefined') {\n    canvas = G_vmlCanvasManager.initElement(canvas);\n  }\n  canvas.setAttribute('width', width);\n  canvas.setAttribute('height', height);\n  return canvas;\n});\n_defineProperty(Util, \"hex2rgb\", function (rgb, hex) {\n  //16進数の文字列をrgbに変換\n  rgb[0] = parseInt(hex.slice(0, 2), 16) / 255;\n  rgb[1] = parseInt(hex.slice(2, 4), 16) / 255;\n  rgb[2] = parseInt(hex.slice(4, 6), 16) / 255;\n  if (isNaN(rgb[0])) {\n    rgb[0] = 0;\n  }\n  ;\n  if (isNaN(rgb[1])) {\n    rgb[1] = 0;\n  }\n  ;\n  if (isNaN(rgb[2])) {\n    rgb[2] = 0;\n  }\n  ;\n  return rgb;\n});\n_defineProperty(Util, \"createXMLHttpRequest\", function () {\n  if (window.XMLHttpRequest) {\n    return new XMLHttpRequest();\n  } else if (window.ActiveXObject) {\n    try {\n      return new ActiveXObject(\"Msxml2.XMLHTTP\");\n    } catch (e) {\n      try {\n        return new ActiveXObject(\"Microsoft.XMLHTTP\");\n      } catch (e2) {\n        return null;\n      }\n    }\n  } else {\n    return null;\n  }\n});\n_defineProperty(Util, \"getCurrent\", function () {\n  var current = \"/\";\n  if (document.currentScript) {\n    current = document.currentScript.src;\n  } else {\n    var scripts = document.getElementsByTagName('script'),\n      script = scripts[scripts.length - 1];\n    if (script.src) {\n      current = script.src;\n    }\n  }\n  current = current.substring(0, current.lastIndexOf('/') + 1);\n  return current;\n});\n_defineProperty(Util, \"loadJs\", function (path, func) {\n  ////var script = document.createElement('script');\n  ////script.type=\"module\"\n  ////script.src = path;\n  //loadingCount++;\n\n  //var _func = func;\n\n  //import(path)\n  //.then( function(){\n  //\tloadingCount--;\n  //\tif(_func){\n  //\t\t_func();\n  //\t}\n  //})\n  //.catch(function(){\n  //\tloadingCount--;\n  //})\n  ////document.head.appendChild(script);\n});\n\n//# sourceURL=webpack://hdrpaint/./src/lib/util.js?");

/***/ }),

/***/ "./src/lib/vec3.js":
/*!*************************!*\
  !*** ./src/lib/vec3.js ***!
  \*************************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": function() { return /* binding */ Vec3; }\n/* harmony export */ });\nfunction _defineProperty(obj, key, value) { key = _toPropertyKey(key); if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\nfunction _toPropertyKey(arg) { var key = _toPrimitive(arg, \"string\"); return typeof key === \"symbol\" ? key : String(key); }\nfunction _toPrimitive(input, hint) { if (typeof input !== \"object\" || input === null) return input; var prim = input[Symbol.toPrimitive]; if (prim !== undefined) { var res = prim.call(input, hint || \"default\"); if (typeof res !== \"object\") return res; throw new TypeError(\"@@toPrimitive must return a primitive value.\"); } return (hint === \"string\" ? String : Number)(input); }\nclass Vec3 {\n  constructor(x = 0, y = 0, z = 0) {\n    //var o=new Array(3);\n    var o = new Float32Array(3);\n    o[0] = x;\n    o[1] = y;\n    o[2] = z;\n    return o;\n  }\n  static setValues(a, x, y, z) {\n    a[0] = x;\n    a[1] = y;\n    a[2] = z;\n  }\n  static setValue(a, x, y, z) {\n    this.setValues(a, x, y, z);\n  }\n  static copy(a, b) {\n    a[0] = b[0];\n    a[1] = b[1];\n    a[2] = b[2];\n  }\n  static add(a, b, c) {\n    a[0] = b[0] + c[0];\n    a[1] = b[1] + c[1];\n    a[2] = b[2] + c[2];\n  }\n  static sub(a, b, c) {\n    a[0] = b[0] - c[0];\n    a[1] = b[1] - c[1];\n    a[2] = b[2] - c[2];\n  }\n  static copy(a, b) {\n    a[0] = b[0];\n    a[1] = b[1];\n    a[2] = b[2];\n  }\n  static mult(a, b, c) {\n    a[0] = b[0] * c;\n    a[1] = b[1] * c;\n    a[2] = b[2] * c;\n  }\n  static mul(a, b, c) {\n    a[0] = b[0] * c;\n    a[1] = b[1] * c;\n    a[2] = b[2] * c;\n  }\n  static madd(a, b, c, d) {\n    this.mad(a, b, c, d);\n  }\n  static mad(a, b, c, d) {\n    a[0] = b[0] + c[0] * d;\n    a[1] = b[1] + c[1] * d;\n    a[2] = b[2] + c[2] * d;\n  }\n  static len(b, c) {\n    var buf0 = b[0] - c[0];\n    var buf1 = b[1] - c[1];\n    var buf2 = b[2] - c[2];\n    return Math.sqrt(buf0 * buf0 + buf1 * buf1 + buf2 * buf2);\n  }\n  static len2(b, c) {\n    var buf0 = b[0] - c[0];\n    var buf1 = b[1] - c[1];\n    var buf2 = b[2] - c[2];\n    return buf0 * buf0 + buf1 * buf1 + buf2 * buf2;\n  }\n  static scalar(a) {\n    return Math.sqrt(a[0] * a[0] + a[1] * a[1] + a[2] * a[2]);\n  }\n  static scalar2(a) {\n    return a[0] * a[0] + a[1] * a[1] + a[2] * a[2];\n  }\n  static normalize(a, b) {\n    if (b[0] === 0 && b[1] === 0 && b[2] === 0) {\n      return;\n    }\n    var l = Math.sqrt(b[0] * b[0] + b[1] * b[1] + b[2] * b[2]);\n    l = 1 / l;\n    a[0] = b[0] * l;\n    a[1] = b[1] * l;\n    a[2] = b[2] * l;\n  }\n  static norm(a) {\n    this.normalize(a, a);\n  }\n  static dot(a, b) {\n    return a[0] * b[0] + a[1] * b[1] + a[2] * b[2];\n  }\n  static vecmul(a, b, c) {\n    a[0] = b[0] * c[0];\n    a[1] = b[1] * c[1];\n    a[2] = b[2] * c[2];\n  }\n  static cross(a, b, c) {\n    var buf0 = b[1] * c[2] - b[2] * c[1];\n    var buf1 = b[2] * c[0] - b[0] * c[2];\n    var buf2 = b[0] * c[1] - b[1] * c[0];\n    a[0] = buf0;\n    a[1] = buf1;\n    a[2] = buf2;\n  }\n  static cross3(a, b, c, d, e) {\n    Vec3.sub(buf1, c, b);\n    Vec3.sub(buf2, e, d);\n    Vec3.cross(a, buf1, buf2);\n  }\n  static cross2(a, b, c, d) {\n    this.cross3(a, b, c, b, d);\n  }\n  static checkBetween(n, n0, n1) {\n    var cross = new Vec3();\n    Vec3.cross(cross, n0, n1);\n    Vec3.cross(cross, cross, n);\n    if (Vec3.dot(cross, n0) * Vec3.dot(cross, n1) > 0) {\n      return false;\n    }\n    return true;\n  }\n}\n_defineProperty(Vec3, \"eulerFromVec3\", function (a, b) {\n  a[1] = Math.atan2(b[0], b[2]);\n  a[2] = 0;\n  a[0] = Math.atan2(b[1], Math.sqrt(b[0] * b[0] + b[2] * b[2]));\n});\n;\nVec3.ZERO = new Vec3();\nvar buf1 = new Vec3();\nvar buf2 = new Vec3();\n\n//# sourceURL=webpack://hdrpaint/./src/lib/vec3.js?");

/***/ }),

/***/ "./src/lib/vector.js":
/*!***************************!*\
  !*** ./src/lib/vector.js ***!
  \***************************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   Mat22: function() { return /* binding */ Mat22; },\n/* harmony export */   Mat33: function() { return /* binding */ Mat33; },\n/* harmony export */   Mat43: function() { return /* binding */ Mat43; },\n/* harmony export */   Mat44: function() { return /* binding */ Mat44; },\n/* harmony export */   Vec2: function() { return /* binding */ Vec2; },\n/* harmony export */   Vec3: function() { return /* binding */ Vec3; },\n/* harmony export */   Vec4: function() { return /* binding */ Vec4; }\n/* harmony export */ });\n/* harmony import */ var _pool_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./pool.js */ \"./src/lib/pool.js\");\n/* harmony import */ var _mat43_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./mat43.js */ \"./src/lib/mat43.js\");\n/* harmony import */ var _mat22_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./mat22.js */ \"./src/lib/mat22.js\");\n/* harmony import */ var _vec3_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./vec3.js */ \"./src/lib/vec3.js\");\n\n\nvar _class;\nfunction _defineProperty(obj, key, value) { key = _toPropertyKey(key); if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\nfunction _toPropertyKey(arg) { var key = _toPrimitive(arg, \"string\"); return typeof key === \"symbol\" ? key : String(key); }\nfunction _toPrimitive(input, hint) { if (typeof input !== \"object\" || input === null) return input; var prim = input[Symbol.toPrimitive]; if (prim !== undefined) { var res = prim.call(input, hint || \"default\"); if (typeof res !== \"object\") return res; throw new TypeError(\"@@toPrimitive must return a primitive value.\"); } return (hint === \"string\" ? String : Number)(input); }\nfunction _classStaticPrivateFieldSpecGet(receiver, classConstructor, descriptor) { _classCheckPrivateStaticAccess(receiver, classConstructor); _classCheckPrivateStaticFieldDescriptor(descriptor, \"get\"); return _classApplyDescriptorGet(receiver, descriptor); }\nfunction _classCheckPrivateStaticFieldDescriptor(descriptor, action) { if (descriptor === undefined) { throw new TypeError(\"attempted to \" + action + \" private static field before its declaration\"); } }\nfunction _classCheckPrivateStaticAccess(receiver, classConstructor) { if (receiver !== classConstructor) { throw new TypeError(\"Private static access of wrong provenance\"); } }\nfunction _classApplyDescriptorGet(receiver, descriptor) { if (descriptor.get) { return descriptor.get.call(receiver); } return descriptor.value; }\n\n\n\n\nvar Mat43 = _mat43_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"];\nvar Vec3 = _vec3_js__WEBPACK_IMPORTED_MODULE_3__[\"default\"];\nvar Mat22 = _mat22_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"];\nvar Vec2 = function () {\n  var Vec2 = function () {\n    var vec2 = new Float32Array(2);\n    vec2[0] = 0.0;\n    vec2[1] = 0.0;\n    return vec2;\n  };\n  var ret = Vec2;\n  ret.copy = function (a, b) {\n    a[0] = b[0];\n    a[1] = b[1];\n  };\n  ret.scalar = function (a) {\n    return Math.sqrt(a[0] * a[0] + a[1] * a[1]);\n  };\n  ret.scalar2 = function (a) {\n    return a[0] * a[0] + a[1] * a[1];\n  };\n  ret.setValues = function (a, x, y) {\n    a[0] = x;\n    a[1] = y;\n  };\n  ret.add = function (a, b, c) {\n    a[0] = b[0] + c[0];\n    a[1] = b[1] + c[1];\n  };\n  ret.sub = function (a, b, c) {\n    a[0] = b[0] - c[0];\n    a[1] = b[1] - c[1];\n  };\n  ret.mul = function (a, b, c) {\n    a[0] = b[0] * c;\n    a[1] = b[1] * c;\n  };\n  ret.mad = function (a, b, c, d) {\n    a[0] = b[0] + c[0] * d;\n    a[1] = b[1] + c[1] * d;\n  };\n  ret.len = function (a, b) {\n    return Math.sqrt((a[0] - b[0]) * (a[0] - b[0]) + (a[1] - b[1]) * (a[1] - b[1]));\n  };\n  ret.len2 = function (a, b) {\n    return (a[0] - b[0]) * (a[0] - b[0]) + (a[1] - b[1]) * (a[1] - b[1]);\n  };\n  ret.normalize = function (a, b) {\n    var l = Math.sqrt(b[0] * b[0] + b[1] * b[1]);\n    l = 1 / l;\n    if (!isFinite(l)) return;\n    a[0] *= l;\n    a[1] *= l;\n  };\n  ret.norm = function (a) {\n    var l = Math.sqrt(a[0] * a[0] + a[1] * a[1]);\n    l = 1 / l;\n    if (!isFinite(l)) return;\n    a[0] *= l;\n    a[1] *= l;\n  };\n  ret.dot = function (a, b) {\n    return a[0] * b[0] + a[1] * b[1];\n  };\n  ret.cross = function (a, b) {\n    return a[0] * b[1] - a[1] * b[0];\n  };\n  return ret;\n}();\nvar Vec4 = function () {\n  var buf0, buf1, buf2, buf3;\n  var x2, y2, z2, xy, yz, zx, xw, yw, zw;\n  var qr, ss, flag, sp, ph, pt, t1, t0;\n  var Vec4 = function () {\n    var o = new Float32Array(4);\n    o[0] = 0;\n    o[1] = 0;\n    o[2] = 0;\n    o[3] = 0;\n    return o;\n    //this[0]=0.0\n    //this[1]=0.0\n    //this[2]=0.0\n    //this[3]=1.0\n  };\n  var ret = Vec4;\n  ret.setValues = function (a, x, y, z, w) {\n    a[0] = x;\n    a[1] = y;\n    a[2] = z;\n    a[3] = w;\n  };\n  ret.copy = function (a, b) {\n    a[0] = b[0];\n    a[1] = b[1];\n    a[2] = b[2];\n    a[3] = b[3];\n  };\n  ret.add = function (a, b, c) {\n    a[0] = b[0] + c[0];\n    a[1] = b[1] + c[1];\n    a[2] = b[2] + c[2];\n    a[3] = b[3] + c[3];\n  };\n  ret.sub = function (a, b, c) {\n    a[0] = b[0] - c[0];\n    a[1] = b[1] - c[1];\n    a[2] = b[2] - c[2];\n    a[3] = b[3] - c[3];\n  };\n  ret.mul = function (a, b, c) {\n    a[0] *= c;\n    a[1] *= c;\n    a[2] *= c;\n    a[3] *= c;\n  };\n  ret.qdot = function (a, b, c) {\n    buf0 = b[0] * c[0] - b[1] * c[1] - b[2] * c[2] - b[3] * c[3];\n    buf1 = b[0] * c[1] + c[0] * b[1] + b[2] * c[3] - b[3] * c[2];\n    buf2 = b[0] * c[2] + c[0] * b[2] + b[3] * c[1] - b[1] * c[3];\n    buf3 = b[0] * c[3] + c[0] * b[3] + b[1] * c[2] - b[2] * c[1];\n    a[0] = buf0;\n    a[1] = buf1;\n    a[2] = buf2;\n    a[3] = buf3;\n  };\n  ret.qmul = function (a, b, c) {\n    if (b[0] == 1) {\n      a[0] = b[0];\n      a[1] = b[1];\n      a[2] = b[2];\n      a[3] = b[3];\n      return;\n    }\n    var theta = Math.acos(b[0]);\n    var r = Math.sin(theta * c) / Math.sin(theta);\n    a[0] = Math.cos(theta * c);\n    a[1] = b[1] * r;\n    a[2] = b[2] * r;\n    a[3] = b[3] * r;\n  };\n  ret.qmdot = function (a, b, c) {\n    buf0 = b[0] * c[0] + b[1] * c[1] + b[2] * c[2] + b[3] * c[3];\n    buf1 = -b[0] * c[1] + c[0] * b[1] - b[2] * c[3] + b[3] * c[2];\n    buf2 = -b[0] * c[2] + c[0] * b[2] - b[3] * c[1] + b[1] * c[3];\n    buf3 = -b[0] * c[3] + c[0] * b[3] - b[1] * c[2] + b[2] * c[1];\n    a[0] = Math.min(1, Math.max(-1, buf0));\n    a[1] = buf1;\n    a[2] = buf2;\n    a[3] = buf3;\n  };\n  ret.fromRotVector = function (v, w, x, y, z) {\n    var SIN = Math.sin(w * 0.5);\n    v[0] = Math.cos(w * 0.5);\n    ;\n    v[1] = SIN * x;\n    v[2] = SIN * y;\n    v[3] = SIN * z;\n  };\n  ret.toTorque = function (v, q) {\n    var w = Math.acos(q[0]) * 2;\n    if (w !== 0) {\n      w = w / Math.sin(w * 0.5);\n    } else {\n      w = 0;\n    }\n    v[0] = q[1] * w;\n    v[1] = q[2] * w;\n    v[2] = q[3] * w;\n  };\n  ret.rotVec3 = function (a, b, c) {\n    //c = (0,x,y,z)\n    buf0 = -b[1] * c[0] - b[2] * c[1] - b[3] * c[2];\n    buf1 = b[0] * c[0] + b[2] * c[2] - b[3] * c[1];\n    buf2 = b[0] * c[1] + b[3] * c[0] - b[1] * c[2];\n    buf3 = b[0] * c[2] + b[1] * c[1] - b[2] * c[0];\n    a[0] = buf0 * -b[1] + b[0] * buf1 + buf2 * -b[3] - buf3 * -b[2];\n    a[1] = buf0 * -b[2] + b[0] * buf2 + buf3 * -b[1] - buf1 * -b[3];\n    a[2] = buf0 * -b[3] + b[0] * buf3 + buf1 * -b[2] - buf2 * -b[1];\n  };\n  ret.toMat33 = function (a, b) {\n    x2 = b[1] * b[1] * 2.0;\n    y2 = b[2] * b[2] * 2.0;\n    z2 = b[3] * b[3] * 2.0;\n    xy = b[1] * b[2] * 2.0;\n    yz = b[2] * b[3] * 2.0;\n    zx = b[3] * b[1] * 2.0;\n    xw = b[1] * b[0] * 2.0;\n    yw = b[2] * b[0] * 2.0;\n    zw = b[3] * b[0] * 2.0;\n    a[0] = 1.0 - y2 - z2;\n    a[1] = xy + zw;\n    a[2] = zx - yw;\n    a[3] = xy - zw;\n    a[4] = 1.0 - z2 - x2;\n    a[5] = yz + xw;\n    a[6] = zx + yw;\n    a[7] = yz - xw;\n    a[8] = 1.0 - x2 - y2;\n  };\n  ret.toMat43 = ret.qTOm = function (a, b) {\n    x2 = b[1] * b[1] * 2.0;\n    y2 = b[2] * b[2] * 2.0;\n    z2 = b[3] * b[3] * 2.0;\n    xy = b[1] * b[2] * 2.0;\n    yz = b[2] * b[3] * 2.0;\n    zx = b[3] * b[1] * 2.0;\n    xw = b[1] * b[0] * 2.0;\n    yw = b[2] * b[0] * 2.0;\n    zw = b[3] * b[0] * 2.0;\n    a[0] = 1.0 - y2 - z2;\n    a[1] = xy + zw;\n    a[2] = zx - yw;\n    a[3] = xy - zw;\n    a[4] = 1.0 - z2 - x2;\n    a[5] = yz + xw;\n    a[6] = zx + yw;\n    a[7] = yz - xw;\n    a[8] = 1.0 - x2 - y2;\n    a[9] = a[10] = a[11] = 0.0;\n  };\n  //\n  ret.slerp = function (a, b, c, t) {\n    qr = b[0] * c[0] + b[1] * c[1] + b[2] * c[2] + b[3] * c[3];\n    ss = 1.0 - qr * qr;\n    flag = 0;\n    if (qr < 0) {\n      flag = 1;\n      qr *= -1;\n    }\n    if (ss <= 0.0) {\n      a[0] = b[0];\n      a[1] = b[1];\n      a[2] = b[2];\n      a[3] = b[3];\n    } else {\n      sp = Math.sqrt(ss);\n      ph = Math.acos(qr);\n      pt = ph * t;\n      t1 = Math.sin(pt) / sp;\n      t0 = Math.sin(ph - pt) / sp;\n      if (flag) t1 *= -1;\n      a[0] = b[0] * t0 + c[0] * t1;\n      a[1] = b[1] * t0 + c[1] * t1;\n      a[2] = b[2] * t0 + c[2] * t1;\n      a[3] = b[3] * t0 + c[3] * t1;\n    }\n  };\n  ret.fromMat44 = function (v, m) {\n    var m33 = Mat33.alloc();\n    m33[0] = m[0];\n    m33[1] = m[1];\n    m33[2] = m[2];\n    m33[3] = m[4];\n    m33[4] = m[5];\n    m33[5] = m[6];\n    m33[6] = m[8];\n    m33[7] = m[9];\n    m33[8] = m[10];\n    //this.fromMat33(v,m33);\n    Mat33.rotToQuat(v, m33);\n    Mat33.free(1);\n  };\n  ret.fromMat33 = function (v, m) {\n    var invx = 1 / Math.sqrt(m[0] * m[0] + m[1] * m[1] + m[2] * m[2]);\n    var invy = 1 / Math.sqrt(m[3] * m[3] + m[4] * m[4] + m[5] * m[5]);\n    var invz = 1 / Math.sqrt(m[6] * m[6] + m[7] * m[7] + m[8] * m[8]);\n    var m33 = Mat33.alloc();\n    m33[0] = m[0] * invx;\n    m33[1] = m[1] * invx;\n    m33[2] = m[2] * invx;\n    m33[3] = m[3] * invy;\n    m33[4] = m[4] * invy;\n    m33[5] = m[5] * invy;\n    m33[6] = m[6] * invz;\n    m33[7] = m[7] * invz;\n    m33[8] = m[8] * invz;\n    Mat33.getRotVec(v, m33);\n    var r = Vec3.scalar(v);\n    if (r !== 0) {\n      Vec3.mul(v, v, 1 / r);\n      Vec4.fromRotVector(v, r, v[0], v[1], v[2]);\n    } else {\n      Vec4.setValue(v, 0, 0, 0, 1);\n    }\n    Mat33.free(1);\n  };\n  return ret;\n}();\nclass Mat33 {\n  constructor() {\n    var o = new Float32Array(9);\n    Mat33.setInit(o);\n    return o;\n  }\n  static setInit(m) {\n    m[0] = 1;\n    m[1] = 0;\n    m[2] = 0;\n    m[3] = 0;\n    m[4] = 1;\n    m[5] = 0;\n    m[6] = 0;\n    m[7] = 0;\n    m[8] = 1;\n  }\n  static init() {\n    _classStaticPrivateFieldSpecGet(Mat33, Mat33, _ZERO)[0] = 0;\n    _classStaticPrivateFieldSpecGet(Mat33, Mat33, _ZERO)[4] = 0;\n    _classStaticPrivateFieldSpecGet(Mat33, Mat33, _ZERO)[8] = 0;\n  }\n  static setValue(obj, a0, a1, a2, a3, a4, a5, a6, a7, a8) {\n    obj[0] = a0;\n    obj[1] = a1;\n    obj[2] = a2;\n    obj[3] = a3;\n    obj[4] = a4;\n    obj[5] = a5;\n    obj[6] = a6;\n    obj[7] = a7;\n    obj[8] = a8;\n  }\n  static copy(m, a) {\n    m[0] = a[0];\n    m[1] = a[1];\n    m[2] = a[2];\n    m[3] = a[3];\n    m[4] = a[4];\n    m[5] = a[5];\n    m[6] = a[6];\n    m[7] = a[7];\n    m[8] = a[8];\n  }\n  static add(a, b, c) {\n    a[0] = b[0] + c[0];\n    a[1] = b[1] + c[1];\n    a[2] = b[2] + c[2];\n    a[3] = b[3] + c[3];\n    a[4] = b[4] + c[4];\n    a[5] = b[5] + c[5];\n    a[6] = b[6] + c[6];\n    a[7] = b[7] + c[7];\n    a[8] = b[8] + c[8];\n  }\n  static madd(a, b, c, d) {\n    a[0] = b[0] + c[0] * d;\n    a[1] = b[1] + c[1] * d;\n    a[2] = b[2] + c[2] * d;\n    a[3] = b[3] + c[3] * d;\n    a[4] = b[4] + c[4] * d;\n    a[5] = b[5] + c[5] * d;\n    a[6] = b[6] + c[6] * d;\n    a[7] = b[7] + c[7] * d;\n    a[8] = b[8] + c[8] * d;\n  }\n  static sub(a, b, c) {\n    a[0] = b[0] - c[0];\n    a[1] = b[1] - c[1];\n    a[2] = b[2] - c[2];\n    a[3] = b[3] - c[3];\n    a[4] = b[4] - c[4];\n    a[5] = b[5] - c[5];\n    a[6] = b[6] - c[6];\n    a[7] = b[7] - c[7];\n    a[8] = b[8] - c[8];\n  }\n  static mul(a, b, c) {\n    a[0] = b[0] * c;\n    a[1] = b[1] * c;\n    a[2] = b[2] * c;\n    a[3] = b[3] * c;\n    a[4] = b[4] * c;\n    a[5] = b[5] * c;\n    a[6] = b[6] * c;\n    a[7] = b[7] * c;\n    a[8] = b[8] * c;\n  }\n  static dotVec3(ret, m, v) {\n    var v0 = v[0];\n    var v1 = v[1];\n    var v2 = v[2];\n    ret[0] = m[0] * v0 + m[3] * v1 + m[6] * v2;\n    ret[1] = m[1] * v0 + m[4] * v1 + m[7] * v2;\n    ret[2] = m[2] * v0 + m[5] * v1 + m[8] * v2;\n    //ret.set(bufferVec3);\n  }\n  static dot(ret, ma, mb) {\n    var buffer = _classStaticPrivateFieldSpecGet(Mat33, Mat33, _buffer);\n    buffer[0] = ma[0] * mb[0] + ma[3] * mb[1] + ma[6] * mb[2];\n    buffer[1] = ma[1] * mb[0] + ma[4] * mb[1] + ma[7] * mb[2];\n    buffer[2] = ma[2] * mb[0] + ma[5] * mb[1] + ma[8] * mb[2];\n    buffer[3] = ma[0] * mb[3] + ma[3] * mb[4] + ma[6] * mb[5];\n    buffer[4] = ma[1] * mb[3] + ma[4] * mb[4] + ma[7] * mb[5];\n    buffer[5] = ma[2] * mb[3] + ma[5] * mb[4] + ma[8] * mb[5];\n    buffer[6] = ma[0] * mb[6] + ma[3] * mb[7] + ma[6] * mb[8];\n    buffer[7] = ma[1] * mb[6] + ma[4] * mb[7] + ma[7] * mb[8];\n    buffer[8] = ma[2] * mb[6] + ma[5] * mb[7] + ma[8] * mb[8];\n    ret.set(buffer);\n  }\n  static fromRotVector(ret, r, x, y, z) {\n    var SIN = Math.sin(r);\n    var COS = Math.cos(r);\n    ret[0] = x * x * (1 - COS) + COS;\n    ret[3] = x * y * (1 - COS) - z * SIN;\n    ret[6] = z * x * (1 - COS) + y * SIN;\n    ret[1] = x * y * (1 - COS) + z * SIN;\n    ret[4] = y * y * (1 - COS) + COS;\n    ret[7] = y * z * (1 - COS) - x * SIN;\n    ret[2] = z * x * (1 - COS) - y * SIN;\n    ret[5] = y * z * (1 - COS) + x * SIN;\n    ret[8] = z * z * (1 - COS) + COS;\n  }\n  static fromQuat(a, b) {\n    var x2 = b[1] * b[1] * 2.0;\n    var y2 = b[2] * b[2] * 2.0;\n    var z2 = b[3] * b[3] * 2.0;\n    var xy = b[1] * b[2] * 2.0;\n    var yz = b[2] * b[3] * 2.0;\n    var zx = b[3] * b[1] * 2.0;\n    var xw = b[1] * b[0] * 2.0;\n    var yw = b[2] * b[0] * 2.0;\n    var zw = b[3] * b[0] * 2.0;\n    a[0] = 1.0 - y2 - z2;\n    a[1] = xy + zw;\n    a[2] = zx - yw;\n    a[3] = xy - zw;\n    a[4] = 1.0 - z2 - x2;\n    a[5] = yz + xw;\n    a[6] = zx + yw;\n    a[7] = yz - xw;\n    a[8] = 1.0 - x2 - y2;\n  }\n  static getRotVec(ret, m) {\n    //回転行列から回転ベクトル作成\n    var COS = (m[0] + m[4] + m[8] - 1) * 0.5;\n    if (COS * COS >= 1) {\n      Vec3.setValue(ret, 0, 0, 0);\n      return;\n    }\n    var r = Math.acos(COS);\n    var SIN = Math.sin(r);\n    ret[0] = m[5] - m[7];\n    ret[1] = m[6] - m[2];\n    ret[2] = m[1] - m[3];\n    Vec3.mul(ret, ret, r / (SIN * 2.0));\n  }\n  static rotToQuat(r, m) {\n    //回転行列からクォータニオンに変換\n    r[1] = m[0] - m[4] - m[8] + 1;\n    r[2] = -m[0] + m[4] - m[8] + 1;\n    r[3] = -m[0] - m[4] + m[8] + 1;\n    r[0] = m[0] + m[4] + m[8] + 1;\n    var bigest = 0;\n    for (var i = 1; i < 4; i++) {\n      if (r[i] > r[bigest]) {\n        bigest = i;\n      }\n    }\n    if (r[bigest] < 0) {\n      return;\n    }\n    var v = Math.sqrt(r[bigest]) * 0.5;\n    r[bigest] = v;\n    var mult = 0.25 / v;\n    switch (bigest) {\n      case 1:\n        r[2] = (m[1] + m[3]) * mult;\n        r[3] = (m[2] + m[6]) * mult;\n        r[0] = (m[5] - m[7]) * mult;\n        break;\n      case 2:\n        r[1] = (m[1] + m[3]) * mult;\n        r[3] = (m[7] + m[5]) * mult;\n        r[0] = (m[6] - m[2]) * mult;\n        break;\n      case 3:\n        r[1] = (m[7] + m[5]) * mult;\n        r[2] = (m[2] + m[6]) * mult;\n        r[0] = (m[1] - m[3]) * mult;\n        break;\n      case 0:\n        r[1] = (m[5] - m[7]) * mult;\n        r[2] = (m[6] - m[2]) * mult;\n        r[3] = (m[1] - m[3]) * mult;\n        break;\n    }\n    return;\n  }\n  static getRotQuat(ret, m) {\n    return Mat33.rotToQuat(ret, m);\n    Mat33.getRotVec(ret, m);\n    var r = Vec3.scalar(ret);\n    if (!r) {\n      Vec4.setValue(ret, 1, 0, 0, 0);\n      return;\n    }\n    Vec3.mul(ret, ret, 1 / r);\n    Vec4.fromRotVector(ret, r, ret[0], ret[1], ret[2]);\n  }\n  static getEulerXYZ(vec, m) {\n    //回転行列をオイラー角に変換\n    vec[1] = Math.asin(m[2]);\n    if (m[2] == 1 || m[2] == -1) {\n      vec[0] = 0;\n      vec[2] = Math.atan2(-m[3], [4]);\n    } else {\n      vec[0] = Math.atan2(m[5], m[8]);\n      vec[2] = Math.atan2(m[1], m[0]);\n    }\n  }\n  static getEuler(vec, m) {\n    //回転行列をオイラー角に変換 たぶんxzy\n    vec[2] = Math.asin(m[1]);\n    if (m[1] == 1 || m[1] == -1) {\n      vec[0] = 0;\n      vec[1] = Math.atan2(m[8], [6]);\n    } else {\n      vec[0] = Math.atan2(-m[7], m[4]);\n      vec[1] = Math.atan2(-m[2], m[0]);\n    }\n  }\n  static getInv(ret, m) {\n    var d = m[0] * m[4] * m[8] + m[3] * m[7] * m[2] + m[6] * m[1] * m[5] - m[6] * m[4] * m[2] - m[3] * m[1] * m[8] - m[0] * m[7] * m[5];\n    if (!d) {\n      this.mul(m, m, 0);\n      return;\n    }\n    d = 1.0 / d;\n    var m0 = (m[4] * m[8] - m[7] * m[5]) * d;\n    var m1 = (m[7] * m[2] - m[1] * m[8]) * d;\n    var m2 = (m[1] * m[5] - m[4] * m[2]) * d;\n    var m3 = (m[6] * m[5] - m[3] * m[8]) * d;\n    var m4 = (m[0] * m[8] - m[6] * m[2]) * d;\n    var m5 = (m[3] * m[2] - m[0] * m[5]) * d;\n    var m6 = (m[3] * m[7] - m[6] * m[4]) * d;\n    var m7 = (m[6] * m[1] - m[0] * m[7]) * d;\n    var m8 = (m[0] * m[4] - m[3] * m[1]) * d;\n    ret[0] = m0;\n    ret[1] = m1;\n    ret[2] = m2;\n    ret[3] = m3;\n    ret[4] = m4;\n    ret[5] = m5;\n    ret[6] = m6;\n    ret[7] = m7;\n    ret[8] = m8;\n  }\n  static calcTranspose(ret, m) {\n    //転置\n    var buf;\n    buf = m[1];\n    ret[1] = m[3];\n    ret[3] = buf;\n    buf = m[2];\n    ret[2] = m[6];\n    ret[6] = buf;\n    buf = m[5];\n    ret[5] = m[7];\n    ret[7] = buf;\n  }\n  static scale(mat33, x, y, z) {\n    mat33[0] = x;\n    mat33[1] = 0;\n    mat33[2] = 0;\n    mat33[3] = 0;\n    mat33[4] = y;\n    mat33[5] = 0;\n    mat33[6] = 0;\n    mat33[7] = 0;\n    mat33[8] = z;\n  }\n  static rotate(mat33, r, x, y, z) {\n    //xyz軸にr回転する行列作成\n    var SIN = Math.sin(r);\n    var COS = Math.cos(r);\n    mat33[0] = x * x * (1 - COS) + COS;\n    mat33[3] = x * y * (1 - COS) - z * SIN;\n    mat33[6] = z * x * (1 - COS) + y * SIN;\n    mat33[1] = x * y * (1 - COS) + z * SIN;\n    mat33[4] = y * y * (1 - COS) + COS;\n    mat33[7] = y * z * (1 - COS) - x * SIN;\n    mat33[2] = z * x * (1 - COS) - y * SIN;\n    mat33[5] = y * z * (1 - COS) + x * SIN;\n    mat33[8] = z * z * (1 - COS) + COS;\n  }\n}\n_class = Mat33;\nvar _ZERO = {\n  writable: true,\n  value: new _class()\n};\nvar _buffer = {\n  writable: true,\n  value: new _class()\n};\nvar _bufferVec = {\n  writable: true,\n  value: new Vec3()\n};\n;\nMat33.init();\nvar buf0, buf1, buf2, buf3, buf4, buf5, buf6, buf7, buf8, buf9, buf10, buf11, buf12, buf13, buf14, buf15;\nvar bM = new Float32Array(16);\nvar mat43 = new Mat43();\nclass Mat44 {\n  constructor() {\n    var m = new Float32Array(16);\n    m[0] = 1.0;\n    m[1] = 0.0;\n    m[2] = 0.0;\n    m[3] = 0.0;\n    m[4] = 0.0;\n    m[5] = 1.0;\n    m[6] = 0.0;\n    m[7] = 0.0;\n    m[8] = 0.0;\n    m[9] = 0.0;\n    m[10] = 1.0;\n    m[11] = 0.0;\n    m[12] = 0.0;\n    m[13] = 0.0;\n    m[14] = 0.0;\n    m[15] = 1.0;\n    return m;\n  }\n  static setInit(mat) {\n    mat[0] = 1.0;\n    mat[1] = 0.0;\n    mat[2] = 0.0;\n    mat[3] = 0.0;\n    mat[4] = 0.0;\n    mat[5] = 1.0;\n    mat[6] = 0.0;\n    mat[7] = 0.0;\n    mat[8] = 0.0;\n    mat[9] = 0.0;\n    mat[10] = 1.0;\n    mat[11] = 0.0;\n    mat[12] = 0.0;\n    mat[13] = 0.0;\n    mat[14] = 0.0;\n    mat[15] = 1.0;\n  }\n  static setValue(obj, a0, a1, a2, a3, a4, a5, a6, a7, a8, a9, a10, a11, a12, a13, a14, a15) {\n    obj[0] = a0;\n    obj[1] = a1;\n    obj[2] = a2;\n    obj[3] = a3;\n    obj[4] = a4;\n    obj[5] = a5;\n    obj[6] = a6;\n    obj[7] = a7;\n    obj[8] = a8;\n    obj[9] = a9;\n    obj[10] = a10;\n    obj[11] = a11;\n    obj[12] = a12;\n    obj[13] = a13;\n    obj[14] = a14;\n    obj[15] = a15;\n  }\n  static copy(a, b) {\n    a[0] = b[0];\n    a[1] = b[1];\n    a[2] = b[2];\n    a[3] = b[3];\n    a[4] = b[4];\n    a[5] = b[5];\n    a[6] = b[6];\n    a[7] = b[7];\n    a[8] = b[8];\n    a[9] = b[9];\n    a[10] = b[10];\n    a[11] = b[11];\n    a[12] = b[12];\n    a[13] = b[13];\n    a[14] = b[14];\n    a[15] = b[15];\n  }\n  static copyMat43(a, b) {\n    a[0] = b[0];\n    a[1] = b[1];\n    a[2] = b[2];\n    a[3] = 0;\n    a[4] = b[3];\n    a[5] = b[4];\n    a[6] = b[5];\n    a[7] = 0;\n    a[8] = b[6];\n    a[9] = b[7];\n    a[10] = b[8];\n    a[11] = 0;\n    a[12] = b[9];\n    a[13] = b[10];\n    a[14] = b[11];\n    a[15] = 1;\n  }\n  static mul(a, b, c) {\n    a[0] = b[0] * c;\n    a[1] = b[1] * c;\n    a[2] = b[2] * c;\n    a[3] = b[3] * c;\n    a[4] = b[4] * c;\n    a[5] = b[5] * c;\n    a[6] = b[6] * c;\n    a[7] = b[7] * c;\n    a[8] = b[8] * c;\n    a[9] = b[9] * c;\n    a[10] = b[10] * c;\n    a[11] = b[11] * c;\n    a[12] = b[12] * c;\n    a[13] = b[13] * c;\n    a[14] = b[14] * c;\n    a[15] = b[15] * c;\n  }\n  static dotVec3(a, b, c) {\n    buf0 = c[0];\n    buf1 = c[1];\n    buf2 = c[2];\n    a[0] = b[0] * buf0 + b[4] * buf1 + b[8] * buf2 + b[12];\n    a[1] = b[1] * buf0 + b[5] * buf1 + b[9] * buf2 + b[13];\n    a[2] = b[2] * buf0 + b[6] * buf1 + b[10] * buf2 + b[14];\n  }\n  static dotMat33Vec3(a, b, c) {\n    buf0 = c[0];\n    buf1 = c[1];\n    buf2 = c[2];\n    a[0] = b[0] * buf0 + b[4] * buf1 + b[8] * buf2;\n    a[1] = b[1] * buf0 + b[5] * buf1 + b[9] * buf2;\n    a[2] = b[2] * buf0 + b[6] * buf1 + b[10] * buf2;\n  }\n  static dotVec4(a, b, c) {\n    buf0 = c[0];\n    buf1 = c[1];\n    buf2 = c[2];\n    buf3 = c[3];\n    a[0] = b[0] * buf0 + b[4] * buf1 + b[8] * buf2 + b[12] * buf3;\n    a[1] = b[1] * buf0 + b[5] * buf1 + b[9] * buf2 + b[13] * buf3;\n    a[2] = b[2] * buf0 + b[6] * buf1 + b[10] * buf2 + b[14] * buf3;\n    a[3] = b[3] * buf0 + b[7] * buf1 + b[11] * buf2 + b[15] * buf3;\n  }\n  static dot(a, b, c) {\n    if (a == b) {\n      buf0 = b[0];\n      buf1 = b[1];\n      buf2 = b[2];\n      buf3 = b[3];\n      buf4 = b[4];\n      buf5 = b[5];\n      buf6 = b[6];\n      buf7 = b[7];\n      buf8 = b[8];\n      buf9 = b[9];\n      buf10 = b[10];\n      buf11 = b[11];\n      buf12 = b[12];\n      buf13 = b[13];\n      buf14 = b[14];\n      buf15 = b[15];\n      a[0] = buf0 * c[0] + buf4 * c[1] + buf8 * c[2] + buf12 * c[3];\n      a[1] = buf1 * c[0] + buf5 * c[1] + buf9 * c[2] + buf13 * c[3];\n      a[2] = buf2 * c[0] + buf6 * c[1] + buf10 * c[2] + buf14 * c[3];\n      a[3] = buf3 * c[0] + buf7 * c[1] + buf11 * c[2] + buf15 * c[3];\n      a[4] = buf0 * c[4] + buf4 * c[5] + buf8 * c[6] + buf12 * c[7];\n      a[5] = buf1 * c[4] + buf5 * c[5] + buf9 * c[6] + buf13 * c[7];\n      a[6] = buf2 * c[4] + buf6 * c[5] + buf10 * c[6] + buf14 * c[7];\n      a[7] = buf3 * c[4] + buf7 * c[5] + buf11 * c[6] + buf15 * c[7];\n      a[8] = buf0 * c[8] + buf4 * c[9] + buf8 * c[10] + buf12 * c[11];\n      a[9] = buf1 * c[8] + buf5 * c[9] + buf9 * c[10] + buf13 * c[11];\n      a[10] = buf2 * c[8] + buf6 * c[9] + buf10 * c[10] + buf14 * c[11];\n      a[11] = buf3 * c[8] + buf7 * c[9] + buf11 * c[10] + buf15 * c[11];\n      a[12] = buf0 * c[12] + buf4 * c[13] + buf8 * c[14] + buf12 * c[15];\n      a[13] = buf1 * c[12] + buf5 * c[13] + buf9 * c[14] + buf13 * c[15];\n      a[14] = buf2 * c[12] + buf6 * c[13] + buf10 * c[14] + buf14 * c[15];\n      a[15] = buf3 * c[12] + buf7 * c[13] + buf11 * c[14] + buf15 * c[15];\n    } else {\n      buf0 = c[0];\n      buf1 = c[1];\n      buf2 = c[2];\n      buf3 = c[3];\n      buf4 = c[4];\n      buf5 = c[5];\n      buf6 = c[6];\n      buf7 = c[7];\n      buf8 = c[8];\n      buf9 = c[9];\n      buf10 = c[10];\n      buf11 = c[11];\n      buf12 = c[12];\n      buf13 = c[13];\n      buf14 = c[14];\n      buf15 = c[15];\n      a[0] = b[0] * buf0 + b[4] * buf1 + b[8] * buf2 + b[12] * buf3;\n      a[1] = b[1] * buf0 + b[5] * buf1 + b[9] * buf2 + b[13] * buf3;\n      a[2] = b[2] * buf0 + b[6] * buf1 + b[10] * buf2 + b[14] * buf3;\n      a[3] = b[3] * buf0 + b[7] * buf1 + b[11] * buf2 + b[15] * buf3;\n      a[4] = b[0] * buf4 + b[4] * buf5 + b[8] * buf6 + b[12] * buf7;\n      a[5] = b[1] * buf4 + b[5] * buf5 + b[9] * buf6 + b[13] * buf7;\n      a[6] = b[2] * buf4 + b[6] * buf5 + b[10] * buf6 + b[14] * buf7;\n      a[7] = b[3] * buf4 + b[7] * buf5 + b[11] * buf6 + b[15] * buf7;\n      a[8] = b[0] * buf8 + b[4] * buf9 + b[8] * buf10 + b[12] * buf11;\n      a[9] = b[1] * buf8 + b[5] * buf9 + b[9] * buf10 + b[13] * buf11;\n      a[10] = b[2] * buf8 + b[6] * buf9 + b[10] * buf10 + b[14] * buf11;\n      a[11] = b[3] * buf8 + b[7] * buf9 + b[11] * buf10 + b[15] * buf11;\n      a[12] = b[0] * buf12 + b[4] * buf13 + b[8] * buf14 + b[12] * buf15;\n      a[13] = b[1] * buf12 + b[5] * buf13 + b[9] * buf14 + b[13] * buf15;\n      a[14] = b[2] * buf12 + b[6] * buf13 + b[10] * buf14 + b[14] * buf15;\n      a[15] = b[3] * buf12 + b[7] * buf13 + b[11] * buf14 + b[15] * buf15;\n    }\n  }\n  static dotMat43(a, b, c) {\n    buf0 = b[0] * c[0] + b[4] * c[1] + b[8] * c[2];\n    buf1 = b[1] * c[0] + b[5] * c[1] + b[9] * c[2];\n    buf2 = b[2] * c[0] + b[6] * c[1] + b[10] * c[2];\n    buf3 = b[3] * c[0] + b[7] * c[1] + b[11] * c[2];\n    buf4 = b[0] * c[3] + b[4] * c[4] + b[8] * c[5];\n    buf5 = b[1] * c[3] + b[5] * c[4] + b[9] * c[5];\n    buf6 = b[2] * c[3] + b[6] * c[4] + b[10] * c[5];\n    buf7 = b[3] * c[3] + b[7] * c[4] + b[11] * c[5];\n    buf8 = b[0] * c[6] + b[4] * c[7] + b[8] * c[8];\n    buf9 = b[1] * c[6] + b[5] * c[7] + b[9] * c[8];\n    buf10 = b[2] * c[6] + b[6] * c[7] + b[10] * c[8];\n    buf11 = b[3] * c[6] + b[7] * c[7] + b[11] * c[8];\n    buf12 = b[0] * c[9] + b[4] * c[10] + b[8] * c[11] + b[12];\n    buf13 = b[1] * c[9] + b[5] * c[10] + b[9] * c[11] + b[13];\n    buf14 = b[2] * c[9] + b[6] * c[10] + b[10] * c[11] + b[14];\n    buf15 = b[3] * c[9] + b[7] * c[10] + b[11] * c[11] + b[15];\n    a[0] = buf0;\n    a[1] = buf1;\n    a[2] = buf2;\n    a[3] = buf3;\n    a[4] = buf4;\n    a[5] = buf5;\n    a[6] = buf6;\n    a[7] = buf7;\n    a[8] = buf8;\n    a[9] = buf9;\n    a[10] = buf10;\n    a[11] = buf11;\n    a[12] = buf12;\n    a[13] = buf13;\n    a[14] = buf14;\n    a[15] = buf15;\n  }\n  //location,scale,eulerAnlge から行列を作る\n  static fromLSE(m, l, s, e) {\n    Mat43.fromLSE(mat43, l, s, e);\n    Mat44.setValue(m, mat43[0], mat43[1], mat43[2], 0, mat43[3], mat43[4], mat43[5], 0, mat43[6], mat43[7], mat43[8], 0, mat43[9], mat43[10], mat43[11], 1);\n  }\n  static fromLSR(m, l, s, r) {\n    Mat43.fromLSR(mat43, l, s, r);\n    Mat44.setValue(m, mat43[0], mat43[1], mat43[2], 0, mat43[3], mat43[4], mat43[5], 0, mat43[6], mat43[7], mat43[8], 0, mat43[9], mat43[10], mat43[11], 1);\n  }\n  static getRotVector(target, angle) {\n    Mat43.getRotVector.call(this, target, angle);\n  }\n  static getInv(a, b) {\n    var det = b[0] * b[5] * b[10] * b[15] + b[0] * b[9] * b[14] * b[7] + b[0] * b[13] * b[6] * b[11] + b[4] * b[1] * b[14] * b[11] + b[4] * b[9] * b[2] * b[15] + b[4] * b[13] * b[10] * b[3] + b[8] * b[1] * b[6] * b[15] + b[8] * b[5] * b[14] * b[3] + b[8] * b[13] * b[2] * b[7] + b[12] * b[1] * b[10] * b[7] + b[12] * b[5] * b[2] * b[11] + b[12] * b[9] * b[6] * b[3] - b[0] * b[5] * b[14] * b[11] - b[0] * b[9] * b[6] * b[15] - b[0] * b[13] * b[10] * b[7] - b[4] * b[1] * b[10] * b[15] - b[4] * b[9] * b[14] * b[3] - b[4] * b[13] * b[2] * b[11] - b[8] * b[1] * b[14] * b[7] - b[8] * b[5] * b[2] * b[15] - b[8] * b[13] * b[6] * b[3] - b[12] * b[1] * b[6] * b[11] - b[12] * b[5] * b[10] * b[3] - b[12] * b[9] * b[2] * b[7];\n    if (Math.abs(det) < 0.000000000001) {\n      return;\n    }\n    det = 1 / det;\n    buf0 = b[0];\n    buf1 = b[1];\n    buf2 = b[2];\n    buf3 = b[3];\n    buf4 = b[4];\n    buf5 = b[5];\n    buf6 = b[6];\n    buf7 = b[7];\n    buf8 = b[8];\n    buf9 = b[9];\n    buf10 = b[10];\n    buf11 = b[11];\n    buf12 = b[12];\n    buf13 = b[13];\n    buf14 = b[14];\n    buf15 = b[15];\n    a[0] = (buf5 * buf10 * buf15 + buf9 * buf14 * buf7 + buf13 * buf6 * buf11 - buf5 * buf14 * buf11 - buf9 * buf6 * buf15 - buf13 * buf10 * buf7) * det;\n    a[4] = (buf4 * buf14 * buf11 + buf8 * buf6 * buf15 + buf12 * buf10 * buf7 - buf4 * buf10 * buf15 - buf8 * buf14 * buf7 - buf12 * buf6 * buf11) * det;\n    a[8] = (buf4 * buf9 * buf15 + buf8 * buf13 * buf7 + buf12 * buf5 * buf11 - buf4 * buf13 * buf11 - buf8 * buf5 * buf15 - buf12 * buf9 * buf7) * det;\n    a[12] = (buf4 * buf13 * buf10 + buf8 * buf5 * buf14 + buf12 * buf9 * buf6 - buf4 * buf9 * buf14 - buf8 * buf13 * buf6 - buf12 * buf5 * buf10) * det;\n    a[1] = (buf1 * buf14 * buf11 + buf9 * buf2 * buf15 + buf13 * buf10 * buf3 - buf1 * buf10 * buf15 - buf9 * buf14 * buf3 - buf13 * buf2 * buf11) * det;\n    a[5] = (buf0 * buf10 * buf15 + buf8 * buf14 * buf3 + buf12 * buf2 * buf11 - buf0 * buf14 * buf11 - buf8 * buf2 * buf15 - buf12 * buf10 * buf3) * det;\n    a[9] = (buf0 * buf13 * buf11 + buf8 * buf1 * buf15 + buf12 * buf9 * buf3 - buf0 * buf9 * buf15 - buf8 * buf13 * buf3 - buf12 * buf1 * buf11) * det;\n    a[13] = (buf0 * buf9 * buf14 + buf8 * buf13 * buf2 + buf12 * buf1 * buf10 - buf0 * buf13 * buf10 - buf8 * buf1 * buf14 - buf12 * buf9 * buf2) * det;\n    a[2] = (buf1 * buf6 * buf15 + buf5 * buf14 * buf3 + buf13 * buf2 * buf7 - buf1 * buf14 * buf7 - buf5 * buf2 * buf15 - buf13 * buf6 * buf3) * det;\n    a[6] = (buf0 * buf14 * buf7 + buf4 * buf2 * buf15 + buf12 * buf6 * buf3 - buf0 * buf6 * buf15 - buf4 * buf14 * buf3 - buf12 * buf2 * buf7) * det;\n    a[10] = (buf0 * buf5 * buf15 + buf4 * buf13 * buf3 + buf12 * buf1 * buf7 - buf0 * buf13 * buf7 - buf4 * buf1 * buf15 - buf12 * buf5 * buf3) * det;\n    a[14] = (buf0 * buf13 * buf6 + buf4 * buf1 * buf14 + buf12 * buf5 * buf2 - buf0 * buf5 * buf14 - buf4 * buf13 * buf2 - buf12 * buf1 * buf6) * det;\n    a[3] = (buf1 * buf10 * buf7 + buf5 * buf2 * buf11 + buf9 * buf6 * buf3 - buf1 * buf6 * buf11 - buf5 * buf10 * buf3 - buf9 * buf2 * buf7) * det;\n    a[7] = (buf0 * buf6 * buf11 + buf4 * buf10 * buf3 + buf8 * buf2 * buf7 - buf0 * buf10 * buf7 - buf4 * buf2 * buf11 - buf8 * buf6 * buf3) * det;\n    a[11] = (buf0 * buf9 * buf7 + buf4 * buf1 * buf11 + buf8 * buf5 * buf3 - buf0 * buf5 * buf11 - buf4 * buf9 * buf3 - buf8 * buf1 * buf7) * det;\n    a[15] = (buf0 * buf5 * buf10 + buf4 * buf9 * buf2 + buf8 * buf1 * buf6 - buf0 * buf9 * buf6 - buf4 * buf1 * buf10 - buf8 * buf5 * buf2) * det;\n  }\n}\n_defineProperty(Mat44, \"fromRotVector\", function (ret, r, x, y, z) {\n  var SIN = Math.sin(r);\n  var COS = Math.cos(r);\n  ret[0] = x * x * (1 - COS) + COS;\n  ret[4] = x * y * (1 - COS) - z * SIN;\n  ret[8] = z * x * (1 - COS) + y * SIN;\n  ret[1] = x * y * (1 - COS) + z * SIN;\n  ret[5] = y * y * (1 - COS) + COS;\n  ret[9] = y * z * (1 - COS) - x * SIN;\n  ret[2] = z * x * (1 - COS) - y * SIN;\n  ret[6] = y * z * (1 - COS) + x * SIN;\n  ret[10] = z * z * (1 - COS) + COS;\n  ret[3] = ret[7] = ret[11] = ret[12] = ret[13] = ret[14] = 0;\n  ret[15] = 1;\n});\n_defineProperty(Mat44, \"determinant\", function (a) {\n  return b[0] * b[5] * b[10] * b[15] + b[0] * b[9] * b[14] * b[7] + b[0] * b[13] * b[6] * b[11] + b[4] * b[1] * b[14] * b[11] + b[4] * b[9] * b[2] * b[15] + b[4] * b[13] * b[10] * b[3] + b[8] * b[1] * b[6] * b[15] + b[8] * b[5] * b[14] * b[3] + b[8] * b[13] * b[2] * b[7] + b[12] * b[1] * b[10] * b[7] + b[12] * b[5] * b[2] * b[11] + b[12] * b[9] * b[6] * b[3] - b[0] * b[5] * b[14] * b[11] - b[0] * b[9] * b[6] * b[15] - b[0] * b[13] * b[10] * b[7] - b[4] * b[1] * b[10] * b[15] - b[4] * b[9] * b[14] * b[3] - b[4] * b[13] * b[2] * b[11] - b[8] * b[1] * b[14] * b[7] - b[8] * b[5] * b[2] * b[15] - b[8] * b[13] * b[6] * b[3] - b[12] * b[1] * b[6] * b[11] - b[12] * b[5] * b[10] * b[3] - b[12] * b[9] * b[2] * b[7];\n});\n;\n(function () {\n  //プール\n  var classes = [Vec2, Vec3, Vec4, Mat33, Mat43, Mat44];\n  for (var i = 0; i < classes.length; i++) {\n    var ret = classes[i];\n    (0,_pool_js__WEBPACK_IMPORTED_MODULE_0__[\"default\"])(ret);\n  }\n})();\nvar Vec2, Vec3, Vec4, Mat43, Mat22;\n\n//# sourceURL=webpack://hdrpaint/./src/lib/vector.js?");

/***/ }),

/***/ "./src/lib/watcher.js":
/*!****************************!*\
  !*** ./src/lib/watcher.js ***!
  \****************************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": function() { return /* binding */ Watcher; }\n/* harmony export */ });\n/* harmony import */ var _util_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./util.js */ \"./src/lib/util.js\");\n//変数監視\n\n\nclass Watch {\n  constructor(variable_root, variable_name, callback) {\n    this.variable_root = variable_root;\n    this.vairable_name = variable_name;\n    this.variable_direction = variable_name.split(\".\");\n    this.callback = callback;\n    this.old_value = {};\n  }\n  getValue(n) {\n    //監視対象の変数の値を取得\n    // n=1なら親を取得\n    if (!n) {\n      n = 0;\n    }\n    var value = this.variable_root;\n    var v = this.variable_direction;\n    for (var j = 0; j < v.length - n; j++) {\n      if (value == undefined) {\n        value = null;\n        break;\n      }\n      if (!value) {\n        break;\n      }\n      value = value[v[j]];\n    }\n    return value;\n  }\n  setValue(value) {\n    //監視変数に値をセットする\n    var val = this.getValue(1); //対象の変数の親を取得\n    val[this.variable_direction[this.variable_direction.length - 1]] = value;\n  }\n  refresh() {\n    //バインドされた変数の値をノード属性にセット\n    var value = this.getValue(0);\n    if (value && (value instanceof HTMLElement || value.nodeName)) {} else {\n      if (typeof value === 'object') {\n        value = JSON.stringify(value);\n      }\n    }\n    this.change_flg = this.old_value !== value;\n    this.old_value = value;\n  }\n}\nclass Task {\n  constructor(watches, callback) {\n    this.watches = watches;\n    this.callback = callback;\n  }\n  exec() {\n    var flg = false;\n    for (var i = 0; i < this.watches.length; i++) {\n      flg = flg || this.watches[i].change_flg;\n    }\n    if (flg) {\n      var values = this.watches.map(w => w.getValue(0));\n      this.callback(values);\n    }\n  }\n}\nclass Watcher {\n  constructor() {\n    this.watches = [];\n    this.tasks = [];\n  }\n  init() {\n    //初期化&バインド\n    //\t\tvar func =()=>{\n    //\t\t\tthis.refresh();\n    //\t\t\twindow.requestAnimationFrame(func);\n    //\t\t}\n    //\t\tfunc();\n    var func = () => {\n      this.refresh();\n      window.requestAnimationFrame(func);\n    };\n    func();\n  }\n  watch(variable_roots, variable_names, func) {\n    var ws = [];\n    if (!Array.isArray(variable_names)) {\n      variable_names = [variable_names];\n    }\n    if (!Array.isArray(variable_roots)) {\n      var root = variable_roots;\n      variable_roots = [];\n      for (var i = 0; i < variable_names.length; i++) {\n        variable_roots.push(root);\n      }\n    }\n    for (var i = 0; i < variable_names.length; i++) {\n      var variable_root = variable_roots[i];\n      var variable_name = variable_names[i];\n      var w = this.watches.find(f => {\n        return variable_root == f.variable_root && f.variable_name == variable_name;\n      });\n      if (!w) {\n        //変数監視が無い場合は追加\n        w = new Watch(variable_root, variable_name, func);\n        this.watches.push(w);\n      }\n      ws.push(w);\n    }\n    var task = new Task(ws, func);\n    this.tasks.push(task);\n    return task;\n  }\n  refresh() {\n    //監視対象をチェック\n    this.watches.forEach(w => {\n      w.refresh();\n    });\n\n    //タスク実行\n    this.tasks.forEach(w => {\n      w.exec();\n    });\n  }\n  static getValue(root, name, flg = 0) {\n    var v = name.split(\".\");\n    var value = root;\n    for (var j = 0; j < v.length - flg; j++) {\n      if (value == undefined) {\n        value = null;\n        break;\n      }\n      if (!value) {\n        break;\n      }\n      value = value[v[j]];\n    }\n    return value;\n  }\n  static setValue(root, name, value) {\n    var v = name.split(\".\");\n    var val = this.getValue(root, name, 1); //対象の変数の親を取得\n    val[v[v.length - 1]] = value;\n  }\n}\n\n//# sourceURL=webpack://hdrpaint/./src/lib/watcher.js?");

/***/ }),

/***/ "./src/lib/zip.js":
/*!************************!*\
  !*** ./src/lib/zip.js ***!
  \************************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": function() { return /* binding */ Zip; }\n/* harmony export */ });\n/* harmony import */ var _util_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./util.js */ \"./src/lib/util.js\");\n/* harmony import */ var _datastream_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./datastream.js */ \"./src/lib/datastream.js\");\n/* harmony import */ var _deflate_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./deflate.js */ \"./src/lib/deflate.js\");\n/* harmony import */ var _zlib_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./zlib.js */ \"./src/lib/zlib.js\");\n\n\n\n\nvar calcCrc32 = function (array) {\n  //CRC32を計算する\n  var table = [];\n  var poly = 0xEDB88320;\n  var result = 0xFFFFFFFF;\n\n  //create table\n  for (var i = 0; i < 256; i++) {\n    var u = i;\n    for (var j = 0; j < 8; j++) {\n      if (u & 0x1) u = u >>> 1 ^ poly;else u >>>= 1;\n    }\n    table.push(u >>> 0);\n  }\n\n  //calculate\n  for (var i = 0; i < array.length; i++) result = (result >>> 8 ^ table[array[i] ^ result & 0xFF]) >>> 0;\n  return ~result >>> 0;\n};\nvar LOCAL_HEADER_SIZE = 30;\nvar CENTRAL_SIZE = 46;\nvar END_SIZE = 22;\nclass Zip {\n  static read(buffer) {\n    var ds = new _datastream_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"](buffer);\n    var files = [];\n    while (1) {\n      //ローカルファイルヘッダ\n      var sig = ds.getUint32(true); //シグネチャ\n      if (sig !== 0x04034b50) {\n        break;\n      }\n      var file = {};\n      files.push(file);\n      ds.getUint16(true); //バージョン\n      ds.getUint16(true); //ビットフラグ\n      ds.getUint16(true); //圧縮メソッド\n      ds.getUint16(true); //最終変更時間\n      ds.getUint16(true); //最終変更日時\n      ds.getUint32(true); //CRC-32\n      var data_length = ds.getUint32(true); //圧縮サイズ\n      ds.getUint32(true); //非圧縮サイズ\n      var file_name_length = ds.getUint16(true); //ファイル名の長さ\n      ds.getUint16(0, true); //拡張フィールドの長さ\n      file.name = _util_js__WEBPACK_IMPORTED_MODULE_0__[\"default\"].utf8ToString(ds.getBytes(file_name_length)); //ファイル名\n      ds.fill(0x0, 0); //拡張フィールド\n\n      file.data = ds.getBytes(data_length); //ファイルデータ\n\n      //Data descriptor\n      //ds.setUint32(crc,true);//CRC-32\n      //ds.setUint32(filesize,true);//圧縮サイズ\n      //ds.setUint32(filesize,true);//非圧縮サイズ\n    }\n    return files;\n  }\n  static create(_files, compress) {\n    var files = [];\n    var total_size = 0;\n    if (compress == null) {\n      compress = 0;\n    }\n    for (var fi = 0; fi < _files.length; fi++) {\n      var file = {};\n      files.push(file);\n      file.name_utf8 = _util_js__WEBPACK_IMPORTED_MODULE_0__[\"default\"].stringToUtf8(_files[fi].name);\n      file.data = _files[fi].data;\n      file.offset = total_size;\n      file.compress_data_length = file.data.length;\n      file.crc = calcCrc32(file.data);\n      total_size += LOCAL_HEADER_SIZE + file.data.length + file.name_utf8.length;\n    }\n    total_size += CENTRAL_SIZE * files.length + END_SIZE;\n    for (var fi = 0; fi < files.length; fi++) {\n      total_size += files[fi].name_utf8.length;\n    }\n    var ds = new _datastream_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"](total_size);\n    var offset = 0;\n    for (var fi = 0; fi < files.length; fi++) {\n      var file = files[fi];\n      //ローカルファイルヘッダ\n      ds.setUint32(0x04034b50, true); //シグネチャ\n      ds.setUint16(20, true); //バージョン\n      ds.setUint16(0x0, true); //ビットフラグ\n      ds.setUint16(compress, true); //圧縮メソッド\n      var compress_data = file.data;\n      if (compress === 8) {\n        compress_data = Array.from(_deflate_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"].compress(file.data, 1));\n        file.compress_data_length = compress_data.length;\n      }\n      ds.setUint16(0x0, true); //最終変更時間\n      ds.setUint16(0x0, true); //最終変更日時\n      ds.setUint32(file.crc, true); //CRC-32\n      ds.setUint32(file.compress_data_length, true); //圧縮サイズ\n      ds.setUint32(file.data.length, true); //非圧縮サイズ\n      ds.setUint16(file.name_utf8.length, true); //ファイル名の長さ\n      ds.setUint16(0, true); //拡張フィールドの長さ\n      ds.setBytes(file.name_utf8); //ファイル名\n      ds.fill(0x0, 0); //拡張フィールド\n\n      var oldidx = ds.idx;\n      ds.setBytes(compress_data); //ファイルデータ\n      //var filesize=ds.idx-oldidx >>> 3;\n\n      //Data descriptor\n      //ds.setUint32(crc,true);//CRC-32\n      //ds.setUint32(filesize,true);//圧縮サイズ\n      //ds.setUint32(filesize,true);//非圧縮サイズ\n    }\n    var central_idx = ds.getByteIndex();\n    for (var fi = 0; fi < files.length; fi++) {\n      var file = files[fi];\n\n      //セントラルディレクトリエントリ\n      ds.setUint32(0x02014b50, true); //シグネチャ\n      ds.setUint8(20, true); //バージョン\n      ds.setUint8(10, true); //バージョン\n      ds.setUint16(20, true); //最小バージョン\n      ds.setUint16(0x0, true); //ビットフラグ\n      ds.setUint16(compress, true); //圧縮メソッド\n      ds.setUint16(0x0, true); //最終変更時間\n      ds.setUint16(0x0, true); //最終変更日時\n      ds.setUint32(file.crc, true); //CRC-32\n      ds.setUint32(file.compress_data_length, true); //圧縮サイズ\n      ds.setUint32(file.data.length, true); //非圧縮サイズ\n      ds.setUint16(file.name_utf8.length, true); //ファイル名の長さ\n      ds.setUint16(0, true); //拡張フィールドの長さ\n      ds.setUint16(0, true); //ファイルコメントの長さ\n      ds.setUint16(0, true); //ファイルが開始するディスク番号\n      ds.setUint16(0, true); //内部ファイル属性\n      ds.setUint32(0, true); //外部ファイル属性\n      ds.setUint32(file.offset, true); //ローカルファイルヘッダの相対オフセット\n      ds.setBytes(file.name_utf8); //ファイル名\n      ds.fill(0x0, 0); //拡張フィールド\n      ds.fill(0x0, 0); //ファイルコメント\n\n      offset += LOCAL_HEADER_SIZE + file.compress_data_length + file.name_utf8.length;\n    }\n    var central_size = ds.getByteIndex() - central_idx;\n\n    //終端レコード\n    ds.setUint32(0x06054b50, true); //シグネチャ\n    ds.setUint16(0, true); //このディスクの数\n    ds.setUint16(0, true); //セントラルディレクトリが開始するディスク\n    ds.setUint16(files.length, true); //セントラルディレクトリレコードの数\n    ds.setUint16(files.length, true); //セントラルディレクトリレコードの合計数\n    ds.setUint32(central_size, true); //セントラルディレクトリレコードのサイズ\n    ds.setUint32(central_idx, true); //セントラルディレクトリの開始位置のオフセット\n    ds.setUint16(0, true); //コメント長さ\n    ds.setTextBuf(\"\"); //コメント\n\n    return ds.byteBuffer.buffer.slice(0, ds.idx >> 3);\n    //return ds.byteBuffer;\n  }\n}\n\n//# sourceURL=webpack://hdrpaint/./src/lib/zip.js?");

/***/ }),

/***/ "./src/lib/zlib.js":
/*!*************************!*\
  !*** ./src/lib/zlib.js ***!
  \*************************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": function() { return /* binding */ Zlib; }\n/* harmony export */ });\n/* harmony import */ var _deflate_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./deflate.js */ \"./src/lib/deflate.js\");\n\nvar adler32 = function (data) {\n  //パリティ計算\n  var aa = 1,\n    bb = 0;\n  var len = data.length;\n  for (var ai = 0; ai < len;) {\n    var bmax = Math.min(5550, len - ai);\n    for (var bi = 0; bi < bmax; bi++, ai++) {\n      aa += data[ai];\n      bb += aa;\n    }\n    aa %= 65521;\n    bb %= 65521;\n  }\n  return bb * 65536 + aa;\n};\nclass Zlib {\n  constructor() {}\n  static compress(buffer, flg, block) {\n    var header = [];\n    header[0] = (7 << 4) + 8;\n    header[1] = 2 << 6;\n    header[1] += 31 - ((header[0] << 8) + header[1]) % 31;\n    var body = Array.from(_deflate_js__WEBPACK_IMPORTED_MODULE_0__[\"default\"].compress(buffer, flg, block));\n\n    //var check = Deflate.expand(new Uint8Array(body).buffer);\n\n    var ad = adler32(buffer);\n    var footer = new DataView(new ArrayBuffer(4));\n    footer.setUint32(0, ad);\n    footer = Array.from(new Uint8Array(footer.buffer));\n    return header.concat(body).concat(Array.from(footer));\n  }\n  static expand(buffer, offset, length) {\n    var dv = new DataView(buffer);\n    var c = dv.getUint16(0);\n    var adl = dv.getUint32(offset + (length - 4));\n    var data = _deflate_js__WEBPACK_IMPORTED_MODULE_0__[\"default\"].expand(buffer, offset + 2, length - 6);\n    var ad2 = adler32(data);\n    return data;\n  }\n}\n\n//# sourceURL=webpack://hdrpaint/./src/lib/zlib.js?");

/***/ }),

/***/ "./src/main.js":
/*!*********************!*\
  !*** ./src/main.js ***!
  \*********************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./lib/vector.js */ \"./src/lib/vector.js\");\n/* harmony import */ var _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./hdrpaint.js */ \"./src/hdrpaint.js\");\n/* harmony import */ var _lib_slider_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./lib/slider.js */ \"./src/lib/slider.js\");\n/* harmony import */ var _lib_img_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./lib/img.js */ \"./src/lib/img.js\");\n/* harmony import */ var _commandlog_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./commandlog.js */ \"./src/commandlog.js\");\n/* harmony import */ var _file_js__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./file.js */ \"./src/file.js\");\n/* harmony import */ var _redraw_js__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./redraw.js */ \"./src/redraw.js\");\n/* harmony import */ var _penfunc_js__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./penfunc.js */ \"./src/penfunc.js\");\n/* harmony import */ var _brush_js__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./brush.js */ \"./src/brush.js\");\n/* harmony import */ var _penpoint_js__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ./penpoint.js */ \"./src/penpoint.js\");\n/* harmony import */ var _layer_js__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ./layer.js */ \"./src/layer.js\");\n/* harmony import */ var _lib_util_js__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ./lib/util.js */ \"./src/lib/util.js\");\n/* harmony import */ var _lib_colorpickerhdr_js__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ./lib/colorpickerhdr.js */ \"./src/lib/colorpickerhdr.js\");\n/* harmony import */ var _lib_colorselector_js__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ./lib/colorselector.js */ \"./src/lib/colorselector.js\");\n/* harmony import */ var _lib_binder_js__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ./lib/binder.js */ \"./src/lib/binder.js\");\n/* harmony import */ var _lib_watcher_js__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ./lib/watcher.js */ \"./src/lib/watcher.js\");\n/* harmony import */ var _command_copy_js__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! ./command/copy.js */ \"./src/command/copy.js\");\n/* harmony import */ var _command_paste_js__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! ./command/paste.js */ \"./src/command/paste.js\");\n/* harmony import */ var _command_drawLine_js__WEBPACK_IMPORTED_MODULE_18__ = __webpack_require__(/*! ./command/drawLine.js */ \"./src/command/drawLine.js\");\n/* harmony import */ var _command_changeLayerAttribute_js__WEBPACK_IMPORTED_MODULE_19__ = __webpack_require__(/*! ./command/changeLayerAttribute.js */ \"./src/command/changeLayerAttribute.js\");\n/* harmony import */ var _command_changeModifierAttribute_js__WEBPACK_IMPORTED_MODULE_20__ = __webpack_require__(/*! ./command/changeModifierAttribute.js */ \"./src/command/changeModifierAttribute.js\");\n/* harmony import */ var _command_clear_js__WEBPACK_IMPORTED_MODULE_21__ = __webpack_require__(/*! ./command/clear.js */ \"./src/command/clear.js\");\n/* harmony import */ var _command_composite_js__WEBPACK_IMPORTED_MODULE_22__ = __webpack_require__(/*! ./command/composite.js */ \"./src/command/composite.js\");\n/* harmony import */ var _command_createNewLayer_js__WEBPACK_IMPORTED_MODULE_23__ = __webpack_require__(/*! ./command/createNewLayer.js */ \"./src/command/createNewLayer.js\");\n/* harmony import */ var _command_copylayer_js__WEBPACK_IMPORTED_MODULE_24__ = __webpack_require__(/*! ./command/copylayer.js */ \"./src/command/copylayer.js\");\n/* harmony import */ var _command_createmodifier_js__WEBPACK_IMPORTED_MODULE_25__ = __webpack_require__(/*! ./command/createmodifier.js */ \"./src/command/createmodifier.js\");\n/* harmony import */ var _command_deleteLayer_js__WEBPACK_IMPORTED_MODULE_26__ = __webpack_require__(/*! ./command/deleteLayer.js */ \"./src/command/deleteLayer.js\");\n/* harmony import */ var _command_fill_js__WEBPACK_IMPORTED_MODULE_27__ = __webpack_require__(/*! ./command/fill.js */ \"./src/command/fill.js\");\n/* harmony import */ var _command_joinLayer_js__WEBPACK_IMPORTED_MODULE_28__ = __webpack_require__(/*! ./command/joinLayer.js */ \"./src/command/joinLayer.js\");\n/* harmony import */ var _command_loadImage_js__WEBPACK_IMPORTED_MODULE_29__ = __webpack_require__(/*! ./command/loadImage.js */ \"./src/command/loadImage.js\");\n/* harmony import */ var _command_moveLayer_js__WEBPACK_IMPORTED_MODULE_30__ = __webpack_require__(/*! ./command/moveLayer.js */ \"./src/command/moveLayer.js\");\n/* harmony import */ var _command_multiCommand_js__WEBPACK_IMPORTED_MODULE_31__ = __webpack_require__(/*! ./command/multiCommand.js */ \"./src/command/multiCommand.js\");\n/* harmony import */ var _command_resizeCanvas_js__WEBPACK_IMPORTED_MODULE_32__ = __webpack_require__(/*! ./command/resizeCanvas.js */ \"./src/command/resizeCanvas.js\");\n/* harmony import */ var _command_resizeLayer_js__WEBPACK_IMPORTED_MODULE_33__ = __webpack_require__(/*! ./command/resizeLayer.js */ \"./src/command/resizeLayer.js\");\n/* harmony import */ var _command_translate_js__WEBPACK_IMPORTED_MODULE_34__ = __webpack_require__(/*! ./command/translate.js */ \"./src/command/translate.js\");\n/* harmony import */ var _blendfuncs_normal_js__WEBPACK_IMPORTED_MODULE_35__ = __webpack_require__(/*! ./blendfuncs/normal.js */ \"./src/blendfuncs/normal.js\");\n/* harmony import */ var _blendfuncs_mul_js__WEBPACK_IMPORTED_MODULE_36__ = __webpack_require__(/*! ./blendfuncs/mul.js */ \"./src/blendfuncs/mul.js\");\n/* harmony import */ var _blendfuncs_add_js__WEBPACK_IMPORTED_MODULE_37__ = __webpack_require__(/*! ./blendfuncs/add.js */ \"./src/blendfuncs/add.js\");\n/* harmony import */ var _blendfuncs_sub_js__WEBPACK_IMPORTED_MODULE_38__ = __webpack_require__(/*! ./blendfuncs/sub.js */ \"./src/blendfuncs/sub.js\");\n/* harmony import */ var _blendfuncs_transmit_js__WEBPACK_IMPORTED_MODULE_39__ = __webpack_require__(/*! ./blendfuncs/transmit.js */ \"./src/blendfuncs/transmit.js\");\n/* harmony import */ var _modifier_grayscale_js__WEBPACK_IMPORTED_MODULE_40__ = __webpack_require__(/*! ./modifier/grayscale.js */ \"./src/modifier/grayscale.js\");\n/* harmony import */ var _modifier_shift_js__WEBPACK_IMPORTED_MODULE_41__ = __webpack_require__(/*! ./modifier/shift.js */ \"./src/modifier/shift.js\");\n/* harmony import */ var _modifier_blur_js__WEBPACK_IMPORTED_MODULE_42__ = __webpack_require__(/*! ./modifier/blur.js */ \"./src/modifier/blur.js\");\n/* harmony import */ var _modifier_gradient_js__WEBPACK_IMPORTED_MODULE_43__ = __webpack_require__(/*! ./modifier/gradient.js */ \"./src/modifier/gradient.js\");\n/* harmony import */ var _modifier_colormap_js__WEBPACK_IMPORTED_MODULE_44__ = __webpack_require__(/*! ./modifier/colormap.js */ \"./src/modifier/colormap.js\");\n/* harmony import */ var _modifier_noise_js__WEBPACK_IMPORTED_MODULE_45__ = __webpack_require__(/*! ./modifier/noise.js */ \"./src/modifier/noise.js\");\n/* harmony import */ var _modifier_link_js__WEBPACK_IMPORTED_MODULE_46__ = __webpack_require__(/*! ./modifier/link.js */ \"./src/modifier/link.js\");\n/* harmony import */ var _modifier_composite_js__WEBPACK_IMPORTED_MODULE_47__ = __webpack_require__(/*! ./modifier/composite.js */ \"./src/modifier/composite.js\");\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nvar binder = new _lib_binder_js__WEBPACK_IMPORTED_MODULE_14__[\"default\"]();\nwindow.binder = binder;\nvar watcher = new _lib_watcher_js__WEBPACK_IMPORTED_MODULE_15__[\"default\"]();\nwindow.Redraw = _redraw_js__WEBPACK_IMPORTED_MODULE_6__[\"default\"];\nwindow.inputs = [];\nvar shortcuts = [];\nwindow.pen_log = null;\nwindow.pen_func = null;\nwindow.bloomed_img = null;\nwindow.bloom_img = null;\nwindow.preview = null;\nwindow.preview_ctx = null;\nwindow.preview_ctx_imagedata = null;\n\n//コマンド\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n//合成function\n\n\n\n\n\n\n//モデファイア\n\n\n\n\n\n\n\n\nwindow.Brush = _brush_js__WEBPACK_IMPORTED_MODULE_8__[\"default\"];\n_hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].inputs = inputs;\n_hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].doc = {};\n_hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].doc.draw_col = new _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec4();\n_hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].doc.background_color = new _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec4();\n_lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec4.setValues(_hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].doc.background_color, 1, 1, 1, 1);\n_hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].doc.scale = 100;\n_hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].doc.canvas_pos = new _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec2();\n_hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].cursor_pos = new _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec2();\nvar canvas_field;\n\n//最初に全コントロールを配列に入れる\nvar elements = Array.prototype.slice.call(document.getElementsByTagName(\"input\"));\nelements = elements.concat(Array.prototype.slice.call(document.getElementsByTagName(\"select\")));\nelements = elements.concat(Array.prototype.slice.call(document.getElementsByTagName(\"button\")));\nfor (var i = 0; i < elements.length; i++) {\n  var input = elements[i];\n  var id = input.getAttribute(\"id\");\n  inputs[id] = elements[i];\n  var input = inputs[id];\n  if (input.getAttribute(\"shortcut\")) {\n    var shortcut = {};\n    var ka = input.getAttribute(\"shortcut\");\n    if (ka.length === 1) {\n      ka = ka.charCodeAt(0);\n    }\n    shortcut.key = ka;\n    shortcut.command = input;\n    shortcuts.push(shortcut);\n  }\n}\nvar getPos = function (e) {\n  var rect = preview.getBoundingClientRect();\n  _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].cursor_pos[0] = e.clientX - rect.left - 1;\n  _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].cursor_pos[1] = e.clientY - rect.top - 1;\n  _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].cursor_pos[0] *= 100 / _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].doc.scale;\n  _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].cursor_pos[1] *= 100 / _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].doc.scale;\n};\nvar onloadfunc = function (e) {\n  if (_lib_util_js__WEBPACK_IMPORTED_MODULE_11__[\"default\"].getLoadingCount() > 0) {\n    window.setTimeout(onloadfunc, 1000);\n    return;\n  }\n  preview = document.getElementById('preview');\n  preview_ctx = preview.getContext('2d');\n  preview_ctx_imagedata = preview_ctx.createImageData(preview.width, preview.height);\n  window.addEventListener(\"beforeunload\", function (event) {\n    if (_commandlog_js__WEBPACK_IMPORTED_MODULE_4__[\"default\"].command_logs.length > 1) {\n      event.returnValue = '移動前に表示する確認のメッセージ';\n      return false;\n    }\n    return true;\n  });\n\n  //blendfuncセット\n  var layer_blendfunc = document.querySelector(\"#layer_blendfunc\");\n  while (layer_blendfunc.firstChild) {\n    layer_blendfunc.removeChild(layer_blendfunc.firstChild);\n  }\n  for (var i = 0; i < _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].blendfuncsname.length; i++) {\n    var name = _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].blendfuncsname[i];\n    var option = document.createElement(\"option\");\n    option.value = name;\n    _lib_util_js__WEBPACK_IMPORTED_MODULE_11__[\"default\"].setText(option, name);\n    layer_blendfunc.appendChild(option);\n  }\n\n  //ダイアログ閉じる処理\n  //document.querySelector(\".dialog_parent\").addEventListener(\"click\",function(e){\n  //\tif(this !== e.target)return false;\n  //\tHdrpaint.closeDialog();\n  //});\n\n  var keys = Object.keys(inputs);\n  for (var i = 0; i < keys.length; i++) {\n    var key = keys[i];\n    var input = inputs[key];\n    if (input.getAttribute(\"title\") === null) {\n      input.setAttribute(\"title\", key);\n    }\n  }\n  var rag = null;\n  var absolute = new _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec2();\n  var drawfunc = function (e) {\n    //描画関数\n\n    var x = _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].cursor_pos[0];\n    var y = _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].cursor_pos[1];\n    if (e.buttons & 2 || _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].selected_tool === \"color_picker\") {\n      //カラーピッカー\n      var layer_id = _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].root_layer_id;\n      if (inputs[\"selected_layer_only\"].checked) {\n        layer_id = _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].selected_layer_id;\n      }\n      var img = hdrpaint.getLayerById(layer_id).img;\n      if (x < 0 || x >= img.width || y < 0 || y > img.height) {} else {\n        var data = img.data;\n        var idx = ((y | 0) * img.width + (x | 0)) * 4;\n        selectorhdr.R_txt.value = data[idx];\n        selectorhdr.G_txt.value = data[idx + 1];\n        selectorhdr.B_txt.value = data[idx + 2];\n        selectorhdr.A_txt.value = data[idx + 3];\n        _lib_util_js__WEBPACK_IMPORTED_MODULE_11__[\"default\"].fireEvent(selectorhdr.A_txt, \"change\");\n      }\n      return;\n    }\n    if (_hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].selected_tool === \"rectangle\") {\n      if (!(e.buttons & 1)) {\n        return;\n      }\n      //矩形選択時\n      var rectangle = _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].select_rectangle;\n      var x2 = Math.floor(x);\n      var y2 = Math.floor(y);\n      if (_hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].mode === \"areamove\") {\n        rectangle.x += -drag_start[0] + x2;\n        rectangle.y += -drag_start[1] + y2;\n        drag_start[0] = x2;\n        drag_start[1] = y2;\n      } else {\n        if (!rectangle) {\n          rectangle = {\n            x: 0,\n            y: 0,\n            w: 0,\n            h: 0\n          };\n          _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].select_rectangle = rectangle;\n        }\n        rectangle.x = Math.min(drag_start[0], x2);\n        rectangle.y = Math.min(drag_start[1], y2);\n        rectangle.w = Math.abs(drag_start[0] - x2);\n        rectangle.h = Math.abs(drag_start[1] - y2);\n      }\n    } else if (_hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].selected_tool === \"pen\") {\n      //inputs[\"pen\"].checked){\n      //ペンのとき\n      if (!pen_log) return;\n      var point = new _penpoint_js__WEBPACK_IMPORTED_MODULE_9__[\"default\"]();\n      var layer = hdrpaint.getLayerById(hdrpaint.selected_layer_id);\n      var vec3 = new _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3(x, y, 0);\n      layer.toRelative(vec3);\n      point.pos[0] = vec3[0];\n      point.pos[1] = vec3[1];\n      if (e.buttons & 1) {\n        if (e.pointerType === \"mouse\") {\n          point.pressure = 1;\n        } else {\n          point.pressure = e.pressure;\n        }\n      } else {\n        point.pressure = 0;\n      }\n      var points = pen_log.obj.param.points;\n\n      //今回座標をパスに追加\n      point.time = Date.now();\n      points.push(point);\n      if (inputs[\"stroke_correction\"].checked) {\n        if (points.length >= 3 && pen_func.idx < points.length - 2) {\n          var buf = new _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec2();\n          _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec2.sub(buf, points[points.length - 2].pos, points[points.length - 3].pos);\n          var a = _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec2.scalar(buf);\n          if (a > 20) {\n            _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec2.norm(buf);\n            _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec2.mul(buf, buf, a - 20);\n          }\n          _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec2.add(points[points.length - 2].pos, points[points.length - 3].pos, buf);\n        }\n      }\n      if (!(e.buttons & 1)) {\n        //描画前ポイントを補正\n        var points = pen_log.obj.param.points;\n        if (pen_func.idx + 1 < points.length) {\n          var len = points.length - (pen_func.idx + 1);\n          var a = points[pen_func.idx].pressure;\n          var b = points[points.length - 1].pressure;\n          for (var pi = pen_func.idx + 1; pi < points.length; pi++) {\n            var r = (pi - pen_func.idx) / len;\n            points[pi].pressure = a + (b - a) * r;\n          }\n        }\n      }\n      if (!(e.buttons & 1)) {\n        pen_func.end();\n        point.pressure = 0;\n        pen_log = null;\n      }\n      pen_func.actualDraw();\n    } else if (_hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].selected_tool === \"translate\") {\n      if (!(e.buttons & 1)) {\n        pen_log = null;\n      } else if (pen_log) {\n        //移動のとき\n\n        if (pen_log.obj.name === \"translateLayer\") {\n          var oldx = pen_log.obj.param.x;\n          var oldy = pen_log.obj.param.y;\n          x = (x | 0) - drag_start[0];\n          y = (y | 0) - drag_start[1];\n\n          //一旦元の座標に戻してから再度移動させる\n          pen_log.obj.undo();\n          //pen_log.obj.param.x=x-oldx;\n          //pen_log.obj.param.y=y-oldy;\n          pen_log.obj.param.x = x;\n          pen_log.obj.param.y = y;\n          pen_log.obj.func();\n          pen_log.refreshLabel();\n          //CommandLog.appendOption();\n        } else if (pen_log.obj.name === \"changeLayerAttribute\") {\n          var layer = hdrpaint.getLayerById(pen_log.obj.param.layer_id);\n          if (pen_log.obj.param.name[0] === 'angle') {\n            var x = _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].cursor_pos[0];\n            var y = _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].cursor_pos[1];\n            var vec3 = new _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3(x, y, 0);\n            var parent_layer = hdrpaint.getLayerById(layer.parent);\n            parent_layer.toRelative(vec3);\n            pen_log.obj.param.value = [Math.atan2(vec3[1] - layer.height * 0.5, vec3[0] - layer.width * 0.5) * (360 / (Math.PI * 2)) - pen_log.obj.param.offset];\n          } else {\n            var x = _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].cursor_pos[0];\n            var y = _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].cursor_pos[1];\n            var vec3 = new _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3(x, y, 0);\n            var parent_layer = hdrpaint.getLayerById(layer.parent);\n            x = vec3[0];\n            y = vec3[1];\n            layer.scale[0] = 1;\n            layer.scale[1] = 1;\n            layer.toRelative(vec3);\n            x = (vec3[0] - pen_log.obj.param.offsetx - layer.width * 0.5) / (layer.width * 0.5);\n            y = (vec3[1] - pen_log.obj.param.offsety - layer.height * 0.5) / (layer.height * 0.5);\n            if (!pen_log.obj.param.areax) {\n              x = pen_log.obj.undo_data.value[0];\n            } else {\n              x *= pen_log.obj.param.areax;\n            }\n            if (!pen_log.obj.param.areay) {\n              y = pen_log.obj.undo_data.value[1];\n            } else {\n              y *= pen_log.obj.param.areay;\n            }\n            //一旦元の座標に戻してから再度移動させる\n            pen_log.obj.param.value = [x, y];\n          }\n          pen_log.obj.func();\n          pen_log.refreshLabel();\n          //CommandLog.appendOption();\n        }\n      }\n    }\n  };\n  inputs[\"background_color\"].addEventListener(\"change\", function (e) {\n    var sp = this.value.split(\",\");\n    var rgb = _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].doc.background_color;\n    rgb[0] = Number(sp[0]);\n    rgb[1] = Number(sp[1]);\n    rgb[2] = Number(sp[2]);\n    rgb[3] = Number(sp[3]);\n    _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].root_layer.composite();\n  });\n  window.addEventListener(\"pointerup\", function (e) {\n    getPos(e);\n    if (pen_log) {\n      drawfunc(e);\n      e.preventDefault();\n    }\n    _layer_js__WEBPACK_IMPORTED_MODULE_10__[\"default\"].enableRefreshThumbnail = true;\n  });\n  var drag_start = new _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec2();\n  var canvas_field = document.querySelector(\"#canvas_field\");\n  canvas_field.addEventListener(\"pointermove\", function (e) {\n    getPos(e);\n    //Redraw.refreshPreviewStatus(e);\n    if (e.buttons) {\n      drawfunc(e);\n      e.preventDefault();\n    }\n  });\n  preview.addEventListener(\"contextmenu\", function (e) {\n    event.preventDefault();\n  }, false);\n  var handle_field = document.querySelector(\"#handles\");\n  var func_name = \"\";\n  handle_field.addEventListener(\"pointerdown\", function (e) {\n    if (!(e.buttons & 1)) {\n      return;\n    }\n    getPos(e);\n    var x = _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].cursor_pos[0];\n    var y = _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].cursor_pos[1];\n    drag_start[0] = x;\n    drag_start[1] = y;\n    _layer_js__WEBPACK_IMPORTED_MODULE_10__[\"default\"].enableRefreshThumbnail = false;\n    if (_hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].selected_layer === null) {\n      return;\n    }\n    //レイヤ位置移動\n    drag_start[0] = x | 0;\n    drag_start[1] = y | 0;\n    var layer_id = -1; //全レイヤ移動\n    var flg_active_layer_only = inputs[\"selected_layer_only\"].checked;\n    //if(flg_active_layer_only){\n    //アクティブレイヤ\n    layer_id = _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].selected_layer.id;\n    //}\n    //\n    var layer = hdrpaint.getLayerById(layer_id);\n    if (e.target.id == \"handles\") {\n      pen_log = _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].executeCommand(\"translateLayer\", {\n        \"layer_id\": layer_id,\n        \"x\": 0,\n        \"y\": 0\n      });\n    } else if (e.target.id == \"rotate\") {\n      pen_log = _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].executeCommand(\"changeLayerAttribute\", {\n        \"layer_id\": layer_id,\n        \"name\": [\"angle\"],\n        \"value\": [layer.angle]\n      });\n      var x = _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].cursor_pos[0];\n      var y = _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].cursor_pos[1];\n      var vec3 = new _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3(x, y, 0);\n      var parent_layer = hdrpaint.getLayerById(layer.parent);\n      parent_layer.toRelative(vec3);\n      pen_log.obj.param.offset = Math.atan2(vec3[1] - layer.height * 0.5, vec3[0] - layer.width * 0.5) * (360 / (Math.PI * 2)) - layer.angle;\n    } else {\n      pen_log = _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].executeCommand(\"changeLayerAttribute\", {\n        \"layer_id\": layer_id,\n        \"name\": [\"scale.0\", \"scale.1\"],\n        \"value\": [layer.scale[0], layer.scale[1]]\n      });\n      var x = _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].cursor_pos[0];\n      var y = _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].cursor_pos[1];\n      var vec3 = new _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec3(x, y, 0);\n      var parent_layer = hdrpaint.getLayerById(layer.parent);\n      layer.toRelative(vec3);\n      pen_log.obj.param.offsetx = vec3[0] - layer.width;\n      pen_log.obj.param.offsety = vec3[1] - layer.height;\n      if (e.target.id == \"right_down\") {\n        pen_log.obj.param.areax = 1;\n        pen_log.obj.param.areay = 1;\n      }\n      if (e.target.id == \"right\") {\n        pen_log.obj.param.areax = 1;\n        pen_log.obj.param.areay = 0;\n      }\n      if (e.target.id == \"down\") {\n        pen_log.obj.param.areax = 0;\n        pen_log.obj.param.areay = 1;\n      }\n      pen_log.obj.func();\n    }\n    e.stopPropagation();\n  });\n  canvas_field.addEventListener(\"pointerdown\", function (e) {\n    if (e.buttons & 4) {\n      //キャンバス移動\n      oldpos[0] = e.pageX;\n      oldpos[1] = e.pageY;\n      e.preventDefault();\n    }\n    getPos(e);\n    var x = _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].cursor_pos[0];\n    var y = _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].cursor_pos[1];\n    drag_start[0] = x;\n    drag_start[1] = y;\n    _layer_js__WEBPACK_IMPORTED_MODULE_10__[\"default\"].enableRefreshThumbnail = false;\n    if (_hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].selected_layer === null) {\n      return;\n    }\n    _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].mode = \"\";\n    if (_hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].selected_tool === \"rectangle\" && e.buttons & 1) {\n      var rectangle = _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].select_rectangle;\n      x = Math.floor(x);\n      y = Math.floor(y);\n      if (_hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].select_rectangle) {\n        if (x >= rectangle.x && x < rectangle.x + rectangle.w && y >= rectangle.y && y < rectangle.y + rectangle.h) {\n          //選択領域内で押下された場合は移動モードにする\n          _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].mode = \"areamove\";\n          return;\n        }\n      }\n      _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].mode = \"areaselect\";\n      _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].select_rectangle = null;\n      var rect = document.querySelector(\".select_rectangle\");\n      rect.style.display = \"none\";\n      return;\n    } else if (_hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].selected_tool === \"fill\" && e.buttons & 1) {\n      if (_hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].selected_layer.type === 1) {\n        return;\n      }\n      //塗りつぶし\n\n      var joined_img = _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].root_layer.img;\n      if (x < 0 || x >= joined_img.width || y < 0 || y >= joined_img.height) {\n        //範囲外は無視\n        return;\n      }\n      var layer = _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].selected_layer;\n      //Hdrpaint.selected_layer.getAbsolutePosition(absolute);\n      //x -= absolute[0];\n      //y -= absolute[1];\n      if (x < 0 || x >= layer.width || y < 0 || y >= layer.height) {\n        //範囲外は無視\n        return;\n      }\n      var color = new Float32Array(4);\n      _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec4.copy(color, _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].color);\n      var flg_active_layer_only = inputs[\"selected_layer_only\"].checked;\n      _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].executeCommand(\"fill\", {\n        \"layer_id\": _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].selected_layer.id,\n        \"x\": x,\n        \"y\": y,\n        \"color\": color,\n        \"is_layer\": flg_active_layer_only\n      });\n    } else if (_hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].selected_tool === \"pen\" && e.buttons & 1) {\n      //ペンもしくは消しゴム\n      if (_hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].selected_layer.type !== 0) {\n        //通常レイヤ以外は無効\n        return;\n      }\n      if (_hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].selected_layer.mask_alpha && inputs[\"eraser\"].checked) {\n        //アルファマスクありで消しゴムの場合無視\n        return;\n      }\n\n      //ペン状態取得\n\n      var param = {};\n      _brush_js__WEBPACK_IMPORTED_MODULE_8__[\"default\"].setParam(param);\n      param.alpha_mask = _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].selected_layer.mask_alpha;\n      param.points = [];\n      param.img_id = _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].selected_layer.img_id;\n      pen_log = _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].executeCommand(\"brush\", param);\n      if (pen_log) {\n        pen_func = new _penfunc_js__WEBPACK_IMPORTED_MODULE_7__[\"default\"]();\n        pen_func.pen_log = pen_log;\n        if (inputs[\"stroke_correction\"].checked) {\n          pen_func.ragtime = 40;\n        } else {\n          pen_func.ragtime = 18;\n        }\n        drawfunc(e);\n      }\n    }\n    drawfunc(e);\n  }, false);\n  inputs[\"history\"].addEventListener('change', function (event) {\n    var index = this.selectedIndex;\n    var option = this.options[index];\n    _commandlog_js__WEBPACK_IMPORTED_MODULE_4__[\"default\"].moveLog(parseInt(option.value));\n  });\n  var ctrlkey;\n  document.addEventListener('keyup', function (event) {\n    if (event.keyCode == 17) {\n      ctrlkey = false;\n    }\n    switch (event.keyCode) {\n      case 81:\n        //q\n        if (old_tool) {\n          _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].selected_tool = old_tool;\n          old_tool = null;\n        }\n        break;\n      //case 32://space\n      case 87:\n        //w\n        //flg_active_layer_only=false;\n        _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].selected_layer_only = false;\n      //\tinputs[\"selected_layer_only\"].checked=false;\n      //\tUtil.fireEvent(inputs[\"selected_layer_only\"],\"change\");\n    }\n  });\n  var old_tool = null;\n  document.addEventListener('keydown', async function (event) {\n    if (event.ctrlKey) {\n      ctrlkey = true;\n    }\n    var keycode = event.keyCode;\n    if (!event.shiftKey && keycode <= 96 && keycode >= 65) {\n      keycode += 32;\n    }\n\n    //キーショートカット\n    if (event.target.tagName === \"INPUT\") {\n      if (event.target.type === \"text\") {\n        return;\n      }\n    }\n    var shortcut = shortcuts.find(a => {\n      return a.key === keycode;\n    });\n    if (shortcut) {\n      var command = shortcut.command;\n      if (command.nodeName === \"INPUT\") {\n        if (command.type === \"checkbox\" || command.type === \"radio\") {\n          command.checked = true;\n        }\n        _lib_util_js__WEBPACK_IMPORTED_MODULE_11__[\"default\"].fireEvent(command, \"change\");\n      }\n      return;\n    }\n    for (var bi = 0; bi < _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].brushes.length; bi++) {\n      var brush = _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].brushes[bi];\n      if (!brush.shortcut) continue;\n      var shortcut = brush.shortcut.charCodeAt(0);\n      if (shortcut === keycode) {\n        brush.select();\n        return;\n      }\n    }\n    switch (keycode) {\n      case 113:\n        //q\n        if (!old_tool) {\n          old_tool = _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].selected_tool;\n        }\n        _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].selected_tool = \"color_picker\";\n        break;\n      case 82:\n        //R\n        _redraw_js__WEBPACK_IMPORTED_MODULE_6__[\"default\"].compositeAll();\n        break;\n      case 99:\n        //c\n        if (event.ctrlKey) {\n          //コピー\n          var range = _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].getSelectArea();\n          var src_layer = _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].selected_layer;\n          var img = new _lib_img_js__WEBPACK_IMPORTED_MODULE_3__[\"default\"](range.w, range.h);\n          _lib_img_js__WEBPACK_IMPORTED_MODULE_3__[\"default\"].copy(img, 0, 0, src_layer.img, range.x, range.y, range.w, range.h);\n          _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].clipboard = img;\n        }\n        break;\n      case 118 - 32:\n        //V\n        //クリップボードからペースト\n        navigator.clipboard.read().then(async data => {\n          if (data.length === 0) return;\n          for (let i = 0; i < data[0].types.length; i++) {\n            const blob = await data[0].getType(\"image/png\");\n            if (!blob) break;\n            var file = new File([blob], \"paste.png\", {\n              type: \"image/png\"\n            });\n            //var imageFile = data.getAsFile();\n            _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].loadImageFile_(file);\n            break;\n          }\n        });\n\n        //var imageFile = data.getAsFile();\n        //Hdrpaint.loadImageFile_(imageFile);\n        event.preventDefault();\n        break;\n      case 118:\n        //v\n        if (event.ctrlKey) {\n          //ペースト\n          var data = _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].getPosition();\n          _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].executeCommand(\"paste\", {\n            \"position\": data.position,\n            \"parent\": data.parent_layer.id\n          });\n        }\n        break;\n      case 120:\n        //x\n        if (event.ctrlKey) {\n          //カット\n          var src_layer = _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].selected_layer;\n          var range = _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].getSelectArea();\n          var img = new _lib_img_js__WEBPACK_IMPORTED_MODULE_3__[\"default\"](range.w, range.h);\n          _lib_img_js__WEBPACK_IMPORTED_MODULE_3__[\"default\"].copy(img, 0, 0, src_layer.img, range.x, range.y, range.w, range.h);\n          _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].clipboard = img;\n          var data = _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].getPosition();\n          var rectangle = _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].getSelectArea();\n          //Hdrpaint.executeCommand(\"copy\",{\"position\":data.position,\"parent\":data.parent_layer.id,\"src_layer_id\":Hdrpaint.selected_layer.id,range:rectangle});\n\n          //選択範囲をクリア\n          _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].executeCommand(\"clear\", {\n            \"layer_id\": _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].selected_layer.id,\n            \"range\": range\n          });\n        }\n        break;\n      case 122 - 32:\n        //Z\n        if (event.ctrlKey) {\n          //リドゥ\n          _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].redo();\n        }\n        event.preventDefault();\n        break;\n      case 122:\n        //z\n        if (event.ctrlKey) {\n          if (event.shiftKey) {\n            //リドゥ\n            _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].redo();\n          } else {\n            //アンドゥ\n            _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].undo();\n          }\n        }\n        event.preventDefault();\n        break;\n      case 46:\n        //delete\n        if (_hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].selected_layer.type !== 0) {\n          //通常レイヤ以外は無視\n          break;\n        }\n        var rectangle = _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].getSelectArea();\n\n        //選択範囲をクリア\n        _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].executeCommand(\"clear\", {\n          \"layer_id\": _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].selected_layer.id,\n          range: rectangle\n        });\n        break;\n      case 119:\n        //w\n        _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].selected_layer_only = true;\n        break;\n    }\n  });\n  window.changeGamma = function (arg) {\n    _redraw_js__WEBPACK_IMPORTED_MODULE_6__[\"default\"].refreshPreview(2);\n    _layer_js__WEBPACK_IMPORTED_MODULE_10__[\"default\"].eachLayers(function (layer) {\n      layer.registRefreshThumbnail();\n    });\n  };\n  var resizeCanvas = function () {\n    var width = parseInt(inputs[\"canvas_width\"].value);\n    var height = parseInt(inputs[\"canvas_height\"].value);\n    _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].executeCommand(\"resizeCanvas\", {\n      \"width\": width,\n      \"height\": height\n    });\n  };\n  inputs[\"canvas_width\"].addEventListener(\"change\", resizeCanvas);\n  inputs[\"canvas_height\"].addEventListener(\"change\", resizeCanvas);\n  inputs[\"btn_resize_layer\"].addEventListener(\"click\", function (e) {\n    var width = parseInt(preview.width);\n    var height = parseInt(preview.height);\n    _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].executeCommand(\"resizeLayer\", {\n      \"layer_id\": _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].selected_layer.id,\n      \"width\": width,\n      \"height\": height\n    });\n  });\n  inputs[\"btn_resize_layers\"].addEventListener(\"click\", function (e) {\n    var width = parseInt(preview.width);\n    var height = parseInt(preview.height);\n    _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].executeCommand(\"resizeLayer\", {\n      \"layer_id\": -1,\n      \"width\": width,\n      \"height\": height\n    });\n  });\n  inputs[\"open_layer\"].addEventListener(\"change\", function (e) {\n    var file = this.files[0];\n    if (file) {\n      _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].loadImageFile_(file);\n    }\n    this.value = null;\n  });\n  document.getElementById(\"open_hpd\").addEventListener(\"click\", function (e) {\n    var file_hpd = inputs['file_hpd'];\n    file_hpd.onchange = function () {\n      var file = file_hpd.files[0];\n      _file_js__WEBPACK_IMPORTED_MODULE_5__[\"default\"].loadHpd(file);\n      //\t\tUtil.loadBinary(file,function(buffer){\n      //\t\t\tloadHpd(buffer);\n      //\t\t\tvar log =CommandLog.createLog(\"loadDocumentFile\",{\"file\":file.name});\n      //\t\t\tCommandLog.appendOption(log);\n      //\t\t});\n      file_hpd.value = null;\n    };\n    file_hpd.click();\n    e.preventDefault();\n    return false;\n  });\n  document.getElementById(\"add_brush\").addEventListener(\"click\", function (e) {\n    var file_hpd = inputs['file_hpd'];\n    file_hpd.onchange = function () {\n      var file = file_hpd.files[0];\n      _lib_util_js__WEBPACK_IMPORTED_MODULE_11__[\"default\"].loadBinary(file, function (buffer) {\n        addBrush(buffer);\n      });\n      file_hpd.value = null;\n    };\n    file_hpd.click();\n    e.preventDefault();\n    return false;\n  });\n  var layerMove = function (delta) {\n    if (!_hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].selected_layer) {\n      return;\n    }\n    var layer_id = _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].selected_layer_id;\n    var layer = hdrpaint.getLayerById(layer_id);\n    var parent_layer = hdrpaint.getLayerById(layer.parent);\n    var children = parent_layer.children;\n    var position = children.indexOf(layer_id);\n    position += delta;\n    if (position >= children.length || position < 0) {\n      return;\n    }\n    _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].executeCommand(\"moveLayer\", {\n      \"layer_id\": layer_id,\n      \"parent_layer_id\": parent_layer.id,\n      \"position\": position\n    });\n  };\n  inputs[\"down_layer\"].addEventListener(\"click\", function (e) {\n    layerMove(-1);\n  });\n  inputs[\"up_layer\"].addEventListener(\"click\", function (e) {\n    layerMove(1);\n  });\n\n  //レイヤ結合ボタン押下時\n  inputs[\"join_layer\"].addEventListener(\"click\", function (e) {\n    if (_hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].selected_layer.type === 1) {\n      _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].executeCommand(\"composite\", {\n        \"layer_id\": _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].selected_layer.id\n      });\n      return;\n    }\n    var parent_layer = _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].selected_layer.parent;\n    var position = parent_layer.children.indexOf(_hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].selected_layer);\n    if (position === 0) {\n      return;\n    }\n    if (parent_layer.children[position - 1].type === 1) {\n      return;\n    }\n    var id2 = parent_layer.children[position - 1].id;\n    _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].executeCommand(\"joinLayer\", {\n      \"layer_id\": id2,\n      \"layer_id2\": _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].selected_layer.id\n    });\n  });\n  inputs[\"delete_layer\"].addEventListener(\"click\", function (e) {\n    _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].executeCommand(\"deleteLayer\", {\n      \"layer_id\": _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].selected_layer.id\n    });\n  });\n  var oldpos = new _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec2();\n  canvas_field = document.getElementById(\"canvas_field\");\n  var canvas_area = document.getElementById(\"canvas_area\");\n  //canvas_area.addEventListener(\"paste\", function(e){\n  //\t//navigator.clipboard.write(data);\n  //\t//if(Hdrpaint.floating_layer){\n\n  //\t//\tvar data =Hdrpaint.getPosition();\n  //\t//\tHdrpaint.executeCommand(\"paste\",{\"position\":data.position,\"parent\":data.parent_layer.id});\n  //\t//}else{\n  //\t//\n  //\t//\n  //\t\tvar data =null;\n\n  //\t\tfor(var i=0;i<navigator.clipboard.types.length;i++){\n  //\t\t\tif(navigator.clipboard.types[i] ===\"Files\"){\n  //\t\t\t\tdata = e.clipboardData.items[i];\n  //\t\t\t\tbreak;\n  //\t\t\t}\n  //\t\t}\n  //\t\tif(!data){\n  //\t\t\treturn true;\n  //\t\t}\n  //\t\t\n  //\t\tvar imageFile = data.getAsFile();\n  //\t\tHdrpaint.loadImageFile_(imageFile);\n  //\t//}\n  //});\n  canvas_area.addEventListener(\"copy\", function (e) {\n    //OSのクリップボードにSDR結合画像をコピー\n    const selection = document.getSelection();\n    var url = _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].root_layer.img.toBlob(blob => {\n      let data = [new ClipboardItem({\n        [blob.type]: blob\n      })];\n      navigator.clipboard.write(data);\n    }, \"image/png\");\n    event.preventDefault();\n  });\n\n  //レイヤパラメータコントロール変更時反映\n  document.querySelector(\"#layer_param\").addEventListener(\"change\", function (e) {\n    var input = e.target;\n    if (!_hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].selected_layer) {\n      return;\n    }\n    if (!input) {\n      return;\n    }\n    var layer = _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].selected_layer;\n    //var member = input.id.replace(\"layer_\",\"\");\n    var member = input.getAttribute(\"name\");\n    //var member = input.name;\n    if (input.getAttribute(\"type\") === \"radio\") {\n      member = input.name;\n    }\n    if (member === \"\") {\n      member = input.title;\n    }\n    var value;\n    if (input.getAttribute(\"type\") === \"checkbox\") {\n      value = input.checked;\n    } else {\n      value = input.value;\n    }\n    if (input.hasAttribute(\"number\")) {\n      value = Number(value);\n    }\n    var int_val = parseInt(value);\n    switch (member) {\n      case \"width\":\n        _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].executeCommand(\"resizeLayer\", {\n          \"layer_id\": layer.id,\n          \"width\": int_val,\n          \"height\": layer.height\n        });\n        break;\n      case \"height\":\n        _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].executeCommand(\"resizeLayer\", {\n          \"layer_id\": layer.id,\n          \"width\": layer.width,\n          \"height\": int_val\n        });\n        break;\n      default:\n        _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].executeCommand(\"changeLayerAttribute\", {\n          \"layer_id\": layer.id,\n          \"name\": member,\n          \"value\": value\n        });\n    }\n  });\n  function arrayToBase64(array) {\n    return btoa(String.fromCharCode(...array));\n  }\n  function base64ToArray(base64) {\n    var binary = atob(base64);\n    var len = binary.length;\n    var bytes = new Uint8Array(len);\n    for (var i = 0; i < len; i++) {\n      bytes[i] = binary.charCodeAt(i);\n    }\n    return bytes;\n  }\n  function dataURIConverter(dataURI) {\n    // base64/URLEncodedデータを文字列としてバイナリデータに変換する\n    var buffer = base64ToArray(dataURI.split(',')[1]);\n\n    // mimetypeを抜き出す\n    var mimeType = dataURI.split(',')[0].split(':')[1].split(';')[0];\n\n    // 第一引数は配列で渡し、Fileオブジェクトを返す。\n    return new File([buffer], 'ファイル名', {\n      type: mimeType\n    });\n  }\n  canvas_field.addEventListener(\"pointermove\", function (e) {\n    if (e.buttons & 4) {\n      //中ボタンドラッグでキャンバス移動\n      //c.scrollLeft-=e.pageX-oldpos[0];\n      //c.scrollTop-=e.pageY-oldpos[1];\n      var doc = _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].doc;\n      doc.canvas_pos[0] += e.pageX - oldpos[0];\n      doc.canvas_pos[1] += e.pageY - oldpos[1];\n      var c = document.getElementById(\"canvas_field\");\n      var spacer = document.getElementById(\"spcaer\");\n      if (doc.canvas_pos[0] < 0) {\n        //\tc.scrollLeft-=doc.canvas_pos[0];\n        doc.canvas_pos[0] = 0;\n      }\n      if (doc.canvas_pos[1] < 0) {\n        doc.canvas_pos[1] = 0;\n      }\n      preview.style.left = doc.canvas_pos[0] + \"px\";\n      preview.style.top = doc.canvas_pos[1] + \"px\";\n      oldpos[0] = e.pageX;\n      oldpos[1] = e.pageY;\n    }\n  });\n  document.getElementById(\"canvas_area\").addEventListener(\"wheel\", function (e) {\n    if (!e.ctrlKey) {\n      return;\n    }\n    var doc = _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].doc;\n    var add = 0;\n    e.preventDefault();\n    if (e.buttons & 4) {\n      return;\n    }\n    if (event.deltaY > 0) {\n      if (doc.scale <= 100) {\n        doc.scale /= 2;\n      } else {\n        doc.scale -= 100;\n      }\n    } else {\n      if (doc.scale <= 100) {\n        doc.scale *= 2;\n      } else {\n        doc.scale += 100;\n      }\n    }\n    if (doc.scale < 25) {\n      doc.scale = 25;\n    }\n    if (doc.scale > 2000) {\n      doc.scale = 2000;\n    }\n    if (doc.scale > 100) {\n      preview.style.imageRendering = \"pixelated\";\n    } else {\n      preview.style.imageRendering = \"auto\";\n    }\n    var cx = canvas_field.scrollX + canvas_field.clientWidth / 2;\n    var cy = canvas_field.scrollY + canvas_field.clientHeight / 2;\n    preview.style.width = preview.width * doc.scale / 100 + \"px\";\n    preview.style.height = preview.height * doc.scale / 100 + \"px\";\n\n    //Redraw.refreshPreviewStatus(e);\n  });\n  var a = document.getElementById(\"save_hpd\");\n  a.addEventListener(\"contextmenu\", _file_js__WEBPACK_IMPORTED_MODULE_5__[\"default\"].saveHpd);\n  a.addEventListener(\"click\", _file_js__WEBPACK_IMPORTED_MODULE_5__[\"default\"].saveHpd);\n  a = document.getElementById(\"save_ldr\");\n  a.addEventListener(\"contextmenu\", _file_js__WEBPACK_IMPORTED_MODULE_5__[\"default\"].saveLdr);\n  a.addEventListener(\"click\", _file_js__WEBPACK_IMPORTED_MODULE_5__[\"default\"].saveLdr);\n  a = document.getElementById(\"save_hdr\");\n  a.addEventListener(\"contextmenu\", _file_js__WEBPACK_IMPORTED_MODULE_5__[\"default\"].saveHdr);\n  a.addEventListener(\"click\", _file_js__WEBPACK_IMPORTED_MODULE_5__[\"default\"].saveHdr);\n  var url = location.search.substring(1, location.search.length);\n  var args = url.split(\"&\");\n  _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec4.setValues(_hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].doc.draw_col, 0.8, 0.2, 0.2, 1);\n  for (i = args.length; i--;) {\n    var arg = args[i].split(\"=\");\n    if (arg.length > 1) {\n      var name = arg[0];\n      if (!isNaN(arg[1]) && arg[1] != \"\") {\n        if (arg[1].length > 1 && arg[1].indexOf(0) == \"0\") {\n          globalParam[name] = arg[1];\n        } else {\n          globalParam[name] = +arg[1];\n        }\n      } else {\n        globalParam[name] = arg[1];\n      }\n    }\n    if (inputs.hasOwnProperty(name)) {\n      if ((inputs[name].type == \"checkbox\" || inputs[name].type == \"radio\") && globalParam[name]) {\n        inputs[name].checked = true;\n      } else {\n        inputs[name].value = globalParam[name];\n      }\n      _lib_util_js__WEBPACK_IMPORTED_MODULE_11__[\"default\"].fireEvent(inputs[name], \"input\");\n    }\n  }\n  if (globalParam.hasOwnProperty(\"file\")) {\n    //パラメタ渡されてる場合はそれ開く\n\n    _file_js__WEBPACK_IMPORTED_MODULE_5__[\"default\"].loadHpd(globalParam.file);\n    //Util.loadBinary(globalParam.file,function(buffer){\n    //\tloadHpd(buffer);\n    //});\n  } else {\n    //Hdrpaint.executeCommand(\"resizeLayer\",{\"layer_id\":root_layer.id,\"width\":512,\"height\":512});\n    //Hdrpaint.executeCommand(\"createNewLayer\",{\"position\":0,\"parent\":0,\"width\":512,\"height\":512,\"composite_flg\":1});\n    hdrpaint.executeCommand(\"createmodifier\", {\n      \"modifier\": \"composite\",\n      \"parent_layer_id\": -1,\n      \"width\": 512,\n      \"height\": 512\n    });\n    _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].executeCommand(\"resizeCanvas\", {\n      \"width\": 512,\n      \"height\": 512\n    });\n    var canvas_field = document.querySelector(\"#canvas_field\");\n    _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].doc.canvas_pos[0] = canvas_field.clientWidth - 512 >> 1;\n    _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].doc.canvas_pos[1] = canvas_field.clientHeight - 512 >> 1;\n    preview.style.left = _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].doc.canvas_pos[0] + \"px\";\n    preview.style.top = _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].doc.canvas_pos[1] + \"px\";\n    _commandlog_js__WEBPACK_IMPORTED_MODULE_4__[\"default\"].reset();\n    _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].executeCommand(\"createNewLayer\", {\n      \"position\": 0,\n      \"parent\": _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].root_layer.id,\n      \"width\": preview.width,\n      \"height\": preview.height\n    });\n    var layer = hdrpaint.getLayerById(hdrpaint.root_layer.children[0]);\n    layer.name = \"default\";\n    layer.refreshDiv();\n    layer.registRefreshThumbnail();\n    hdrpaint.root_layer.refreshDiv();\n  }\n  binder.bind(document.querySelector(\"#status2\"), \"\", _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"], [\"cursor_pos\", \"cursor_pos\", \"doc.scale\"], v => {\n    var root_layer = hdrpaint.root_layer;\n    var img = root_layer.img;\n    var data = img.data;\n    var width = img.width;\n    var height = img.height;\n    if (v[0] < 0 || v[1] < 0 || v[0] >= width || v[1] >= height) {\n      _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].cursor_color[0] = NaN;\n      _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].cursor_color[1] = NaN;\n      _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].cursor_color[2] = NaN;\n      _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].cursor_color[3] = NaN;\n      return \"倍率:\";\n      v[2] + \" X:- Y:-\";\n    }\n    var idx = img.getIndex(v[0] | 0, v[1] | 0) << 2;\n    _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].cursor_color[0] = data[idx];\n    _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].cursor_color[1] = data[idx + 1];\n    _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].cursor_color[2] = data[idx + 2];\n    _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].cursor_color[3] = data[idx + 3];\n    return \"倍率:\" + v[2] + \" X:\" + v[0] + \" Y:\" + v[1];\n  });\n  var f = v => isNaN(v[0]) ? \"-\" : v[0].toFixed(3);\n  binder.bind(document.querySelector(\"#pos_R\"), \"\", _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"], [\"cursor_color.0\"], f);\n  binder.bind(document.querySelector(\"#pos_G\"), \"\", _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"], [\"cursor_color.1\"], f);\n  binder.bind(document.querySelector(\"#pos_B\"), \"\", _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"], [\"cursor_color.2\"], f);\n  binder.bind(document.querySelector(\"#pos_A\"), \"\", _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"], [\"cursor_color.3\"], f);\n  watcher.watch(hdrpaint, [\"doc.scale\", \"doc.canvas_pos.0\", \"doc.canvas_pos.1\"], function (old) {\n    hdrpaint.refreshSelectedRectangle();\n    hdrpaint.refreshLayerRectangle();\n  });\n  watcher.watch(hdrpaint, [\"select_rectangle.x\", \"select_rectangle.y\", \"select_rectangle.w\", \"select_rectangle.h\"], function (values) {\n    hdrpaint.refreshSelectedRectangle();\n  });\n  watcher.watch(hdrpaint, [\"selected_layer.id\", \"selected_layer.size\", \"selected_layer.scale\", \"selected_layer.position\", \"selected_layer.angle\"], function (values) {\n    hdrpaint.refreshLayerRectangle();\n  });\n  watcher.init();\n  _brush_js__WEBPACK_IMPORTED_MODULE_8__[\"default\"].init();\n  var brush = _brush_js__WEBPACK_IMPORTED_MODULE_8__[\"default\"].create();\n  var brush1 = brush;\n  brush.name = \"ペン\";\n  brush.shortcut = \"a\";\n  brush.weight_pressure_effect = true;\n  brush.weight = 5;\n  _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].brushes.push(brush);\n  brush.refresh();\n  brush = _brush_js__WEBPACK_IMPORTED_MODULE_8__[\"default\"].create();\n  brush.name = \"消しゴム\";\n  brush.eraser = true;\n  brush.shortcut = \"s\";\n  brush.weight = 10;\n  _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].brushes.push(brush);\n  brush.refresh();\n  _brush_js__WEBPACK_IMPORTED_MODULE_8__[\"default\"].refreshBrush();\n  brush1.select();\n  var colorpickerhdr = new _lib_colorpickerhdr_js__WEBPACK_IMPORTED_MODULE_12__[\"default\"]();\n  colorpickerhdr.init(document.getElementsByClassName(\"colorpickerhdr\"));\n  binder.init(document, _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"]);\n  var selectorhdr = new _lib_colorselector_js__WEBPACK_IMPORTED_MODULE_13__[\"default\"](true);\n  document.querySelector(\"#color_selector\").appendChild(selectorhdr.div);\n  selectorhdr.changeCallback = function () {\n    _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].color[0] = Number(this.R_txt.value);\n    _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].color[1] = Number(this.G_txt.value);\n    _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].color[2] = Number(this.B_txt.value);\n    _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].color[3] = Number(this.A_txt.value);\n    _brush_js__WEBPACK_IMPORTED_MODULE_8__[\"default\"].refreshPreview();\n  };\n  _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec4.setValues(_hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].color, 1, 0.5, 0.5, 1);\n  selectorhdr.setColor(_hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].color);\n};\ndocument.body.onload = onloadfunc;\n\n//# sourceURL=webpack://hdrpaint/./src/main.js?");

/***/ }),

/***/ "./src/modifier/blur.js":
/*!******************************!*\
  !*** ./src/modifier/blur.js ***!
  \******************************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var _lib_slider_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../lib/slider.js */ \"./src/lib/slider.js\");\n/* harmony import */ var _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../hdrpaint.js */ \"./src/hdrpaint.js\");\n/* harmony import */ var _layer_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../layer.js */ \"./src/layer.js\");\nvar _class;\nfunction _defineProperty(obj, key, value) { key = _toPropertyKey(key); if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\nfunction _toPropertyKey(arg) { var key = _toPrimitive(arg, \"string\"); return typeof key === \"symbol\" ? key : String(key); }\nfunction _toPrimitive(input, hint) { if (typeof input !== \"object\" || input === null) return input; var prim = input[Symbol.toPrimitive]; if (prim !== undefined) { var res = prim.call(input, hint || \"default\"); if (typeof res !== \"object\") return res; throw new TypeError(\"@@toPrimitive must return a primitive value.\"); } return (hint === \"string\" ? String : Number)(input); }\n\n\n\n_hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].registModifier((_class = class extends _layer_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"] {\n  constructor() {\n    super();\n    this.scale = 16;\n  }\n  showDivParam() {\n    return \"blursize:\" + this.scale;\n  }\n  before(area) {\n    var size = Math.ceil(this.scale) * 2;\n    area[0] -= size;\n    area[1] -= size;\n    area[2] += size << 1;\n    area[3] += size << 1;\n  }\n  reflect(img, composite_area) {\n    var scale = Math.ceil(this.scale);\n    composite_area[0] += scale;\n    composite_area[1] += scale;\n    composite_area[2] -= scale << 1;\n    composite_area[3] -= scale << 1;\n    var x = Math.max(0, composite_area[0] - img.offsetx);\n    var y = Math.max(0, composite_area[1] - img.offsety);\n    var x1 = Math.min(img.width, composite_area[2] + x);\n    var y1 = Math.min(img.height, composite_area[3] + y);\n    img.gauss(scale >> 1, scale, x, y, x1 - x, y1 - y);\n  }\n}, _defineProperty(_class, \"name\", \"blur\"), _defineProperty(_class, \"type\", \"filter\"), _defineProperty(_class, \"option\", `ぼかし半径:<input class=\"slider modifier_scale\" name=\"scale\" step=\"1\" min=\"1\" max=\"128\" ><br>`), _class));\n_lib_slider_js__WEBPACK_IMPORTED_MODULE_0__[\"default\"].init();\n\n//# sourceURL=webpack://hdrpaint/./src/modifier/blur.js?");

/***/ }),

/***/ "./src/modifier/colormap.js":
/*!**********************************!*\
  !*** ./src/modifier/colormap.js ***!
  \**********************************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var _hdrpaint_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../hdrpaint.js */ \"./src/hdrpaint.js\");\n/* harmony import */ var _layer_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../layer.js */ \"./src/layer.js\");\nfunction _defineProperty(obj, key, value) { key = _toPropertyKey(key); if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\nfunction _toPropertyKey(arg) { var key = _toPrimitive(arg, \"string\"); return typeof key === \"symbol\" ? key : String(key); }\nfunction _toPrimitive(input, hint) { if (typeof input !== \"object\" || input === null) return input; var prim = input[Symbol.toPrimitive]; if (prim !== undefined) { var res = prim.call(input, hint || \"default\"); if (typeof res !== \"object\") return res; throw new TypeError(\"@@toPrimitive must return a primitive value.\"); } return (hint === \"string\" ? String : Number)(input); }\n\n\nvar clip = function (v, min, max) {\n  return Math.max(min, Math.min(max, v));\n};\nclass ColorMap extends _layer_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"] {\n  constructor() {\n    super();\n    this.effect = 4;\n    this.children = [];\n    this.gradtype = \"0\";\n  }\n  showDivParam() {\n    return \"gradtype:\" + this.gradtype;\n  }\n  beforeReflect() {\n    if (this.children.length < 1) {\n      return;\n    }\n    this.children[0].beforeReflect();\n  }\n  reflect(img, composite_area) {\n    var x = Math.max(0, composite_area[0]);\n    var y = Math.max(0, composite_area[1]);\n    var x1 = Math.min(this.parent.size[0], composite_area[2] + x);\n    var y1 = Math.min(this.parent.size[1], composite_area[3] + y);\n    var layer = this;\n    var offx = img.offsetx;\n    var offy = img.offsety;\n    img.scan(function (r, idx, x, y) {\n      layer.getPixel(r, idx, x + offx, y + offy);\n    }, x - img.offsetx, y - img.offsety, x1 - x, y1 - y);\n  }\n  getPixel(ret_pixel, idx, x, y) {\n    if (this.children.length < 1) {\n      return;\n    }\n    if (y === undefined) {\n      y = x;\n      x = idx;\n      idx = 0;\n    }\n    var total;\n    if (this.gradtype === \"0\") {\n      total = (ret_pixel[idx] + ret_pixel[idx + 1] + ret_pixel[idx + 2]) * 0.33333;\n    } else {\n      total = ret_pixel[idx + 3];\n    }\n    total = clip(total, 0, 1);\n    var a = ret_pixel[idx + 3];\n    var child = this.children[0];\n    child.getPixel(ret_pixel, idx, total * (child.size[0] - 1), 0);\n  }\n}\n_defineProperty(ColorMap, \"name\", \"colormap\");\n_defineProperty(ColorMap, \"type\", \"filter\");\n_defineProperty(ColorMap, \"option\", `\n\t\t<label><input type=\"radio\" name=\"gradtype\"  value=\"0\" />明るさで判定</label>\n\t\t<label><input type=\"radio\" name=\"gradtype\"  value=\"1\" />アルファ値で判定</label>\n\t`);\n;\n_hdrpaint_js__WEBPACK_IMPORTED_MODULE_0__[\"default\"].registModifier(ColorMap);\n\n//# sourceURL=webpack://hdrpaint/./src/modifier/colormap.js?");

/***/ }),

/***/ "./src/modifier/composite.js":
/*!***********************************!*\
  !*** ./src/modifier/composite.js ***!
  \***********************************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../lib/vector.js */ \"./src/lib/vector.js\");\n/* harmony import */ var _lib_img_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../lib/img.js */ \"./src/lib/img.js\");\n/* harmony import */ var _hdrpaint_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../hdrpaint.js */ \"./src/hdrpaint.js\");\n/* harmony import */ var _layer_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../layer.js */ \"./src/layer.js\");\nfunction _defineProperty(obj, key, value) { key = _toPropertyKey(key); if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\nfunction _toPropertyKey(arg) { var key = _toPrimitive(arg, \"string\"); return typeof key === \"symbol\" ? key : String(key); }\nfunction _toPrimitive(input, hint) { if (typeof input !== \"object\" || input === null) return input; var prim = input[Symbol.toPrimitive]; if (prim !== undefined) { var res = prim.call(input, hint || \"default\"); if (typeof res !== \"object\") return res; throw new TypeError(\"@@toPrimitive must return a primitive value.\"); } return (hint === \"string\" ? String : Number)(input); }\n\n\n\n\nlet composite_img = new _lib_img_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"](512, 512);\nlet composite_area = new _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec4();\nclass Composite extends _layer_js__WEBPACK_IMPORTED_MODULE_3__[\"default\"] {\n  constructor() {\n    super();\n    this.children = [];\n    this.type = 1;\n  }\n  init() {\n    var width = this.size[0];\n    var height = this.size[1];\n    //var img = hdrpaint.createImg(width,height);\n    var img = new _lib_img_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"](width, height);\n    //this.img_id = img.id;\n    this.img = img;\n    //var layer =Hdrpaint.createLayer(img.id,1);\n    this.width = width;\n    this.height = height;\n    if (img) {\n      _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec2.setValues(this.size, img.width, img.height);\n    }\n    this.type = 1;\n  }\n\n  //レイヤ合成\n  composite(left, top, right, bottom) {\n    var children = this.children;\n    var layer_img = this.img;\n    if (typeof left === 'undefined') {\n      //エリア指定無しの場合は全体\n      left = 0;\n      top = 0;\n      right = layer_img.width - 1;\n      bottom = layer_img.height - 1;\n    }\n    var width = right - left + 1;\n    var height = bottom - top + 1;\n    _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec4.setValues(composite_area, left, top, width, height);\n\n    //合成前処理\n    for (var li = children.length; li--;) {\n      var layer = _layer_js__WEBPACK_IMPORTED_MODULE_3__[\"default\"].findById(children[li]);\n      if (!layer.display) {\n        //非表示の場合スルー\n        continue;\n      }\n      layer.before(composite_area);\n    }\n\n    //コンポジットバッファエリア再計算\n    left = Math.max(0, composite_area[0]);\n    top = Math.max(0, composite_area[1]);\n    right = Math.min(layer_img.width, composite_area[2] + left);\n    bottom = Math.min(layer_img.height, composite_area[3] + top);\n    if (composite_img.data.length < (right - left) * (bottom - top) << 2) {\n      composite_img = new _lib_img_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"](right - left, bottom - top);\n    }\n    composite_img.offsetx = left;\n    composite_img.offsety = top;\n    composite_img.width = right - left;\n    composite_img.height = bottom - top;\n    if (this.id === _hdrpaint_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"].root_layer.id) {\n      //ルートレイヤなら背景色塗りつぶし\n      var bg = _hdrpaint_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"].doc.background_color;\n      composite_img.fill(bg[0], bg[1], bg[2], bg[3], 0, 0, composite_img.width, composite_img.height);\n    } else {\n      //ルートレイヤ以外は透明色塗りつぶし\n      composite_img.clear(0, 0, composite_img.width, composite_img.height);\n    }\n\n    //合成処理\n    for (var li = 0; li < children.length; li++) {\n      var layer = _layer_js__WEBPACK_IMPORTED_MODULE_3__[\"default\"].findById(children[li]);\n      if (!layer.display) {\n        //非表示の場合スルー\n        continue;\n      }\n      //layer.beforeReflect(composite_area);\n      layer.reflect(composite_img, composite_area);\n    }\n\n    //コンポジット結果をコンポジットキャッシュに反映\n    var x0 = composite_area[0];\n    var x1 = composite_area[0] + composite_area[2];\n    var y0 = composite_area[1];\n    var y1 = composite_area[1] + composite_area[3];\n    x0 = Math.max(0, x0);\n    y0 = Math.max(0, y0);\n    x1 = Math.min(layer_img.width, x1);\n    y1 = Math.min(layer_img.height, y1);\n    _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec4.setValues(composite_area, x0, y0, x1 - x0, y1 - y0);\n    _lib_img_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].copy(layer_img, composite_area[0], composite_area[1], composite_img, -composite_img.offsetx + composite_area[0], -composite_img.offsety + composite_area[1], composite_area[2], composite_area[3]);\n    if (this.id === _hdrpaint_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"].root_layer.id) {\n      //ルートレイヤの場合はプレビュー更新\n      Redraw.refreshPreview(0, composite_area[0], composite_area[1], composite_area[2], composite_area[3]);\n    } else {\n      this.refreshImg(composite_area[0], composite_area[1], composite_area[2], composite_area[3]);\n      //通常レイヤの場合はサムネ更新\n      this.registRefreshThumbnail();\n    }\n  }\n}\n_defineProperty(Composite, \"name\", \"composite\");\n_defineProperty(Composite, \"type\", \"filter\");\n;\n_hdrpaint_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"].registModifier(Composite);\n\n//# sourceURL=webpack://hdrpaint/./src/modifier/composite.js?");

/***/ }),

/***/ "./src/modifier/gradient.js":
/*!**********************************!*\
  !*** ./src/modifier/gradient.js ***!
  \**********************************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var _lib_img_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../lib/img.js */ \"./src/lib/img.js\");\n/* harmony import */ var _lib_vector_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../lib/vector.js */ \"./src/lib/vector.js\");\n/* harmony import */ var _lib_slider_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../lib/slider.js */ \"./src/lib/slider.js\");\n/* harmony import */ var _hdrpaint_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../hdrpaint.js */ \"./src/hdrpaint.js\");\n/* harmony import */ var _layer_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../layer.js */ \"./src/layer.js\");\nfunction _defineProperty(obj, key, value) { key = _toPropertyKey(key); if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\nfunction _toPropertyKey(arg) { var key = _toPrimitive(arg, \"string\"); return typeof key === \"symbol\" ? key : String(key); }\nfunction _toPrimitive(input, hint) { if (typeof input !== \"object\" || input === null) return input; var prim = input[Symbol.toPrimitive]; if (prim !== undefined) { var res = prim.call(input, hint || \"default\"); if (typeof res !== \"object\") return res; throw new TypeError(\"@@toPrimitive must return a primitive value.\"); } return (hint === \"string\" ? String : Number)(input); }\n\n\n\n\n\nvar arr = new _lib_vector_js__WEBPACK_IMPORTED_MODULE_1__.Vec4();\nvar backimg = new _lib_img_js__WEBPACK_IMPORTED_MODULE_0__[\"default\"](128, 1);\nvar points = new Array();\nfor (var i = 0; i < 4; i++) {\n  var point = {};\n  point.color = new _lib_vector_js__WEBPACK_IMPORTED_MODULE_1__.Vec4();\n  point.pos = 0.0;\n  points.push(point);\n}\nvar width, height;\nvar mat33 = new _lib_vector_js__WEBPACK_IMPORTED_MODULE_1__.Mat33();\nvar _mat33 = new _lib_vector_js__WEBPACK_IMPORTED_MODULE_1__.Mat33();\nclass Gradient extends _layer_js__WEBPACK_IMPORTED_MODULE_4__[\"default\"] {\n  constructor() {\n    super();\n    for (var i = 0; i < 4; i++) {\n      var nam = \"col\" + i;\n      this[nam] = \"0,0,0,1\";\n      this[nam + \"pos\"] = 1;\n    }\n    this[\"col1\"] = \"1,1,1,1\";\n    this.col0pos = 0;\n    this.col1pos = 1;\n    this.radius = 0;\n  }\n  showDivParam() {\n    //\n    //\t\tvar layer = this;\n    //\t\tlayer.beforeReflect();\n    //\t\tmat33[0]=1/128;\n    //\t\tmat33[1]=1;\n    //\t\twidth=64;\n    //\t\theight=0;\n    //\t\tbackimg.scan(function(ret,idx,x,y){layer.getPixel(ret,idx,x,y);});\n    //\t\tlayer.dom.style.backgroundImage = \"url(\" + backimg.toDataURL() + \"),url(./back.png)\";\n    //\n    return \"\";\n  }\n  beforeReflect(img, composite_area) {\n    for (var i = 0; i < 4; i++) {\n      var nam = \"col\" + i;\n      var a = this[nam].split(\",\");\n      points[i].color[0] = 0;\n      points[i].color[1] = 0;\n      points[i].color[2] = 0;\n      points[i].color[3] = 0;\n      if (a.length === 4) {\n        points[i].color[0] = Number(a[0]);\n        points[i].color[1] = Number(a[1]);\n        points[i].color[2] = Number(a[2]);\n        points[i].color[3] = Number(a[3]);\n      }\n      points[i].pos = this[nam + \"pos\"];\n    }\n    points.sort(function (a, b) {\n      return a.pos - b.pos;\n    });\n    for (var i = 1; i < 4; i++) {\n      points[i]._r = points[i].pos - points[i - 1].pos;\n      if (points[i]._r) {\n        points[i]._r = 1.0 / points[i]._r;\n      }\n    }\n    var parent = _layer_js__WEBPACK_IMPORTED_MODULE_4__[\"default\"].findById(this.parent);\n    if (parent) {\n      width = parent.size[0];\n      height = parent.size[1];\n    }\n    if (img) {\n      if (img.thumbnail) {\n        width = img.width;\n        height = img.height;\n      }\n    }\n    _lib_vector_js__WEBPACK_IMPORTED_MODULE_1__.Mat33.rotate(mat33, this.radius * Math.PI / 180, 0, 0, 1);\n    _lib_vector_js__WEBPACK_IMPORTED_MODULE_1__.Mat33.setValue(_mat33, 1 / width, 0, 0, 0, 1 / height, 0, 0, 0, 1);\n    _lib_vector_js__WEBPACK_IMPORTED_MODULE_1__.Mat33.dot(mat33, mat33, _mat33);\n    width = width >> 1;\n    height = height >> 1;\n  }\n  reflect(img, area) {\n    this.beforeReflect(img, area);\n    var layer = this;\n    var offx = -this.position[0] + img.offsetx;\n    var offy = -this.position[1] + img.offsety;\n    img.scan(function (ret, idx, x, y) {\n      layer.getPixel(arr, x + offx, y + offy);\n      ret[idx + 0] = arr[0];\n      ret[idx + 1] = arr[1];\n      ret[idx + 2] = arr[2];\n      ret[idx + 3] = arr[3];\n    }, area[0] - img.offsetx, area[1] - img.offsety, area[2], area[3]);\n  }\n  getPixel(ret, x, y) {\n    var b = mat33[0] * (x - width) + mat33[1] * (y - height) + 0.5;\n    b = Math.max(0, Math.min(b, 1));\n    var i = 1;\n    for (; i < 3; i++) {\n      if (b <= points[i].pos) {\n        break;\n      }\n    }\n    b = (b - points[i - 1].pos) * points[i]._r;\n    b = Math.max(0, Math.min(b, 1));\n    var color0 = points[i - 1].color;\n    var color1 = points[i].color;\n    var a = 1 - b;\n    ret[0] = color0[0] * a + color1[0] * b;\n    ret[1] = color0[1] * a + color1[1] * b;\n    ret[2] = color0[2] * a + color1[2] * b;\n    ret[3] = color0[3] * a + color1[3] * b;\n  }\n}\n_defineProperty(Gradient, \"name\", \"gradient\");\n_defineProperty(Gradient, \"type\", \"generator\");\n_defineProperty(Gradient, \"option\", `\n\t角度:<input class=\"slider modifier_scale\" name=\"radius\" value=\"0\" min=\"0\" max=\"360\"><br>\n\n\t<div class=\"modifier_gradient \">\n\tR,G,B,A pos<br>\n\t<ul>\n\t<li>\n\t<input type=\"text\" class=\"col colorpickerhdr\" name=\"col0\">\n\t<input class=\"slider pos\" name=\"col0pos\" min=\"0\" max=\"1\">\n\t</li>\n\n\t<li>\n\t<input type=\"text\" class=\"col colorpickerhdr\" name=\"col1\">\n\t<input class=\"slider pos\" name=\"col1pos\" min=\"0\" max=\"1\">\n\t</li>\n\n\t<li>\n\t<input type=\"text\" class=\"col colorpickerhdr\" name=\"col2\">\n\t<input class=\"slider pos\" name=\"col2pos\" min=\"0\" max=\"1\">\n\t</li>\n\n\t<li>\n\t<input type=\"text\" class=\"col colorpickerhdr\" name=\"col3\">\n\t<input class=\"slider pos\" name=\"col3pos\" min=\"0\" max=\"1\">\n\t</li>\n\t</ul>\n\n\t</div>\n\t`);\n_hdrpaint_js__WEBPACK_IMPORTED_MODULE_3__[\"default\"].registModifier(Gradient);\n_lib_slider_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"].init();\n\n//# sourceURL=webpack://hdrpaint/./src/modifier/gradient.js?");

/***/ }),

/***/ "./src/modifier/grayscale.js":
/*!***********************************!*\
  !*** ./src/modifier/grayscale.js ***!
  \***********************************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var _hdrpaint_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../hdrpaint.js */ \"./src/hdrpaint.js\");\n/* harmony import */ var _layer_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../layer.js */ \"./src/layer.js\");\nfunction _defineProperty(obj, key, value) { key = _toPropertyKey(key); if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\nfunction _toPropertyKey(arg) { var key = _toPrimitive(arg, \"string\"); return typeof key === \"symbol\" ? key : String(key); }\nfunction _toPrimitive(input, hint) { if (typeof input !== \"object\" || input === null) return input; var prim = input[Symbol.toPrimitive]; if (prim !== undefined) { var res = prim.call(input, hint || \"default\"); if (typeof res !== \"object\") return res; throw new TypeError(\"@@toPrimitive must return a primitive value.\"); } return (hint === \"string\" ? String : Number)(input); }\n\n\nvar img;\nvar img_data;\nclass Grayscale extends _layer_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"] {\n  constructor() {\n    super();\n    this.children = null;\n  }\n  beforeReflect() {}\n  reflect(_img, composite_area) {\n    this.beforeReflect();\n    img = _img;\n    img_data = img.data;\n    var x = Math.max(0, composite_area[0]);\n    var y = Math.max(0, composite_area[1]);\n    var parent = _layer_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].findById(this.parent);\n    var x1 = Math.min(parent.size[0], composite_area[2] + x);\n    var y1 = Math.min(parent.size[1], composite_area[3] + y);\n    var layer = this;\n    img.scan(layer.getPixel, x - img.offsetx, y - img.offsety, x1 - x, y1 - y);\n  }\n  getPixel(ret, idx, x, y) {\n    if (y == undefined) {\n      y = x;\n      x = idx;\n      idx = 0;\n    }\n    if (!img) {\n      return;\n    }\n    var idx = img.getIndex(x, y) << 2;\n    var total = img_data[idx] + img_data[idx + 1] + img_data[idx + 2];\n    total *= 0.33333;\n    ret[idx + 0] = total;\n    ret[idx + 1] = total;\n    ret[idx + 2] = total;\n    ret[idx + 3] = img_data[idx + 3];\n  }\n}\n_defineProperty(Grayscale, \"name\", \"grayscale\");\n_defineProperty(Grayscale, \"type\", \"filter\");\n_defineProperty(Grayscale, \"option\", \"\");\n_hdrpaint_js__WEBPACK_IMPORTED_MODULE_0__[\"default\"].registModifier(Grayscale);\n\n//# sourceURL=webpack://hdrpaint/./src/modifier/grayscale.js?");

/***/ }),

/***/ "./src/modifier/link.js":
/*!******************************!*\
  !*** ./src/modifier/link.js ***!
  \******************************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var _main_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../main.js */ \"./src/main.js\");\n/* harmony import */ var _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../hdrpaint.js */ \"./src/hdrpaint.js\");\n/* harmony import */ var _layer_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../layer.js */ \"./src/layer.js\");\nfunction _defineProperty(obj, key, value) { key = _toPropertyKey(key); if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\nfunction _toPropertyKey(arg) { var key = _toPrimitive(arg, \"string\"); return typeof key === \"symbol\" ? key : String(key); }\nfunction _toPrimitive(input, hint) { if (typeof input !== \"object\" || input === null) return input; var prim = input[Symbol.toPrimitive]; if (prim !== undefined) { var res = prim.call(input, hint || \"default\"); if (typeof res !== \"object\") return res; throw new TypeError(\"@@toPrimitive must return a primitive value.\"); } return (hint === \"string\" ? String : Number)(input); }\n\n\n\nvar img;\nvar img_data;\nclass Link extends _layer_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"] {\n  constructor() {\n    super();\n    this.children = null;\n  }\n  beforeReflect() {}\n  reflect(_img, composite_area) {}\n}\n_defineProperty(Link, \"name\", \"link\");\n_defineProperty(Link, \"type\", \"generator\");\n_defineProperty(Link, \"option\", \"<select id='layerlist' name='target'></select>\");\nhdrpaint.registModifier(Link);\n\n//# sourceURL=webpack://hdrpaint/./src/modifier/link.js?");

/***/ }),

/***/ "./src/modifier/noise.js":
/*!*******************************!*\
  !*** ./src/modifier/noise.js ***!
  \*******************************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var _lib_slider_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../lib/slider.js */ \"./src/lib/slider.js\");\n/* harmony import */ var _layer_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../layer.js */ \"./src/layer.js\");\n/* harmony import */ var _lib_noise_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../lib/noise.js */ \"./src/lib/noise.js\");\n/* harmony import */ var _hdrpaint_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../hdrpaint.js */ \"./src/hdrpaint.js\");\nfunction _defineProperty(obj, key, value) { key = _toPropertyKey(key); if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\nfunction _toPropertyKey(arg) { var key = _toPrimitive(arg, \"string\"); return typeof key === \"symbol\" ? key : String(key); }\nfunction _toPrimitive(input, hint) { if (typeof input !== \"object\" || input === null) return input; var prim = input[Symbol.toPrimitive]; if (prim !== undefined) { var res = prim.call(input, hint || \"default\"); if (typeof res !== \"object\") return res; throw new TypeError(\"@@toPrimitive must return a primitive value.\"); } return (hint === \"string\" ? String : Number)(input); }\n\n\n\n\nvar scale;\nvar octave;\nvar _total;\nvar betsu;\nvar z;\nvar func;\nvar funcs = {\n  \"perlin\": _lib_noise_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"].perlinnoise,\n  \"simplex\": _lib_noise_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"].simplexnoise,\n  \"value\": _lib_noise_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"].valuenoise\n};\nclass _Noise extends _layer_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"] {\n  constructor() {\n    super();\n    this.scale = 128;\n    this.zoffset = 0;\n    this.octave = 0;\n    this.betsu = false;\n    this.func = \"simplex\";\n    this.children = null;\n  }\n  beforeReflect() {\n    scale = 1 / this.scale;\n    octave = Number(this.octave);\n    _total = 1 / ((1 << octave + 1) - 1);\n    betsu = this.betsu;\n    func = funcs[this.func];\n    z = this.zoffset;\n  }\n  reflect(img, composite_area) {\n    var x = composite_area[0];\n    var y = composite_area[1];\n    var w = composite_area[2];\n    var h = composite_area[3];\n    this.beforeReflect();\n    var layer = this;\n    var offx = -this.position[0] + img.offsetx;\n    var offy = -this.position[1] + img.offsety;\n    img.scan(function (r, idx, x, y) {\n      layer.calcPixel(r, idx, x + offx, y + offy);\n    }, x - img.offsetx, y - img.offsety, w, h);\n  }\n  getPixel(ret, x, y) {\n    this.calcPixel(ret, 0, x, y);\n  }\n  calcPixel(ret, idx, x, y) {\n    var r = 0;\n    var scale2 = scale;\n    var pow = 1 << octave;\n    var nmax = 1;\n    if (betsu) {\n      nmax = 3;\n    }\n    for (var n = 0; n < nmax; n++) {\n      r = 0;\n      for (var i = 0; i < octave + 1; i++) {\n        scale2 = (1 << i) * scale;\n        r += func(x * scale2 + i * 0.123 + n * 0.321, y * scale2 + i * 0.123 + n * 0.321, z * scale2 + i * 0.123 + n) * (1 << octave - i);\n      }\n      ret[n + idx] = r * _total;\n    }\n    if (!betsu) {\n      ret[1 + idx] = ret[0 + idx];\n      ret[2 + idx] = ret[0 + idx];\n    }\n    ret[3 + idx] = 1;\n  }\n}\n_defineProperty(_Noise, \"name\", \"noise\");\n_defineProperty(_Noise, \"type\", \"generator\");\n_defineProperty(_Noise, \"option\", `\n\t\t\tfunc:<select class=\"modifier_func\" name=\"func\">\n\t\t\t\t<option value=\"perlin\">Perlin</option>\n\t\t\t\t<option value=\"simplex\">Simplex</option>\n\t\t\t\t<option value=\"value\">Value</option>\n\t\t\t\t</select><br>\n\t\t\tスケール:<input class=\"slider modifier_scale\" name=\"scale\" value=\"32\" min=\"1\" max=\"256\"><br>\n\t\t\tオクターブ数:<input class=\"slider modifier_octabe\" name=\"octave\" value=\"0\" min=\"0\" max=\"10\" step=\"1\"><br>\n\t\t\tZ(seed):<input class=\"slider modifier_z\" name=\"zoffset\" max=\"255\"><br>\n\t\t\trgb別:<input type=\"checkbox\" class=\"modifier_betsu\" name=\"betsu\"><br>\n\t\t`);\n;\n_hdrpaint_js__WEBPACK_IMPORTED_MODULE_3__[\"default\"].registModifier(_Noise);\n_lib_slider_js__WEBPACK_IMPORTED_MODULE_0__[\"default\"].init();\n\n//# sourceURL=webpack://hdrpaint/./src/modifier/noise.js?");

/***/ }),

/***/ "./src/modifier/shift.js":
/*!*******************************!*\
  !*** ./src/modifier/shift.js ***!
  \*******************************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var _lib_img_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../lib/img.js */ \"./src/lib/img.js\");\n/* harmony import */ var _lib_vector_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../lib/vector.js */ \"./src/lib/vector.js\");\n/* harmony import */ var _hdrpaint_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../hdrpaint.js */ \"./src/hdrpaint.js\");\n/* harmony import */ var _layer_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../layer.js */ \"./src/layer.js\");\nfunction _defineProperty(obj, key, value) { key = _toPropertyKey(key); if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\nfunction _toPropertyKey(arg) { var key = _toPrimitive(arg, \"string\"); return typeof key === \"symbol\" ? key : String(key); }\nfunction _toPrimitive(input, hint) { if (typeof input !== \"object\" || input === null) return input; var prim = input[Symbol.toPrimitive]; if (prim !== undefined) { var res = prim.call(input, hint || \"default\"); if (typeof res !== \"object\") return res; throw new TypeError(\"@@toPrimitive must return a primitive value.\"); } return (hint === \"string\" ? String : Number)(input); }\n\n\n\n\nvar ret_pixel = new _lib_vector_js__WEBPACK_IMPORTED_MODULE_1__.Vec4();\nvar bufimg = new _lib_img_js__WEBPACK_IMPORTED_MODULE_0__[\"default\"](1024, 1024);\nvar layer;\nvar xmod = 1;\nvar ymod = 1;\nvar offx;\nvar offy;\nvar clip = function (v, min, max) {\n  return Math.max(min, Math.min(max, v));\n};\nclass Shift extends _layer_js__WEBPACK_IMPORTED_MODULE_3__[\"default\"] {\n  constructor() {\n    super();\n    _defineProperty(this, \"beforeReflect\", function () {\n      offx = 0;\n      offy = 0;\n      if (this.children.length >= 1) {\n        var child = this.children[0];\n        child.beforeReflect();\n        offx = -this.position[0] - child.position[0];\n        offy = -this.position[1] - child.position[1];\n      }\n    });\n    this.effect = 4;\n    this.children = [];\n  }\n  before(area) {\n    var size = this.effect;\n    area[0] -= size;\n    area[1] -= size;\n    area[2] += size << 1;\n    area[3] += size << 1;\n  }\n  reflect(img, composite_area) {\n    var scale = this.effect >> 1;\n    composite_area[0] += scale;\n    composite_area[1] += scale;\n    composite_area[2] -= scale << 1;\n    composite_area[3] -= scale << 1;\n    if (bufimg.data.length < img.data.length) {\n      bufimg = new _lib_img_js__WEBPACK_IMPORTED_MODULE_0__[\"default\"](img.width, img.height);\n    }\n    bufimg.width = img.width;\n    bufimg.height = img.height;\n    bufimg.offsetx = img.offsetx;\n    bufimg.offsety = img.offsety;\n    _lib_img_js__WEBPACK_IMPORTED_MODULE_0__[\"default\"].copy(bufimg, 0, 0, img, 0, 0, img.width, img.height);\n    this.beforeReflect();\n    var x = Math.max(0, composite_area[0]);\n    var y = Math.max(0, composite_area[1]);\n    var x1 = Math.min(this.parent.size[0], composite_area[2] + x);\n    var y1 = Math.min(this.parent.size[1], composite_area[3] + y);\n    var imgdata = img.data;\n    for (var j = y; j < y1; j++) {\n      var idx = img.getIndex(x - img.offsetx, j - img.offsety) << 2;\n      for (var i = x; i < x1; i++) {\n        this.getPixel(ret_pixel, i, j);\n        imgdata[idx + 0] = ret_pixel[0];\n        imgdata[idx + 1] = ret_pixel[1];\n        imgdata[idx + 2] = ret_pixel[2];\n        imgdata[idx + 3] = ret_pixel[3];\n        idx += 4;\n      }\n    }\n  }\n  getPixel(ret_pixel, x, y) {\n    var img = bufimg;\n    var sx = 0;\n    var sy = 0;\n    if (this.children.length >= 1) {\n      var child = this.children[0];\n      child.getPixel(ret_pixel, x + offx, y + offy);\n      sx = ret_pixel[0] - 0.5;\n      sy = ret_pixel[1] - 0.5;\n      //sz = ret_pixel[2]-0.5;\n\n      var pow = this.effect;\n      sx = sx * pow | 0;\n      sy = sy * pow | 0;\n      //sz = sz* pow|0;\n    }\n    var d_idx2 = img.getIndex(clip(x + sx - img.offsetx, 0, img.width - 1), clip(y + sy - img.offsety, 0, img.height - 1)) << 2;\n    ret_pixel[0] = img.data[d_idx2 + 0];\n    ret_pixel[1] = img.data[d_idx2 + 1];\n    ret_pixel[2] = img.data[d_idx2 + 2];\n    ret_pixel[3] = img.data[d_idx2 + 3];\n  }\n}\n_defineProperty(Shift, \"name\", \"shift\");\n_defineProperty(Shift, \"type\", \"filter\");\n_defineProperty(Shift, \"option\", `\n\t\t\t影響度:<input type=\"text\" class=\"slider modifier_effect\" name=\"effect\" value=\"0.5\" min=\"0\" max=\"100\">\n\t\t`);\n_hdrpaint_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"].registModifier(Shift);\n\n//# sourceURL=webpack://hdrpaint/./src/modifier/shift.js?");

/***/ }),

/***/ "./src/penfunc.js":
/*!************************!*\
  !*** ./src/penfunc.js ***!
  \************************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": function() { return /* binding */ PenFunc; }\n/* harmony export */ });\n/* harmony import */ var _lib_util_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./lib/util.js */ \"./src/lib/util.js\");\n/* harmony import */ var _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./hdrpaint.js */ \"./src/hdrpaint.js\");\n/* harmony import */ var _layer_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./layer.js */ \"./src/layer.js\");\n\n\n\nvar id = -1;\nclass PenFunc {\n  constructor() {\n    this.pen_log = null;\n    this.endFlg = 0;\n    this.idx = 0;\n    this.ragtime = 0;\n    var aaa = this;\n    setTimeout(function () {\n      aaa.actualDraw();\n    }, 1);\n  }\n  end() {\n    this.endFlg = 1;\n  }\n  actualDraw() {\n    var aaa = this;\n    var log = this.pen_log;\n    var points = log.obj.param.points;\n    if (id >= 0) {\n      clearTimeout(id);\n      id = -1;\n    }\n    if (this.endFlg && points.length <= this.idx) {\n      var layer = _layer_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"].findById(log.obj.param.layer_id);\n      var funcs = _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].blendfuncs;\n      _hdrpaint_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].painted_mask.fill(0);\n      return;\n    }\n    if (points.length <= this.idx) {\n      id = setTimeout(function () {\n        aaa.actualDraw();\n      }, 16);\n      return;\n    }\n    var now = Date.now();\n    var org = points[this.idx];\n    var d = this.ragtime - (now - org.time);\n    if (d > 0) {\n      id = setTimeout(function () {\n        aaa.actualDraw();\n      }, d * 0.5);\n      return;\n    }\n    if (this.idx >= 1) {\n      //ログ文面変更\n      log.refreshLabel();\n\n      //今回と前回の座標で直線描画\n      log.obj.draw(this.idx);\n    }\n    this.idx++;\n    if (points.length <= this.idx) {\n      id = setTimeout(function () {\n        aaa.actualDraw();\n      }, 16);\n      return;\n    }\n    d = Math.max(this.ragtime - (now - org.time), 1);\n    id = setTimeout(function () {\n      aaa.actualDraw();\n    }, d * 0.5);\n    return;\n  }\n}\n\n//# sourceURL=webpack://hdrpaint/./src/penfunc.js?");

/***/ }),

/***/ "./src/penpoint.js":
/*!*************************!*\
  !*** ./src/penpoint.js ***!
  \*************************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": function() { return /* binding */ PenPoint; }\n/* harmony export */ });\n/* harmony import */ var _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./lib/vector.js */ \"./src/lib/vector.js\");\n\nclass PenPoint {\n  constructor() {\n    this.pos = new _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec2();\n    this.pressure = 1;\n  }\n}\n\n//# sourceURL=webpack://hdrpaint/./src/penpoint.js?");

/***/ }),

/***/ "./src/redraw.js":
/*!***********************!*\
  !*** ./src/redraw.js ***!
  \***********************/
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": function() { return /* binding */ Redraw; }\n/* harmony export */ });\n/* harmony import */ var _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./lib/vector.js */ \"./src/lib/vector.js\");\n/* harmony import */ var _lib_util_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./lib/util.js */ \"./src/lib/util.js\");\n/* harmony import */ var _layer_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./layer.js */ \"./src/layer.js\");\n\n\n\n\n\nvar absolute = new _lib_vector_js__WEBPACK_IMPORTED_MODULE_0__.Vec2();\nvar refresh_stack = [];\nvar refreshMain_ = function () {\n  if (Redraw.refreshoff) {\n    //更新禁止フラグが立っている場合は処理しない\n    window.requestAnimationFrame(refreshMain_);\n    return;\n  }\n  for (var ri = 0; ri < refresh_stack.length; ri++) {\n    var r = refresh_stack[ri];\n    refreshMain_sub(r.step, r.x, r.y, r.w, r.h);\n  }\n  refresh_stack = [];\n  window.requestAnimationFrame(refreshMain_);\n};\nvar refreshMain_sub = function (step, x, y, w, h) {\n  //プレビュー画面を更新\n\n  if (typeof step === 'undefined') {\n    step = 0;\n  }\n  var root_layer = hdrpaint.root_layer;\n  var bloom_size = parseFloat(hdrpaint.post_effect.bloom_size);\n  var joined_img = root_layer.img;\n\n  //引数無しの場合、デフォルトで更新領域は全域\n  var left = 0;\n  var right = joined_img.width;\n  var top = 0;\n  var bottom = joined_img.height;\n  var joined_img_data = joined_img.data;\n  var joined_img_width = joined_img.width;\n  if (w) {\n    left = x;\n    right = x + w;\n    top = y;\n    bottom = y + h;\n\n    //更新領域設定、はみ出している場合はクランプする\n    left -= bloom_size;\n    right += bloom_size;\n    top -= bloom_size;\n    bottom += bloom_size;\n    left = Math.max(0, left);\n    right = Math.min(joined_img.width, right);\n    top = Math.max(0, top);\n    bottom = Math.min(joined_img.height, bottom);\n    left = Math.floor(left);\n    right = Math.ceil(right);\n    top = Math.floor(top);\n    bottom = Math.ceil(bottom);\n  }\n  var width = right - left;\n  var height = bottom - top;\n  var flg_active_layer_only = inputs[\"selected_layer_only\"].checked;\n  if (flg_active_layer_only) {\n    //選択レイヤのみ表示\n    var img = bloom_img;\n    var img_data = img.data;\n    var img_width = img.width;\n    var layer = hdrpaint.selected_layer;\n    bloom_img.clear(left, top, width, height);\n    layer.getAbsolutePosition(absolute);\n    if (layer.typename === \"normal_layer\") {\n      bloom_img.copy(left, top, layer.img, left - absolute[0], top - absolute[1], width, height);\n    } else {\n      layer.beforeReflect();\n      bloom_img.scan(function (ret, idx, x, y) {\n        layer.getPixel(ret, idx, x - absolute[0], y - absolute[1]);\n      }, left, top, width, height);\n    }\n  } else {\n    if (step <= 0) {\n      if (hdrpaint.post_effect.ch_bloom) {\n        //ブルーム処理ありの場合は前処理を行う\n\n        bloom_img.copy(left - bloom_size, top - bloom_size, hdrpaint.root_layer.img, left - bloom_size, top - bloom_size, right - left + bloom_size * 2, bottom - top + bloom_size * 2);\n        bloom_img.gauss(bloom_size >> 1, bloom_size, left, top, right - left, bottom - top);\n        bloomed_img.copy(left, top, bloom_img, left, top, right - left, bottom - top);\n      }\n    }\n\n    //ブルーム処理\n    //ブルーム前の絵はjoined_imgに残し、結果はbloomed_imgに出力\n    if (step <= 1) {\n      var bloom = parseFloat(hdrpaint.post_effect.bloom_power);\n      var _bloom = 1 - bloom;\n      var bloom_img_data = bloom_img.data;\n      var bloomed_img_data = bloomed_img.data;\n      if (hdrpaint.post_effect.ch_bloom && bloom > 0) {\n        for (var yi = top; yi < bottom; yi++) {\n          var idx = yi * joined_img_width + left << 2;\n          var max = yi * joined_img_width + right << 2;\n          for (; idx < max; idx += 4) {\n            bloom_img_data[idx] = joined_img_data[idx] * _bloom + bloomed_img_data[idx] * bloom;\n            bloom_img_data[idx + 1] = joined_img_data[idx + 1] * _bloom + bloomed_img_data[idx + 1] * bloom;\n            bloom_img_data[idx + 2] = joined_img_data[idx + 2] * _bloom + bloomed_img_data[idx + 2] * bloom;\n            bloom_img_data[idx + 3] = joined_img_data[idx + 3];\n          }\n        }\n      } else {\n        bloom_img.copy(left, top, joined_img, left, top, width, height);\n      }\n    }\n  }\n  if (step <= 2) {\n    //ガンマ補正とトーンマッピング\n    var ctx_imagedata_data = preview_ctx_imagedata.data;\n    var ev = parseFloat(hdrpaint.post_effect.ev);\n    var gamma = 1.0 / parseFloat(hdrpaint.post_effect.gamma);\n    joined_img_data = bloom_img.data;\n    if (hdrpaint.post_effect.ch_gamma) {\n      var r = Math.pow(2, -ev);\n      for (var yi = top; yi < bottom; yi++) {\n        var idx = yi * joined_img_width + left << 2;\n        var max = yi * joined_img_width + right << 2;\n        for (; idx < max; idx += 4) {\n          ctx_imagedata_data[idx + 0] = Math.pow(joined_img_data[idx + 0] * r, gamma) * 255;\n          ctx_imagedata_data[idx + 1] = Math.pow(joined_img_data[idx + 1] * r, gamma) * 255;\n          ctx_imagedata_data[idx + 2] = Math.pow(joined_img_data[idx + 2] * r, gamma) * 255;\n          ctx_imagedata_data[idx + 3] = joined_img_data[idx + 3] * 255;\n        }\n      }\n    } else {\n      var r = Math.pow(2, -ev) * 255;\n      for (var yi = top; yi < bottom; yi++) {\n        var idx = yi * joined_img_width + left << 2;\n        var max = yi * joined_img_width + right << 2;\n        for (; idx < max; idx += 4) {\n          ctx_imagedata_data[idx + 0] = joined_img_data[idx + 0] * r;\n          ctx_imagedata_data[idx + 1] = joined_img_data[idx + 1] * r;\n          ctx_imagedata_data[idx + 2] = joined_img_data[idx + 2] * r;\n          ctx_imagedata_data[idx + 3] = joined_img_data[idx + 3] * 255;\n        }\n      }\n    }\n  }\n\n  //結果をキャンバスに表示\n  preview_ctx.putImageData(preview_ctx_imagedata, 0, 0, left, top, right - left, bottom - top);\n};\nlet refreshoff = 0;\nclass Redraw {\n  constructor() {}\n  static disableRefresh() {\n    refreshoff = true;\n  }\n  static enableRefresh() {\n    refreshoff = false;\n  }\n  static refreshPreview(step, x, y, w, h) {\n    var root_layer = hdrpaint.root_layer;\n    if (refresh_stack.length === 1) {\n      //全更新がある場合は無視\n      if (refresh_stack[0].step === 0 && refresh_stack[0].w === 0) {\n        return;\n      }\n    }\n    if (typeof x === 'undefined') {\n      //全更新の場合はコレまでのは無視する\n      refresh_stack = [];\n      x = 0;\n      y = 0;\n      w = root_layer.img.width;\n      h = root_layer.img.height;\n    }\n    var refresh_data = {};\n    refresh_data.step = step;\n    refresh_data.x = x;\n    refresh_data.y = y;\n    refresh_data.w = w;\n    refresh_data.h = h;\n    refresh_stack.push(refresh_data);\n\n    //\t\tif(refresh_stack.length===1){\n    //\t\t\twindow.requestAnimationFrame(function(e){\n    //\t\t\t\trefreshMain_();\n    //\t\t\t});\n    //\t}\n  }\n  static compositeAll() {\n    //全レイヤ更新\n    var f = function (layer, left, top, right, bottom) {\n      if (layer.type !== _layer_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"].COMPOSITE) {\n        return;\n      }\n      var lower_layers = layer.children;\n      for (var li = 0; li < lower_layers.length; li++) {\n        var lower_layer = lower_layers[li];\n        f(lower_layer, left, top, right, bottom);\n      }\n      layer.composite(left, top, right, bottom);\n    };\n    f(hdrpaint.root_layer);\n  }\n}\nwindow.requestAnimationFrame(refreshMain_);\n\n//# sourceURL=webpack://hdrpaint/./src/redraw.js?");

/***/ })

/******/ 	});
/************************************************************************/
/******/ 	// The module cache
/******/ 	var __webpack_module_cache__ = {};
/******/ 	
/******/ 	// The require function
/******/ 	function __webpack_require__(moduleId) {
/******/ 		// Check if module is in cache
/******/ 		var cachedModule = __webpack_module_cache__[moduleId];
/******/ 		if (cachedModule !== undefined) {
/******/ 			return cachedModule.exports;
/******/ 		}
/******/ 		// Create a new module (and put it into the cache)
/******/ 		var module = __webpack_module_cache__[moduleId] = {
/******/ 			// no module.id needed
/******/ 			// no module.loaded needed
/******/ 			exports: {}
/******/ 		};
/******/ 	
/******/ 		// Execute the module function
/******/ 		__webpack_modules__[moduleId](module, module.exports, __webpack_require__);
/******/ 	
/******/ 		// Return the exports of the module
/******/ 		return module.exports;
/******/ 	}
/******/ 	
/************************************************************************/
/******/ 	/* webpack/runtime/define property getters */
/******/ 	!function() {
/******/ 		// define getter functions for harmony exports
/******/ 		__webpack_require__.d = function(exports, definition) {
/******/ 			for(var key in definition) {
/******/ 				if(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {
/******/ 					Object.defineProperty(exports, key, { enumerable: true, get: definition[key] });
/******/ 				}
/******/ 			}
/******/ 		};
/******/ 	}();
/******/ 	
/******/ 	/* webpack/runtime/hasOwnProperty shorthand */
/******/ 	!function() {
/******/ 		__webpack_require__.o = function(obj, prop) { return Object.prototype.hasOwnProperty.call(obj, prop); }
/******/ 	}();
/******/ 	
/******/ 	/* webpack/runtime/make namespace object */
/******/ 	!function() {
/******/ 		// define __esModule on exports
/******/ 		__webpack_require__.r = function(exports) {
/******/ 			if(typeof Symbol !== 'undefined' && Symbol.toStringTag) {
/******/ 				Object.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });
/******/ 			}
/******/ 			Object.defineProperty(exports, '__esModule', { value: true });
/******/ 		};
/******/ 	}();
/******/ 	
/************************************************************************/
/******/ 	
/******/ 	// startup
/******/ 	// Load entry module and return exports
/******/ 	// This entry module can't be inlined because the eval devtool is used.
/******/ 	var __webpack_exports__ = __webpack_require__("./src/index.js");
/******/ 	
/******/ })()
;